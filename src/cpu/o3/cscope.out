cscope 15 $HOME/Documents/phd_tools/power_gating_noc/gem5/src/cpu/o3               0000450911
	@DVFSPolicyO3Core.cc

2 
	~"DVFSPŞicyO3CÜe.h
"

4 
	~<io¡»am
>

5 
	~<f¡»am
>

7 
usšg
 
Çme¥aû
 
	g¡d
;

9 
	#PLL


10 

	)

14 şas 
	cDutyCyşeCÜes
 : 
public
 
DVFSPŞicyO3CÜe


16 
public
:

17 
	$DutyCyşeCÜes
(
Ev’tQueue
 *
ev’tq
è: 
	`DVFSPŞicyO3CÜe
Óv’tq), 
	`ev’t
(
this
),

18 #ifdeà
PLL


19 
	`¶l
(&
cÜes
,
ev’tq
),

21 
	`toggË
(0),
	`¶usduty
(0),
	`mšusduty
(0),
	`¶u¥”iod
(0),
	$mšu¥”iod
(0) {}

23 
vœtu®
 
	$addCÜeIm¶
(
Ba£CPU
* 
ıu
)

25 if(
cÜes
.
	`em±y
())

27 
if¡»am
 
	`š
("freq_core.txt");

28 if(
š
)

30 
¡ršg
 
desü
;

31 
	`g‘lše
(
š
,
desü
);

32 
š
>>
¶usduty
>>
mšusduty
>>
¶u¥”iod
>>
mšu¥”iod
;

33 
cout
<<"Period data†oaded from freq_core.txt ("

34 <<
¶usduty
<<","<<
mšusduty
<<","

35 <<
¶u¥”iod
<<","<<
mšu¥”iod
<<")"<<
’dl
;

37 if(
¶usduty
!=0 && 
mšusduty
!=0 && 
¶u¥”iod
!=0 && 
mšu¥”iod
!=0)

38 
ev’tq
->
	`scheduË
(&
ev’t
,
š™ŸlD–ay
);

39 
cout
<<"DFS…Şicy oÀCPU di§bËd iÀäeq_cÜe.txt"<<
’dl
;

41 
cÜes
.
	`addObjeù
(
ıu
);

42 
	}
}

44 
	$dvfsEv’t
()

46 
Tick
 
p
 = 
toggË
 ? 
mšu¥”iod
 : 
¶u¥”iod
;

51 #ifdeà
PLL


52 
¶l
.
	`chªgeP”iod
(
p
);

54 
cÜes
.
	`chªgeP”iod
(
p
);

56 
ev’tq
->
	`scheduË
(&
ev’t
,
	`curTick
()+(
toggË
 ? 
mšusduty
 : 
¶usduty
));

57 
toggË
^=1;

58 
	}
}

60 
	gvœtu®
 ~
	$DutyCyşeCÜes
()

63 if(
ev’t
.
	`scheduËd
()è
ev’tq
->
	`descheduË
(&event);

64 
	}
}

66 
	g´iv©e
:

67 
Ev’tW¿µ”
<
DutyCyşeCÜes
, &
	gDutyCyşeCÜes
::
dvfsEv’t
> 
ev’t
;

68 
F»qu’cyI¦ªd
 
	gcÜes
;

69 #ifdeà
PLL


70 
AdvªûdPÎMod–
 
	g¶l
;

72 
boŞ
 
	gtoggË
;

73 
Tick
 
	g¶usduty
;

74 
Tick
 
	gmšusduty
;

75 
Tick
 
	g¶u¥”iod
;

76 
Tick
 
	gmšu¥”iod
;

77 cÚ¡ 
Tick
 
	gš™ŸlD–ay
=10000ull;

85 
	gDVFSPŞicyO3CÜe
::
	$addCÜe
(
Ba£CPU
* 
cÜe
, 
Ev’tQueue
* 
ev’tq
)

87 
DutyCyşeCÜes
 
	`pŞicy
(
ev’tq
);

88 
pŞicy
.
	`addCÜeIm¶
(
cÜe
);

89 
	}
}

91 
	gDVFSPŞicyO3CÜe
::
	$DVFSPŞicyO3CÜe
(
Ev’tQueue
* 
ev’tq
è: 
	$ev’tq
(
ev’tq
è{
	}
}

93 
DVFSPŞicyO3CÜe
::
	$addCÜeIm¶
(
Ba£CPU
* 
ıu
è{
	}
}

95 
DVFSPŞicyO3CÜe
::~
	$DVFSPŞicyO3CÜe
(è{
	}
}

	@DVFSPolicyO3Core.h

2 #iâdeà
DVFSPOLICY_O3CORE_H


3 
	#DVFSPOLICY_O3CORE_H


	)

5 
	~"../ba£.hh
"

6 
	~"sim/cÜe.hh
"

12 şas 
	cDVFSPŞicyO3CÜe


14 
	mpublic
:

19 
addCÜe
(
Ba£CPU
 *
ıu
, 
Ev’tQueue
 *
ev’tq
);

24 
	m¡d
::
¡ršg
 
	$Çme
(ècÚ¡ {  
	`ty³id
(*
this
).
	`Çme
(); }

26 
vœtu®
 ~
	`DVFSPŞicyO3CÜe
();

28 
´Ùeùed
:

29 
ex¶ic™
 
	`DVFSPŞicyO3CÜe
(
Ev’tQueue
 *
ev’tq
);

31 
vœtu®
 
	`addCÜeIm¶
(
Ba£CPU
 *
ıu
);

33 
Ev’tQueue
 *
ev’tq
;

34 
	}
};

	@base_dyn_inst.cc

31 
	~"ıu/o3/ıu.hh
"

32 
	~"ıu/o3/i§_¥ecific.hh
"

33 
	~"ıu/ba£_dyn_š¡_im¶.hh
"

36 
‹m¶©e
 
şass
 
	gBa£DynIn¡
<
	gO3CPUIm¶
>;

	@bpred_unit.cc

31 
	~"ıu/o3/b´ed_un™_im¶.hh
"

32 
	~"ıu/o3/i§_¥ecific.hh
"

34 
‹m¶©e
 
şass
 
	gBP»dUn™
<
	gO3CPUIm¶
>;

	@bpred_unit.hh

43 #iâdeà
__CPU_O3_BPRED_UNIT_HH__


44 
	#__CPU_O3_BPRED_UNIT_HH__


	)

46 
	~<li¡
>

48 
	~"ba£/¡©i¡ics.hh
"

49 
	~"ba£/ty³s.hh
"

50 
	~"ıu/´ed/2b™_loÿl.hh
"

51 
	~"ıu/´ed/btb.hh
"

52 
	~"ıu/´ed/¿s.hh
"

53 
	~"ıu/´ed/touºam’t.hh
"

54 
	~"ıu/š¡_£q.hh
"

56 
	gD”ivO3CPUP¬ams
;

62 
	g‹m¶©e
<
şass
 
	gIm¶
>

63 şas 
	cBP»dUn™


65 
	m´iv©e
:

66 
ty³Çme
 
	tIm¶
::
	tDynIn¡PŒ
 DynInstPtr;

68 
	eP»dTy³
 {

69 
	mLoÿl
,

70 
	mTouºam’t


73 
P»dTy³
 
	g´ediùÜ
;

75 cÚ¡ 
	g¡d
::
¡ršg
 
_Çme
;

77 
	gpublic
:

82 
BP»dUn™
(
D”ivO3CPUP¬ams
 *
·¿ms
);

84 cÚ¡ 
	g¡d
::
¡ršg
 &
	$Çme
(ècÚ¡ {  
_Çme
; 
	}
}

89 
»gSts
();

92 
	$d¿šSª™yCheck
() const;

95 
	`keOv”From
();

105 
boŞ
 
	`´ediù
(
DynIn¡PŒ
 &
š¡
, 
TheISA
::
PCS‹
 &
pc
, 
Th»adID
 
tid
);

108 
	`BPUncÚd
(* &
bp_hi¡Üy
);

116 
	`upd©e
(cÚ¡ 
In¡SeqNum
 &
dÚe_¢
, 
Th»adID
 
tid
);

124 
	`squash
(cÚ¡ 
In¡SeqNum
 &
squashed_¢
, 
Th»adID
 
tid
);

135 
	`squash
(cÚ¡ 
In¡SeqNum
 &
squashed_¢
,

136 cÚ¡ 
TheISA
::
PCS‹
 &
cÜr_rg‘
,

137 
boŞ
 
aùu®ly_k’
, 
Th»adID
 
tid
);

143 
	`BPSquash
(*
bp_hi¡Üy
);

152 
boŞ
 
	`BPLookup
(
Addr
 
š¡PC
, * &
bp_hi¡Üy
);

162 
	`BPBTBUpd©e
(
Addr
 
š¡PC
, * &
bp_hi¡Üy
);

169 
boŞ
 
	$BTBV®id
(
Addr
 
š¡PC
)

170 {  
BTB
.
	`v®id
(
š¡PC
, 0); 
	}
}

177 
	gTheISA
::
PCS‹
 
	$BTBLookup
(
Addr
 
š¡PC
)

178 {  
BTB
.
	`lookup
(
š¡PC
, 0); 
	}
}

190 
BPUpd©e
(
Addr
 
š¡PC
, 
boŞ
 
k’
, *
bp_hi¡Üy
, boŞ 
squashed
);

197 
BTBUpd©e
(
Addr
 
š¡PC
, cÚ¡ 
TheISA
::
PCS‹
 &
rg‘
)

198 { 
BTB
.
upd©e
(
š¡PC
, 
rg‘
, 0); }

200 
dump
();

202 
	g´iv©e
:

203 
	sP»diùÜHi¡Üy
 {

208 
P»diùÜHi¡Üy
(cÚ¡ 
In¡SeqNum
 &
£q_num
, 
Addr
 
š¡PC
,

209 
boŞ
 
´ed_k’
, *
bp_hi¡Üy
,

210 
Th»adID
 
_tid
)

211 : 
£qNum
(
£q_num
), 
pc
(
š¡PC
), 
bpHi¡Üy
(
bp_hi¡Üy
), 
RAST¬g‘
(0),

212 
RASIndex
(0), 
tid
(
_tid
), 
´edTak’
(
´ed_k’
), 
u£dRAS
(0), 
pushedRAS
(0),

213 
wasC®l
(0), 
wasR‘uº
(0), 
v®idBTB
(0)

216 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
P»diùÜHi¡Üy
 &
’Œy
) const {

217  
this
->
£qNum
 =ğ
’Œy
.seqNum;

221 
In¡SeqNum
 
	g£qNum
;

224 
Addr
 
	gpc
;

230 *
	gbpHi¡Üy
;

233 
	gTheISA
::
PCS‹
 
RAST¬g‘
;

236 
	gRASIndex
;

239 
Th»adID
 
	gtid
;

242 
boŞ
 
	g´edTak’
;

245 
boŞ
 
	gu£dRAS
;

248 
boŞ
 
	gpushedRAS
;

251 
boŞ
 
	gwasC®l
;

254 
boŞ
 
	gwasR‘uº
;

256 
boŞ
 
	gv®idBTB
;

259 
	g¡d
::
	tli¡
<
	tP»diùÜHi¡Üy
> 
	tHi¡Üy
;

260 
ty³Çme
 
	tHi¡Üy
::
	t™”©Ü
 
	tHi¡ÜyIt
;

267 
Hi¡Üy
 
	g´edHi¡
[
Im¶
::
MaxTh»ads
];

270 
LoÿlBP
 *
	gloÿlBP
;

273 
Touºam’tBP
 *
	gtouºam’tBP
;

276 
DeçuÉBTB
 
	gBTB
;

279 
R‘uºAddrSck
 
	gRAS
[
Im¶
::
MaxTh»ads
];

282 
	gSts
::
SÿÏr
 
lookups
;

284 
	gSts
::
SÿÏr
 
cÚdP»diùed
;

286 
	gSts
::
SÿÏr
 
cÚdIncÜ»ù
;

288 
	gSts
::
SÿÏr
 
BTBLookups
;

290 
	gSts
::
SÿÏr
 
BTBH™s
;

292 
	gSts
::
SÿÏr
 
BTBCÜ»ù
;

294 
	gSts
::
SÿÏr
 
u£dRAS
;

296 
	gSts
::
SÿÏr
 
RASIncÜ»ù
;

	@bpred_unit_impl.hh

43 
	~<®gÜ™hm
>

45 
	~"¬ch/i§_Œa™s.hh
"

46 
	~"¬ch/ty³s.hh
"

47 
	~"¬ch/ut™y.hh
"

48 
	~"ba£/Œaû.hh
"

49 
	~"cÚfig/the_i§.hh
"

50 
	~"ıu/o3/b´ed_un™.hh
"

51 
	~"debug/F‘ch.hh
"

52 
	~"·¿ms/D”ivO3CPU.hh
"

54 
	g‹m¶©e
<
şass
 
	gIm¶
>

55 
	gBP»dUn™
<
	gIm¶
>::
	$BP»dUn™
(
D”ivO3CPUP¬ams
 *
·¿ms
)

56 : 
	`_Çme
(
·¿ms
->
Çme
 + ".BPredUnit"),

57 
	`BTB
(
·¿ms
->
BTBEÁr›s
,

58 
·¿ms
->
BTBTagSize
,

59 
·¿ms
->
š¡ShiáAmt
)

62 ià(
·¿ms
->
´edTy³
 == "local") {

63 
loÿlBP
 = 
Ãw
 
	`LoÿlBP
(
·¿ms
->
loÿlP»diùÜSize
,

64 
·¿ms
->
loÿlCŒB™s
,

65 
·¿ms
->
š¡ShiáAmt
);

66 
´ediùÜ
 = 
Loÿl
;

67 } ià(
·¿ms
->
´edTy³
 == "tournament") {

68 
touºam’tBP
 = 
Ãw
 
	`Touºam’tBP
(
·¿ms
->
loÿlCŒB™s
,

69 
·¿ms
->
loÿlHi¡ÜyTabËSize
,

70 
·¿ms
->
loÿlHi¡ÜyB™s
,

71 
·¿ms
->
glob®P»diùÜSize
,

72 
·¿ms
->
glob®Hi¡ÜyB™s
,

73 
·¿ms
->
glob®CŒB™s
,

74 
·¿ms
->
choiûP»diùÜSize
,

75 
·¿ms
->
choiûCŒB™s
,

76 
·¿ms
->
š¡ShiáAmt
);

77 
´ediùÜ
 = 
Touºam’t
;

79 
	`çl
("Invalid BP selected!");

82 
i
=0; i < 
Im¶
::
MaxTh»ads
; i++)

83 
RAS
[
i
].
	`š™
(
·¿ms
->
RASSize
);

84 
	}
}

86 
	g‹m¶©e
 <
şass
 
	gIm¶
>

88 
	gBP»dUn™
<
	gIm¶
>::
	$»gSts
()

90 
lookups


91 .
	`Çme
(name() + ".lookups")

92 .
	`desc
("Number of BP†ookups")

95 
cÚdP»diùed


96 .
	`Çme
(name() + ".condPredicted")

97 .
	`desc
("Number of conditional branches…redicted")

100 
cÚdIncÜ»ù


101 .
	`Çme
(name() + ".condIncorrect")

102 .
	`desc
("Number of conditional branches incorrect")

105 
BTBLookups


106 .
	`Çme
(name() + ".BTBLookups")

107 .
	`desc
("Number of BTB†ookups")

110 
BTBH™s


111 .
	`Çme
(name() + ".BTBHits")

112 .
	`desc
("Number of BTB hits")

115 
BTBCÜ»ù


116 .
	`Çme
(name() + ".BTBCorrect")

117 .
	`desc
("Number of correct BTB…redictions (this stat may‚ot "

121 
u£dRAS


122 .
	`Çme
(name() + ".usedRAS")

123 .
	`desc
("Number ofimeshe RAS was usedo get‡arget.")

126 
RASIncÜ»ù


127 .
	`Çme
(name() + ".RASInCorrect")

128 .
	`desc
("Number of incorrect RAS…redictions.")

130 
	}
}

132 
	g‹m¶©e
 <
şass
 
	gIm¶
>

134 
	gBP»dUn™
<
	gIm¶
>::
	$d¿šSª™yCheck
() const

138 
i
 = 0; i < 
Im¶
::
MaxTh»ads
; ++i)

139 
	`as£¹
(
´edHi¡
[
i
].
	`em±y
());

140 
	}
}

142 
	g‹m¶©e
 <
şass
 
	gIm¶
>

144 
	gBP»dUn™
<
	gIm¶
>::
	$keOv”From
()

155 
	}
}

157 
‹m¶©e
 <
şass
 
Im¶
>

158 
boŞ


159 
BP»dUn™
<
Im¶
>::
´ediù
(
DynIn¡PŒ
 &
š¡
, 
TheISA
::
PCS‹
 &
pc
, 
Th»adID
 
tid
)

166 
boŞ
 
	g´ed_k’
 = 
çl£
;

167 
	gTheISA
::
PCS‹
 
rg‘
 = 
pc
;

169 ++
	glookups
;

171 *
	gbp_hi¡Üy
 = 
NULL
;

173 ià(
	gš¡
->
isUncÚdCŒl
()) {

174 
DPRINTF
(
F‘ch
, "B¿nchP»d: [tid:%i]: UncÚd™iÚ® cÚŒŞ.\n", 
tid
);

175 
	g´ed_k’
 = 
Œue
;

177 
BPUncÚd
(
bp_hi¡Üy
);

179 ++
	gcÚdP»diùed
;

180 
	g´ed_k’
 = 
BPLookup
(
pc
.
š¡Addr
(), 
bp_hi¡Üy
);

182 
DPRINTF
(
F‘ch
, "BranchPred:[tid:%i]: [sn:%i] Branch…redictor"

184 
tid
, 
š¡
->
£qNum
, 
´ed_k’
, in¡->
pcS‹
());

187 
DPRINTF
(
F‘ch
, "BranchPred: [tid:%i]: [sn:%i] Creating…rediction history "

189 
tid
, 
š¡
->
£qNum
, in¡->
pcS‹
());

191 
P»diùÜHi¡Üy
 
´ediù_»cÜd
(
š¡
->
£qNum
, 
pc
.
š¡Addr
(),

192 
´ed_k’
, 
bp_hi¡Üy
, 
tid
);

195 ià(
	g´ed_k’
) {

196 ià(
	gš¡
->
isR‘uº
()) {

197 ++
	gu£dRAS
;

198 
	g´ediù_»cÜd
.
	gwasR‘uº
 = 
Œue
;

201 
	gTheISA
::
PCS‹
 
¿sTİ
 = 
RAS
[
tid
].
tİ
();

202 
	grg‘
 = 
TheISA
::
budR‘PC
(
pc
, 
¿sTİ
);

205 
	g´ediù_»cÜd
.
	gu£dRAS
 = 
Œue
;

206 
	g´ediù_»cÜd
.
	gRASIndex
 = 
RAS
[
tid
].
tİIdx
();

207 
	g´ediù_»cÜd
.
	gRAST¬g‘
 = 
¿sTİ
;

209 
	gRAS
[
tid
].
pİ
();

211 
DPRINTF
(
F‘ch
, "BranchPred: [tid:%i]: Instruction %s is‡„eturn, "

213 
tid
, 
š¡
->
pcS‹
(), 
rg‘
, 
´ediù_»cÜd
.
RASIndex
);

215 ++
	gBTBLookups
;

217 ià(
	gš¡
->
isC®l
()) {

218 
	gRAS
[
tid
].
push
(
pc
);

219 
	g´ediù_»cÜd
.
	gpushedRAS
 = 
Œue
;

222 
	g´ediù_»cÜd
.
	gwasC®l
 = 
Œue
;

224 
DPRINTF
(
F‘ch
, "BranchPred: [tid:%i]: Instruction %s was‡ "

226 
tid
, 
š¡
->
pcS‹
(), 
pc
, 
RAS
[tid].
tİIdx
());

229 ià(
	gBTB
.
v®id
(
pc
.
š¡Addr
(), 
tid
)) {

230 ++
	gBTBH™s
;

231 
	g´ediù_»cÜd
.
	gv®idBTB
 = 
Œue
;

234 
	grg‘
 = 
BTB
.
lookup
(
pc
.
š¡Addr
(), 
tid
);

236 
DPRINTF
(
F‘ch
, "BranchPred: [tid:%i]: Instruction %s…redicted"

237 "¬g‘ i %s.\n", 
tid
, 
š¡
->
pcS‹
(), 
rg‘
);

240 
DPRINTF
(
F‘ch
, "BranchPred: [tid:%i]: BTB doesn't have‡ "

241 "v®idƒÁry.\n",
tid
);

242 
	g´ed_k’
 = 
çl£
;

246 ià(!
	gš¡
->
isC®l
(è&& !š¡->
isR‘uº
()) {

247 
BPBTBUpd©e
(
pc
.
š¡Addr
(), 
bp_hi¡Üy
);

248 
DPRINTF
(
F‘ch
, "BranchPred: [tid:%i]:[sn:%i] BPBTBUpdate"

250 
tid
, 
š¡
->
£qNum
, in¡->
pcS‹
());

251 } ià(
	gš¡
->
isC®l
(è&& !š¡->
isUncÚdCŒl
()) {

252 
	gRAS
[
tid
].
pİ
();

253 
	g´ediù_»cÜd
.
	gpushedRAS
 = 
çl£
;

255 
	gTheISA
::
advªûPC
(
rg‘
, 
š¡
->
¡©icIn¡
);

260 ià(
	gš¡
->
isR‘uº
()) {

261 
	g´ediù_»cÜd
.
	gwasR‘uº
 = 
Œue
;

263 
	gTheISA
::
advªûPC
(
rg‘
, 
š¡
->
¡©icIn¡
);

266 
	gpc
 = 
rg‘
;

268 
	g´edHi¡
[
tid
].
push_äÚt
(
´ediù_»cÜd
);

270 
DPRINTF
(
F‘ch
, "BranchPred: [tid:%i]: [sn:%i]: Historyƒntry‡dded."

271 "´edHi¡.size(): %i\n", 
tid
, 
š¡
->
£qNum
, 
´edHi¡
[tid].
size
());

273  
	g´ed_k’
;

276 
	g‹m¶©e
 <
şass
 
	gIm¶
>

278 
	gBP»dUn™
<
	gIm¶
>::
	$upd©e
(cÚ¡ 
In¡SeqNum
 &
dÚe_¢
, 
Th»adID
 
tid
)

280 
	`DPRINTF
(
F‘ch
, "BranchPred: [tid:%i]: Committing branches until "

281 "[¢:%Îi].\n", 
tid
, 
dÚe_¢
);

283 !
´edHi¡
[
tid
].
	`em±y
() &&

284 
´edHi¡
[
tid
].
	`back
().
£qNum
 <ğ
dÚe_¢
) {

286 
	`BPUpd©e
(
´edHi¡
[
tid
].
	`back
().
pc
,

287 
´edHi¡
[
tid
].
	`back
().
´edTak’
,

288 
´edHi¡
[
tid
].
	`back
().
bpHi¡Üy
, 
çl£
);

290 
´edHi¡
[
tid
].
	`pİ_back
();

292 
	}
}

294 
	g‹m¶©e
 <
şass
 
	gIm¶
>

296 
	gBP»dUn™
<
	gIm¶
>::
	$squash
(cÚ¡ 
In¡SeqNum
 &
squashed_¢
, 
Th»adID
 
tid
)

298 
Hi¡Üy
 &
´ed_hi¡
 = 
´edHi¡
[
tid
];

300 !
´ed_hi¡
.
	`em±y
() &&

301 
´ed_hi¡
.
	`äÚt
().
£qNum
 > 
squashed_¢
) {

302 ià(
´ed_hi¡
.
	`äÚt
().
u£dRAS
) {

303 
	`DPRINTF
(
F‘ch
, "BranchPred: [tid:%i]: Restoringop of RASo: %i,"

304 "¬g‘: %s.\n", 
tid
,

305 
´ed_hi¡
.
	`äÚt
().
RASIndex
,…»d_hi¡.äÚt().
RAST¬g‘
);

307 
RAS
[
tid
].
	`»¡Üe
(
´ed_hi¡
.
	`äÚt
().
RASIndex
,

308 
´ed_hi¡
.
	`äÚt
().
RAST¬g‘
);

309 } if(
´ed_hi¡
.
	`äÚt
().
wasC®l
 &&…»d_hi¡.äÚt().
pushedRAS
) {

311 
	`DPRINTF
(
F‘ch
, "BranchPred: [tid: %i] Squashing"

312 " C®È[¢:%i] PC: % Pİpšg RAS\n", 
tid
,

313 
´ed_hi¡
.
	`äÚt
().
£qNum
,…»d_hi¡.äÚt().
pc
);

314 
RAS
[
tid
].
	`pİ
();

318 
	`BPSquash
(
´ed_hi¡
.
	`äÚt
().
bpHi¡Üy
);

320 
	`DPRINTF
(
F‘ch
, "BranchPred: [tid:%i]: Removing history for [sn:%i] "

321 "PC %s.\n", 
tid
, 
´ed_hi¡
.
	`äÚt
().
£qNum
,

322 
´ed_hi¡
.
	`äÚt
().
pc
);

324 
´ed_hi¡
.
	`pİ_äÚt
();

326 
	`DPRINTF
(
F‘ch
, "[tid:%i]:…redHist.size(): %i\n",

327 
tid
, 
´edHi¡
[tid].
	`size
());

330 
	}
}

332 
	g‹m¶©e
 <
şass
 
	gIm¶
>

334 
	gBP»dUn™
<
	gIm¶
>::
squash
(cÚ¡ 
In¡SeqNum
 &
squashed_¢
,

335 cÚ¡ 
TheISA
::
PCS‹
 &
cÜrT¬g‘
,

336 
boŞ
 
aùu®ly_k’
,

337 
Th»adID
 
tid
)

350 
	gHi¡Üy
 &
	g´ed_hi¡
 = 
´edHi¡
[
tid
];

352 ++
	gcÚdIncÜ»ù
;

354 
DPRINTF
(
F‘ch
, "BranchPred: [tid:%i]: Squashing from sequence‚umber %i, "

356 
tid
, 
squashed_¢
, 
cÜrT¬g‘
);

359 
squash
(
squashed_¢
, 
tid
);

364 ià(!
	g´ed_hi¡
.
em±y
()) {

366 
Hi¡ÜyIt
 
	ghi¡_™
 = 
´ed_hi¡
.
begš
();

371 ià(
	g´ed_hi¡
.
äÚt
().
	g£qNum
 !ğ
squashed_¢
) {

372 
DPRINTF
(
F‘ch
, "Front sn %i != Squash sn %i\n",

373 
´ed_hi¡
.
äÚt
().
£qNum
, 
squashed_¢
);

375 
as£¹
(
´ed_hi¡
.
äÚt
().
£qNum
 =ğ
squashed_¢
);

379 ià((*
	ghi¡_™
).
	gu£dRAS
) {

380 ++
	gRASIncÜ»ù
;

383 
BPUpd©e
((*
hi¡_™
).
pc
, 
aùu®ly_k’
,

384 
´ed_hi¡
.
äÚt
().
bpHi¡Üy
, 
Œue
);

385 ià(
	gaùu®ly_k’
) {

386 ià(
	ghi¡_™
->
	gwasR‘uº
 && !hi¡_™->
	gu£dRAS
) {

387 
DPRINTF
(
F‘ch
, "BranchPred: [tid: %i] Incorrectly…redicted"

388 "„‘uº [¢:%i] PC: %s\n", 
tid
, 
hi¡_™
->
£qNum
,

389 
hi¡_™
->
pc
);

390 
	gRAS
[
tid
].
pİ
();

392 
DPRINTF
(
F‘ch
,"BranchPred: [tid: %i] BTB Update called for [sn:%i]"

393 " PC: %s\n", 
tid
,
hi¡_™
->
£qNum
, hi¡_™->
pc
);

396 
	gBTB
.
upd©e
((*
hi¡_™
).
pc
, 
cÜrT¬g‘
, 
tid
);

400 ià(
	ghi¡_™
->
	gu£dRAS
) {

401 
DPRINTF
(
F‘ch
,"BranchPred: [tid: %i] Incorrectly…redicted"

402 "„‘uº [¢:%i] PC: % Re¡Üšg RAS\n", 
tid
,

403 
hi¡_™
->
£qNum
, hi¡_™->
pc
);

404 
DPRINTF
(
F‘ch
, "BranchPred: [tid:%i]: Restoringop of RAS"

405 "o: %i,¬g‘: %s.\n", 
tid
,

406 
hi¡_™
->
RASIndex
, hi¡_™->
RAST¬g‘
);

407 
	gRAS
[
tid
].
»¡Üe
(
hi¡_™
->
RASIndex
, hi¡_™->
RAST¬g‘
);

409 } ià(
	ghi¡_™
->
	gwasC®l
 && hi¡_™->
	gpushedRAS
) {

411 
DPRINTF
(
F‘ch
, "BranchPred: [tid: %i] Incorrectly…redicted"

412 " C®È[¢:%i] PC: % Pİpšg RAS\n", 
tid
,

413 
hi¡_™
->
£qNum
, hi¡_™->
pc
);

414 
	gRAS
[
tid
].
pİ
();

417 
DPRINTF
(
F‘ch
, "BranchPred: [tid:%i]: Removing history for [sn:%i]"

418 " PC %  Aùu®ly Tak’: %i\n", 
tid
, 
hi¡_™
->
£qNum
,

419 
hi¡_™
->
pc
, 
aùu®ly_k’
);

421 
	g´ed_hi¡
.
”a£
(
hi¡_™
);

423 
DPRINTF
(
F‘ch
, "[tid:%i]:…»dHi¡.size(): %i\n", 
tid
,

424 
´edHi¡
[
tid
].
size
());

428 
	g‹m¶©e
 <
şass
 
	gIm¶
>

430 
	gBP»dUn™
<
	gIm¶
>::
	$BPUncÚd
(* &
bp_hi¡Üy
)

433 ià(
´ediùÜ
 =ğ
Touºam’t
) {

434 
touºam’tBP
->
	`uncÚdBr
(
bp_hi¡Üy
);

436 
	}
}

438 
	g‹m¶©e
 <
şass
 
	gIm¶
>

440 
	gBP»dUn™
<
	gIm¶
>::
	$BPSquash
(*
bp_hi¡Üy
)

442 ià(
´ediùÜ
 =ğ
Loÿl
) {

443 
loÿlBP
->
	`squash
(
bp_hi¡Üy
);

444 } ià(
´ediùÜ
 =ğ
Touºam’t
) {

445 
touºam’tBP
->
	`squash
(
bp_hi¡Üy
);

447 
	`·nic
("Predictorype is unexpected value!");

449 
	}
}

451 
	g‹m¶©e
 <
şass
 
	gIm¶
>

452 
boŞ


453 
	gBP»dUn™
<
	gIm¶
>::
	$BPLookup
(
Addr
 
š¡PC
, * &
bp_hi¡Üy
)

455 ià(
´ediùÜ
 =ğ
Loÿl
) {

456  
loÿlBP
->
	`lookup
(
š¡PC
, 
bp_hi¡Üy
);

457 } ià(
´ediùÜ
 =ğ
Touºam’t
) {

458  
touºam’tBP
->
	`lookup
(
š¡PC
, 
bp_hi¡Üy
);

460 
	`·nic
("Predictorype is unexpected value!");

462 
	}
}

464 
	g‹m¶©e
 <
şass
 
	gIm¶
>

466 
	gBP»dUn™
<
	gIm¶
>::
	$BPBTBUpd©e
(
Addr
 
š¡PC
, * &
bp_hi¡Üy
)

468 ià(
´ediùÜ
 =ğ
Loÿl
) {

469  
loÿlBP
->
	`BTBUpd©e
(
š¡PC
, 
bp_hi¡Üy
);

470 } ià(
´ediùÜ
 =ğ
Touºam’t
) {

471  
touºam’tBP
->
	`BTBUpd©e
(
š¡PC
, 
bp_hi¡Üy
);

473 
	`·nic
("Predictorype is unexpected value!");

475 
	}
}

477 
	g‹m¶©e
 <
şass
 
	gIm¶
>

479 
	gBP»dUn™
<
	gIm¶
>::
	$BPUpd©e
(
Addr
 
š¡PC
, 
boŞ
 
k’
, *
bp_hi¡Üy
,

480 
boŞ
 
squashed
)

482 ià(
´ediùÜ
 =ğ
Loÿl
) {

483 
loÿlBP
->
	`upd©e
(
š¡PC
, 
k’
, 
bp_hi¡Üy
);

484 } ià(
´ediùÜ
 =ğ
Touºam’t
) {

485 
touºam’tBP
->
	`upd©e
(
š¡PC
, 
k’
, 
bp_hi¡Üy
, 
squashed
);

487 
	`·nic
("Predictorype is unexpected value!");

489 
	}
}

491 
	g‹m¶©e
 <
şass
 
	gIm¶
>

493 
	gBP»dUn™
<
	gIm¶
>::
	$dump
()

495 
Hi¡ÜyIt
 
´ed_hi¡_™
;

497 
i
 = 0; i < 
Im¶
::
MaxTh»ads
; ++i) {

498 ià(!
´edHi¡
[
i
].
	`em±y
()) {

499 
´ed_hi¡_™
 = 
´edHi¡
[
i
].
	`begš
();

501 
	`ırštf
("´edHi¡[%i].size(): %i\n", 
i
, 
´edHi¡
[i].
	`size
());

503 
´ed_hi¡_™
 !ğ
´edHi¡
[
i
].
	`’d
()) {

504 
	`ırštf
("[sn:%lli], PC:%#x,id:%i,…redTaken:%i, "

506 
´ed_hi¡_™
->
£qNum
,…»d_hi¡_™->
pc
,

507 
´ed_hi¡_™
->
tid
,…»d_hi¡_™->
´edTak’
,

508 
´ed_hi¡_™
->
bpHi¡Üy
);

509 
´ed_hi¡_™
++;

512 
	`ırštf
("\n");

515 
	}
}

	@checker.cc

43 
	~"ıu/check”/ıu_im¶.hh
"

44 
	~"ıu/o3/check”.hh
"

45 
	~"·¿ms/O3Check”.hh
"

47 
şass
 
	gMemObjeù
;

49 
‹m¶©e


50 
şass
 
	gCheck”
<
	gO3CPUIm¶
>;

56 
O3Check”
 *

57 
	gO3Check”P¬ams
::
	$ü—‹
()

59 
O3Check”
::
P¬ams
 *
·¿ms
 = 
Ãw
 O3Check”::
	`P¬ams
();

60 
·¿ms
->
Çme
 =‚ame;

61 
·¿ms
->
numTh»ads
 =‚umThreads;

62 
·¿ms
->
max_š¡s_ªy_th»ad
 = 0;

63 
·¿ms
->
max_š¡s_®l_th»ads
 = 0;

64 
·¿ms
->
max_lßds_ªy_th»ad
 = 0;

65 
·¿ms
->
max_lßds_®l_th»ads
 = 0;

66 
·¿ms
->
ex™OnE¼Ü
 =ƒxitOnError;

67 
·¿ms
->
upd©eOnE¼Ü
 = updateOnError;

68 
·¿ms
->
w¬nOÆyOnLßdE¼Ü
 = warnOnlyOnLoadError;

69 
·¿ms
->
şock
 = clock;

70 
·¿ms
->
Œaûr
 =racer;

73 
CouÁ”
 
‹mp
;

74 
‹mp
 = 
max_š¡s_ªy_th»ad
;

75 
‹mp
 = 
max_š¡s_®l_th»ads
;

76 
‹mp
 = 
max_lßds_ªy_th»ad
;

77 
‹mp
 = 
max_lßds_®l_th»ads
;

78 
‹mp
++;

79 
Tick
 
‹mp2
 = 
´og»ss_š‹rv®
;

80 
·¿ms
->
´og»ss_š‹rv®
 = 0;

81 
‹mp2
++;

83 
·¿ms
->
™b
 = itb;

84 
·¿ms
->
dtb
 = dtb;

85 
·¿ms
->
i§
 = isa;

86 
·¿ms
->
sy¡em
 = system;

87 
·¿ms
->
ıu_id
 = cpu_id;

88 
·¿ms
->
´ofe
 =…rofile;

89 
·¿ms
->
š‹¼u±s
 = 
NULL
;

90 
·¿ms
->
wÜklßd
 = workload;

92 
O3Check”
 *
ıu
 = 
Ãw
 
	`O3Check”
(
·¿ms
);

93  
ıu
;

94 
	}
}

	@checker.hh

43 #iâdeà
__CPU_O3_CHECKER_HH__


44 
	#__CPU_O3_CHECKER_HH__


	)

46 
	~"ıu/check”/ıu.hh
"

47 
	~"ıu/o3/dyn_š¡.hh
"

48 
	~"ıu/o3/im¶.hh
"

53 
şass
 
	gO3Check”
 : 
public
 
Check”
<
O3CPUIm¶
>

55 
public
:

56 
O3Check”
(
P¬ams
 *
p
)

57 : 
Check”
<
O3CPUIm¶
>(
p
)

	@comm.hh

43 #iâdeà
__CPU_O3_COMM_HH__


44 
	#__CPU_O3_COMM_HH__


	)

46 
	~<veùÜ
>

48 
	~"¬ch/ty³s.hh
"

49 
	~"ba£/ty³s.hh
"

50 
	~"ıu/š¡_£q.hh
"

51 
	~"sim/çuÉs.hh
"

56 
	tPhysRegIndex
;

59 
	g‹m¶©e
<
şass
 
	gIm¶
>

60 
	sDeçuÉF‘chDeçuÉDecode
 {

61 
ty³Çme
 
	tIm¶
::
	tDynIn¡PŒ
 DynInstPtr;

63 
	msize
;

65 
DynIn¡PŒ
 
	mš¡s
[
Im¶
::
MaxWidth
];

66 
FauÉ
 
	mãtchFauÉ
;

67 
In¡SeqNum
 
	mãtchFauÉSN
;

68 
boŞ
 
	mş—rF‘chFauÉ
;

72 
	g‹m¶©e
<
şass
 
	gIm¶
>

73 
	sDeçuÉDecodeDeçuÉR’ame
 {

74 
ty³Çme
 
	tIm¶
::
	tDynIn¡PŒ
 DynInstPtr;

76 
	msize
;

78 
DynIn¡PŒ
 
	mš¡s
[
Im¶
::
MaxWidth
];

82 
	g‹m¶©e
<
şass
 
	gIm¶
>

83 
	sDeçuÉR’ameDeçuÉIEW
 {

84 
ty³Çme
 
	tIm¶
::
	tDynIn¡PŒ
 DynInstPtr;

86 
	msize
;

88 
DynIn¡PŒ
 
	mš¡s
[
Im¶
::
MaxWidth
];

92 
	g‹m¶©e
<
şass
 
	gIm¶
>

93 
	sDeçuÉIEWDeçuÉComm™
 {

94 
ty³Çme
 
	tIm¶
::
	tDynIn¡PŒ
 DynInstPtr;

96 
	msize
;

98 
DynIn¡PŒ
 
	mš¡s
[
Im¶
::
MaxWidth
];

99 
DynIn¡PŒ
 
	mmi¥»diùIn¡
[
Im¶
::
MaxTh»ads
];

100 
Addr
 
	mmi¥»dPC
[
Im¶
::
MaxTh»ads
];

101 
In¡SeqNum
 
	msquashedSeqNum
[
Im¶
::
MaxTh»ads
];

102 
	mTheISA
::
PCS‹
 
pc
[
Im¶
::
MaxTh»ads
];

104 
boŞ
 
	msquash
[
Im¶
::
MaxTh»ads
];

105 
boŞ
 
	mb¿nchMi¥»diù
[
Im¶
::
MaxTh»ads
];

106 
boŞ
 
	mb¿nchTak’
[
Im¶
::
MaxTh»ads
];

107 
boŞ
 
	mšşudeSquashIn¡
[
Im¶
::
MaxTh»ads
];

110 
	g‹m¶©e
<
şass
 
	gIm¶
>

111 
	sIssueSŒuù
 {

112 
ty³Çme
 
	tIm¶
::
	tDynIn¡PŒ
 DynInstPtr;

114 
	msize
;

116 
DynIn¡PŒ
 
	mš¡s
[
Im¶
::
MaxWidth
];

120 
	g‹m¶©e
<
şass
 
	gIm¶
>

121 
	sTimeBufSŒuù
 {

122 
ty³Çme
 
	tIm¶
::
	tDynIn¡PŒ
 DynInstPtr;

123 
	sdecodeComm
 {

124 
	mTheISA
::
PCS‹
 
ÃxtPC
;

125 
DynIn¡PŒ
 
	mmi¥»diùIn¡
;

126 
DynIn¡PŒ
 
	msquashIn¡
;

127 
In¡SeqNum
 
	mdÚeSeqNum
;

128 
Addr
 
	mmi¥»dPC
;

129 
ušt64_t
 
	mb¿nchAddr
;

130 
	mb¿nchCouÁ
;

131 
boŞ
 
	msquash
;

132 
boŞ
 
	m´edIncÜ»ù
;

133 
boŞ
 
	mb¿nchMi¥»diù
;

134 
boŞ
 
	mb¿nchTak’
;

137 
decodeComm
 
	mdecodeInfo
[
Im¶
::
MaxTh»ads
];

139 
	s»ÇmeComm
 {

142 
»ÇmeComm
 
	m»ÇmeInfo
[
Im¶
::
MaxTh»ads
];

144 
	s›wComm
 {

146 
	mä“IQEÁr›s
;

147 
	mä“LSQEÁr›s
;

149 
	miqCouÁ
;

150 
	mld¡qCouÁ
;

152 
	mdi¥©ched
;

153 
	mdi¥©chedToLSQ
;

154 
boŞ
 
	mu£dIQ
;

155 
boŞ
 
	mu£dLSQ
;

158 
›wComm
 
	m›wInfo
[
Im¶
::
MaxTh»ads
];

160 
	scomm™Comm
 {

176 
	mTheISA
::
PCS‹
 
pc
;

180 
DynIn¡PŒ
 
	mmi¥»diùIn¡
;

183 
DynIn¡PŒ
 
	msquashIn¡
;

186 
DynIn¡PŒ
 
	munÿchedLßd
;

190 
In¡SeqNum
 
	mnÚS³cSeqNum
;

195 
In¡SeqNum
 
	mdÚeSeqNum
;

198 
	mä“ROBEÁr›s
;

200 
boŞ
 
	msquash
;

201 
boŞ
 
	mrobSquashšg
;

204 
boŞ
 
	mu£dROB
;

207 
boŞ
 
	mem±yROB
;

210 
boŞ
 
	mb¿nchTak’
;

212 
boŞ
 
	mš‹¼u±P’dšg
;

214 
boŞ
 
	mş—rIÁ”ru±
;

217 
boŞ
 
	munÿched
;

221 
comm™Comm
 
	mcomm™Info
[
Im¶
::
MaxTh»ads
];

223 
boŞ
 
	mdecodeBlock
[
Im¶
::
MaxTh»ads
];

224 
boŞ
 
	mdecodeUnblock
[
Im¶
::
MaxTh»ads
];

225 
boŞ
 
	m»ÇmeBlock
[
Im¶
::
MaxTh»ads
];

226 
boŞ
 
	m»ÇmeUnblock
[
Im¶
::
MaxTh»ads
];

227 
boŞ
 
	m›wBlock
[
Im¶
::
MaxTh»ads
];

228 
boŞ
 
	m›wUnblock
[
Im¶
::
MaxTh»ads
];

229 
boŞ
 
	mcomm™Block
[
Im¶
::
MaxTh»ads
];

230 
boŞ
 
	mcomm™Unblock
[
Im¶
::
MaxTh»ads
];

	@commit.cc

31 
	~"ıu/o3/comm™_im¶.hh
"

32 
	~"ıu/o3/i§_¥ecific.hh
"

34 
‹m¶©e
 
şass
 
	gDeçuÉComm™
<
	gO3CPUIm¶
>;

	@commit.hh

44 #iâdeà
__CPU_O3_COMMIT_HH__


45 
	#__CPU_O3_COMMIT_HH__


	)

47 
	~<queue
>

49 
	~"ba£/¡©i¡ics.hh
"

50 
	~"ıu/ex‘¿û.hh
"

51 
	~"ıu/š¡_£q.hh
"

52 
	~"ıu/timebuf.hh
"

54 
	gD”ivO3CPUP¬ams
;

56 
	g‹m¶©e
 <
	gşass
>

57 
	gO3Th»adS‹
;

81 
	g‹m¶©e
<
şass
 
	gIm¶
>

82 şas 
	cDeçuÉComm™


84 
	mpublic
:

86 
ty³Çme
 
	tIm¶
::
	tO3CPU
 O3CPU;

87 
ty³Çme
 
	tIm¶
::
	tDynIn¡PŒ
 DynInstPtr;

88 
ty³Çme
 
	tIm¶
::
	tCPUPŞ
 CPUPol;

90 
ty³Çme
 
	tCPUPŞ
::
	tR’ameM­
 RenameMap;

91 
ty³Çme
 
	tCPUPŞ
::
	tROB
 ROB;

93 
ty³Çme
 
	tCPUPŞ
::
	tTimeSŒuù
 TimeStruct;

94 
ty³Çme
 
	tCPUPŞ
::
	tF‘chSŒuù
 FetchStruct;

95 
ty³Çme
 
	tCPUPŞ
::
	tIEWSŒuù
 IEWStruct;

96 
ty³Çme
 
	tCPUPŞ
::
	tR’ameSŒuù
 RenameStruct;

98 
ty³Çme
 
	tCPUPŞ
::
	tF‘ch
 Fetch;

99 
ty³Çme
 
	tCPUPŞ
::
	tIEW
 IEW;

101 
	mO3Th»adS‹
<
	tIm¶
> 
	tTh»ad
;

106 şas 
	cT¿pEv’t
 : 
public
 
Ev’t
 {

107 
´iv©e
:

108 
DeçuÉComm™
<
Im¶
> *
comm™
;

109 
Th»adID
 
	mtid
;

111 
	mpublic
:

112 
T¿pEv’t
(
DeçuÉComm™
<
Im¶
> *
_comm™
, 
Th»adID
 
_tid
);

114 
´oûss
();

116 
vœtu®
 
	m¡d
::
¡ršg
 
g‘ObjeùId
() const

118  
comm™
->
ıu
->
g‘ObjeùId
();

121 cÚ¡ *
desütiÚ
() const;

127 
	eComm™Stus
{

128 
	gAùive
,

129 
	gIÇùive


133 
	eTh»adStus
 {

134 
	gRuÂšg
,

135 
	gIdË
,

136 
	gROBSquashšg
,

137 
	gT¿pP’dšg
,

138 
	gF‘chT¿pP’dšg
,

139 
	gSquashAá”P’dšg
,

143 
	eComm™PŞicy
 {

144 
	gAgg»ssive
,

145 
	gRoundRobš
,

146 
	gOlde¡R—dy


149 
	g´iv©e
:

151 
Comm™Stus
 
_¡©us
;

153 
Comm™Stus
 
	g_ÃxtStus
;

155 
Th»adStus
 
	gcomm™Stus
[
Im¶
::
MaxTh»ads
];

157 
Comm™PŞicy
 
	gcomm™PŞicy
;

159 
	gpublic
:

161 
DeçuÉComm™
(
O3CPU
 *
_ıu
, 
D”ivO3CPUP¬ams
 *
·¿ms
);

164 
	g¡d
::
¡ršg
 
	$Çme
() const;

167 
	`»gSts
();

170 
	`£tTh»ads
(
¡d
::
veùÜ
<
Th»ad
 *> &
th»ads
);

173 
	`£tTimeBufãr
(
TimeBufãr
<
TimeSŒuù
> *
tb_±r
);

175 
	`£tF‘chQueue
(
TimeBufãr
<
F‘chSŒuù
> *
fq_±r
);

178 
	`£tR’ameQueue
(
TimeBufãr
<
R’ameSŒuù
> *
rq_±r
);

181 
	`£tIEWQueue
(
TimeBufãr
<
IEWSŒuù
> *
iq_±r
);

184 
	`£tIEWSge
(
IEW
 *
›w_¡age
);

187 
¡d
::
queue
<
DynIn¡PŒ
> 
skidBufãr
;

193 
IEW
 *
›wSge
;

196 
	`£tAùiveTh»ads
(
¡d
::
li¡
<
Th»adID
> *
©_±r
);

199 
	`£tR’ameM­
(
R’ameM­
 
rm_±r
[
Im¶
::
MaxTh»ads
]);

202 
	`£tROB
(
ROB
 *
rob_±r
);

205 
	`¡¬tupSge
();

208 
	`d¿š
();

211 
	`d¿šResume
();

214 
	$d¿šSª™yCheck
() const;

217 
boŞ
 
	$isD¿šed
() const;

220 
	`keOv”From
();

223 
	`tick
();

228 
	`comm™
();

231 
size_t
 
	`numROBF»eEÁr›s
(
Th»adID
 
tid
);

234 
	`g’”©eT¿pEv’t
(
Th»adID
 
tid
);

239 
	`g’”©eTCEv’t
(
Th»adID
 
tid
);

241 
´iv©e
:

245 
	`upd©eStus
();

250 
	`£tNextStus
();

255 
boŞ
 
	`robDÚeSquashšg
();

261 
boŞ
 
	`chªgedROBEÁr›s
();

264 
	`squashAÎ
(
Th»adID
 
tid
);

267 
	`squashFromT¿p
(
Th»adID
 
tid
);

270 
	`squashFromTC
(
Th»adID
 
tid
);

273 
	`squashFromSquashAá”
(
Th»adID
 
tid
);

303 
	`squashAá”
(
Th»adID
 
tid
, 
DynIn¡PŒ
 &
h—d_š¡
);

306 
	`hªdËIÁ”ru±
();

309 
	`´İag©eIÁ”ru±
();

312 
	`comm™In¡s
();

317 
boŞ
 
	`comm™H—d
(
DynIn¡PŒ
 &
h—d_š¡
, 
š¡_num
);

320 
	`g‘In¡s
();

323 
	`skidIn£¹
();

326 
	`m¬kCom¶‘edIn¡s
();

329 
Th»adID
 
	`g‘Comm™tšgTh»ad
();

332 
Th»adID
 
	`roundRobš
();

335 
Th»adID
 
	`Şde¡R—dy
();

337 
public
:

339 
TheISA
::
PCS‹
 
	$pcS‹
(
Th»adID
 
tid
è{  
pc
[tid]; 
	}
}

342 
pcS‹
(cÚ¡ 
TheISA
::
PCS‹
 &
v®
, 
Th»adID
 
tid
)

343 { 
	gpc
[
tid
] = 
v®
; }

346 
Addr
 
	$š¡Addr
(
Th»adID
 
tid
è{  
pc
[tid].
	`š¡Addr
(); 
	}
}

349 
Addr
 
	$ÃxtIn¡Addr
(
Th»adID
 
tid
è{  
pc
[tid].
	`ÃxtIn¡Addr
(); 
	}
}

352 
Addr
 
	$miüoPC
(
Th»adID
 
tid
è{  
pc
[tid].
	`miüoPC
(); 
	}
}

354 
	g´iv©e
:

356 
TimeBufãr
<
TimeSŒuù
> *
timeBufãr
;

359 
ty³Çme
 
	gTimeBufãr
<
	gTimeSŒuù
>::
wœe
 
toIEW
;

362 
ty³Çme
 
	gTimeBufãr
<
	gTimeSŒuù
>::
wœe
 
robInfoFromIEW
;

364 
	gTimeBufãr
<
	gF‘chSŒuù
> *
	gãtchQueue
;

366 
ty³Çme
 
	gTimeBufãr
<
	gF‘chSŒuù
>::
wœe
 
äomF‘ch
;

369 
	gTimeBufãr
<
	gIEWSŒuù
> *
	g›wQueue
;

372 
ty³Çme
 
	gTimeBufãr
<
	gIEWSŒuù
>::
wœe
 
äomIEW
;

375 
	gTimeBufãr
<
	gR’ameSŒuù
> *
	g»ÇmeQueue
;

378 
ty³Çme
 
	gTimeBufãr
<
	gR’ameSŒuù
>::
wœe
 
äomR’ame
;

380 
	gpublic
:

382 
ROB
 *
rob
;

384 
	g´iv©e
:

386 
O3CPU
 *
ıu
;

389 
	g¡d
::
veùÜ
<
Th»ad
 *> 
th»ad
;

394 
boŞ
 
	gwrÙeToTimeBufãr
;

399 
boŞ
 
	gchªgedROBNumEÁr›s
[
Im¶
::
MaxTh»ads
];

402 
Th»adID
 
	gsquashCouÁ”
;

405 
boŞ
 
	gŒ­Squash
[
Im¶
::
MaxTh»ads
];

408 
boŞ
 
	gtcSquash
[
Im¶
::
MaxTh»ads
];

417 
DynIn¡PŒ
 
	gsquashAá”In¡
[
Im¶
::
MaxTh»ads
];

420 
	g¡d
::
li¡
<
Th»adID
> 
´iÜ™y_li¡
;

423 
Cyşes
 
	g›wToComm™D–ay
;

426 
Cyşes
 
	gcomm™ToIEWD–ay
;

429 
Cyşes
 
	g»ÇmeToROBD–ay
;

431 
Cyşes
 
	gãtchToComm™D–ay
;

436 
	g»ÇmeWidth
;

439 
	gcomm™Width
;

442 
	gnumRobs
;

445 
Th»adID
 
	gnumTh»ads
;

448 
boŞ
 
	gd¿šP’dšg
;

453 
Cyşes
 
	gŒ­L©’cy
;

456 
FauÉ
 
	gš‹¼u±
;

461 
	gTheISA
::
PCS‹
 
pc
[
Im¶
::
MaxTh»ads
];

464 
In¡SeqNum
 
	gyounge¡SeqNum
[
Im¶
::
MaxTh»ads
];

467 
In¡SeqNum
 
	gÏ¡Comm™edSeqNum
[
Im¶
::
MaxTh»ads
];

470 
boŞ
 
	gŒ­InFlight
[
Im¶
::
MaxTh»ads
];

473 
boŞ
 
	gcomm™‹dStÜes
[
Im¶
::
MaxTh»ads
];

477 
boŞ
 
	gcheckEm±yROB
[
Im¶
::
MaxTh»ads
];

480 
	g¡d
::
li¡
<
Th»adID
> *
aùiveTh»ads
;

483 
R’ameM­
 *
	g»ÇmeM­
[
Im¶
::
MaxTh»ads
];

486 
boŞ
 
	gÿnHªdËIÁ”ru±s
;

489 
upd©eComIn¡Sts
(
DynIn¡PŒ
 &
š¡
);

493 
	gSts
::
SÿÏr
 
comm™SquashedIn¡s
;

497 
	gSts
::
SÿÏr
 
comm™SquashEv’ts
;

501 
	gSts
::
SÿÏr
 
comm™NÚS³cSÎs
;

503 
	gSts
::
SÿÏr
 
b¿nchMi¥»diùs
;

505 
	gSts
::
Di¡ributiÚ
 
numComm™‹dDi¡
;

508 
	gSts
::
VeùÜ
 
š¡sComm™‹d
;

510 
	gSts
::
VeùÜ
 
İsComm™‹d
;

512 
	gSts
::
VeùÜ
 
¡©ComSwp
;

514 
	gSts
::
VeùÜ
 
¡©ComRefs
;

516 
	gSts
::
VeùÜ
 
¡©ComLßds
;

518 
	gSts
::
VeùÜ
 
¡©ComMemb¬s
;

520 
	gSts
::
VeùÜ
 
¡©ComB¿nches
;

522 
	gSts
::
VeùÜ
 
¡©ComFlßtšg
;

524 
	gSts
::
VeùÜ
 
¡©ComIÁeg”
;

526 
	gSts
::
VeùÜ
 
¡©ComFunùiÚC®ls
;

529 
	gSts
::
SÿÏr
 
comm™EligibËSam¶es
;

531 
	gSts
::
VeùÜ
 
comm™EligibË
;

	@commit_impl.hh

44 
	~<®gÜ™hm
>

45 
	~<¡ršg
>

47 
	~"¬ch/ut™y.hh
"

48 
	~"ba£/lßd”/symb.hh
"

49 
	~"ba£/ı_ªnÙ©e.hh
"

50 
	~"cÚfig/the_i§.hh
"

51 
	~"ıu/check”/ıu.hh
"

52 
	~"ıu/o3/comm™.hh
"

53 
	~"ıu/o3/th»ad_¡©e.hh
"

54 
	~"ıu/ba£.hh
"

55 
	~"ıu/ex‘¿û.hh
"

56 
	~"ıu/timebuf.hh
"

57 
	~"debug/Aùiv™y.hh
"

58 
	~"debug/Comm™.hh
"

59 
	~"debug/Comm™R©e.hh
"

60 
	~"debug/D¿š.hh
"

61 
	~"debug/ExecFauÉšg.hh
"

62 
	~"·¿ms/D”ivO3CPU.hh
"

63 
	~"sim/çuÉs.hh
"

64 
	~"sim/fuÎ_sy¡em.hh
"

66 
usšg
 
Çme¥aû
 
	g¡d
;

68 
	g‹m¶©e
 <
şass
 
	gIm¶
>

69 
	gDeçuÉComm™
<
	gIm¶
>::
T¿pEv’t
::T¿pEv’t(
DeçuÉComm™
<
Im¶
> *
_comm™
,

70 
Th»adID
 
_tid
)

71 : 
Ev’t
(
CPU_Tick_Pri
-1, 
AutoD–‘e
), 
comm™
(
_comm™
), 
	$tid
(
_tid
)

73 
	}
}

75 
	g‹m¶©e
 <
şass
 
	gIm¶
>

77 
	gDeçuÉComm™
<
	gIm¶
>::
T¿pEv’t
::
	$´oûss
()

81 
comm™
->
Œ­Squash
[
tid
] = 
Œue
;

82 
	}
}

84 
	g‹m¶©e
 <
şass
 
	gIm¶
>

86 
	gDeçuÉComm™
<
	gIm¶
>::
T¿pEv’t
::
	$desütiÚ
() const

89 
	}
}

91 
	g‹m¶©e
 <
şass
 
	gIm¶
>

92 
	gDeçuÉComm™
<
	gIm¶
>::
	$DeçuÉComm™
(
O3CPU
 *
_ıu
, 
D”ivO3CPUP¬ams
 *
·¿ms
)

93 : 
	`ıu
(
_ıu
),

94 
	`squashCouÁ”
(0),

95 
	`›wToComm™D–ay
(
·¿ms
->
›wToComm™D–ay
),

96 
	`comm™ToIEWD–ay
(
·¿ms
->
comm™ToIEWD–ay
),

97 
	`»ÇmeToROBD–ay
(
·¿ms
->
»ÇmeToROBD–ay
),

98 
	`ãtchToComm™D–ay
(
·¿ms
->
comm™ToF‘chD–ay
),

99 
	`»ÇmeWidth
(
·¿ms
->
»ÇmeWidth
),

100 
	`comm™Width
(
·¿ms
->
comm™Width
),

101 
	`numTh»ads
(
·¿ms
->
numTh»ads
),

102 
	`d¿šP’dšg
(
çl£
),

103 
	`Œ­L©’cy
(
·¿ms
->
Œ­L©’cy
),

104 
	$ÿnHªdËIÁ”ru±s
(
Œue
)

106 
_¡©us
 = 
Aùive
;

107 
_ÃxtStus
 = 
IÇùive
;

108 
¡d
::
¡ršg
 
pŞicy
 = 
·¿ms
->
smtComm™PŞicy
;

111 
¡d
::
	`ŒªsfÜm
(
pŞicy
.
	`begš
(),…Şicy.
	`’d
(),…olicy.begin(),

112 ((*)()è
tŞow”
);

115 ià(
pŞicy
 == "aggressive"){

116 
comm™PŞicy
 = 
Agg»ssive
;

118 
	`DPRINTF
(
Comm™
,"Commit Policy seto Aggressive.\n");

119 } ià(
pŞicy
 == "roundrobin"){

120 
comm™PŞicy
 = 
RoundRobš
;

123 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

124 
´iÜ™y_li¡
.
	`push_back
(
tid
);

127 
	`DPRINTF
(
Comm™
,"Commit Policy seto Round Robin.\n");

128 } ià(
pŞicy
 == "oldestready"){

129 
comm™PŞicy
 = 
Olde¡R—dy
;

131 
	`DPRINTF
(
Comm™
,"Commit Policy seto Oldest Ready.");

133 
	`as£¹
(0 && "Invalid SMT Commit Policy. Options Are: {Aggressive,"

137 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

138 
comm™Stus
[
tid
] = 
IdË
;

139 
chªgedROBNumEÁr›s
[
tid
] = 
çl£
;

140 
checkEm±yROB
[
tid
] = 
çl£
;

141 
Œ­InFlight
[
tid
] = 
çl£
;

142 
comm™‹dStÜes
[
tid
] = 
çl£
;

143 
Œ­Squash
[
tid
] = 
çl£
;

144 
tcSquash
[
tid
] = 
çl£
;

145 
pc
[
tid
].
	`£t
(0);

146 
Ï¡Comm™edSeqNum
[
tid
] = 0;

147 
squashAá”In¡
[
tid
] = 
NULL
;

149 
š‹¼u±
 = 
NoFauÉ
;

150 
	}
}

152 
	g‹m¶©e
 <
şass
 
	gIm¶
>

153 
	g¡d
::
¡ršg


154 
DeçuÉComm™
<
Im¶
>::
	$Çme
() const

156  
ıu
->
	`Çme
() + ".commit";

157 
	}
}

159 
	g‹m¶©e
 <
şass
 
	gIm¶
>

161 
	gDeçuÉComm™
<
	gIm¶
>::
	$»gSts
()

163 
usšg
 
Çme¥aû
 
Sts
;

164 
comm™SquashedIn¡s


165 .
	`Çme
(name() + ".commitSquashedInsts")

166 .
	`desc
("The‚umber of squashed insts skipped by commit")

167 .
	`´”eq
(
comm™SquashedIn¡s
);

168 
comm™SquashEv’ts


169 .
	`Çme
(name() + ".commitSquashEvents")

170 .
	`desc
("The‚umber ofimes commit isoldo squash")

171 .
	`´”eq
(
comm™SquashEv’ts
);

172 
comm™NÚS³cSÎs


173 .
	`Çme
(name() + ".commitNonSpecStalls")

174 .
	`desc
("The‚umber ofimes commit has been forcedo stallo "

176 .
	`´”eq
(
comm™NÚS³cSÎs
);

177 
b¿nchMi¥»diùs


178 .
	`Çme
(name() + ".branchMispredicts")

179 .
	`desc
("The‚umber ofimes‡ branch was mispredicted")

180 .
	`´”eq
(
b¿nchMi¥»diùs
);

181 
numComm™‹dDi¡


182 .
	`š™
(0,
comm™Width
,1)

183 .
	`Çme
(name() + ".committed_per_cycle")

184 .
	`desc
("Number of insts commitedƒach cycle")

185 .
	`æags
(
Sts
::
pdf
)

188 
š¡sComm™‹d


189 .
	`š™
(
ıu
->
numTh»ads
)

190 .
	`Çme
(name() + ".committedInsts")

191 .
	`desc
("Number of instructions committed")

192 .
	`æags
(
tÙ®
)

195 
İsComm™‹d


196 .
	`š™
(
ıu
->
numTh»ads
)

197 .
	`Çme
(name() + ".committedOps")

198 .
	`desc
("Number of ops (including micro ops) committed")

199 .
	`æags
(
tÙ®
)

202 
¡©ComSwp


203 .
	`š™
(
ıu
->
numTh»ads
)

204 .
	`Çme
(name() + ".swp_count")

205 .
	`desc
("Number of s/w…refetches committed")

206 .
	`æags
(
tÙ®
)

209 
¡©ComRefs


210 .
	`š™
(
ıu
->
numTh»ads
)

211 .
	`Çme
(name() + ".refs")

212 .
	`desc
("Number of memory„eferences committed")

213 .
	`æags
(
tÙ®
)

216 
¡©ComLßds


217 .
	`š™
(
ıu
->
numTh»ads
)

218 .
	`Çme
(name() + ".loads")

219 .
	`desc
("Number of†oads committed")

220 .
	`æags
(
tÙ®
)

223 
¡©ComMemb¬s


224 .
	`š™
(
ıu
->
numTh»ads
)

225 .
	`Çme
(name() + ".membars")

226 .
	`desc
("Number of memory barriers committed")

227 .
	`æags
(
tÙ®
)

230 
¡©ComB¿nches


231 .
	`š™
(
ıu
->
numTh»ads
)

232 .
	`Çme
(name() + ".branches")

233 .
	`desc
("Number of branches committed")

234 .
	`æags
(
tÙ®
)

237 
¡©ComFlßtšg


238 .
	`š™
(
ıu
->
numTh»ads
)

239 .
	`Çme
(name() + ".fp_insts")

240 .
	`desc
("Number of committed floating…oint instructions.")

241 .
	`æags
(
tÙ®
)

244 
¡©ComIÁeg”


245 .
	`š™
(
ıu
->
numTh»ads
)

246 .
	`Çme
(name()+".int_insts")

247 .
	`desc
("Number of committed integer instructions.")

248 .
	`æags
(
tÙ®
)

251 
¡©ComFunùiÚC®ls


252 .
	`š™
(
ıu
->
numTh»ads
)

253 .
	`Çme
(name()+".function_calls")

254 .
	`desc
("Number of function calls committed.")

255 .
	`æags
(
tÙ®
)

258 
comm™EligibË


259 .
	`š™
(
ıu
->
numTh»ads
)

260 .
	`Çme
(name() + ".bw_limited")

261 .
	`desc
("number of insts‚ot committed dueo BW†imits")

262 .
	`æags
(
tÙ®
)

265 
comm™EligibËSam¶es


266 .
	`Çme
(name() + ".bw_lim_events")

267 .
	`desc
("number cycles where commit BW†imit„eached")

269 
	}
}

271 
	g‹m¶©e
 <
şass
 
	gIm¶
>

273 
	gDeçuÉComm™
<
	gIm¶
>::
£tTh»ads
(
¡d
::
veùÜ
<
Th»ad
 *> &
th»ads
)

275 
th»ad
 = 
th»ads
;

278 
	g‹m¶©e
 <
şass
 
	gIm¶
>

280 
	gDeçuÉComm™
<
	gIm¶
>::
£tTimeBufãr
(
TimeBufãr
<
TimeSŒuù
> *
tb_±r
)

282 
timeBufãr
 = 
tb_±r
;

285 
	gtoIEW
 = 
timeBufãr
->
g‘Wœe
(0);

288 
	grobInfoFromIEW
 = 
timeBufãr
->
g‘Wœe
(-
›wToComm™D–ay
);

291 
	g‹m¶©e
 <
şass
 
	gIm¶
>

293 
	gDeçuÉComm™
<
	gIm¶
>::
£tF‘chQueue
(
TimeBufãr
<
F‘chSŒuù
> *
fq_±r
)

295 
ãtchQueue
 = 
fq_±r
;

298 
	gäomF‘ch
 = 
ãtchQueue
->
g‘Wœe
(-
ãtchToComm™D–ay
);

301 
	g‹m¶©e
 <
şass
 
	gIm¶
>

303 
	gDeçuÉComm™
<
	gIm¶
>::
£tR’ameQueue
(
TimeBufãr
<
R’ameSŒuù
> *
rq_±r
)

305 
»ÇmeQueue
 = 
rq_±r
;

308 
	gäomR’ame
 = 
»ÇmeQueue
->
g‘Wœe
(-
»ÇmeToROBD–ay
);

311 
	g‹m¶©e
 <
şass
 
	gIm¶
>

313 
	gDeçuÉComm™
<
	gIm¶
>::
£tIEWQueue
(
TimeBufãr
<
IEWSŒuù
> *
iq_±r
)

315 
›wQueue
 = 
iq_±r
;

318 
	gäomIEW
 = 
›wQueue
->
g‘Wœe
(-
›wToComm™D–ay
);

321 
	g‹m¶©e
 <
şass
 
	gIm¶
>

323 
	gDeçuÉComm™
<
	gIm¶
>::
	$£tIEWSge
(
IEW
 *
›w_¡age
)

325 
›wSge
 = 
›w_¡age
;

326 
	}
}

328 
	g‹m¶©e
<
şass
 
	gIm¶
>

330 
	gDeçuÉComm™
<
	gIm¶
>::
£tAùiveTh»ads
(
li¡
<
Th»adID
> *
©_±r
)

332 
aùiveTh»ads
 = 
©_±r
;

335 
	g‹m¶©e
 <
şass
 
	gIm¶
>

337 
	gDeçuÉComm™
<
	gIm¶
>::
	$£tR’ameM­
(
R’ameM­
 
rm_±r
[])

339 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++)

340 
»ÇmeM­
[
tid
] = &
rm_±r
[tid];

341 
	}
}

343 
	g‹m¶©e
 <
şass
 
	gIm¶
>

345 
	gDeçuÉComm™
<
	gIm¶
>::
	$£tROB
(
ROB
 *
rob_±r
)

347 
rob
 = 
rob_±r
;

348 
	}
}

350 
	g‹m¶©e
 <
şass
 
	gIm¶
>

352 
	gDeçuÉComm™
<
	gIm¶
>::
	$¡¬tupSge
()

354 
rob
->
	`£tAùiveTh»ads
(
aùiveTh»ads
);

355 
rob
->
	`»£tEÁr›s
();

358 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

359 
toIEW
->
comm™Info
[
tid
].
u£dROB
 = 
Œue
;

360 
toIEW
->
comm™Info
[
tid
].
ä“ROBEÁr›s
 = 
rob
->
	`numF»eEÁr›s
(tid);

361 
toIEW
->
comm™Info
[
tid
].
em±yROB
 = 
Œue
;

366 
ıu
->
	`aùiv©eSge
(
O3CPU
::
Comm™Idx
);

368 
ıu
->
	`aùiv™yThisCyşe
();

369 
	}
}

371 
	g‹m¶©e
 <
şass
 
	gIm¶
>

373 
	gDeçuÉComm™
<
	gIm¶
>::
	$d¿š
()

375 
d¿šP’dšg
 = 
Œue
;

376 
	}
}

378 
	g‹m¶©e
 <
şass
 
	gIm¶
>

380 
	gDeçuÉComm™
<
	gIm¶
>::
	$d¿šResume
()

382 
d¿šP’dšg
 = 
çl£
;

383 
	}
}

385 
	g‹m¶©e
 <
şass
 
	gIm¶
>

387 
	gDeçuÉComm™
<
	gIm¶
>::
	$d¿šSª™yCheck
() const

389 
	`as£¹
(
	`isD¿šed
());

390 
rob
->
	`d¿šSª™yCheck
();

391 
	}
}

393 
	g‹m¶©e
 <
şass
 
	gIm¶
>

394 
boŞ


395 
	gDeçuÉComm™
<
	gIm¶
>::
	$isD¿šed
() const

406 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

407 ià(
pc
[
tid
].
	`miüoPC
() != 0)

408  
çl£
;

417  
rob
->
	`isEm±y
() &&

418 
š‹¼u±
 =ğ
NoFauÉ
;

419 
	}
}

421 
	g‹m¶©e
 <
şass
 
	gIm¶
>

423 
	gDeçuÉComm™
<
	gIm¶
>::
	$keOv”From
()

425 
_¡©us
 = 
Aùive
;

426 
_ÃxtStus
 = 
IÇùive
;

427 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

428 
comm™Stus
[
tid
] = 
IdË
;

429 
chªgedROBNumEÁr›s
[
tid
] = 
çl£
;

430 
Œ­Squash
[
tid
] = 
çl£
;

431 
tcSquash
[
tid
] = 
çl£
;

432 
squashAá”In¡
[
tid
] = 
NULL
;

434 
squashCouÁ”
 = 0;

435 
rob
->
	`keOv”From
();

436 
	}
}

438 
	g‹m¶©e
 <
şass
 
	gIm¶
>

440 
	gDeçuÉComm™
<
	gIm¶
>::
	$upd©eStus
()

443 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

444 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

446 
th»ads
 !ğ
’d
) {

447 
Th»adID
 
tid
 = *
th»ads
++;

449 
chªgedROBNumEÁr›s
[
tid
] = 
çl£
;

452 ià(
comm™Stus
[
tid
] =ğ
T¿pP’dšg
 ||

453 
comm™Stus
[
tid
] =ğ
F‘chT¿pP’dšg
) {

454 
_ÃxtStus
 = 
Aùive
;

458 ià(
_ÃxtStus
 =ğ
IÇùive
 && 
_¡©us
 =ğ
Aùive
) {

459 
	`DPRINTF
(
Aùiv™y
, "Deactivating stage.\n");

460 
ıu
->
	`d—ùiv©eSge
(
O3CPU
::
Comm™Idx
);

461 } ià(
_ÃxtStus
 =ğ
Aùive
 && 
_¡©us
 =ğ
IÇùive
) {

462 
	`DPRINTF
(
Aùiv™y
, "Activating stage.\n");

463 
ıu
->
	`aùiv©eSge
(
O3CPU
::
Comm™Idx
);

466 
_¡©us
 = 
_ÃxtStus
;

467 
	}
}

469 
	g‹m¶©e
 <
şass
 
	gIm¶
>

471 
	gDeçuÉComm™
<
	gIm¶
>::
	$£tNextStus
()

473 
squashes
 = 0;

475 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

476 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

478 
th»ads
 !ğ
’d
) {

479 
Th»adID
 
tid
 = *
th»ads
++;

481 ià(
comm™Stus
[
tid
] =ğ
ROBSquashšg
) {

482 
squashes
++;

486 
squashCouÁ”
 = 
squashes
;

490 ià(
squashCouÁ”
) {

491 
_ÃxtStus
 = 
Aùive
;

493 
	}
}

495 
	g‹m¶©e
 <
şass
 
	gIm¶
>

496 
boŞ


497 
	gDeçuÉComm™
<
	gIm¶
>::
	$chªgedROBEÁr›s
()

499 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

500 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

502 
th»ads
 !ğ
’d
) {

503 
Th»adID
 
tid
 = *
th»ads
++;

505 ià(
chªgedROBNumEÁr›s
[
tid
]) {

506  
Œue
;

510  
çl£
;

511 
	}
}

513 
	g‹m¶©e
 <
şass
 
	gIm¶
>

514 
size_t


515 
	gDeçuÉComm™
<
	gIm¶
>::
	$numROBF»eEÁr›s
(
Th»adID
 
tid
)

517  
rob
->
	`numF»eEÁr›s
(
tid
);

518 
	}
}

520 
	g‹m¶©e
 <
şass
 
	gIm¶
>

522 
	gDeçuÉComm™
<
	gIm¶
>::
	$g’”©eT¿pEv’t
(
Th»adID
 
tid
)

524 
	`DPRINTF
(
Comm™
, "G’”©šg¿°ev’ˆfÜ [tid:%i]\n", 
tid
);

526 
T¿pEv’t
 *
Œ­
 = 
Ãw
 
	`T¿pEv’t
(
this
, 
tid
);

528 
ıu
->
	`scheduË
(
Œ­
, cpu->
	`şockEdge
(
Œ­L©’cy
));

529 
Œ­InFlight
[
tid
] = 
Œue
;

530 
th»ad
[
tid
]->
Œ­P’dšg
 = 
Œue
;

531 
	}
}

533 
	g‹m¶©e
 <
şass
 
	gIm¶
>

535 
	gDeçuÉComm™
<
	gIm¶
>::
	$g’”©eTCEv’t
(
Th»adID
 
tid
)

537 
	`as£¹
(!
Œ­InFlight
[
tid
]);

538 
	`DPRINTF
(
Comm™
, "G’”©šg TC squashƒv’ˆfÜ [tid:%i]\n", 
tid
);

540 
tcSquash
[
tid
] = 
Œue
;

541 
	}
}

543 
	g‹m¶©e
 <
şass
 
	gIm¶
>

545 
	gDeçuÉComm™
<
	gIm¶
>::
	$squashAÎ
(
Th»adID
 
tid
)

551 
In¡SeqNum
 
squashed_š¡
 = 
rob
->
	`isEm±y
() ?

552 
Ï¡Comm™edSeqNum
[
tid
] : 
rob
->
	`»adH—dIn¡
Ñid)->
£qNum
 - 1;

557 
younge¡SeqNum
[
tid
] = 
Ï¡Comm™edSeqNum
[tid];

559 
rob
->
	`squash
(
squashed_š¡
, 
tid
);

560 
chªgedROBNumEÁr›s
[
tid
] = 
Œue
;

563 
toIEW
->
comm™Info
[
tid
].
dÚeSeqNum
 = 
squashed_š¡
;

567 
toIEW
->
comm™Info
[
tid
].
squash
 = 
Œue
;

571 
toIEW
->
comm™Info
[
tid
].
robSquashšg
 = 
Œue
;

573 
toIEW
->
comm™Info
[
tid
].
mi¥»diùIn¡
 = 
NULL
;

574 
toIEW
->
comm™Info
[
tid
].
squashIn¡
 = 
NULL
;

576 
toIEW
->
comm™Info
[
tid
].
pc
 =…c[tid];

577 
	}
}

579 
	g‹m¶©e
 <
şass
 
	gIm¶
>

581 
	gDeçuÉComm™
<
	gIm¶
>::
	$squashFromT¿p
(
Th»adID
 
tid
)

583 
	`squashAÎ
(
tid
);

585 
	`DPRINTF
(
Comm™
, "Squashšg from¿p,„e¡¬tšg‡ˆPC %s\n", 
pc
[
tid
]);

587 
th»ad
[
tid
]->
Œ­P’dšg
 = 
çl£
;

588 
th»ad
[
tid
]->
noSquashFromTC
 = 
çl£
;

589 
Œ­InFlight
[
tid
] = 
çl£
;

591 
Œ­Squash
[
tid
] = 
çl£
;

593 
comm™Stus
[
tid
] = 
ROBSquashšg
;

594 
ıu
->
	`aùiv™yThisCyşe
();

595 
	}
}

597 
	g‹m¶©e
 <
şass
 
	gIm¶
>

599 
	gDeçuÉComm™
<
	gIm¶
>::
	$squashFromTC
(
Th»adID
 
tid
)

601 
	`squashAÎ
(
tid
);

603 
	`DPRINTF
(
Comm™
, "Squashšg from TC,„e¡¬tšg‡ˆPC %s\n", 
pc
[
tid
]);

605 
th»ad
[
tid
]->
noSquashFromTC
 = 
çl£
;

606 
	`as£¹
(!
th»ad
[
tid
]->
Œ­P’dšg
);

608 
comm™Stus
[
tid
] = 
ROBSquashšg
;

609 
ıu
->
	`aùiv™yThisCyşe
();

611 
tcSquash
[
tid
] = 
çl£
;

612 
	}
}

614 
	g‹m¶©e
 <
şass
 
	gIm¶
>

616 
	gDeçuÉComm™
<
	gIm¶
>::
	$squashFromSquashAá”
(
Th»adID
 
tid
)

618 
	`DPRINTF
(
Comm™
, "Squashing‡fter squash‡fter„equest, "

619 "»¡¬tšg‡ˆPC %s\n", 
pc
[
tid
]);

621 
	`squashAÎ
(
tid
);

625 
toIEW
->
comm™Info
[
tid
].
squashIn¡
 = 
squashAá”In¡
[tid];

626 
squashAá”In¡
[
tid
] = 
NULL
;

628 
comm™Stus
[
tid
] = 
ROBSquashšg
;

629 
ıu
->
	`aùiv™yThisCyşe
();

630 
	}
}

632 
	g‹m¶©e
 <
şass
 
	gIm¶
>

634 
	gDeçuÉComm™
<
	gIm¶
>::
	$squashAá”
(
Th»adID
 
tid
, 
DynIn¡PŒ
 &
h—d_š¡
)

636 
	`DPRINTF
(
Comm™
, "Executing squash‡fter for [tid:%i] inst [sn:%lli]\n",

637 
tid
, 
h—d_š¡
->
£qNum
);

639 
	`as£¹
(!
squashAá”In¡
[
tid
] || squashAá”In¡[tid] =ğ
h—d_š¡
);

640 
comm™Stus
[
tid
] = 
SquashAá”P’dšg
;

641 
squashAá”In¡
[
tid
] = 
h—d_š¡
;

642 
	}
}

644 
	g‹m¶©e
 <
şass
 
	gIm¶
>

646 
	gDeçuÉComm™
<
	gIm¶
>::
	$tick
()

648 
wrÙeToTimeBufãr
 = 
çl£
;

649 
_ÃxtStus
 = 
IÇùive
;

651 ià(
aùiveTh»ads
->
	`em±y
())

654 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

655 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

659 
th»ads
 !ğ
’d
) {

660 
Th»adID
 
tid
 = *
th»ads
++;

664 
comm™‹dStÜes
[
tid
] = 
çl£
;

666 ià(
comm™Stus
[
tid
] =ğ
ROBSquashšg
) {

668 ià(
rob
->
	`isDÚeSquashšg
(
tid
)) {

669 
comm™Stus
[
tid
] = 
RuÂšg
;

671 
	`DPRINTF
(
Comm™
,"[tid:%u]: Still Squashing, cannot commit‡ny"

672 " in¡ thi cyşe.\n", 
tid
);

673 
rob
->
	`doSquash
(
tid
);

674 
toIEW
->
comm™Info
[
tid
].
robSquashšg
 = 
Œue
;

675 
wrÙeToTimeBufãr
 = 
Œue
;

680 
	`comm™
();

682 
	`m¬kCom¶‘edIn¡s
();

684 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

686 
th»ads
 !ğ
’d
) {

687 
Th»adID
 
tid
 = *
th»ads
++;

689 ià(!
rob
->
	`isEm±y
(
tid
è&&„ob->
	`»adH—dIn¡
Ñid)->
	`»adyToComm™
()) {

692 
_ÃxtStus
 = 
Aùive
;

694 
DynIn¡PŒ
 
š¡
 = 
rob
->
	`»adH—dIn¡
(
tid
);

696 
	`DPRINTF
(
Comm™
,"[tid:%i]: Instruction [sn:%lli] PC %s is head of"

698 
tid
, 
š¡
->
£qNum
, in¡->
	`pcS‹
());

700 } ià(!
rob
->
	`isEm±y
(
tid
)) {

701 
DynIn¡PŒ
 
š¡
 = 
rob
->
	`»adH—dIn¡
(
tid
);

703 
	`DPRINTF
(
Comm™
,"[tid:%i]: Can't commit, Instruction [sn:%lli] PC "

705 
tid
, 
š¡
->
£qNum
, in¡->
	`pcS‹
());

708 
	`DPRINTF
(
Comm™
, "[tid:%i]: ROB has %d insts & %d freeƒntries.\n",

709 
tid
, 
rob
->
	`couÁIn¡s
Ñid),„ob->
	`numF»eEÁr›s
(tid));

713 ià(
wrÙeToTimeBufãr
) {

714 
	`DPRINTF
(
Aùiv™y
, "Activity This Cycle.\n");

715 
ıu
->
	`aùiv™yThisCyşe
();

718 
	`upd©eStus
();

719 
	}
}

721 
	g‹m¶©e
 <
şass
 
	gIm¶
>

723 
	gDeçuÉComm™
<
	gIm¶
>::
	$hªdËIÁ”ru±
()

726 ià(!
ıu
->
	`checkIÁ”ru±s
(ıu->
	`tcBa£
(0))) {

727 
	`DPRINTF
(
Comm™
, "Pending interrupt is cleared by master before "

729 
toIEW
->
comm™Info
[0].
ş—rIÁ”ru±
 = 
Œue
;

730 
š‹¼u±
 = 
NoFauÉ
;

736 ià(
ÿnHªdËIÁ”ru±s
 && 
ıu
->
š¡Li¡
.
	`em±y
()) {

739 
	`DPRINTF
(
Comm™
, "Interrupt detected.\n");

742 
toIEW
->
comm™Info
[0].
ş—rIÁ”ru±
 = 
Œue
;

744 
	`as£¹
(!
th»ad
[0]->
noSquashFromTC
);

745 
th»ad
[0]->
noSquashFromTC
 = 
Œue
;

747 ià(
ıu
->
check”
) {

748 
ıu
->
check”
->
	`hªdËP’dšgIÁ
();

752 
ıu
->
	`´oûssIÁ”ru±s
(
š‹¼u±
);

754 
th»ad
[0]->
noSquashFromTC
 = 
çl£
;

756 
comm™Stus
[0] = 
T¿pP’dšg
;

759 
	`g’”©eT¿pEv’t
(0);

761 
š‹¼u±
 = 
NoFauÉ
;

763 
	`DPRINTF
(
Comm™
, "Interrupt…ending: instruction is %sin "

765 
ÿnHªdËIÁ”ru±s
 ? "not " : "",

766 
ıu
->
š¡Li¡
.
	`em±y
() ? "" : "not " );

768 
	}
}

770 
	g‹m¶©e
 <
şass
 
	gIm¶
>

772 
	gDeçuÉComm™
<
	gIm¶
>::
	$´İag©eIÁ”ru±
()

774 ià(
comm™Stus
[0] =ğ
T¿pP’dšg
 || 
š‹¼u±
 || 
Œ­Squash
[0] ||

775 
tcSquash
[0])

784 
š‹¼u±
 = 
ıu
->
	`g‘IÁ”ru±s
();

789 ià(
š‹¼u±
 !ğ
NoFauÉ
)

790 
toIEW
->
comm™Info
[0].
š‹¼u±P’dšg
 = 
Œue
;

791 
	}
}

793 
	g‹m¶©e
 <
şass
 
	gIm¶
>

795 
	gDeçuÉComm™
<
	gIm¶
>::
	$comm™
()

797 ià(
FuÎSy¡em
) {

799 ià(
ıu
->
	`checkIÁ”ru±s
(ıu->
	`tcBa£
(0)))

800 
	`´İag©eIÁ”ru±
();

806 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

807 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

809 
th»ads
 !ğ
’d
) {

810 
Th»adID
 
tid
 = *
th»ads
++;

814 ià(
Œ­Squash
[
tid
] =ğ
Œue
) {

815 
	`as£¹
(!
tcSquash
[
tid
]);

816 
	`squashFromT¿p
(
tid
);

817 } ià(
tcSquash
[
tid
] =ğ
Œue
) {

818 
	`as£¹
(
comm™Stus
[
tid
] !ğ
T¿pP’dšg
);

819 
	`squashFromTC
(
tid
);

820 } ià(
comm™Stus
[
tid
] =ğ
SquashAá”P’dšg
) {

824 
	`squashFromSquashAá”
(
tid
);

830 ià(
äomIEW
->
squash
[
tid
] &&

831 
comm™Stus
[
tid
] !ğ
T¿pP’dšg
 &&

832 
äomIEW
->
squashedSeqNum
[
tid
] <ğ
younge¡SeqNum
[tid]) {

834 ià(
äomIEW
->
mi¥»diùIn¡
[
tid
]) {

835 
	`DPRINTF
(
Comm™
,

837 
tid
,

838 
äomIEW
->
mi¥»diùIn¡
[
tid
]->
	`š¡Addr
(),

839 
äomIEW
->
squashedSeqNum
[
tid
]);

841 
	`DPRINTF
(
Comm™
,

843 
tid
, 
äomIEW
->
squashedSeqNum
[tid]);

846 
	`DPRINTF
(
Comm™
, "[tid:%i]: Redirectingo PC %#x\n",

847 
tid
,

848 
äomIEW
->
pc
[
tid
].
	`ÃxtIn¡Addr
());

850 
comm™Stus
[
tid
] = 
ROBSquashšg
;

854 
In¡SeqNum
 
squashed_š¡
 = 
äomIEW
->
squashedSeqNum
[
tid
];

856 ià(
äomIEW
->
šşudeSquashIn¡
[
tid
] =ğ
Œue
) {

857 
squashed_š¡
--;

862 
younge¡SeqNum
[
tid
] = 
squashed_š¡
;

864 
rob
->
	`squash
(
squashed_š¡
, 
tid
);

865 
chªgedROBNumEÁr›s
[
tid
] = 
Œue
;

867 
toIEW
->
comm™Info
[
tid
].
dÚeSeqNum
 = 
squashed_š¡
;

869 
toIEW
->
comm™Info
[
tid
].
squash
 = 
Œue
;

873 
toIEW
->
comm™Info
[
tid
].
robSquashšg
 = 
Œue
;

875 
toIEW
->
comm™Info
[
tid
].
mi¥»diùIn¡
 =

876 
äomIEW
->
mi¥»diùIn¡
[
tid
];

877 
toIEW
->
comm™Info
[
tid
].
b¿nchTak’
 =

878 
äomIEW
->
b¿nchTak’
[
tid
];

879 
toIEW
->
comm™Info
[
tid
].
squashIn¡
 =

880 
rob
->
	`fšdIn¡
(
tid
, 
squashed_š¡
);

881 ià(
toIEW
->
comm™Info
[
tid
].
mi¥»diùIn¡
) {

882 ià(
toIEW
->
comm™Info
[
tid
].
mi¥»diùIn¡
->
	`isUncÚdCŒl
()) {

883 
toIEW
->
comm™Info
[
tid
].
b¿nchTak’
 = 
Œue
;

887 
toIEW
->
comm™Info
[
tid
].
pc
 = 
äomIEW
->pc[tid];

889 ià(
toIEW
->
comm™Info
[
tid
].
mi¥»diùIn¡
) {

890 ++
b¿nchMi¥»diùs
;

896 
	`£tNextStus
();

898 ià(
squashCouÁ”
 !ğ
numTh»ads
) {

900 
	`g‘In¡s
();

903 
	`comm™In¡s
();

907 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

909 
th»ads
 !ğ
’d
) {

910 
Th»adID
 
tid
 = *
th»ads
++;

912 ià(
chªgedROBNumEÁr›s
[
tid
]) {

913 
toIEW
->
comm™Info
[
tid
].
u£dROB
 = 
Œue
;

914 
toIEW
->
comm™Info
[
tid
].
ä“ROBEÁr›s
 = 
rob
->
	`numF»eEÁr›s
(tid);

916 
wrÙeToTimeBufãr
 = 
Œue
;

917 
chªgedROBNumEÁr›s
[
tid
] = 
çl£
;

918 ià(
rob
->
	`isEm±y
(
tid
))

919 
checkEm±yROB
[
tid
] = 
Œue
;

930 ià(
checkEm±yROB
[
tid
] && 
rob
->
	`isEm±y
(tid) &&

931 !
›wSge
->
	`hasStÜesToWB
(
tid
è&& !
comm™‹dStÜes
[tid]) {

932 
checkEm±yROB
[
tid
] = 
çl£
;

933 
toIEW
->
comm™Info
[
tid
].
u£dROB
 = 
Œue
;

934 
toIEW
->
comm™Info
[
tid
].
em±yROB
 = 
Œue
;

935 
toIEW
->
comm™Info
[
tid
].
ä“ROBEÁr›s
 = 
rob
->
	`numF»eEÁr›s
(tid);

936 
wrÙeToTimeBufãr
 = 
Œue
;

940 
	}
}

942 
	g‹m¶©e
 <
şass
 
	gIm¶
>

944 
	gDeçuÉComm™
<
	gIm¶
>::
	$comm™In¡s
()

955 
	`DPRINTF
(
Comm™
, "Tryingo commit instructions inhe ROB.\n");

957 
num_comm™‹d
 = 0;

959 
DynIn¡PŒ
 
h—d_š¡
;

963 
num_comm™‹d
 < 
comm™Width
) {

966 ià(
š‹¼u±
 !ğ
NoFauÉ
)

967 
	`hªdËIÁ”ru±
();

969 
comm™_th»ad
 = 
	`g‘Comm™tšgTh»ad
();

971 ià(
comm™_th»ad
 =ğ-1 || !
rob
->
	`isH—dR—dy
(commit_thread))

974 
h—d_š¡
 = 
rob
->
	`»adH—dIn¡
(
comm™_th»ad
);

976 
Th»adID
 
tid
 = 
h—d_š¡
->
th»adNumb”
;

978 
	`as£¹
(
tid
 =ğ
comm™_th»ad
);

980 
	`DPRINTF
(
Comm™
, "Tryingo commit head instruction, [sn:%i] [tid:%i]\n",

981 
h—d_š¡
->
£qNum
, 
tid
);

985 ià(
h—d_š¡
->
	`isSquashed
()) {

987 
	`DPRINTF
(
Comm™
, "Retiring squashed instruction from "

990 
rob
->
	`»tœeH—d
(
comm™_th»ad
);

992 ++
comm™SquashedIn¡s
;

995 
chªgedROBNumEÁr›s
[
tid
] = 
Œue
;

997 
pc
[
tid
] = 
h—d_š¡
->
	`pcS‹
();

1004 
th»ad
[
tid
]->
funcExeIn¡
++;

1007 
boŞ
 
comm™_sucûss
 = 
	`comm™H—d
(
h—d_š¡
, 
num_comm™‹d
);

1009 ià(
comm™_sucûss
) {

1010 ++
num_comm™‹d
;

1012 
chªgedROBNumEÁr›s
[
tid
] = 
Œue
;

1015 
toIEW
->
comm™Info
[
tid
].
dÚeSeqNum
 = 
h—d_š¡
->
£qNum
;

1017 ià(
tid
 == 0) {

1018 
ÿnHªdËIÁ”ru±s
 = (!
h—d_š¡
->
	`isD–ayedComm™
()) &&

1019 ((
THE_ISA
 !ğ
ALPHA_ISA
) ||

1020 (!(
pc
[0].
	`š¡Addr
() & 0x3)));

1024 
h—d_š¡
->
	`upd©eMiscRegs
();

1026 
ıu
->
	`ŒaûFunùiÚs
(
pc
[
tid
].
	`š¡Addr
());

1028 
TheISA
::
	`advªûPC
(
pc
[
tid
], 
h—d_š¡
->
¡©icIn¡
);

1031 
Ï¡Comm™edSeqNum
[
tid
] = 
h—d_š¡
->
£qNum
;

1035 ià(
h—d_š¡
->
	`isSquashAá”
())

1036 
	`squashAá”
(
tid
, 
h—d_š¡
);

1038 ià(
d¿šP’dšg
) {

1039 
	`DPRINTF
(
D¿š
, "D¿ššg: %i:%s\n", 
tid
, 
pc
[tid]);

1040 ià(
pc
[
tid
].
	`miüoPC
(è=ğ0 && 
š‹¼u±
 =ğ
NoFauÉ
) {

1041 
	`squashAá”
(
tid
, 
h—d_š¡
);

1042 
ıu
->
	`comm™D¿šed
(
tid
);

1046 
couÁ
 = 0;

1047 
Addr
 
Şdpc
;

1050 
	`as£¹
(!
th»ad
[
tid
]->
noSquashFromTC
 && !th»ad[tid]->
Œ­P’dšg
);

1052 
Şdpc
 = 
pc
[
tid
].
	`š¡Addr
();

1053 
ıu
->
sy¡em
->
pcEv’tQueue
.
	`£rviû
(
th»ad
[
tid
]->
	`g‘TC
());

1054 
couÁ
++;

1055 } 
Şdpc
 !ğ
pc
[
tid
].
	`š¡Addr
());

1056 ià(
couÁ
 > 1) {

1057 
	`DPRINTF
(
Comm™
,

1062 
	`DPRINTF
(
Comm™
, "Unableo commit head instruction PC:%s "

1064 
h—d_š¡
->
	`pcS‹
(), 
tid
 ,h—d_š¡->
£qNum
);

1070 
	`DPRINTF
(
Comm™R©e
, "%i\n", 
num_comm™‹d
);

1071 
numComm™‹dDi¡
.
	`§m¶e
(
num_comm™‹d
);

1073 ià(
num_comm™‹d
 =ğ
comm™Width
) {

1074 
comm™EligibËSam¶es
++;

1076 
	}
}

1078 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1079 
boŞ


1080 
	gDeçuÉComm™
<
	gIm¶
>::
	$comm™H—d
(
DynIn¡PŒ
 &
h—d_š¡
, 
š¡_num
)

1082 
	`as£¹
(
h—d_š¡
);

1084 
Th»adID
 
tid
 = 
h—d_š¡
->
th»adNumb”
;

1088 ià(!
h—d_š¡
->
	`isExecu‹d
()) {

1091 
th»ad
[
tid
]->
funcExeIn¡
--;

1093 ià(
h—d_š¡
->
	`isNÚS³cuÏtive
() ||

1094 
h—d_š¡
->
	`isStÜeCÚd™iÚ®
() ||

1095 
h—d_š¡
->
	`isMemB¬r›r
() ||

1096 
h—d_š¡
->
	`isWr™eB¬r›r
()) {

1098 
	`DPRINTF
(
Comm™
, "Encountered‡ barrier or‚on-speculative "

1100 
h—d_š¡
->
£qNum
, h—d_š¡->
	`pcS‹
());

1102 ià(
š¡_num
 > 0 || 
›wSge
->
	`hasStÜesToWB
(
tid
)) {

1103 
	`DPRINTF
(
Comm™
, "Waiting for‡ll storeso writeback.\n");

1104  
çl£
;

1107 
toIEW
->
comm™Info
[
tid
].
nÚS³cSeqNum
 = 
h—d_š¡
->
£qNum
;

1111 
h—d_š¡
->
	`ş—rCªComm™
();

1113 ++
comm™NÚS³cSÎs
;

1115  
çl£
;

1116 } ià(
h—d_š¡
->
	`isLßd
()) {

1117 ià(
š¡_num
 > 0 || 
›wSge
->
	`hasStÜesToWB
(
tid
)) {

1118 
	`DPRINTF
(
Comm™
, "Waiting for‡ll storeso writeback.\n");

1119  
çl£
;

1122 
	`as£¹
(
h—d_š¡
->
	`unÿch—bË
());

1123 
	`DPRINTF
(
Comm™
, "[sn:%lli]: Uncached†oad, PC %s.\n",

1124 
h—d_š¡
->
£qNum
, h—d_š¡->
	`pcS‹
());

1128 
toIEW
->
comm™Info
[
tid
].
nÚS³cSeqNum
 = 
h—d_š¡
->
£qNum
;

1129 
toIEW
->
comm™Info
[
tid
].
unÿched
 = 
Œue
;

1130 
toIEW
->
comm™Info
[
tid
].
unÿchedLßd
 = 
h—d_š¡
;

1132 
h—d_š¡
->
	`ş—rCªComm™
();

1134  
çl£
;

1136 
	`·nic
("Tryingo commit un-executed instruction "

1141 ià(
h—d_š¡
->
	`isTh»adSync
()) {

1143 
	`·nic
("Thread sync instructions‡re‚ot handled yet.\n");

1147 
FauÉ
 
š¡_çuÉ
 = 
h—d_š¡
->
	`g‘FauÉ
();

1150 ià(!
h—d_š¡
->
	`isStÜe
(è&& 
š¡_çuÉ
 =ğ
NoFauÉ
) {

1151 
h—d_š¡
->
	`£tCom¶‘ed
();

1156 ià(
ıu
->
check”
) {

1157 
ıu
->
check”
->
	`v”ify
(
h—d_š¡
);

1160 ià(
š¡_çuÉ
 !ğ
NoFauÉ
) {

1161 
	`DPRINTF
(
Comm™
, "Inst [sn:%lli] PC %s has‡ fault\n",

1162 
h—d_š¡
->
£qNum
, h—d_š¡->
	`pcS‹
());

1164 ià(
›wSge
->
	`hasStÜesToWB
(
tid
è|| 
š¡_num
 > 0) {

1165 
	`DPRINTF
(
Comm™
, "Stores outstanding, fault must wait.\n");

1166  
çl£
;

1169 
h—d_š¡
->
	`£tCom¶‘ed
();

1171 ià(
ıu
->
check”
) {

1173 
ıu
->
check”
->
	`v”ify
(
h—d_š¡
);

1176 
	`as£¹
(!
th»ad
[
tid
]->
noSquashFromTC
);

1180 
th»ad
[
tid
]->
noSquashFromTC
 = 
Œue
;

1188 
ıu
->
	`Œ­
(
š¡_çuÉ
, 
tid
, 
h—d_š¡
->
¡©icIn¡
);

1191 
th»ad
[
tid
]->
noSquashFromTC
 = 
çl£
;

1193 
comm™Stus
[
tid
] = 
T¿pP’dšg
;

1195 
	`DPRINTF
(
Comm™
, "Committing instruction with fault [sn:%lli]\n",

1196 
h—d_š¡
->
£qNum
);

1197 ià(
h—d_š¡
->
ŒaûD©a
) {

1198 ià(
	`DTRACE
(
ExecFauÉšg
)) {

1199 
h—d_š¡
->
ŒaûD©a
->
	`£tF‘chSeq
(h—d_š¡->
£qNum
);

1200 
h—d_š¡
->
ŒaûD©a
->
	`£tCPSeq
(
th»ad
[
tid
]->
numOp
);

1201 
h—d_š¡
->
ŒaûD©a
->
	`dump
();

1203 
d–‘e
 
h—d_š¡
->
ŒaûD©a
;

1204 
h—d_š¡
->
ŒaûD©a
 = 
NULL
;

1208 
	`g’”©eT¿pEv’t
(
tid
);

1209  
çl£
;

1212 
	`upd©eComIn¡Sts
(
h—d_š¡
);

1214 ià(
FuÎSy¡em
) {

1215 ià(
th»ad
[
tid
]->
´ofe
) {

1216 
th»ad
[
tid
]->
´ofePC
 = 
h—d_š¡
->
	`š¡Addr
();

1217 
ProfeNode
 *
node
 = 
th»ad
[
tid
]->
´ofe
->
	`cÚsume
(

1218 
th»ad
[
tid
]->
	`g‘TC
(), 
h—d_š¡
->
¡©icIn¡
);

1220 ià(
node
)

1221 
th»ad
[
tid
]->
´ofeNode
 = 
node
;

1223 ià(
CPA
::
	`avaabË
()) {

1224 ià(
h—d_š¡
->
	`isCÚŒŞ
()) {

1225 
Th»adCÚ‹xt
 *
tc
 = 
th»ad
[
tid
]->
	`g‘TC
();

1226 
CPA
::
	`ıa
()->
	`swAutoBegš
(
tc
, 
h—d_š¡
->
	`ÃxtIn¡Addr
());

1230 
	`DPRINTF
(
Comm™
, "Committing instruction with [sn:%lli] PC %s\n",

1231 
h—d_š¡
->
£qNum
, h—d_š¡->
	`pcS‹
());

1232 ià(
h—d_š¡
->
ŒaûD©a
) {

1233 
h—d_š¡
->
ŒaûD©a
->
	`£tF‘chSeq
(h—d_š¡->
£qNum
);

1234 
h—d_š¡
->
ŒaûD©a
->
	`£tCPSeq
(
th»ad
[
tid
]->
numOp
);

1235 
h—d_š¡
->
ŒaûD©a
->
	`dump
();

1236 
d–‘e
 
h—d_š¡
->
ŒaûD©a
;

1237 
h—d_š¡
->
ŒaûD©a
 = 
NULL
;

1239 ià(
h—d_š¡
->
	`isR‘uº
()) {

1240 
	`DPRINTF
(
Comm™
,"Return Instruction Committed [sn:%lli] PC %s \n",

1241 
h—d_š¡
->
£qNum
, h—d_š¡->
	`pcS‹
());

1245 
i
 = 0; i < 
h—d_š¡
->
	`numDe¡Regs
(); i++) {

1246 
»ÇmeM­
[
tid
]->
	`£tEÁry
(
h—d_š¡
->
	`æ©‹ÃdDe¡RegIdx
(
i
),

1247 
h—d_š¡
->
	`»ÇmedDe¡RegIdx
(
i
));

1251 
rob
->
	`»tœeH—d
(
tid
);

1253 #ià
TRACING_ON


1254 
h—d_š¡
->
comm™Tick
 = 
	`curTick
(è- h—d_š¡->
ãtchTick
;

1258 ià(
h—d_š¡
->
	`isStÜe
())

1259 
comm™‹dStÜes
[
tid
] = 
Œue
;

1262  
Œue
;

1263 
	}
}

1265 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1267 
	gDeçuÉComm™
<
	gIm¶
>::
	$g‘In¡s
()

1269 
	`DPRINTF
(
Comm™
, "Getting instructions from Rename stage.\n");

1272 
š¡s_to_´oûss
 = 
¡d
::
	`mš
(()
»ÇmeWidth
, 
äomR’ame
->
size
);

1274 
š¡_num
 = 0; in¡_num < 
š¡s_to_´oûss
; ++inst_num) {

1275 
DynIn¡PŒ
 
š¡
;

1277 
š¡
 = 
äomR’ame
->
š¡s
[
š¡_num
];

1278 
Th»adID
 
tid
 = 
š¡
->
th»adNumb”
;

1280 ià(!
š¡
->
	`isSquashed
() &&

1281 
comm™Stus
[
tid
] !ğ
ROBSquashšg
 &&

1282 
comm™Stus
[
tid
] !ğ
T¿pP’dšg
) {

1283 
chªgedROBNumEÁr›s
[
tid
] = 
Œue
;

1285 
	`DPRINTF
(
Comm™
, "Inserting PC %s [sn:%i] [tid:%i] into ROB.\n",

1286 
š¡
->
	`pcS‹
(), in¡->
£qNum
, 
tid
);

1288 
rob
->
	`š£¹In¡
(
š¡
);

1290 
	`as£¹
(
rob
->
	`g‘Th»adEÁr›s
(
tid
è<ğrob->
	`g‘MaxEÁr›s
(tid));

1292 
younge¡SeqNum
[
tid
] = 
š¡
->
£qNum
;

1294 
	`DPRINTF
(
Comm™
, "Instruction PC %s [sn:%i] [tid:%i] was "

1296 
š¡
->
	`pcS‹
(), in¡->
£qNum
, 
tid
);

1299 
	}
}

1301 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1303 
	gDeçuÉComm™
<
	gIm¶
>::
	$skidIn£¹
()

1305 
	`DPRINTF
(
Comm™
, "Attemptingo‡ny instructions from„ename into "

1308 
š¡_num
 = 0; in¡_num < 
äomR’ame
->
size
; ++inst_num) {

1309 
DynIn¡PŒ
 
š¡
 = 
äomR’ame
->
š¡s
[
š¡_num
];

1311 ià(!
š¡
->
	`isSquashed
()) {

1312 
	`DPRINTF
(
Comm™
, "Inserting PC %s [sn:%i] [tid:%i] into ",

1313 "skidBufãr.\n", 
š¡
->
	`pcS‹
(), in¡->
£qNum
,

1314 
š¡
->
th»adNumb”
);

1315 
skidBufãr
.
	`push
(
š¡
);

1317 
	`DPRINTF
(
Comm™
, "Instruction PC %s [sn:%i] [tid:%i] was "

1319 
š¡
->
	`pcS‹
(), in¡->
£qNum
, in¡->
th»adNumb”
);

1322 
	}
}

1324 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1326 
	gDeçuÉComm™
<
	gIm¶
>::
	$m¬kCom¶‘edIn¡s
()

1330 
š¡_num
 = 0;

1331 
š¡_num
 < 
äomIEW
->
size
 && fromIEW->
š¡s
[inst_num];

1332 ++
š¡_num
)

1334 ià(!
äomIEW
->
š¡s
[
š¡_num
]->
	`isSquashed
()) {

1335 
	`DPRINTF
(
Comm™
, "[tid:%i]: Marking PC %s, [sn:%lli]„eady "

1337 
äomIEW
->
š¡s
[
š¡_num
]->
th»adNumb”
,

1338 
äomIEW
->
š¡s
[
š¡_num
]->
	`pcS‹
(),

1339 
äomIEW
->
š¡s
[
š¡_num
]->
£qNum
);

1342 
äomIEW
->
š¡s
[
š¡_num
]->
	`£tCªComm™
();

1345 
	}
}

1347 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1348 
boŞ


1349 
	gDeçuÉComm™
<
	gIm¶
>::
	$robDÚeSquashšg
()

1351 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

1352 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

1354 
th»ads
 !ğ
’d
) {

1355 
Th»adID
 
tid
 = *
th»ads
++;

1357 ià(!
rob
->
	`isDÚeSquashšg
(
tid
))

1358  
çl£
;

1361  
Œue
;

1362 
	}
}

1364 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1366 
	gDeçuÉComm™
<
	gIm¶
>::
	$upd©eComIn¡Sts
(
DynIn¡PŒ
 &
š¡
)

1368 
Th»adID
 
tid
 = 
š¡
->
th»adNumb”
;

1370 ià(!
š¡
->
	`isMiüoİ
(è|| in¡->
	`isLa¡Miüoİ
())

1371 
š¡sComm™‹d
[
tid
]++;

1372 
İsComm™‹d
[
tid
]++;

1376 ià(!
š¡
->
	`isNİ
(è&& !š¡->
	`isIn¡P»ãtch
()) {

1377 
ıu
->
	`š¡DÚe
(
tid
, 
š¡
);

1383 ià(
š¡
->
	`isCÚŒŞ
())

1384 
¡©ComB¿nches
[
tid
]++;

1389 ià(
š¡
->
	`isMemRef
()) {

1390 
¡©ComRefs
[
tid
]++;

1392 ià(
š¡
->
	`isLßd
()) {

1393 
¡©ComLßds
[
tid
]++;

1397 ià(
š¡
->
	`isMemB¬r›r
()) {

1398 
¡©ComMemb¬s
[
tid
]++;

1402 ià(
š¡
->
	`isIÁeg”
())

1403 
¡©ComIÁeg”
[
tid
]++;

1406 ià(
š¡
->
	`isFlßtšg
())

1407 
¡©ComFlßtšg
[
tid
]++;

1410 ià(
š¡
->
	`isC®l
())

1411 
¡©ComFunùiÚC®ls
[
tid
]++;

1413 
	}
}

1420 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1421 
Th»adID


1422 
	gDeçuÉComm™
<
	gIm¶
>::
	$g‘Comm™tšgTh»ad
()

1424 ià(
numTh»ads
 > 1) {

1425 
comm™PŞicy
) {

1427 
Agg»ssive
:

1431  
	`Şde¡R—dy
();

1433 
RoundRobš
:

1434  
	`roundRobš
();

1436 
Olde¡R—dy
:

1437  
	`Şde¡R—dy
();

1440  
Inv®idTh»adID
;

1443 
	`as£¹
(!
aùiveTh»ads
->
	`em±y
());

1444 
Th»adID
 
tid
 = 
aùiveTh»ads
->
	`äÚt
();

1446 ià(
comm™Stus
[
tid
] =ğ
RuÂšg
 ||

1447 
comm™Stus
[
tid
] =ğ
IdË
 ||

1448 
comm™Stus
[
tid
] =ğ
F‘chT¿pP’dšg
) {

1449  
tid
;

1451  
Inv®idTh»adID
;

1454 
	}
}

1456 
	g‹m¶©e
<
şass
 
	gIm¶
>

1457 
Th»adID


1458 
	gDeçuÉComm™
<
	gIm¶
>::
	$roundRobš
()

1460 
li¡
<
Th»adID
>::
™”©Ü
 
´i_™”
 = 
´iÜ™y_li¡
.
	`begš
();

1461 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
´iÜ™y_li¡
.
	`’d
();

1463 
´i_™”
 !ğ
’d
) {

1464 
Th»adID
 
tid
 = *
´i_™”
;

1466 ià(
comm™Stus
[
tid
] =ğ
RuÂšg
 ||

1467 
comm™Stus
[
tid
] =ğ
IdË
 ||

1468 
comm™Stus
[
tid
] =ğ
F‘chT¿pP’dšg
) {

1470 ià(
rob
->
	`isH—dR—dy
(
tid
)) {

1471 
´iÜ™y_li¡
.
	`”a£
(
´i_™”
);

1472 
´iÜ™y_li¡
.
	`push_back
(
tid
);

1474  
tid
;

1478 
´i_™”
++;

1481  
Inv®idTh»adID
;

1482 
	}
}

1484 
	g‹m¶©e
<
şass
 
	gIm¶
>

1485 
Th»adID


1486 
	gDeçuÉComm™
<
	gIm¶
>::
	$Şde¡R—dy
()

1488 
Şde¡
 = 0;

1489 
boŞ
 
fœ¡
 = 
Œue
;

1491 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

1492 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

1494 
th»ads
 !ğ
’d
) {

1495 
Th»adID
 
tid
 = *
th»ads
++;

1497 ià(!
rob
->
	`isEm±y
(
tid
) &&

1498 (
comm™Stus
[
tid
] =ğ
RuÂšg
 ||

1499 
comm™Stus
[
tid
] =ğ
IdË
 ||

1500 
comm™Stus
[
tid
] =ğ
F‘chT¿pP’dšg
)) {

1502 ià(
rob
->
	`isH—dR—dy
(
tid
)) {

1504 
DynIn¡PŒ
 
h—d_š¡
 = 
rob
->
	`»adH—dIn¡
(
tid
);

1506 ià(
fœ¡
) {

1507 
Şde¡
 = 
tid
;

1508 
fœ¡
 = 
çl£
;

1509 } ià(
h—d_š¡
->
£qNum
 < 
Şde¡
) {

1510 
Şde¡
 = 
tid
;

1516 ià(!
fœ¡
) {

1517  
Şde¡
;

1519  
Inv®idTh»adID
;

1521 
	}
}

	@cpu.cc

46 
	~"¬ch/k”Ãl_¡©s.hh
"

47 
	~"cÚfig/the_i§.hh
"

48 
	~"ıu/check”/ıu.hh
"

49 
	~"ıu/check”/th»ad_cÚ‹xt.hh
"

50 
	~"ıu/o3/ıu.hh
"

51 
	~"ıu/o3/i§_¥ecific.hh
"

52 
	~"ıu/o3/th»ad_cÚ‹xt.hh
"

53 
	~"ıu/aùiv™y.hh
"

54 
	~"ıu/qu›sû_ev’t.hh
"

55 
	~"ıu/sim¶e_th»ad.hh
"

56 
	~"ıu/th»ad_cÚ‹xt.hh
"

57 
	~"debug/Aùiv™y.hh
"

58 
	~"debug/D¿š.hh
"

59 
	~"debug/O3CPU.hh
"

60 
	~"debug/Qu›sû.hh
"

61 
	~"’ums/MemÜyMode.hh
"

62 
	~"sim/cÜe.hh
"

63 
	~"sim/fuÎ_sy¡em.hh
"

64 
	~"sim/´oûss.hh
"

65 
	~"sim/¡©_cÚŒŞ.hh
"

66 
	~"sim/sy¡em.hh
"

68 #ià
THE_ISA
 =ğ
ALPHA_ISA


69 
	~"¬ch/®pha/oså®.hh
"

70 
	~"debug/Aùiv™y.hh
"

73 
	gBa£CPUP¬ams
;

75 
usšg
 
Çme¥aû
 
	gTheISA
;

76 
usšg
 
Çme¥aû
 
	g¡d
;

78 
	gBa£O3CPU
::
	$Ba£O3CPU
(
Ba£CPUP¬ams
 *
·¿ms
)

79 : 
	$Ba£CPU
(
·¿ms
)

81 
	}
}

84 
Ba£O3CPU
::
	$»gSts
()

86 
Ba£CPU
::
	`»gSts
();

87 
	}
}

89 
	g‹m¶©e
<
şass
 
	gIm¶
>

90 
boŞ


91 
	gFuÎO3CPU
<
	gIm¶
>::
IÿchePÜt
::
	$»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
)

93 
	`DPRINTF
(
O3CPU
, "Fetch unit„eceivediming\n");

95 
	`as£¹
(!(
pkt
->
	`memInhib™As£¹ed
(è&& !pkt->
	`sh¬edAs£¹ed
()));

96 
ãtch
->
	`´oûssCacheCom¶‘iÚ
(
pkt
);

98  
Œue
;

99 
	}
}

101 
	g‹m¶©e
<
şass
 
	gIm¶
>

103 
	gFuÎO3CPU
<
	gIm¶
>::
IÿchePÜt
::
	$»cvR‘ry
()

105 
ãtch
->
	`»cvR‘ry
();

106 
	}
}

108 
	g‹m¶©e
 <
şass
 
	gIm¶
>

109 
boŞ


110 
	gFuÎO3CPU
<
	gIm¶
>::
DÿchePÜt
::
	$»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
)

112  
lsq
->
	`»cvTimšgRe¥
(
pkt
);

113 
	}
}

115 
	g‹m¶©e
 <
şass
 
	gIm¶
>

117 
	gFuÎO3CPU
<
	gIm¶
>::
DÿchePÜt
::
	$»cvTimšgSnoİReq
(
Pack‘PŒ
 
pkt
)

119 
lsq
->
	`»cvTimšgSnoİReq
(
pkt
);

120 
	}
}

122 
	g‹m¶©e
 <
şass
 
	gIm¶
>

124 
	gFuÎO3CPU
<
	gIm¶
>::
DÿchePÜt
::
	$»cvR‘ry
()

126 
lsq
->
	`»cvR‘ry
();

127 
	}
}

129 
	g‹m¶©e
 <
şass
 
	gIm¶
>

130 
	gFuÎO3CPU
<
	gIm¶
>::
TickEv’t
::TickEv’t(
FuÎO3CPU
<
Im¶
> *
c
)

131 : 
Ev’t
(
CPU_Tick_Pri
), 
	$ıu
(
c
)

133 
	}
}

135 
	g‹m¶©e
 <
şass
 
	gIm¶
>

137 
	gFuÎO3CPU
<
	gIm¶
>::
TickEv’t
::
	$´oûss
()

139 
ıu
->
	`tick
();

140 
	}
}

142 
	g‹m¶©e
 <
şass
 
	gIm¶
>

144 
	gFuÎO3CPU
<
	gIm¶
>::
TickEv’t
::
	$desütiÚ
() const

147 
	}
}

149 
	g‹m¶©e
 <
şass
 
	gIm¶
>

150 
	gFuÎO3CPU
<
	gIm¶
>::
Aùiv©eTh»adEv’t
::
	$Aùiv©eTh»adEv’t
()

151 : 
	$Ev’t
(
CPU_Sw™ch_Pri
)

153 
	}
}

155 
‹m¶©e
 <
şass
 
Im¶
>

157 
FuÎO3CPU
<
Im¶
>::
Aùiv©eTh»adEv’t
::
š™
(
th»ad_num
,

158 
FuÎO3CPU
<
Im¶
> *
th»ad_ıu
)

160 
	gtid
 = 
th»ad_num
;

161 
	gıu
 = 
th»ad_ıu
;

164 
	g‹m¶©e
 <
şass
 
	gIm¶
>

166 
	gFuÎO3CPU
<
	gIm¶
>::
Aùiv©eTh»adEv’t
::
	$´oûss
()

168 
ıu
->
	`aùiv©eTh»ad
(
tid
);

169 
	}
}

171 
	g‹m¶©e
 <
şass
 
	gIm¶
>

173 
	gFuÎO3CPU
<
	gIm¶
>::
Aùiv©eTh»adEv’t
::
	$desütiÚ
() const

176 
	}
}

178 
	g‹m¶©e
 <
şass
 
	gIm¶
>

179 
	gFuÎO3CPU
<
	gIm¶
>::
D—Îoÿ‹CÚ‹xtEv’t
::
	$D—Îoÿ‹CÚ‹xtEv’t
()

180 : 
	`Ev’t
(
CPU_Tick_Pri
+1), 
	`tid
(0), 
	`»move
(
çl£
), 
	$ıu
(
NULL
)

182 
	}
}

184 
	g‹m¶©e
 <
şass
 
	gIm¶
>

186 
	gFuÎO3CPU
<
	gIm¶
>::
D—Îoÿ‹CÚ‹xtEv’t
::
š™
(
th»ad_num
,

187 
FuÎO3CPU
<
Im¶
> *
th»ad_ıu
)

189 
	gtid
 = 
th»ad_num
;

190 
	gıu
 = 
th»ad_ıu
;

191 
	g»move
 = 
çl£
;

194 
	g‹m¶©e
 <
şass
 
	gIm¶
>

196 
	gFuÎO3CPU
<
	gIm¶
>::
D—Îoÿ‹CÚ‹xtEv’t
::
	$´oûss
()

198 
ıu
->
	`d—ùiv©eTh»ad
(
tid
);

199 ià(
»move
)

200 
ıu
->
	`»moveTh»ad
(
tid
);

201 
	}
}

203 
	g‹m¶©e
 <
şass
 
	gIm¶
>

205 
	gFuÎO3CPU
<
	gIm¶
>::
D—Îoÿ‹CÚ‹xtEv’t
::
	$desütiÚ
() const

208 
	}
}

210 
	g‹m¶©e
 <
şass
 
	gIm¶
>

211 
	gFuÎO3CPU
<
	gIm¶
>::
	$FuÎO3CPU
(
D”ivO3CPUP¬ams
 *
·¿ms
)

212 : 
	`Ba£O3CPU
(
·¿ms
),

213 
	`™b
(
·¿ms
->
™b
),

214 
	`dtb
(
·¿ms
->
dtb
),

215 
	`tickEv’t
(
this
),

216 #iâdeà
NDEBUG


217 
	`š¡couÁ
(0),

219 
	`»moveIn¡sThisCyşe
(
çl£
),

220 
	`ãtch
(
this
, 
·¿ms
),

221 
	`decode
(
this
, 
·¿ms
),

222 
	`»Çme
(
this
, 
·¿ms
),

223 
	`›w
(
this
, 
·¿ms
),

224 
	`comm™
(
this
, 
·¿ms
),

226 
	`»gFe
(
this
, 
·¿ms
->
numPhysIÁRegs
,

227 
·¿ms
->
numPhysFlßtRegs
),

229 
	`ä“Li¡
(
·¿ms
->
numTh»ads
,

230 
TheISA
::
NumIÁRegs
, 
·¿ms
->
numPhysIÁRegs
,

231 
TheISA
::
NumFlßtRegs
, 
·¿ms
->
numPhysFlßtRegs
),

233 
	`rob
(
this
,

234 
·¿ms
->
numROBEÁr›s
,…¬ams->
squashWidth
,

235 
·¿ms
->
smtROBPŞicy
,…¬ams->
smtROBTh»shŞd
,

236 
·¿ms
->
numTh»ads
),

238 
	`scÜebßrd
(
·¿ms
->
numTh»ads
,

239 
TheISA
::
NumIÁRegs
, 
·¿ms
->
numPhysIÁRegs
,

240 
TheISA
::
NumFlßtRegs
, 
·¿ms
->
numPhysFlßtRegs
,

241 
TheISA
::
NumMiscRegs
 * 
numTh»ads
,

242 
TheISA
::
Z”oReg
),

244 
	`i§
(
numTh»ads
, 
NULL
),

246 
	`iÿchePÜt
(&
ãtch
, 
this
),

247 
	`dÿchePÜt
(&
›w
.
ld¡Queue
, 
this
),

249 
	`timeBufãr
(
·¿ms
->
backComSize
,…¬ams->
fÜw¬dComSize
),

250 
	`ãtchQueue
(
·¿ms
->
backComSize
,…¬ams->
fÜw¬dComSize
),

251 
	`decodeQueue
(
·¿ms
->
backComSize
,…¬ams->
fÜw¬dComSize
),

252 
	`»ÇmeQueue
(
·¿ms
->
backComSize
,…¬ams->
fÜw¬dComSize
),

253 
	`›wQueue
(
·¿ms
->
backComSize
,…¬ams->
fÜw¬dComSize
),

254 
	`aùiv™yRec
(
	`Çme
(), 
NumSges
,

255 
·¿ms
->
backComSize
 +…¬ams->
fÜw¬dComSize
,

256 
·¿ms
->
aùiv™y
),

258 
	`glob®SeqNum
(1),

259 
	`sy¡em
(
·¿ms
->
sy¡em
),

260 
	`d¿šMªag”
(
NULL
),

261 
	`Ï¡RuÂšgCyşe
(
	$curCyşe
())

263 ià(!
·¿ms
->
sw™ched_out
) {

264 
_¡©us
 = 
RuÂšg
;

266 
_¡©us
 = 
Sw™chedOut
;

269 ià(
·¿ms
->
check”
) {

270 
Ba£CPU
 *
‹mp_check”
 = 
·¿ms
->
check”
;

271 
check”
 = 
dyÇmic_ÿ¡
<
Check”
<
Im¶
> *>(
‹mp_check”
);

272 
check”
->
	`£tIÿchePÜt
(&
iÿchePÜt
);

273 
check”
->
	`£tSy¡em
(
·¿ms
->
sy¡em
);

275 
check”
 = 
NULL
;

278 ià(!
FuÎSy¡em
) {

279 
th»ad
.
	`»size
(
numTh»ads
);

280 
tids
.
	`»size
(
numTh»ads
);

288 
ãtch
.
	`£tAùiveTh»ads
(&
aùiveTh»ads
);

289 
decode
.
	`£tAùiveTh»ads
(&
aùiveTh»ads
);

290 
»Çme
.
	`£tAùiveTh»ads
(&
aùiveTh»ads
);

291 
›w
.
	`£tAùiveTh»ads
(&
aùiveTh»ads
);

292 
comm™
.
	`£tAùiveTh»ads
(&
aùiveTh»ads
);

295 
ãtch
.
	`£tTimeBufãr
(&
timeBufãr
);

296 
decode
.
	`£tTimeBufãr
(&
timeBufãr
);

297 
»Çme
.
	`£tTimeBufãr
(&
timeBufãr
);

298 
›w
.
	`£tTimeBufãr
(&
timeBufãr
);

299 
comm™
.
	`£tTimeBufãr
(&
timeBufãr
);

302 
ãtch
.
	`£tF‘chQueue
(&
ãtchQueue
);

303 
decode
.
	`£tF‘chQueue
(&
ãtchQueue
);

304 
comm™
.
	`£tF‘chQueue
(&
ãtchQueue
);

305 
decode
.
	`£tDecodeQueue
(&
decodeQueue
);

306 
»Çme
.
	`£tDecodeQueue
(&
decodeQueue
);

307 
»Çme
.
	`£tR’ameQueue
(&
»ÇmeQueue
);

308 
›w
.
	`£tR’ameQueue
(&
»ÇmeQueue
);

309 
›w
.
	`£tIEWQueue
(&
›wQueue
);

310 
comm™
.
	`£tIEWQueue
(&
›wQueue
);

311 
comm™
.
	`£tR’ameQueue
(&
»ÇmeQueue
);

313 
comm™
.
	`£tIEWSge
(&
›w
);

314 
»Çme
.
	`£tIEWSge
(&
›w
);

315 
»Çme
.
	`£tComm™Sge
(&
comm™
);

317 
Th»adID
 
aùive_th»ads
;

318 ià(
FuÎSy¡em
) {

319 
aùive_th»ads
 = 1;

321 
aùive_th»ads
 = 
·¿ms
->
wÜklßd
.
	`size
();

323 ià(
aùive_th»ads
 > 
Im¶
::
MaxTh»ads
) {

324 
	`·nic
("Workload Sizeoo†arge. Increasehe 'MaxThreads' "

331 
	`as£¹
(
·¿ms
->
numPhysIÁRegs
 >ğ
numTh»ads
 * 
TheISA
::
NumIÁRegs
);

332 
	`as£¹
(
·¿ms
->
numPhysFlßtRegs
 >ğ
numTh»ads
 * 
TheISA
::
NumFlßtRegs
);

334 
»Çme
.
	`£tScÜebßrd
(&
scÜebßrd
);

335 
›w
.
	`£tScÜebßrd
(&
scÜebßrd
);

338 
PhysRegIndex
 
Ìeg_idx
 = 0;

339 
PhysRegIndex
 
äeg_idx
 = 
·¿ms
->
numPhysIÁRegs
;

341 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

342 
boŞ
 
bšdRegs
 = (
tid
 <ğ
aùive_th»ads
 - 1);

344 
i§
[
tid
] = 
·¿ms
->isa[tid];

346 
comm™R’ameM­
[
tid
].
	`š™
(
TheISA
::
NumIÁRegs
,

347 
·¿ms
->
numPhysIÁRegs
,

348 
Ìeg_idx
,

350 
TheISA
::
NumFlßtRegs
,

351 
·¿ms
->
numPhysFlßtRegs
,

352 
äeg_idx
,

354 
TheISA
::
NumMiscRegs
,

356 
TheISA
::
Z”oReg
,

357 
TheISA
::
Z”oReg
,

359 
tid
,

360 
çl£
);

362 
»ÇmeM­
[
tid
].
	`š™
(
TheISA
::
NumIÁRegs
,

363 
·¿ms
->
numPhysIÁRegs
,

364 
Ìeg_idx
,

366 
TheISA
::
NumFlßtRegs
,

367 
·¿ms
->
numPhysFlßtRegs
,

368 
äeg_idx
,

370 
TheISA
::
NumMiscRegs
,

372 
TheISA
::
Z”oReg
,

373 
TheISA
::
Z”oReg
,

375 
tid
,

376 
bšdRegs
);

378 
aùiv©eTh»adEv’t
[
tid
].
	`š™
Ñid, 
this
);

379 
d—Îoÿ‹CÚ‹xtEv’t
[
tid
].
	`š™
Ñid, 
this
);

382 
»Çme
.
	`£tR’ameM­
(
»ÇmeM­
);

383 
comm™
.
	`£tR’ameM­
(
comm™R’ameM­
);

386 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++)

387 
»ÇmeM­
[
tid
].
	`£tF»eLi¡
(&
ä“Li¡
);

388 
»Çme
.
	`£tF»eLi¡
(&
ä“Li¡
);

391 
comm™
.
	`£tROB
(&
rob
);

393 
Ï¡Aùiv©edCyşe
 = 0;

396 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++)

397 
glob®SeqNum
[
tid
] = 1;

400 
cÚ‹xtSw™ch
 = 
çl£
;

401 
	`DPRINTF
(
O3CPU
, "Creating O3CPU object.\n");

404 
this
->
th»ad
.
	`»size
Ñhis->
numTh»ads
);

406 
Th»adID
 
tid
 = 0;id < 
this
->
numTh»ads
; ++tid) {

407 ià(
FuÎSy¡em
) {

409 
	`as£¹
(
this
->
numTh»ads
 == 1);

410 
this
->
th»ad
[
tid
] = 
Ãw
 
	`Th»ad
Ñhis, 0, 
NULL
);

412 ià(
tid
 < 
·¿ms
->
wÜklßd
.
	`size
()) {

413 
	`DPRINTF
(
O3CPU
, "Workload[%i]…rocess is %#x",

414 
tid
, 
this
->
th»ad
[tid]);

415 
this
->
th»ad
[
tid
] = 
Ãw
 
ty³Çme
 
FuÎO3CPU
<
Im¶
>::
	`Th»ad
(

416 (
ty³Çme
 
Im¶
::
O3CPU
 *)(
this
),

417 
tid
, 
·¿ms
->
wÜklßd
[tid]);

424 
Proûss
* 
dummy_´oc
 = 
NULL
;

426 
this
->
th»ad
[
tid
] = 
Ãw
 
ty³Çme
 
FuÎO3CPU
<
Im¶
>::
	`Th»ad
(

427 (
ty³Çme
 
Im¶
::
O3CPU
 *)(
this
),

428 
tid
, 
dummy_´oc
);

433 
Th»adCÚ‹xt
 *
tc
;

436 
O3Th»adCÚ‹xt
<
Im¶
> *
o3_tc
 = 
Ãw
 O3ThreadContext<Impl>;

438 
tc
 = 
o3_tc
;

442 ià(
·¿ms
->
check”
) {

443 
tc
 = 
Ãw
 
Check”Th»adCÚ‹xt
<
O3Th»adCÚ‹xt
<
Im¶
> >(

444 
o3_tc
, 
this
->
check”
);

447 
o3_tc
->
ıu
 = (
ty³Çme
 
Im¶
::
O3CPU
 *)(
this
);

448 
	`as£¹
(
o3_tc
->
ıu
);

449 
o3_tc
->
th»ad
 = 
this
->th»ad[
tid
];

451 ià(
FuÎSy¡em
) {

453 
this
->
th»ad
[
tid
]->
qu›sûEv’t
 = 
Ãw
 
	`EndQu›sûEv’t
(
tc
);

456 
this
->
th»ad
[
tid
]->
tc
 =c;

459 
this
->
th»adCÚ‹xts
.
	`push_back
(
tc
);

463 ià(!
·¿ms
->
sw™ched_out
 && !
š‹¼u±s
) {

464 
	`çl
("FullO3CPU %s has‚o interrupt controller.\n"

465 "Ensu» c»©eIÁ”ru±CÚŒŞËr(èi ÿÎed.\n", 
	`Çme
());

468 
Th»adID
 
tid
 = 0;id < 
this
->
numTh»ads
;id++)

469 
this
->
th»ad
[
tid
]->
	`£tFuncExeIn¡
(0);

470 
	}
}

472 
	g‹m¶©e
 <
şass
 
	gIm¶
>

473 
	gFuÎO3CPU
<
	gIm¶
>::~
	$FuÎO3CPU
()

475 
	}
}

477 
‹m¶©e
 <
şass
 
Im¶
>

479 
FuÎO3CPU
<
Im¶
>::
	$»gSts
()

481 
Ba£O3CPU
::
	`»gSts
();

484 
timesIdËd


485 .
	`Çme
(name() + ".timesIdled")

486 .
	`desc
("Number ofimeshatheƒntire CPU went into‡n idle state‡nd"

488 .
	`´”eq
(
timesIdËd
);

490 
idËCyşes


491 .
	`Çme
(name() + ".idleCycles")

492 .
	`desc
("Total‚umber of cycleshathe CPU has spent unscheduled due "

494 .
	`´”eq
(
idËCyşes
);

496 
qu›sûCyşes


497 .
	`Çme
(name() + ".quiesceCycles")

498 .
	`desc
("Total‚umber of cycleshat CPU has spent quiesced or waiting "

500 .
	`´”eq
(
qu›sûCyşes
);

506 
comm™‹dIn¡s


507 .
	`š™
(
numTh»ads
)

508 .
	`Çme
(name() + ".committedInsts")

509 .
	`desc
("Number of Instructions Simulated");

511 
comm™‹dOps


512 .
	`š™
(
numTh»ads
)

513 .
	`Çme
(name() + ".committedOps")

514 .
	`desc
("Number of Ops (including micro ops) Simulated");

516 
tÙ®Comm™‹dIn¡s


517 .
	`Çme
(name() + ".committedInsts_total")

518 .
	`desc
("Number of Instructions Simulated");

520 
ıi


521 .
	`Çme
(name() + ".cpi")

522 .
	`desc
("CPI: Cycles Per Instruction")

523 .
	`´ecisiÚ
(6);

524 
ıi
 = 
numCyşes
 / 
comm™‹dIn¡s
;

526 
tÙ®Cpi


527 .
	`Çme
(name() + ".cpi_total")

528 .
	`desc
("CPI: Total CPI of All Threads")

529 .
	`´ecisiÚ
(6);

530 
tÙ®Cpi
 = 
numCyşes
 / 
tÙ®Comm™‹dIn¡s
;

532 
c


533 .
	`Çme
(name() + ".ipc")

534 .
	`desc
("IPC: Instructions Per Cycle")

535 .
	`´ecisiÚ
(6);

536 
c
 = 
comm™‹dIn¡s
 / 
numCyşes
;

538 
tÙ®Ipc


539 .
	`Çme
(name() + ".ipc_total")

540 .
	`desc
("IPC: Total IPC of All Threads")

541 .
	`´ecisiÚ
(6);

542 
tÙ®Ipc
 = 
tÙ®Comm™‹dIn¡s
 / 
numCyşes
;

544 
this
->
ãtch
.
	`»gSts
();

545 
this
->
decode
.
	`»gSts
();

546 
this
->
»Çme
.
	`»gSts
();

547 
this
->
›w
.
	`»gSts
();

548 
this
->
comm™
.
	`»gSts
();

549 
this
->
rob
.
	`»gSts
();

551 
štRegfeR—ds


552 .
	`Çme
(name() + ".int_regfile_reads")

553 .
	`desc
("number of integer„egfile„eads")

554 .
	`´”eq
(
štRegfeR—ds
);

556 
štRegfeWr™es


557 .
	`Çme
(name() + ".int_regfile_writes")

558 .
	`desc
("number of integer„egfile writes")

559 .
	`´”eq
(
štRegfeWr™es
);

561 
åRegfeR—ds


562 .
	`Çme
(name() + ".fp_regfile_reads")

563 .
	`desc
("number of floating„egfile„eads")

564 .
	`´”eq
(
åRegfeR—ds
);

566 
åRegfeWr™es


567 .
	`Çme
(name() + ".fp_regfile_writes")

568 .
	`desc
("number of floating„egfile writes")

569 .
	`´”eq
(
åRegfeWr™es
);

571 
miscRegfeR—ds


572 .
	`Çme
(name() + ".misc_regfile_reads")

573 .
	`desc
("number of misc„egfile„eads")

574 .
	`´”eq
(
miscRegfeR—ds
);

576 
miscRegfeWr™es


577 .
	`Çme
(name() + ".misc_regfile_writes")

578 .
	`desc
("number of misc„egfile writes")

579 .
	`´”eq
(
miscRegfeWr™es
);

580 
	}
}

582 
	g‹m¶©e
 <
şass
 
	gIm¶
>

584 
	gFuÎO3CPU
<
	gIm¶
>::
	$tick
()

586 
	`DPRINTF
(
O3CPU
, "\n\nFullO3CPU: Ticking main, FullO3CPU.\n");

587 
	`as£¹
(!
	`sw™chedOut
());

588 
	`as£¹
(
	`g‘D¿šS‹
(è!ğ
D¿šabË
::
D¿šed
);

590 ++
numCyşes
;

595 
ãtch
.
	`tick
();

597 
decode
.
	`tick
();

599 
»Çme
.
	`tick
();

601 
›w
.
	`tick
();

603 
comm™
.
	`tick
();

605 ià(!
FuÎSy¡em
)

606 
	`doCÚ‹xtSw™ch
();

609 
timeBufãr
.
	`advªû
();

611 
ãtchQueue
.
	`advªû
();

612 
decodeQueue
.
	`advªû
();

613 
»ÇmeQueue
.
	`advªû
();

614 
›wQueue
.
	`advªû
();

616 
aùiv™yRec
.
	`advªû
();

618 ià(
»moveIn¡sThisCyşe
) {

619 
	`ş—nUpRemovedIn¡s
();

622 ià(!
tickEv’t
.
	`scheduËd
()) {

623 ià(
_¡©us
 =ğ
Sw™chedOut
) {

624 
	`DPRINTF
(
O3CPU
, "Switched out!\n");

626 
Ï¡RuÂšgCyşe
 = 
	`curCyşe
();

627 } ià(!
aùiv™yRec
.
	`aùive
(è|| 
_¡©us
 =ğ
IdË
) {

628 
	`DPRINTF
(
O3CPU
, "Idle!\n");

629 
Ï¡RuÂšgCyşe
 = 
	`curCyşe
();

630 
timesIdËd
++;

632 
	`scheduË
(
tickEv’t
, 
	`şockEdge
(
	`Cyşes
(1)));

633 
	`DPRINTF
(
O3CPU
, "Scheduling‚extick!\n");

637 ià(!
FuÎSy¡em
)

638 
	`upd©eTh»adPriÜ™y
();

640 
	`ŒyD¿š
();

641 
	}
}

643 
	g‹m¶©e
 <
şass
 
	gIm¶
>

645 
	gFuÎO3CPU
<
	gIm¶
>::
	$š™
()

647 
Ba£CPU
::
	`š™
();

649 ià(!
	`·¿ms
()->
sw™ched_out
 &&

650 
sy¡em
->
	`g‘MemÜyMode
(è!ğ
Enums
::
timšg
) {

651 
	`çl
("The O3 CPU„equireshe memory systemo be in "

655 
Th»adID
 
tid
 = 0;id < 
numTh»ads
; ++tid) {

658 
th»ad
[
tid
]->
noSquashFromTC
 = 
Œue
;

660 
th»ad
[
tid
]->
	`š™MemProx›s
Ñh»ad[tid]->
	`g‘TC
());

663 ià(
FuÎSy¡em
 && !
	`·¿ms
()->
sw™ched_out
) {

664 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

665 
Th»adCÚ‹xt
 *
¤c_tc
 = 
th»adCÚ‹xts
[
tid
];

666 
TheISA
::
	`š™CPU
(
¤c_tc
, src_tc->
	`cÚ‹xtId
());

671 
tid
 = 0;id < 
numTh»ads
; ++tid)

672 
th»ad
[
tid
]->
noSquashFromTC
 = 
çl£
;

674 
comm™
.
	`£tTh»ads
(
th»ad
);

675 
	}
}

677 
	g‹m¶©e
 <
şass
 
	gIm¶
>

679 
	gFuÎO3CPU
<
	gIm¶
>::
	$¡¬tup
()

681 
tid
 = 0;id < 
numTh»ads
; ++tid)

682 
i§
[
tid
]->
	`¡¬tup
(
th»adCÚ‹xts
[tid]);

684 
ãtch
.
	`¡¬tupSge
();

685 
decode
.
	`¡¬tupSge
();

686 
›w
.
	`¡¬tupSge
();

687 
»Çme
.
	`¡¬tupSge
();

688 
comm™
.
	`¡¬tupSge
();

689 
	}
}

691 
	g‹m¶©e
 <
şass
 
	gIm¶
>

693 
	gFuÎO3CPU
<
	gIm¶
>::
	$aùiv©eTh»ad
(
Th»adID
 
tid
)

695 
li¡
<
Th»adID
>::
™”©Ü
 
isAùive
 =

696 
¡d
::
	`fšd
(
aùiveTh»ads
.
	`begš
(),‡ùiveTh»ads.
	`’d
(), 
tid
);

698 
	`DPRINTF
(
O3CPU
, "[tid:%i]: C®lšg‡ùiv©th»ad.\n", 
tid
);

699 
	`as£¹
(!
	`sw™chedOut
());

701 ià(
isAùive
 =ğ
aùiveTh»ads
.
	`’d
()) {

702 
	`DPRINTF
(
O3CPU
, "[tid:%i]: Addingo‡ctivehreads†ist\n",

703 
tid
);

705 
aùiveTh»ads
.
	`push_back
(
tid
);

707 
	}
}

709 
	g‹m¶©e
 <
şass
 
	gIm¶
>

711 
	gFuÎO3CPU
<
	gIm¶
>::
	$d—ùiv©eTh»ad
(
Th»adID
 
tid
)

714 
li¡
<
Th»adID
>::
™”©Ü
 
th»ad_™
 =

715 
¡d
::
	`fšd
(
aùiveTh»ads
.
	`begš
(),‡ùiveTh»ads.
	`’d
(), 
tid
);

717 
	`DPRINTF
(
O3CPU
, "[tid:%i]: C®lšg d—ùiv©th»ad.\n", 
tid
);

718 
	`as£¹
(!
	`sw™chedOut
());

720 ià(
th»ad_™
 !ğ
aùiveTh»ads
.
	`’d
()) {

721 
	`DPRINTF
(
O3CPU
,"[tid:%i]: Removing from‡ctivehreads†ist\n",

722 
tid
);

723 
aùiveTh»ads
.
	`”a£
(
th»ad_™
);

725 
	}
}

727 
	g‹m¶©e
 <
şass
 
	gIm¶
>

728 
CouÁ”


729 
	gFuÎO3CPU
<
	gIm¶
>::
	$tÙ®In¡s
() const

731 
CouÁ”
 
	`tÙ®
(0);

733 
Th»adID
 
size
 = 
th»ad
.
	`size
();

734 
Th»adID
 
i
 = 0; i < 
size
; i++)

735 
tÙ®
 +ğ
th»ad
[
i
]->
numIn¡
;

737  
tÙ®
;

738 
	}
}

740 
	g‹m¶©e
 <
şass
 
	gIm¶
>

741 
CouÁ”


742 
	gFuÎO3CPU
<
	gIm¶
>::
	$tÙ®Ops
() const

744 
CouÁ”
 
	`tÙ®
(0);

746 
Th»adID
 
size
 = 
th»ad
.
	`size
();

747 
Th»adID
 
i
 = 0; i < 
size
; i++)

748 
tÙ®
 +ğ
th»ad
[
i
]->
numOp
;

750  
tÙ®
;

751 
	}
}

753 
	g‹m¶©e
 <
şass
 
	gIm¶
>

755 
	gFuÎO3CPU
<
	gIm¶
>::
	$aùiv©eCÚ‹xt
(
Th»adID
 
tid
, 
Cyşes
 
d–ay
)

757 
	`as£¹
(!
	`sw™chedOut
());

760 ià(
d–ay
){

761 
	`DPRINTF
(
O3CPU
, "[tid:%i]: Schedulinghread contexto‡ctivate "

762 "Ú cyş%d\n", 
tid
, 
	`şockEdge
(
d–ay
));

763 
	`scheduËAùiv©eTh»adEv’t
(
tid
, 
d–ay
);

765 
	`aùiv©eTh»ad
(
tid
);

771 ià(
	`g‘D¿šS‹
(è=ğ
D¿šabË
::
D¿šed
)

776 ià(
Ï¡Aùiv©edCyşe
 =ğ0 ||†a¡Aùiv©edCyş< 
	`curTick
()) {

777 
	`scheduËTickEv’t
(
d–ay
);

781 
aùiv™yRec
.
	`aùiv™y
();

782 
ãtch
.
	`wakeFromQu›sû
();

784 
Cyşes
 
	`cyşes
(
	`curCyşe
(è- 
Ï¡RuÂšgCyşe
);

786 ià(
cyşes
 != 0)

787 --
cyşes
;

788 
qu›sûCyşes
 +ğ
cyşes
;

790 
Ï¡Aùiv©edCyşe
 = 
	`curTick
();

792 
_¡©us
 = 
RuÂšg
;

794 
	}
}

796 
	g‹m¶©e
 <
şass
 
	gIm¶
>

797 
boŞ


798 
	gFuÎO3CPU
<
	gIm¶
>::
	$scheduËD—Îoÿ‹CÚ‹xt
(
Th»adID
 
tid
, 
boŞ
 
»move
,

799 
Cyşes
 
d–ay
)

802 ià(
d–ay
){

803 
	`DPRINTF
(
O3CPU
, "[tid:%i]: Schedulinghread contexto deallocate "

804 "Úick %d\n", 
tid
, 
	`şockEdge
(
d–ay
));

805 
	`scheduËD—Îoÿ‹CÚ‹xtEv’t
(
tid
, 
»move
, 
d–ay
);

806  
çl£
;

808 
	`d—ùiv©eTh»ad
(
tid
);

809 ià(
»move
)

810 
	`»moveTh»ad
(
tid
);

811  
Œue
;

813 
	}
}

815 
	g‹m¶©e
 <
şass
 
	gIm¶
>

817 
	gFuÎO3CPU
<
	gIm¶
>::
	$su¥’dCÚ‹xt
(
Th»adID
 
tid
)

819 
	`DPRINTF
(
O3CPU
,"[tid: %i]: Su¥’dšg Th»ad CÚ‹xt.\n", 
tid
);

820 
	`as£¹
(!
	`sw™chedOut
());

821 
boŞ
 
d—Îoÿ‹d
 = 
	`scheduËD—Îoÿ‹CÚ‹xt
(
tid
, 
çl£
, 
	`Cyşes
(1));

823 ià((
aùiveTh»ads
.
	`size
(è=ğ1 && !
d—Îoÿ‹d
) ||

824 
aùiveTh»ads
.
	`size
() == 0)

825 
	`unscheduËTickEv’t
();

827 
	`DPRINTF
(
Qu›sû
, "Suspending Context\n");

828 
Ï¡RuÂšgCyşe
 = 
	`curCyşe
();

829 
_¡©us
 = 
IdË
;

830 
	}
}

832 
	g‹m¶©e
 <
şass
 
	gIm¶
>

834 
	gFuÎO3CPU
<
	gIm¶
>::
	$h®tCÚ‹xt
(
Th»adID
 
tid
)

837 
	`DPRINTF
(
O3CPU
,"[tid:%i]: H®ˆCÚ‹xˆÿÎed. D—Îoÿtšg", 
tid
);

838 
	`as£¹
(!
	`sw™chedOut
());

839 
	`scheduËD—Îoÿ‹CÚ‹xt
(
tid
, 
Œue
, 
	`Cyşes
(1));

840 
	}
}

842 
	g‹m¶©e
 <
şass
 
	gIm¶
>

844 
	gFuÎO3CPU
<
	gIm¶
>::
	$š£¹Th»ad
(
Th»adID
 
tid
)

846 
	`DPRINTF
(
O3CPU
,"[tid:%i] Initializinghread into CPU");

849 
Th»adCÚ‹xt
 *
¤c_tc
;

850 ià(
FuÎSy¡em
)

851 
¤c_tc
 = 
sy¡em
->
th»adCÚ‹xts
[
tid
];

853 
¤c_tc
 = 
	`tcBa£
(
tid
);

856 
œeg
 = 0; i»g < 
TheISA
::
NumIÁRegs
; ireg++) {

857 
PhysRegIndex
 
phys_»g
 = 
ä“Li¡
.
	`g‘IÁReg
();

859 
»ÇmeM­
[
tid
].
	`£tEÁry
(
œeg
,
phys_»g
);

860 
scÜebßrd
.
	`£tReg
(
phys_»g
);

864 
äeg
 = 0; f»g < 
TheISA
::
NumFlßtRegs
; freg++) {

865 
PhysRegIndex
 
phys_»g
 = 
ä“Li¡
.
	`g‘FlßtReg
();

867 
»ÇmeM­
[
tid
].
	`£tEÁry
(
äeg
,
phys_»g
);

868 
scÜebßrd
.
	`£tReg
(
phys_»g
);

875 
	`pcS‹
(
¤c_tc
->pcS‹(), 
tid
);

877 
¤c_tc
->
	`£tStus
(
Th»adCÚ‹xt
::
Aùive
);

879 
	`aùiv©eCÚ‹xt
(
tid
, 
	`Cyşes
(1));

882 
comm™
.
rob
->
	`»£tEÁr›s
();

883 
›w
.
	`»£tEÁr›s
();

884 
	}
}

886 
	g‹m¶©e
 <
şass
 
	gIm¶
>

888 
	gFuÎO3CPU
<
	gIm¶
>::
	$»moveTh»ad
(
Th»adID
 
tid
)

890 
	`DPRINTF
(
O3CPU
,"[tid:%i] Removšgh»ad cÚ‹xˆäom CPU.\n", 
tid
);

902 
œeg
 = 0; i»g < 
TheISA
::
NumIÁRegs
; ireg++) {

903 
PhysRegIndex
 
phys_»g
 = 
»ÇmeM­
[
tid
].
	`lookup
(
œeg
);

905 
scÜebßrd
.
	`un£tReg
(
phys_»g
);

906 
ä“Li¡
.
	`addReg
(
phys_»g
);

910 
äeg
 = 
TheISA
::
NumIÁRegs
; f»g < TheISA::
NumFlßtRegs
; freg++) {

911 
PhysRegIndex
 
phys_»g
 = 
»ÇmeM­
[
tid
].
	`lookup
(
äeg
);

913 
scÜebßrd
.
	`un£tReg
(
phys_»g
);

914 
ä“Li¡
.
	`addReg
(
phys_»g
);

918 
DynIn¡PŒ
 
š¡
 = 
comm™
.
rob
->
	`»adH—dIn¡
(
tid
);

919 
In¡SeqNum
 
squash_£q_num
 = 
š¡
->
£qNum
;

920 
ãtch
.
	`squash
(0, 
squash_£q_num
, 
š¡
, 
tid
);

921 
decode
.
	`squash
(
tid
);

922 
»Çme
.
	`squash
(
squash_£q_num
, 
tid
);

923 
›w
.
	`squash
(
tid
);

924 
›w
.
ld¡Queue
.
	`squash
(
squash_£q_num
, 
tid
);

925 
comm™
.
rob
->
	`squash
(
squash_£q_num
, 
tid
);

928 
	`as£¹
(
›w
.
š¡Queue
.
	`g‘CouÁ
(
tid
) == 0);

929 
	`as£¹
(
›w
.
ld¡Queue
.
	`g‘CouÁ
(
tid
) == 0);

943 
	}
}

946 
	g‹m¶©e
 <
şass
 
	gIm¶
>

948 
	gFuÎO3CPU
<
	gIm¶
>::
	$aùiv©eWh’R—dy
(
Th»adID
 
tid
)

950 
	`DPRINTF
(
O3CPU
,"[tid:%i]: Checking if„esources‡re‡vailable for incoming"

952 
tid
);

954 
boŞ
 
»ady
 = 
Œue
;

956 ià(
ä“Li¡
.
	`numF»eIÁRegs
(è>ğ
TheISA
::
NumIÁRegs
) {

957 
	`DPRINTF
(
O3CPU
,"[tid:%i] Suspendinghread dueo‚otƒnough "

959 
tid
);

960 
»ady
 = 
çl£
;

961 } ià(
ä“Li¡
.
	`numF»eFlßtRegs
(è>ğ
TheISA
::
NumFlßtRegs
) {

962 
	`DPRINTF
(
O3CPU
,"[tid:%i] Suspendinghread dueo‚otƒnough "

964 
tid
);

965 
»ady
 = 
çl£
;

966 } ià(
comm™
.
rob
->
	`numF»eEÁr›s
() >=

967 
comm™
.
rob
->
	`’ŒyAmouÁ
(
aùiveTh»ads
.
	`size
() + 1)) {

968 
	`DPRINTF
(
O3CPU
,"[tid:%i] Suspendinghread dueo‚otƒnough "

970 
tid
);

971 
»ady
 = 
çl£
;

972 } ià(
›w
.
š¡Queue
.
	`numF»eEÁr›s
() >=

973 
›w
.
š¡Queue
.
	`’ŒyAmouÁ
(
aùiveTh»ads
.
	`size
() + 1)) {

974 
	`DPRINTF
(
O3CPU
,"[tid:%i] Suspendinghread dueo‚otƒnough "

976 
tid
);

977 
»ady
 = 
çl£
;

978 } ià(
›w
.
ld¡Queue
.
	`numF»eEÁr›s
() >=

979 
›w
.
ld¡Queue
.
	`’ŒyAmouÁ
(
aùiveTh»ads
.
	`size
() + 1)) {

980 
	`DPRINTF
(
O3CPU
,"[tid:%i] Suspendinghread dueo‚otƒnough "

982 
tid
);

983 
»ady
 = 
çl£
;

986 ià(
»ady
) {

987 
	`š£¹Th»ad
(
tid
);

989 
cÚ‹xtSw™ch
 = 
çl£
;

991 
ıuWa™Li¡
.
	`»move
(
tid
);

993 
	`su¥’dCÚ‹xt
(
tid
);

996 
cÚ‹xtSw™ch
 = 
Œue
;

1000 
ıuWa™Li¡
.
	`push_back
(
tid
);

1002 
	}
}

1004 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1005 
FauÉ


1006 
	gFuÎO3CPU
<
	gIm¶
>::
	$hw»i
(
Th»adID
 
tid
)

1008 #ià
THE_ISA
 =ğ
ALPHA_ISA


1010 
this
->
	`£tMiscRegNoEfãù
(
AÍhaISA
::
MISCREG_LOCKFLAG
, 
çl£
, 
tid
);

1012 
this
->
th»ad
[
tid
]->
k”ÃlSts
->
	`hw»i
();

1016  
NoFauÉ
;

1017 
	}
}

1019 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1020 
boŞ


1021 
	gFuÎO3CPU
<
	gIm¶
>::
	$simP®Check
(
·lFunc
, 
Th»adID
 
tid
)

1023 #ià
THE_ISA
 =ğ
ALPHA_ISA


1024 ià(
this
->
th»ad
[
tid
]->
k”ÃlSts
)

1025 
this
->
th»ad
[
tid
]->
k”ÃlSts
->
	`ÿÎ·l
(
·lFunc
,

1026 
this
->
th»adCÚ‹xts
[
tid
]);

1028 
·lFunc
) {

1029 
PAL
::
h®t
:

1030 
	`h®t
();

1031 ià(--
Sy¡em
::
numSy¡emsRuÂšg
 == 0)

1032 
	`ex™SimLoİ
("all cpus halted");

1035 
PAL
::
b±
:

1036 
PAL
::
bugchk
:

1037 ià(
this
->
sy¡em
->
	`b»akpošt
())

1038  
çl£
;

1042  
Œue
;

1043 
	}
}

1045 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1046 
FauÉ


1047 
	gFuÎO3CPU
<
	gIm¶
>::
	$g‘IÁ”ru±s
()

1050  
this
->
š‹¼u±s
->
	`g‘IÁ”ru±
Ñhis->
th»adCÚ‹xts
[0]);

1051 
	}
}

1053 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1055 
	gFuÎO3CPU
<
	gIm¶
>::
	$´oûssIÁ”ru±s
(
FauÉ
 
š‹¼u±
)

1063 
	`as£¹
(
š‹¼u±
 !ğ
NoFauÉ
);

1064 
this
->
š‹¼u±s
->
	`upd©eIÁrInfo
Ñhis->
th»adCÚ‹xts
[0]);

1066 
	`DPRINTF
(
O3CPU
, "IÁ”ru± % bešg hªdËd\n", 
š‹¼u±
->
	`Çme
());

1067 
this
->
	`Œ­
(
š‹¼u±
, 0, 
NULL
);

1068 
	}
}

1070 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1072 
	gFuÎO3CPU
<
	gIm¶
>::
	$Œ­
(
FauÉ
 
çuÉ
, 
Th»adID
 
tid
, 
SticIn¡PŒ
 
š¡
)

1075 
çuÉ
->
	`švoke
(
this
->
th»adCÚ‹xts
[
tid
], 
š¡
);

1076 
	}
}

1078 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1080 
	gFuÎO3CPU
<
	gIm¶
>::
	$sysÿÎ
(
št64_t
 
ÿÎnum
, 
Th»adID
 
tid
)

1082 
	`DPRINTF
(
O3CPU
, "[tid:%i] Executšg sysÿÎ().\n\n", 
tid
);

1084 
	`DPRINTF
(
Aùiv™y
,"Activity: syscall() called.\n");

1088 ++(
this
->
th»ad
[
tid
]->
funcExeIn¡
);

1091 
this
->
th»ad
[
tid
]->
	`sysÿÎ
(
ÿÎnum
);

1095 --(
this
->
th»ad
[
tid
]->
funcExeIn¡
);

1096 
	}
}

1098 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1100 
	gFuÎO3CPU
<
	gIm¶
>::
£rŸlizeTh»ad
(
¡d
::
o¡»am
 &
os
, 
Th»adID
 
tid
)

1102 
	gth»ad
[
tid
]->
£rŸlize
(
os
);

1105 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1107 
	gFuÎO3CPU
<
	gIm¶
>::
un£rŸlizeTh»ad
(
Checkpošt
 *
ı
, cÚ¡ 
¡d
::
¡ršg
 &
£ùiÚ
,

1108 
Th»adID
 
tid
)

1110 
	gth»ad
[
tid
]->
un£rŸlize
(
ı
, 
£ùiÚ
);

1113 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1115 
	gFuÎO3CPU
<
	gIm¶
>::
	$d¿š
(
D¿šMªag”
 *
d¿š_mªag”
)

1118 ià(
	`sw™chedOut
()) {

1119 
	`£tD¿šS‹
(
D¿šabË
::
D¿šed
);

1123 
	`DPRINTF
(
D¿š
, "Draining...\n");

1124 
	`£tD¿šS‹
(
D¿šabË
::
D¿ššg
);

1132 
comm™
.
	`d¿š
();

1136 ià(!
	`isD¿šed
()) {

1137 
d¿šMªag”
 = 
d¿š_mªag”
;

1139 
	`wakeCPU
();

1140 
aùiv™yRec
.
	`aùiv™y
();

1142 
	`DPRINTF
(
D¿š
, "CPU‚ot drained\n");

1146 
	`£tD¿šS‹
(
D¿šabË
::
D¿šed
);

1147 
	`DPRINTF
(
D¿š
, "CPU is‡lready drained\n");

1148 ià(
tickEv’t
.
	`scheduËd
())

1149 
	`descheduË
(
tickEv’t
);

1155 
i
 = 0; i < 
timeBufãr
.
	`g‘Size
(); ++i) {

1156 
timeBufãr
.
	`advªû
();

1157 
ãtchQueue
.
	`advªû
();

1158 
decodeQueue
.
	`advªû
();

1159 
»ÇmeQueue
.
	`advªû
();

1160 
›wQueue
.
	`advªû
();

1163 
	`d¿šSª™yCheck
();

1166 
	}
}

1168 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1169 
boŞ


1170 
	gFuÎO3CPU
<
	gIm¶
>::
	$ŒyD¿š
()

1172 ià(!
d¿šMªag”
 || !
	`isD¿šed
())

1173  
çl£
;

1175 ià(
tickEv’t
.
	`scheduËd
())

1176 
	`descheduË
(
tickEv’t
);

1178 
	`DPRINTF
(
D¿š
, "CPU done draining,…rocessing drainƒvent\n");

1179 
d¿šMªag”
->
	`sigÇlD¿šDÚe
();

1180 
d¿šMªag”
 = 
NULL
;

1182  
Œue
;

1183 
	}
}

1185 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1187 
	gFuÎO3CPU
<
	gIm¶
>::
	$d¿šSª™yCheck
() const

1189 
	`as£¹
(
	`isD¿šed
());

1190 
ãtch
.
	`d¿šSª™yCheck
();

1191 
decode
.
	`d¿šSª™yCheck
();

1192 
»Çme
.
	`d¿šSª™yCheck
();

1193 
›w
.
	`d¿šSª™yCheck
();

1194 
comm™
.
	`d¿šSª™yCheck
();

1195 
	}
}

1197 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1198 
boŞ


1199 
	gFuÎO3CPU
<
	gIm¶
>::
	$isD¿šed
() const

1201 
boŞ
 
	`d¿šed
(
Œue
);

1203 
Th»adID
 
i
 = 0; i < 
th»ad
.
	`size
(); ++i) {

1204 ià(
aùiv©eTh»adEv’t
[
i
].
	`scheduËd
()) {

1205 
	`DPRINTF
(
D¿š
, "CPU‚ot drained,read %i has‡ "

1206 "³ndšg‡ùiv©ev’t\n", 
i
);

1207 
d¿šed
 = 
çl£
;

1209 ià(
d—Îoÿ‹CÚ‹xtEv’t
[
i
].
	`scheduËd
()) {

1210 
	`DPRINTF
(
D¿š
, "CPU‚ot drained,read %i has‡ "

1211 "³ndšg d—Îoÿ‹ cÚ‹xˆev’t\n", 
i
);

1212 
d¿šed
 = 
çl£
;

1216 ià(!
š¡Li¡
.
	`em±y
(è|| !
»moveLi¡
.empty()) {

1217 
	`DPRINTF
(
D¿š
, "Main CPU structures‚ot drained.\n");

1218 
d¿šed
 = 
çl£
;

1221 ià(!
ãtch
.
	`isD¿šed
()) {

1222 
	`DPRINTF
(
D¿š
, "Fetch‚ot drained.\n");

1223 
d¿šed
 = 
çl£
;

1226 ià(!
decode
.
	`isD¿šed
()) {

1227 
	`DPRINTF
(
D¿š
, "Decode‚ot drained.\n");

1228 
d¿šed
 = 
çl£
;

1231 ià(!
»Çme
.
	`isD¿šed
()) {

1232 
	`DPRINTF
(
D¿š
, "Rename‚ot drained.\n");

1233 
d¿šed
 = 
çl£
;

1236 ià(!
›w
.
	`isD¿šed
()) {

1237 
	`DPRINTF
(
D¿š
, "IEW‚ot drained.\n");

1238 
d¿šed
 = 
çl£
;

1241 ià(!
comm™
.
	`isD¿šed
()) {

1242 
	`DPRINTF
(
D¿š
, "Commit‚ot drained.\n");

1243 
d¿šed
 = 
çl£
;

1246  
d¿šed
;

1247 
	}
}

1249 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1251 
	gFuÎO3CPU
<
	gIm¶
>::
	$comm™D¿šed
(
Th»adID
 
tid
)

1253 
ãtch
.
	`d¿šSÎ
(
tid
);

1254 
	}
}

1256 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1258 
	gFuÎO3CPU
<
	gIm¶
>::
	$d¿šResume
()

1260 
	`£tD¿šS‹
(
D¿šabË
::
RuÂšg
);

1261 ià(
	`sw™chedOut
())

1264 
	`DPRINTF
(
D¿š
, "Resuming...\n");

1266 ià(
sy¡em
->
	`g‘MemÜyMode
(è!ğ
Enums
::
timšg
) {

1267 
	`çl
("The O3 CPU„equireshe memory systemo be in "

1271 
ãtch
.
	`d¿šResume
();

1272 
comm™
.
	`d¿šResume
();

1274 
_¡©us
 = 
IdË
;

1275 
Th»adID
 
i
 = 0; i < 
th»ad
.
	`size
(); i++) {

1276 ià(
th»ad
[
i
]->
	`¡©us
(è=ğ
Th»adCÚ‹xt
::
Aùive
) {

1277 
	`DPRINTF
(
D¿š
, "Aùiv©šgh»ad: %i\n", 
i
);

1278 
	`aùiv©eTh»ad
(
i
);

1279 
_¡©us
 = 
RuÂšg
;

1283 
	`as£¹
(!
tickEv’t
.
	`scheduËd
());

1284 ià(
_¡©us
 =ğ
RuÂšg
)

1285 
	`scheduË
(
tickEv’t
, 
	`ÃxtCyşe
());

1286 
	}
}

1288 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1290 
	gFuÎO3CPU
<
	gIm¶
>::
	$sw™chOut
()

1292 
	`DPRINTF
(
O3CPU
, "Switching out\n");

1293 
Ba£CPU
::
	`sw™chOut
();

1295 
aùiv™yRec
.
	`»£t
();

1297 
_¡©us
 = 
Sw™chedOut
;

1299 ià(
check”
)

1300 
check”
->
	`sw™chOut
();

1301 
	}
}

1303 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1305 
	gFuÎO3CPU
<
	gIm¶
>::
	$keOv”From
(
Ba£CPU
 *
ŞdCPU
)

1307 
Ba£CPU
::
	`keOv”From
(
ŞdCPU
);

1309 
ãtch
.
	`keOv”From
();

1310 
decode
.
	`keOv”From
();

1311 
»Çme
.
	`keOv”From
();

1312 
›w
.
	`keOv”From
();

1313 
comm™
.
	`keOv”From
();

1315 
	`as£¹
(!
tickEv’t
.
	`scheduËd
());

1317 
FuÎO3CPU
<
Im¶
> *
ŞdO3CPU
 = 
dyÇmic_ÿ¡
<FuÎO3CPU<Im¶>*>(
ŞdCPU
);

1318 ià(
ŞdO3CPU
)

1319 
glob®SeqNum
 = 
ŞdO3CPU
->globalSeqNum;

1321 
Ï¡RuÂšgCyşe
 = 
	`curCyşe
();

1322 
_¡©us
 = 
IdË
;

1323 
	}
}

1325 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1326 
	gTheISA
::
MiscReg


1327 
FuÎO3CPU
<
Im¶
>::
	$»adMiscRegNoEfãù
(
misc_»g
, 
Th»adID
 
tid
)

1329  
this
->
i§
[
tid
]->
	`»adMiscRegNoEfãù
(
misc_»g
);

1330 
	}
}

1332 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1333 
	gTheISA
::
MiscReg


1334 
FuÎO3CPU
<
Im¶
>::
	$»adMiscReg
(
misc_»g
, 
Th»adID
 
tid
)

1336 
miscRegfeR—ds
++;

1337  
this
->
i§
[
tid
]->
	`»adMiscReg
(
misc_»g
, 
	`tcBa£
(tid));

1338 
	}
}

1340 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1342 
	gFuÎO3CPU
<
	gIm¶
>::
£tMiscRegNoEfãù
(
misc_»g
,

1343 cÚ¡ 
TheISA
::
MiscReg
 &
v®
, 
Th»adID
 
tid
)

1345 
	gthis
->
	gi§
[
tid
]->
£tMiscRegNoEfãù
(
misc_»g
, 
v®
);

1348 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1350 
	gFuÎO3CPU
<
	gIm¶
>::
£tMiscReg
(
misc_»g
,

1351 cÚ¡ 
TheISA
::
MiscReg
 &
v®
, 
Th»adID
 
tid
)

1353 
	gmiscRegfeWr™es
++;

1354 
	gthis
->
	gi§
[
tid
]->
£tMiscReg
(
misc_»g
, 
v®
, 
tcBa£
(tid));

1357 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1358 
ušt64_t


1359 
	gFuÎO3CPU
<
	gIm¶
>::
	$»adIÁReg
(
»g_idx
)

1361 
štRegfeR—ds
++;

1362  
»gFe
.
	`»adIÁReg
(
»g_idx
);

1363 
	}
}

1365 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1366 
FlßtReg


1367 
	gFuÎO3CPU
<
	gIm¶
>::
	$»adFlßtReg
(
»g_idx
)

1369 
åRegfeR—ds
++;

1370  
»gFe
.
	`»adFlßtReg
(
»g_idx
);

1371 
	}
}

1373 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1374 
FlßtRegB™s


1375 
	gFuÎO3CPU
<
	gIm¶
>::
	$»adFlßtRegB™s
(
»g_idx
)

1377 
åRegfeR—ds
++;

1378  
»gFe
.
	`»adFlßtRegB™s
(
»g_idx
);

1379 
	}
}

1381 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1383 
	gFuÎO3CPU
<
	gIm¶
>::
	$£tIÁReg
(
»g_idx
, 
ušt64_t
 
v®
)

1385 
štRegfeWr™es
++;

1386 
»gFe
.
	`£tIÁReg
(
»g_idx
, 
v®
);

1387 
	}
}

1389 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1391 
	gFuÎO3CPU
<
	gIm¶
>::
	$£tFlßtReg
(
»g_idx
, 
FlßtReg
 
v®
)

1393 
åRegfeWr™es
++;

1394 
»gFe
.
	`£tFlßtReg
(
»g_idx
, 
v®
);

1395 
	}
}

1397 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1399 
	gFuÎO3CPU
<
	gIm¶
>::
	$£tFlßtRegB™s
(
»g_idx
, 
FlßtRegB™s
 
v®
)

1401 
åRegfeWr™es
++;

1402 
»gFe
.
	`£tFlßtRegB™s
(
»g_idx
, 
v®
);

1403 
	}
}

1405 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1406 
ušt64_t


1407 
	gFuÎO3CPU
<
	gIm¶
>::
	$»adArchIÁReg
(
»g_idx
, 
Th»adID
 
tid
)

1409 
štRegfeR—ds
++;

1410 
PhysRegIndex
 
phys_»g
 = 
comm™R’ameM­
[
tid
].
	`lookup
(
»g_idx
);

1412  
»gFe
.
	`»adIÁReg
(
phys_»g
);

1413 
	}
}

1415 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1417 
	gFuÎO3CPU
<
	gIm¶
>::
	$»adArchFlßtReg
(
»g_idx
, 
Th»adID
 
tid
)

1419 
åRegfeR—ds
++;

1420 
idx
 = 
»g_idx
 + 
TheISA
::
NumIÁRegs
;

1421 
PhysRegIndex
 
phys_»g
 = 
comm™R’ameM­
[
tid
].
	`lookup
(
idx
);

1423  
»gFe
.
	`»adFlßtReg
(
phys_»g
);

1424 
	}
}

1426 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1427 
ušt64_t


1428 
	gFuÎO3CPU
<
	gIm¶
>::
	$»adArchFlßtRegIÁ
(
»g_idx
, 
Th»adID
 
tid
)

1430 
åRegfeR—ds
++;

1431 
idx
 = 
»g_idx
 + 
TheISA
::
NumIÁRegs
;

1432 
PhysRegIndex
 
phys_»g
 = 
comm™R’ameM­
[
tid
].
	`lookup
(
idx
);

1434  
»gFe
.
	`»adFlßtRegB™s
(
phys_»g
);

1435 
	}
}

1437 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1439 
	gFuÎO3CPU
<
	gIm¶
>::
	$£tArchIÁReg
(
»g_idx
, 
ušt64_t
 
v®
, 
Th»adID
 
tid
)

1441 
štRegfeWr™es
++;

1442 
PhysRegIndex
 
phys_»g
 = 
comm™R’ameM­
[
tid
].
	`lookup
(
»g_idx
);

1444 
»gFe
.
	`£tIÁReg
(
phys_»g
, 
v®
);

1445 
	}
}

1447 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1449 
	gFuÎO3CPU
<
	gIm¶
>::
	$£tArchFlßtReg
(
»g_idx
, 
v®
, 
Th»adID
 
tid
)

1451 
åRegfeWr™es
++;

1452 
idx
 = 
»g_idx
 + 
TheISA
::
NumIÁRegs
;

1453 
PhysRegIndex
 
phys_»g
 = 
comm™R’ameM­
[
tid
].
	`lookup
(
idx
);

1455 
»gFe
.
	`£tFlßtReg
(
phys_»g
, 
v®
);

1456 
	}
}

1458 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1460 
	gFuÎO3CPU
<
	gIm¶
>::
	$£tArchFlßtRegIÁ
(
»g_idx
, 
ušt64_t
 
v®
, 
Th»adID
 
tid
)

1462 
åRegfeWr™es
++;

1463 
idx
 = 
»g_idx
 + 
TheISA
::
NumIÁRegs
;

1464 
PhysRegIndex
 
phys_»g
 = 
comm™R’ameM­
[
tid
].
	`lookup
(
idx
);

1466 
»gFe
.
	`£tFlßtRegB™s
(
phys_»g
, 
v®
);

1467 
	}
}

1469 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1470 
	gTheISA
::
PCS‹


1471 
FuÎO3CPU
<
Im¶
>::
	$pcS‹
(
Th»adID
 
tid
)

1473  
comm™
.
	`pcS‹
(
tid
);

1474 
	}
}

1476 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1478 
	gFuÎO3CPU
<
	gIm¶
>::
pcS‹
(cÚ¡ 
TheISA
::
PCS‹
 &
v®
, 
Th»adID
 
tid
)

1480 
	gcomm™
.
pcS‹
(
v®
, 
tid
);

1483 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1484 
Addr


1485 
	gFuÎO3CPU
<
	gIm¶
>::
	$š¡Addr
(
Th»adID
 
tid
)

1487  
comm™
.
	`š¡Addr
(
tid
);

1488 
	}
}

1490 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1491 
Addr


1492 
	gFuÎO3CPU
<
	gIm¶
>::
	$ÃxtIn¡Addr
(
Th»adID
 
tid
)

1494  
comm™
.
	`ÃxtIn¡Addr
(
tid
);

1495 
	}
}

1497 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1498 
MiüoPC


1499 
	gFuÎO3CPU
<
	gIm¶
>::
	$miüoPC
(
Th»adID
 
tid
)

1501  
comm™
.
	`miüoPC
(
tid
);

1502 
	}
}

1504 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1506 
	gFuÎO3CPU
<
	gIm¶
>::
	$squashFromTC
(
Th»adID
 
tid
)

1508 
this
->
th»ad
[
tid
]->
noSquashFromTC
 = 
Œue
;

1509 
this
->
comm™
.
	`g’”©eTCEv’t
(
tid
);

1510 
	}
}

1512 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1513 
ty³Çme
 
	gFuÎO3CPU
<
	gIm¶
>::
Li¡It


1514 
FuÎO3CPU
<
Im¶
>::
	$addIn¡
(
DynIn¡PŒ
 &
š¡
)

1516 
š¡Li¡
.
	`push_back
(
š¡
);

1518  --(
š¡Li¡
.
	`’d
());

1519 
	}
}

1521 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1523 
	gFuÎO3CPU
<
	gIm¶
>::
	$š¡DÚe
(
Th»adID
 
tid
, 
DynIn¡PŒ
 &
š¡
)

1526 ià(!
š¡
->
	`isMiüoİ
(è|| in¡->
	`isLa¡Miüoİ
()) {

1527 
th»ad
[
tid
]->
numIn¡
++;

1528 
th»ad
[
tid
]->
numIn¡s
++;

1529 
comm™‹dIn¡s
[
tid
]++;

1530 
tÙ®Comm™‹dIn¡s
++;

1532 
th»ad
[
tid
]->
numOp
++;

1533 
th»ad
[
tid
]->
numOps
++;

1534 
comm™‹dOps
[
tid
]++;

1536 
sy¡em
->
tÙ®NumIn¡s
++;

1538 
comIn¡Ev’tQueue
[
tid
]->
	`£rviûEv’ts
(
th»ad
[tid]->
numIn¡
);

1539 
sy¡em
->
š¡Ev’tQueue
.
	`£rviûEv’ts
(sy¡em->
tÙ®NumIn¡s
);

1540 
	}
}

1542 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1544 
	gFuÎO3CPU
<
	gIm¶
>::
	$»moveFrÚtIn¡
(
DynIn¡PŒ
 &
š¡
)

1546 
	`DPRINTF
(
O3CPU
, "Removing committed instruction [tid:%i] PC %s "

1548 
š¡
->
th»adNumb”
, in¡->
	`pcS‹
(), in¡->
£qNum
);

1550 
»moveIn¡sThisCyşe
 = 
Œue
;

1553 
»moveLi¡
.
	`push
(
š¡
->
	`g‘In¡Li¡It
());

1554 
	}
}

1556 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1558 
	gFuÎO3CPU
<
	gIm¶
>::
	$»moveIn¡sNÙInROB
(
Th»adID
 
tid
)

1560 
	`DPRINTF
(
O3CPU
, "Thread %i: Deleting instructions from instruction"

1561 "†i¡.\n", 
tid
);

1563 
Li¡It
 
’d_™
;

1565 
boŞ
 
rob_em±y
 = 
çl£
;

1567 ià(
š¡Li¡
.
	`em±y
()) {

1569 } ià(
rob
.
	`isEm±y
( )) {

1570 
	`DPRINTF
(
O3CPU
, "ROB isƒmpty, squashing‡ll insts.\n");

1571 
’d_™
 = 
š¡Li¡
.
	`begš
();

1572 
rob_em±y
 = 
Œue
;

1574 
’d_™
 = (
rob
.
	`»adTaIn¡
(
tid
))->
	`g‘In¡Li¡It
();

1575 
	`DPRINTF
(
O3CPU
, "ROB is‚otƒmpty, squashing insts‚ot in ROB.\n");

1578 
»moveIn¡sThisCyşe
 = 
Œue
;

1580 
Li¡It
 
š¡_™
 = 
š¡Li¡
.
	`’d
();

1582 
š¡_™
--;

1586 
š¡_™
 !ğ
’d_™
) {

1587 
	`as£¹
(!
š¡Li¡
.
	`em±y
());

1589 
	`squashIn¡It
(
š¡_™
, 
tid
);

1591 
š¡_™
--;

1596 ià(
rob_em±y
) {

1597 
	`squashIn¡It
(
š¡_™
, 
tid
);

1599 
	}
}

1601 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1603 
	gFuÎO3CPU
<
	gIm¶
>::
	$»moveIn¡sUÁ
(cÚ¡ 
In¡SeqNum
 &
£q_num
, 
Th»adID
 
tid
)

1605 
	`as£¹
(!
š¡Li¡
.
	`em±y
());

1607 
»moveIn¡sThisCyşe
 = 
Œue
;

1609 
Li¡It
 
š¡_™”
 = 
š¡Li¡
.
	`’d
();

1611 
š¡_™”
--;

1613 
	`DPRINTF
(
O3CPU
, "Deleting instructions from instruction "

1615 
tid
, 
£q_num
, (*
š¡_™”
)->
£qNum
);

1617 (*
š¡_™”
)->
£qNum
 > 
£q_num
) {

1619 
boŞ
 
b»ak_loİ
 = (
š¡_™”
 =ğ
š¡Li¡
.
	`begš
());

1621 
	`squashIn¡It
(
š¡_™”
, 
tid
);

1623 
š¡_™”
--;

1625 ià(
b»ak_loİ
)

1628 
	}
}

1630 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1631 
šlše
 

1632 
	gFuÎO3CPU
<
	gIm¶
>::
	$squashIn¡It
(cÚ¡ 
Li¡It
 &
š¡It
, 
Th»adID
 
tid
)

1634 ià((*
š¡It
)->
th»adNumb”
 =ğ
tid
) {

1635 
	`DPRINTF
(
O3CPU
, "Squashing instruction, "

1637 (*
š¡It
)->
th»adNumb”
,

1638 (*
š¡It
)->
£qNum
,

1639 (*
š¡It
)->
	`pcS‹
());

1642 (*
š¡It
)->
	`£tSquashed
();

1647 
»moveLi¡
.
	`push
(
š¡It
);

1649 
	}
}

1651 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1653 
	gFuÎO3CPU
<
	gIm¶
>::
	$ş—nUpRemovedIn¡s
()

1655 !
»moveLi¡
.
	`em±y
()) {

1656 
	`DPRINTF
(
O3CPU
, "Removing instruction, "

1658 (*
»moveLi¡
.
	`äÚt
())->
th»adNumb”
,

1659 (*
»moveLi¡
.
	`äÚt
())->
£qNum
,

1660 (*
»moveLi¡
.
	`äÚt
())->
	`pcS‹
());

1662 
š¡Li¡
.
	`”a£
(
»moveLi¡
.
	`äÚt
());

1664 
»moveLi¡
.
	`pİ
();

1667 
»moveIn¡sThisCyşe
 = 
çl£
;

1668 
	}
}

1677 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1679 
	gFuÎO3CPU
<
	gIm¶
>::
	$dumpIn¡s
()

1681 
num
 = 0;

1683 
Li¡It
 
š¡_li¡_™
 = 
š¡Li¡
.
	`begš
();

1685 
	`ırštf
("Dumping Instruction List\n");

1687 
š¡_li¡_™
 !ğ
š¡Li¡
.
	`’d
()) {

1688 
	`ırštf
("Instruction:%i\nPC:%#x\n[tid:%i]\n[sn:%lli]\nIssued:%i\n"

1690 
num
, (*
š¡_li¡_™
)->
	`š¡Addr
(), (*š¡_li¡_™)->
th»adNumb”
,

1691 (*
š¡_li¡_™
)->
£qNum
, (*š¡_li¡_™)->
	`isIssued
(),

1692 (*
š¡_li¡_™
)->
	`isSquashed
());

1693 
š¡_li¡_™
++;

1694 ++
num
;

1696 
	}
}

1705 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1707 
	gFuÎO3CPU
<
	gIm¶
>::
	$wakeCPU
()

1709 ià(
aùiv™yRec
.
	`aùive
(è|| 
tickEv’t
.
	`scheduËd
()) {

1710 
	`DPRINTF
(
Aùiv™y
, "CPU‡lready„unning.\n");

1714 
	`DPRINTF
(
Aùiv™y
, "Waking up CPU\n");

1716 
Cyşes
 
	`cyşes
(
	`curCyşe
(è- 
Ï¡RuÂšgCyşe
);

1718 ià(
cyşes
 != 0)

1719 --
cyşes
;

1720 
idËCyşes
 +ğ
cyşes
;

1721 
numCyşes
 +ğ
cyşes
;

1723 
	`scheduË
(
tickEv’t
, 
	`ÃxtCyşe
());

1724 
	}
}

1726 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1728 
	gFuÎO3CPU
<
	gIm¶
>::
	$wakeup
()

1730 ià(
this
->
th»ad
[0]->
	`¡©us
(è!ğ
Th»adCÚ‹xt
::
Su¥’ded
)

1733 
this
->
	`wakeCPU
();

1735 
	`DPRINTF
(
Qu›sû
, "Suspended Processor woken\n");

1736 
this
->
th»adCÚ‹xts
[0]->
	`aùiv©e
();

1737 
	}
}

1739 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1740 
Th»adID


1741 
	gFuÎO3CPU
<
	gIm¶
>::
	$g‘F»eTid
()

1743 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

1744 ià(!
tids
[
tid
]) {

1745 
tids
[
tid
] = 
Œue
;

1746  
tid
;

1750  
Inv®idTh»adID
;

1751 
	}
}

1753 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1755 
	gFuÎO3CPU
<
	gIm¶
>::
	$doCÚ‹xtSw™ch
()

1757 ià(
cÚ‹xtSw™ch
) {

1761 
Th»adID
 
size
 = 
ıuWa™Li¡
.
	`size
();

1762 
Th»adID
 
tid
 = 0;id < 
size
;id++) {

1763 
	`aùiv©eWh’R—dy
(
tid
);

1766 ià(
ıuWa™Li¡
.
	`size
() == 0)

1767 
cÚ‹xtSw™ch
 = 
Œue
;

1769 
	}
}

1771 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1773 
	gFuÎO3CPU
<
	gIm¶
>::
	$upd©eTh»adPriÜ™y
()

1775 ià(
aùiveTh»ads
.
	`size
() > 1) {

1778 
li¡
<
Th»adID
>::
™”©Ü
 
li¡_begš
 = 
aùiveTh»ads
.
	`begš
();

1780 
high_th»ad
 = *
li¡_begš
;

1782 
aùiveTh»ads
.
	`”a£
(
li¡_begš
);

1784 
aùiveTh»ads
.
	`push_back
(
high_th»ad
);

1786 
	}
}

1789 
‹m¶©e
 
şass
 
	gFuÎO3CPU
<
	gO3CPUIm¶
>;

	@cpu.hh

46 #iâdeà
__CPU_O3_CPU_HH__


47 
	#__CPU_O3_CPU_HH__


	)

49 
	~<io¡»am
>

50 
	~<li¡
>

51 
	~<queue
>

52 
	~<£t
>

53 
	~<veùÜ
>

55 
	~"¬ch/ty³s.hh
"

56 
	~"ba£/¡©i¡ics.hh
"

57 
	~"cÚfig/the_i§.hh
"

58 
	~"ıu/o3/comm.hh
"

59 
	~"ıu/o3/ıu_pŞicy.hh
"

60 
	~"ıu/o3/scÜebßrd.hh
"

61 
	~"ıu/o3/th»ad_¡©e.hh
"

62 
	~"ıu/aùiv™y.hh
"

63 
	~"ıu/ba£.hh
"

64 
	~"ıu/sim¶e_th»ad.hh
"

65 
	~"ıu/timebuf.hh
"

67 
	~"·¿ms/D”ivO3CPU.hh
"

68 
	~"sim/´oûss.hh
"

70 
	g‹m¶©e
 <
	gşass
>

71 
şass
 
	gCheck”
;

72 
şass
 
	gTh»adCÚ‹xt
;

73 
	g‹m¶©e
 <
	gşass
>

74 
şass
 
	gO3Th»adCÚ‹xt
;

76 
şass
 
	gCheckpošt
;

77 
şass
 
	gMemObjeù
;

78 
şass
 
	gProûss
;

80 
	gBa£CPUP¬ams
;

82 şas 
	cBa£O3CPU
 : 
public
 
Ba£CPU


85 
public
:

86 
Ba£O3CPU
(
Ba£CPUP¬ams
 *
·¿ms
);

88 
»gSts
();

96 
	g‹m¶©e
 <
şass
 
	gIm¶
>

97 şas 
	cFuÎO3CPU
 : 
public
 
Ba£O3CPU


99 
public
:

101 
ty³Çme
 
	tIm¶
::
	tCPUPŞ
 
	tCPUPŞicy
;

102 
ty³Çme
 
	tIm¶
::
	tDynIn¡PŒ
 DynInstPtr;

103 
ty³Çme
 
	tIm¶
::
	tO3CPU
 O3CPU;

105 
	mO3Th»adS‹
<
	tIm¶
> 
	tIm¶S‹
;

106 
	mO3Th»adS‹
<
	tIm¶
> 
	tTh»ad
;

108 
ty³Çme
 
	t¡d
::
	tli¡
<
	tDynIn¡PŒ
>::
	t™”©Ü
 
	tLi¡It
;

110 
ä›nd
 
şass
 
	mO3Th»adCÚ‹xt
<
	mIm¶
>;

112 
	mpublic
:

113 
	eStus
 {

114 
RuÂšg
,

115 
	mIdË
,

116 
	mH®‹d
,

117 
	mBlocked
,

118 
	mSw™chedOut


121 
	gTheISA
::
TLB
 * 
™b
;

122 
	gTheISA
::
TLB
 * 
dtb
;

125 
Stus
 
	g_¡©us
;

127 
	g´iv©e
:

132 şas 
	cIÿchePÜt
 : 
public
 
CpuPÜt


134 
´Ùeùed
:

136 
DeçuÉF‘ch
<
Im¶
> *
ãtch
;

138 
	gpublic
:

140 
IÿchePÜt
(
DeçuÉF‘ch
<
Im¶
> *
_ãtch
, 
FuÎO3CPU
<Im¶>* 
_ıu
)

141 : 
CpuPÜt
(
_ıu
->
Çme
(è+ ".iÿche_pÜt", _ıu), 
ãtch
(
_ãtch
)

144 
	g´Ùeùed
:

148 
vœtu®
 
boŞ
 
»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
);

149 
vœtu®
 
»cvTimšgSnoİReq
(
Pack‘PŒ
 
pkt
) { }

152 
vœtu®
 
»cvR‘ry
();

158 şas 
	cDÿchePÜt
 : 
public
 
CpuPÜt


160 
´Ùeùed
:

163 
LSQ
<
Im¶
> *
lsq
;

165 
	gpublic
:

167 
DÿchePÜt
(
LSQ
<
Im¶
> *
_lsq
, 
FuÎO3CPU
<Im¶>* 
_ıu
)

168 : 
CpuPÜt
(
_ıu
->
Çme
(è+ ".dÿche_pÜt", _ıu), 
lsq
(
_lsq
)

171 
	g´Ùeùed
:

176 
vœtu®
 
boŞ
 
»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
);

177 
vœtu®
 
»cvTimšgSnoİReq
(
Pack‘PŒ
 
pkt
);

180 
vœtu®
 
»cvR‘ry
();

188 
vœtu®
 
boŞ
 
isSnoİšg
(ècÚ¡ {  
	gŒue
; }

191 şas 
	cTickEv’t
 : 
public
 
Ev’t


193 
´iv©e
:

195 
FuÎO3CPU
<
Im¶
> *
ıu
;

197 
	gpublic
:

199 
TickEv’t
(
FuÎO3CPU
<
Im¶
> *
c
);

201 
vœtu®
 
	g¡d
::
¡ršg
 
g‘ObjeùId
() const

203  
ıu
->
g‘ObjeùId
();

207 
´oûss
();

209 cÚ¡ *
desütiÚ
() const;

213 
TickEv’t
 
	gtickEv’t
;

216 
	$scheduËTickEv’t
(
Cyşes
 
d–ay
)

218 ià(
tickEv’t
.
	`squashed
())

219 
	`»scheduË
(
tickEv’t
, 
	`şockEdge
(
d–ay
));

220 ià(!
tickEv’t
.
	`scheduËd
())

221 
	`scheduË
(
tickEv’t
, 
	`şockEdge
(
d–ay
));

222 
	}
}

225 
	$unscheduËTickEv’t
()

227 ià(
tickEv’t
.
	`scheduËd
())

228 
tickEv’t
.
	`squash
();

229 
	}
}

231 şas 
	cAùiv©eTh»adEv’t
 : 
public
 
Ev’t


233 
´iv©e
:

235 
Th»adID
 
tid
;

238 
	gFuÎO3CPU
<
	gIm¶
> *
	gıu
;

240 
	gpublic
:

242 
Aùiv©eTh»adEv’t
();

245 
š™
(
th»ad_num
, 
FuÎO3CPU
<
Im¶
> *
th»ad_ıu
);

248 
´oûss
();

251 cÚ¡ *
desütiÚ
() const;

256 
	$scheduËAùiv©eTh»adEv’t
(
Th»adID
 
tid
, 
Cyşes
 
d–ay
)

259 ià(
aùiv©eTh»adEv’t
[
tid
].
	`squashed
())

260 
	`»scheduË
(
aùiv©eTh»adEv’t
[
tid
],

261 
	`şockEdge
(
d–ay
));

262 ià(!
aùiv©eTh»adEv’t
[
tid
].
	`scheduËd
()) {

263 
Tick
 
wh’
 = 
	`şockEdge
(
d–ay
);

268 ià(
d—Îoÿ‹CÚ‹xtEv’t
[
tid
].
	`scheduËd
() &&

269 
d—Îoÿ‹CÚ‹xtEv’t
[
tid
].
	`wh’
(è=ğ
wh’
) {

270 
wh’
++;

273 
	`scheduË
(
aùiv©eTh»adEv’t
[
tid
], 
wh’
);

275 
	}
}

279 
	$unscheduËAùiv©eTh»adEv’t
(
Th»adID
 
tid
)

281 ià(
aùiv©eTh»adEv’t
[
tid
].
	`scheduËd
())

282 
aùiv©eTh»adEv’t
[
tid
].
	`squash
();

283 
	}
}

286 
Aùiv©eTh»adEv’t
 
	gaùiv©eTh»adEv’t
[
Im¶
::
MaxTh»ads
];

288 şas 
	cD—Îoÿ‹CÚ‹xtEv’t
 : 
public
 
Ev’t


290 
´iv©e
:

292 
Th»adID
 
tid
;

295 
boŞ
 
	g»move
;

298 
	gFuÎO3CPU
<
	gIm¶
> *
	gıu
;

300 
vœtu®
 
	g¡d
::
¡ršg
 
g‘ObjeùId
() const

302  
ıu
->
g‘ObjeùId
();

305 
	gpublic
:

307 
D—Îoÿ‹CÚ‹xtEv’t
();

310 
š™
(
th»ad_num
, 
FuÎO3CPU
<
Im¶
> *
th»ad_ıu
);

313 
´oûss
();

316 
£tRemove
(
boŞ
 
_»move
è{ 
	g»move
 = _remove; }

319 cÚ¡ *
desütiÚ
() const;

324 
	$scheduËD—Îoÿ‹CÚ‹xtEv’t
(
Th»adID
 
tid
, 
boŞ
 
»move
, 
Cyşes
 
d–ay
)

327 ià(
d—Îoÿ‹CÚ‹xtEv’t
[
tid
].
	`squashed
())

328 
	`»scheduË
(
d—Îoÿ‹CÚ‹xtEv’t
[
tid
],

329 
	`şockEdge
(
d–ay
));

330 ià(!
d—Îoÿ‹CÚ‹xtEv’t
[
tid
].
	`scheduËd
())

331 
	`scheduË
(
d—Îoÿ‹CÚ‹xtEv’t
[
tid
],

332 
	`şockEdge
(
d–ay
));

333 
	}
}

337 
	$unscheduËD—Îoÿ‹CÚ‹xtEv’t
(
Th»adID
 
tid
)

339 ià(
d—Îoÿ‹CÚ‹xtEv’t
[
tid
].
	`scheduËd
())

340 
d—Îoÿ‹CÚ‹xtEv’t
[
tid
].
	`squash
();

341 
	}
}

344 
D—Îoÿ‹CÚ‹xtEv’t
 
	gd—Îoÿ‹CÚ‹xtEv’t
[
Im¶
::
MaxTh»ads
];

357 
boŞ
 
ŒyD¿š
();

368 
	$d¿šSª™yCheck
() const;

371 
boŞ
 
	$isD¿šed
() const;

373 
public
:

375 
	`FuÎO3CPU
(
D”ivO3CPUP¬ams
 *
·¿ms
);

377 ~
	`FuÎO3CPU
();

380 
	`»gSts
();

382 
	$dem­Page
(
Addr
 
vaddr
, 
ušt64_t
 
a¢
)

384 
this
->
™b
->
	`dem­Page
(
vaddr
, 
a¢
);

385 
this
->
dtb
->
	`dem­Page
(
vaddr
, 
a¢
);

386 
	}
}

388 
	$dem­In¡Page
(
Addr
 
vaddr
, 
ušt64_t
 
a¢
)

390 
this
->
™b
->
	`dem­Page
(
vaddr
, 
a¢
);

391 
	}
}

393 
	$dem­D©aPage
(
Addr
 
vaddr
, 
ušt64_t
 
a¢
)

395 
this
->
dtb
->
	`dem­Page
(
vaddr
, 
a¢
);

396 
	}
}

401 
tick
();

404 
š™
();

406 
¡¬tup
();

409 
	$numAùiveTh»ads
()

410 {  
aùiveTh»ads
.
	`size
(); 
	}
}

413 
aùiv©eTh»ad
(
Th»adID
 
tid
);

416 
d—ùiv©eTh»ad
(
Th»adID
 
tid
);

419 
š£¹Th»ad
(
Th»adID
 
tid
);

422 
»moveTh»ad
(
Th»adID
 
tid
);

425 
vœtu®
 
CouÁ”
 
	$tÙ®In¡s
() const;

428 
vœtu®
 
CouÁ”
 
	$tÙ®Ops
() const;

431 
	`aùiv©eCÚ‹xt
(
Th»adID
 
tid
, 
Cyşes
 
d–ay
);

434 
	`su¥’dCÚ‹xt
(
Th»adID
 
tid
);

439 
boŞ
 
	`scheduËD—Îoÿ‹CÚ‹xt
(
Th»adID
 
tid
, boŞ 
»move
,

440 
Cyşes
 
d–ay
 = 
	`Cyşes
(1));

445 
	`h®tCÚ‹xt
(
Th»adID
 
tid
);

448 
	`aùiv©eWh’R—dy
(
Th»adID
 
tid
);

451 
	`doCÚ‹xtSw™ch
();

454 
	`upd©eTh»adPriÜ™y
();

457 
boŞ
 
	$isD¿ššg
(ècÚ¡ {  
	`g‘D¿šS‹
(è=ğ
D¿šabË
::
D¿ššg
; 
	}
}

459 
£rŸlizeTh»ad
(
¡d
::
o¡»am
 &
os
, 
Th»adID
 
tid
);

461 
un£rŸlizeTh»ad
(
Checkpošt
 *
ı
, cÚ¡ 
¡d
::
¡ršg
 &
£ùiÚ
,

462 
Th»adID
 
tid
);

464 
	gpublic
:

468 
sysÿÎ
(
št64_t
 
ÿÎnum
, 
Th»adID
 
tid
);

472 
d¿š
(
D¿šMªag”
 *
d¿š_mªag”
);

475 
d¿šResume
();

484 
comm™D¿šed
(
Th»adID
 
tid
);

487 
vœtu®
 
sw™chOut
();

490 
vœtu®
 
keOv”From
(
Ba£CPU
 *
ŞdCPU
);

493 
In¡SeqNum
 
	$g‘AndInüem’tIn¡Seq
()

494 {  
glob®SeqNum
++; 
	}
}

497 
Œ­
(
FauÉ
 
çuÉ
, 
Th»adID
 
tid
, 
SticIn¡PŒ
 
š¡
);

500 
FauÉ
 
hw»i
(
Th»adID
 
tid
);

502 
boŞ
 
simP®Check
(
·lFunc
, 
Th»adID
 
tid
);

505 
FauÉ
 
g‘IÁ”ru±s
();

508 
´oûssIÁ”ru±s
(
FauÉ
 
š‹¼u±
);

511 
	$h®t
(è{ 
	`·nic
("H®ˆnÙ im¶em’‹d!\n"); 
	}
}

514 
boŞ
 
	$v®idIn¡Addr
(
Addr
 
addr
è{  
Œue
; 
	}
}

517 
boŞ
 
	$v®idD©aAddr
(
Addr
 
addr
è{  
Œue
; 
	}
}

522 
	gTheISA
::
MiscReg
 
»adMiscRegNoEfãù
(
misc_»g
, 
Th»adID
 
tid
);

527 
	gTheISA
::
MiscReg
 
»adMiscReg
(
misc_»g
, 
Th»adID
 
tid
);

530 
£tMiscRegNoEfãù
(
misc_»g
, cÚ¡ 
TheISA
::
MiscReg
 &
v®
,

531 
Th»adID
 
tid
);

536 
£tMiscReg
(
misc_»g
, cÚ¡ 
TheISA
::
MiscReg
 &
v®
,

537 
Th»adID
 
tid
);

539 
ušt64_t
 
»adIÁReg
(
»g_idx
);

541 
	gTheISA
::
FlßtReg
 
»adFlßtReg
(
»g_idx
);

543 
	gTheISA
::
FlßtRegB™s
 
»adFlßtRegB™s
(
»g_idx
);

545 
£tIÁReg
(
»g_idx
, 
ušt64_t
 
v®
);

547 
£tFlßtReg
(
»g_idx
, 
TheISA
::
FlßtReg
 
v®
);

549 
£tFlßtRegB™s
(
»g_idx
, 
TheISA
::
FlßtRegB™s
 
v®
);

551 
ušt64_t
 
»adArchIÁReg
(
»g_idx
, 
Th»adID
 
tid
);

553 
»adArchFlßtReg
(
»g_idx
, 
Th»adID
 
tid
);

555 
ušt64_t
 
»adArchFlßtRegIÁ
(
»g_idx
, 
Th»adID
 
tid
);

562 
£tArchIÁReg
(
»g_idx
, 
ušt64_t
 
v®
, 
Th»adID
 
tid
);

564 
£tArchFlßtReg
(
»g_idx
, 
v®
, 
Th»adID
 
tid
);

566 
£tArchFlßtRegIÁ
(
»g_idx
, 
ušt64_t
 
v®
, 
Th»adID
 
tid
);

569 
pcS‹
(cÚ¡ 
TheISA
::
PCS‹
 &
ÃwPCS‹
, 
Th»adID
 
tid
);

572 
	gTheISA
::
PCS‹
 
pcS‹
(
Th»adID
 
tid
);

575 
Addr
 
š¡Addr
(
Th»adID
 
tid
);

578 
MiüoPC
 
miüoPC
(
Th»adID
 
tid
);

581 
Addr
 
ÃxtIn¡Addr
(
Th»adID
 
tid
);

587 
squashFromTC
(
Th»adID
 
tid
);

592 
Li¡It
 
addIn¡
(
DynIn¡PŒ
 &
š¡
);

595 
š¡DÚe
(
Th»adID
 
tid
, 
DynIn¡PŒ
 &
š¡
);

600 
»moveFrÚtIn¡
(
DynIn¡PŒ
 &
š¡
);

604 
»moveIn¡sNÙInROB
(
Th»adID
 
tid
);

607 
»moveIn¡sUÁ
(cÚ¡ 
In¡SeqNum
 &
£q_num
, 
Th»adID
 
tid
);

610 
šlše
 
squashIn¡It
(cÚ¡ 
Li¡It
 &
š¡It
, 
Th»adID
 
tid
);

613 
ş—nUpRemovedIn¡s
();

616 
dumpIn¡s
();

618 
	gpublic
:

619 #iâdeà
NDEBUG


621 
š¡couÁ
;

625 
	g¡d
::
li¡
<
DynIn¡PŒ
> 
š¡Li¡
;

630 
	g¡d
::
queue
<
Li¡It
> 
»moveLi¡
;

632 #ifdeà
DEBUG


636 
	g¡d
::
£t
<
In¡SeqNum
> 
¢Li¡
;

642 
boŞ
 
	g»moveIn¡sThisCyşe
;

644 
	g´Ùeùed
:

646 
ty³Çme
 
CPUPŞicy
::
F‘ch
 
ãtch
;

649 
ty³Çme
 
	gCPUPŞicy
::
Decode
 
decode
;

652 
ty³Çme
 
	gCPUPŞicy
::
R’ame
 
»Çme
;

655 
ty³Çme
 
	gCPUPŞicy
::
IEW
 
›w
;

658 
ty³Çme
 
	gCPUPŞicy
::
Comm™
 
comm™
;

661 
ty³Çme
 
	gCPUPŞicy
::
RegFe
 
»gFe
;

664 
ty³Çme
 
	gCPUPŞicy
::
F»eLi¡
 
ä“Li¡
;

667 
ty³Çme
 
	gCPUPŞicy
::
R’ameM­
 
»ÇmeM­
[
Im¶
::
MaxTh»ads
];

670 
ty³Çme
 
	gCPUPŞicy
::
R’ameM­
 
comm™R’ameM­
[
Im¶
::
MaxTh»ads
];

673 
ty³Çme
 
	gCPUPŞicy
::
ROB
 
rob
;

676 
	g¡d
::
li¡
<
Th»adID
> 
aùiveTh»ads
;

679 
ScÜebßrd
 
	gscÜebßrd
;

681 
	g¡d
::
veùÜ
<
TheISA
::
ISA
 *> 
i§
;

684 
IÿchePÜt
 
	giÿchePÜt
;

687 
DÿchePÜt
 
	gdÿchePÜt
;

689 
	gpublic
:

694 
	eSgeIdx
 {

695 
F‘chIdx
,

696 
	gDecodeIdx
,

697 
	gR’ameIdx
,

698 
	gIEWIdx
,

699 
	gComm™Idx
,

700 
	gNumSges
 };

705 
ty³Çme
 
	tCPUPŞicy
::
	tTimeSŒuù
 TimeStruct;

707 
ty³Çme
 
	tCPUPŞicy
::
	tF‘chSŒuù
 FetchStruct;

709 
ty³Çme
 
	tCPUPŞicy
::
	tDecodeSŒuù
 DecodeStruct;

711 
ty³Çme
 
	tCPUPŞicy
::
	tR’ameSŒuù
 RenameStruct;

713 
ty³Çme
 
	tCPUPŞicy
::
	tIEWSŒuù
 IEWStruct;

716 
	gTimeBufãr
<
	gTimeSŒuù
> 
	gtimeBufãr
;

719 
	gTimeBufãr
<
	gF‘chSŒuù
> 
	gãtchQueue
;

722 
	gTimeBufãr
<
	gDecodeSŒuù
> 
	gdecodeQueue
;

725 
	gTimeBufãr
<
	gR’ameSŒuù
> 
	g»ÇmeQueue
;

728 
	gTimeBufãr
<
	gIEWSŒuù
> 
	g›wQueue
;

730 
	g´iv©e
:

735 
Aùiv™yRecÜd”
 
aùiv™yRec
;

737 
	gpublic
:

739 
	$aùiv™yThisCyşe
(è{ 
aùiv™yRec
.
	`aùiv™y
(); 
	}
}

742 
	$aùiv©eSge
(cÚ¡ 
SgeIdx
 
idx
)

743 { 
aùiv™yRec
.
	`aùiv©eSge
(
idx
); 
	}
}

746 
	$d—ùiv©eSge
(cÚ¡ 
SgeIdx
 
idx
)

747 { 
aùiv™yRec
.
	`d—ùiv©eSge
(
idx
); 
	}
}

750 
wakeCPU
();

752 
vœtu®
 
wakeup
();

755 
Th»adID
 
g‘F»eTid
();

757 
	gpublic
:

759 
Th»adCÚ‹xt
 *

760 
	$tcBa£
(
Th»adID
 
tid
)

762  
th»ad
[
tid
]->
	`g‘TC
();

763 
	}
}

766 
In¡SeqNum
 
	gglob®SeqNum
;

772 
	gCheck”
<
	gIm¶
> *
	gcheck”
;

775 
Sy¡em
 *
	gsy¡em
;

778 
D¿šMªag”
 *
	gd¿šMªag”
;

781 
	g¡d
::
veùÜ
<
Th»ad
 *> 
th»ad
;

784 
boŞ
 
	gcÚ‹xtSw™ch
;

787 
	g¡d
::
li¡
<> 
ıuWa™Li¡
;

790 
Cyşes
 
	gÏ¡RuÂšgCyşe
;

793 
Tick
 
	gÏ¡Aùiv©edCyşe
;

796 
	g¡d
::
m­
<
Th»adID
, > 
	gth»adM­
;

799 
	g¡d
::
veùÜ
<
Th»adID
> 
tids
;

802 
FauÉ
 
	$»ad
(
Reque¡PŒ
 &
»q
, Reque¡PŒ &
¤eqLow
, Reque¡PŒ &
¤eqHigh
,

803 
ušt8_t
 *
d©a
, 
lßd_idx
)

805  
this
->
›w
.
ld¡Queue
.
	`»ad
(
»q
, 
¤eqLow
, 
¤eqHigh
,

806 
d©a
, 
lßd_idx
);

807 
	}
}

810 
FauÉ
 
	$wr™e
(
Reque¡PŒ
 &
»q
, Reque¡PŒ &
¤eqLow
, Reque¡PŒ &
¤eqHigh
,

811 
ušt8_t
 *
d©a
, 
¡Üe_idx
)

813  
this
->
›w
.
ld¡Queue
.
	`wr™e
(
»q
, 
¤eqLow
, 
¤eqHigh
,

814 
d©a
, 
¡Üe_idx
);

815 
	}
}

818 
vœtu®
 
	gCpuPÜt
 &
	$g‘In¡PÜt
(è{  
iÿchePÜt
; 
	}
}

821 
vœtu®
 
	gCpuPÜt
 &
	$g‘D©aPÜt
(è{  
dÿchePÜt
; 
	}
}

824 
	gSts
::
SÿÏr
 
timesIdËd
;

826 
	gSts
::
SÿÏr
 
idËCyşes
;

829 
	gSts
::
SÿÏr
 
qu›sûCyşes
;

831 
	gSts
::
VeùÜ
 
comm™‹dIn¡s
;

833 
	gSts
::
VeùÜ
 
comm™‹dOps
;

835 
	gSts
::
SÿÏr
 
tÙ®Comm™‹dIn¡s
;

837 
	gSts
::
FÜmuÏ
 
ıi
;

839 
	gSts
::
FÜmuÏ
 
tÙ®Cpi
;

841 
	gSts
::
FÜmuÏ
 
c
;

843 
	gSts
::
FÜmuÏ
 
tÙ®Ipc
;

846 
	gSts
::
SÿÏr
 
štRegfeR—ds
;

847 
	gSts
::
SÿÏr
 
štRegfeWr™es
;

849 
	gSts
::
SÿÏr
 
åRegfeR—ds
;

850 
	gSts
::
SÿÏr
 
åRegfeWr™es
;

852 
	gSts
::
SÿÏr
 
miscRegfeR—ds
;

853 
	gSts
::
SÿÏr
 
miscRegfeWr™es
;

	@cpu_policy.hh

31 #iâdeà
__CPU_O3_CPU_POLICY_HH__


32 
	#__CPU_O3_CPU_POLICY_HH__


	)

34 
	~"ıu/o3/b´ed_un™.hh
"

35 
	~"ıu/o3/comm.hh
"

36 
	~"ıu/o3/comm™.hh
"

37 
	~"ıu/o3/decode.hh
"

38 
	~"ıu/o3/ãtch.hh
"

39 
	~"ıu/o3/ä“_li¡.hh
"

40 
	~"ıu/o3/›w.hh
"

41 
	~"ıu/o3/š¡_queue.hh
"

42 
	~"ıu/o3/lsq.hh
"

43 
	~"ıu/o3/lsq_un™.hh
"

44 
	~"ıu/o3/mem_d•_un™.hh
"

45 
	~"ıu/o3/»gfe.hh
"

46 
	~"ıu/o3/»Çme.hh
"

47 
	~"ıu/o3/»Çme_m­.hh
"

48 
	~"ıu/o3/rob.hh
"

49 
	~"ıu/o3/¡Üe_£t.hh
"

60 
	g‹m¶©e
<
şass
 
	gIm¶
>

61 
	sSim¶eCPUPŞicy


66 ::
BP»dUn™
<
	tIm¶
> 
	tBP»dUn™
;

70 
	mPhysRegFe
<
	tIm¶
> 
	tRegFe
;

72 
Sim¶eF»eLi¡
 
	tF»eLi¡
;

74 
Sim¶eR’ameM­
 
	tR’ameM­
;

76 ::
ROB
<
	tIm¶
> 
	tROB
;

78 
	mIn¡ruùiÚQueue
<
	tIm¶
> 
	tIQ
;

80 ::
MemD•Un™
<
	tStÜeS‘
, 
	tIm¶
> 
	tMemD•Un™
;

82 ::
LSQ
<
	tIm¶
> 
	tLSQ
;

84 ::
LSQUn™
<
	tIm¶
> 
	tLSQUn™
;

87 
	mDeçuÉF‘ch
<
	tIm¶
> 
	tF‘ch
;

89 
	mDeçuÉDecode
<
	tIm¶
> 
	tDecode
;

91 
	mDeçuÉR’ame
<
	tIm¶
> 
	tR’ame
;

93 
	mDeçuÉIEW
<
	tIm¶
> 
	tIEW
;

95 
	mDeçuÉComm™
<
	tIm¶
> 
	tComm™
;

98 
	mDeçuÉF‘chDeçuÉDecode
<
	tIm¶
> 
	tF‘chSŒuù
;

101 
	mDeçuÉDecodeDeçuÉR’ame
<
	tIm¶
> 
	tDecodeSŒuù
;

104 
	mDeçuÉR’ameDeçuÉIEW
<
	tIm¶
> 
	tR’ameSŒuù
;

107 
	mDeçuÉIEWDeçuÉComm™
<
	tIm¶
> 
	tIEWSŒuù
;

110 ::
IssueSŒuù
<
	tIm¶
> 
	tIssueSŒuù
;

113 
	mTimeBufSŒuù
<
	tIm¶
> 
	tTimeSŒuù
;

	@decode.cc

31 
	~"ıu/o3/decode_im¶.hh
"

32 
	~"ıu/o3/i§_¥ecific.hh
"

34 
‹m¶©e
 
şass
 
	gDeçuÉDecode
<
	gO3CPUIm¶
>;

	@decode.hh

43 #iâdeà
__CPU_O3_DECODE_HH__


44 
	#__CPU_O3_DECODE_HH__


	)

46 
	~<queue
>

48 
	~"ba£/¡©i¡ics.hh
"

49 
	~"ıu/timebuf.hh
"

51 
	gD”ivO3CPUP¬ams
;

60 
	g‹m¶©e
<
şass
 
	gIm¶
>

61 şas 
	cDeçuÉDecode


63 
	m´iv©e
:

65 
ty³Çme
 
	tIm¶
::
	tO3CPU
 O3CPU;

66 
ty³Çme
 
	tIm¶
::
	tDynIn¡PŒ
 DynInstPtr;

67 
ty³Çme
 
	tIm¶
::
	tCPUPŞ
 CPUPol;

70 
ty³Çme
 
	tCPUPŞ
::
	tF‘chSŒuù
 FetchStruct;

71 
ty³Çme
 
	tCPUPŞ
::
	tDecodeSŒuù
 DecodeStruct;

72 
ty³Çme
 
	tCPUPŞ
::
	tTimeSŒuù
 TimeStruct;

74 
	mpublic
:

78 
	eDecodeStus
 {

79 
Aùive
,

80 
	mIÇùive


84 
	eTh»adStus
 {

85 
	gRuÂšg
,

86 
	gIdË
,

87 
	gS¹Squash
,

88 
	gSquashšg
,

89 
	gBlocked
,

90 
	gUnblockšg


93 
	g´iv©e
:

95 
DecodeStus
 
_¡©us
;

98 
Th»adStus
 
	gdecodeStus
[
Im¶
::
MaxTh»ads
];

100 
	gpublic
:

102 
DeçuÉDecode
(
O3CPU
 *
_ıu
, 
D”ivO3CPUP¬ams
 *
·¿ms
);

104 
¡¬tupSge
();

105 
»£tSge
();

108 
	g¡d
::
¡ršg
 
	$Çme
() const;

111 
	`»gSts
();

114 
	`£tTimeBufãr
(
TimeBufãr
<
TimeSŒuù
> *
tb_±r
);

117 
	`£tDecodeQueue
(
TimeBufãr
<
DecodeSŒuù
> *
dq_±r
);

120 
	`£tF‘chQueue
(
TimeBufãr
<
F‘chSŒuù
> *
fq_±r
);

123 
	`£tAùiveTh»ads
(
¡d
::
li¡
<
Th»adID
> *
©_±r
);

126 
	$d¿šSª™yCheck
() const;

129 
boŞ
 
	$isD¿šed
(ècÚ¡ {  
Œue
; 
	}
}

132 
	$keOv”From
(è{ 
	`»£tSge
(); 
	}
}

137 
tick
();

144 
decode
(
boŞ
 &
¡©us_chªge
, 
Th»adID
 
tid
);

151 
decodeIn¡s
(
Th»adID
 
tid
);

153 
	g´iv©e
:

157 
skidIn£¹
(
Th»adID
 
tid
);

160 
boŞ
 
skidsEm±y
();

163 
upd©eStus
();

168 
sÜtIn¡s
();

171 
»adSÎSigÇls
(
Th»adID
 
tid
);

174 
boŞ
 
checkSigÇlsAndUpd©e
(
Th»adID
 
tid
);

177 
boŞ
 
	$checkSÎ
(
Th»adID
 
tid
) const;

180 
šlše
 
boŞ
 
	`ãtchIn¡sV®id
();

186 
boŞ
 
	`block
(
Th»adID
 
tid
);

192 
boŞ
 
	`unblock
(
Th»adID
 
tid
);

197 
	`squash
(
DynIn¡PŒ
 &
š¡
, 
Th»adID
 
tid
);

199 
public
:

203 
	`squash
(
Th»adID
 
tid
);

205 
´iv©e
:

208 
O3CPU
 *
ıu
;

211 
TimeBufãr
<
TimeSŒuù
> *
timeBufãr
;

214 
ty³Çme
 
TimeBufãr
<
TimeSŒuù
>::
wœe
 
äomR’ame
;

217 
ty³Çme
 
TimeBufãr
<
TimeSŒuù
>::
wœe
 
äomIEW
;

220 
ty³Çme
 
TimeBufãr
<
TimeSŒuù
>::
wœe
 
äomComm™
;

224 
ty³Çme
 
TimeBufãr
<
TimeSŒuù
>::
wœe
 
toF‘ch
;

227 
TimeBufãr
<
DecodeSŒuù
> *
decodeQueue
;

230 
ty³Çme
 
TimeBufãr
<
DecodeSŒuù
>::
wœe
 
toR’ame
;

233 
TimeBufãr
<
F‘chSŒuù
> *
ãtchQueue
;

236 
ty³Çme
 
TimeBufãr
<
F‘chSŒuù
>::
wœe
 
äomF‘ch
;

239 
¡d
::
queue
<
DynIn¡PŒ
> 
š¡s
[
Im¶
::
MaxTh»ads
];

242 
¡d
::
queue
<
DynIn¡PŒ
> 
skidBufãr
[
Im¶
::
MaxTh»ads
];

247 
boŞ
 
wrÙeToTimeBufãr
;

250 
	sSÎs
 {

251 
boŞ
 
»Çme
;

252 
boŞ
 
›w
;

253 
boŞ
 
comm™
;

254 
	}
};

257 
SÎs
 
	g¡®ls
[
Im¶
::
MaxTh»ads
];

260 
Cyşes
 
	g»ÇmeToDecodeD–ay
;

263 
Cyşes
 
	g›wToDecodeD–ay
;

266 
Cyşes
 
	gcomm™ToDecodeD–ay
;

269 
Cyşes
 
	gãtchToDecodeD–ay
;

272 
	gdecodeWidth
;

275 
	gtoR’ameIndex
;

278 
Th»adID
 
	gnumTh»ads
;

281 
	g¡d
::
li¡
<
Th»adID
> *
aùiveTh»ads
;

284 
	gskidBufãrMax
;

287 
Addr
 
	gbd–ayDÚeSeqNum
[
Im¶
::
MaxTh»ads
];

290 
DynIn¡PŒ
 
	gsquashIn¡
[
Im¶
::
MaxTh»ads
];

296 
boŞ
 
	gsquashAá”D–aySlÙ
[
Im¶
::
MaxTh»ads
];

300 
	gSts
::
SÿÏr
 
decodeIdËCyşes
;

302 
	gSts
::
SÿÏr
 
decodeBlockedCyşes
;

304 
	gSts
::
SÿÏr
 
decodeRunCyşes
;

306 
	gSts
::
SÿÏr
 
decodeUnblockCyşes
;

308 
	gSts
::
SÿÏr
 
decodeSquashCyşes
;

310 
	gSts
::
SÿÏr
 
decodeB¿nchResŞved
;

312 
	gSts
::
SÿÏr
 
decodeB¿nchMi¥»d
;

316 
	gSts
::
SÿÏr
 
decodeCÚŒŞMi¥»d
;

318 
	gSts
::
SÿÏr
 
decodeDecodedIn¡s
;

320 
	gSts
::
SÿÏr
 
decodeSquashedIn¡s
;

	@decode_impl.hh

43 
	~"¬ch/ty³s.hh
"

44 
	~"ba£/Œaû.hh
"

45 
	~"cÚfig/the_i§.hh
"

46 
	~"ıu/o3/decode.hh
"

47 
	~"ıu/š¡_£q.hh
"

48 
	~"debug/Aùiv™y.hh
"

49 
	~"debug/Decode.hh
"

50 
	~"·¿ms/D”ivO3CPU.hh
"

51 
	~"sim/fuÎ_sy¡em.hh
"

55 
usšg
 
	g¡d
::
li¡
;

57 
	g‹m¶©e
<
şass
 
	gIm¶
>

58 
	gDeçuÉDecode
<
	gIm¶
>::
	$DeçuÉDecode
(
O3CPU
 *
_ıu
, 
D”ivO3CPUP¬ams
 *
·¿ms
)

59 : 
	`ıu
(
_ıu
),

60 
	`»ÇmeToDecodeD–ay
(
·¿ms
->
»ÇmeToDecodeD–ay
),

61 
	`›wToDecodeD–ay
(
·¿ms
->
›wToDecodeD–ay
),

62 
	`comm™ToDecodeD–ay
(
·¿ms
->
comm™ToDecodeD–ay
),

63 
	`ãtchToDecodeD–ay
(
·¿ms
->
ãtchToDecodeD–ay
),

64 
	`decodeWidth
(
·¿ms
->
decodeWidth
),

65 
	`numTh»ads
(
·¿ms
->
numTh»ads
)

68 
skidBufãrMax
 = (
ãtchToDecodeD–ay
 + 1è* 
·¿ms
->
ãtchWidth
;

69 
	}
}

71 
	g‹m¶©e
<
şass
 
	gIm¶
>

73 
	gDeçuÉDecode
<
	gIm¶
>::
	$¡¬tupSge
()

75 
	`»£tSge
();

76 
	}
}

78 
	g‹m¶©e
<
şass
 
	gIm¶
>

80 
	gDeçuÉDecode
<
	gIm¶
>::
	$»£tSge
()

82 
_¡©us
 = 
IÇùive
;

85 
Th»adID
 
tid
 = 0;id < 
numTh»ads
; ++tid) {

86 
decodeStus
[
tid
] = 
IdË
;

88 
¡®ls
[
tid
].
»Çme
 = 
çl£
;

89 
¡®ls
[
tid
].
›w
 = 
çl£
;

90 
¡®ls
[
tid
].
comm™
 = 
çl£
;

92 
	}
}

94 
	g‹m¶©e
 <
şass
 
	gIm¶
>

95 
	g¡d
::
¡ršg


96 
DeçuÉDecode
<
Im¶
>::
	$Çme
() const

98  
ıu
->
	`Çme
() + ".decode";

99 
	}
}

101 
	g‹m¶©e
 <
şass
 
	gIm¶
>

103 
	gDeçuÉDecode
<
	gIm¶
>::
	$»gSts
()

105 
decodeIdËCyşes


106 .
	`Çme
(name() + ".IdleCycles")

107 .
	`desc
("Number of cycles decode is idle")

108 .
	`´”eq
(
decodeIdËCyşes
);

109 
decodeBlockedCyşes


110 .
	`Çme
(name() + ".BlockedCycles")

111 .
	`desc
("Number of cycles decode is blocked")

112 .
	`´”eq
(
decodeBlockedCyşes
);

113 
decodeRunCyşes


114 .
	`Çme
(name() + ".RunCycles")

115 .
	`desc
("Number of cycles decode is„unning")

116 .
	`´”eq
(
decodeRunCyşes
);

117 
decodeUnblockCyşes


118 .
	`Çme
(name() + ".UnblockCycles")

119 .
	`desc
("Number of cycles decode is unblocking")

120 .
	`´”eq
(
decodeUnblockCyşes
);

121 
decodeSquashCyşes


122 .
	`Çme
(name() + ".SquashCycles")

123 .
	`desc
("Number of cycles decode is squashing")

124 .
	`´”eq
(
decodeSquashCyşes
);

125 
decodeB¿nchResŞved


126 .
	`Çme
(name() + ".BranchResolved")

127 .
	`desc
("Number ofimes decode„esolved‡ branch")

128 .
	`´”eq
(
decodeB¿nchResŞved
);

129 
decodeB¿nchMi¥»d


130 .
	`Çme
(name() + ".BranchMispred")

131 .
	`desc
("Number ofimes decode detected‡ branch misprediction")

132 .
	`´”eq
(
decodeB¿nchMi¥»d
);

133 
decodeCÚŒŞMi¥»d


134 .
	`Çme
(name() + ".ControlMispred")

135 .
	`desc
("Number ofimes decode detected‡n instruction incorrectly"

137 .
	`´”eq
(
decodeCÚŒŞMi¥»d
);

138 
decodeDecodedIn¡s


139 .
	`Çme
(name() + ".DecodedInsts")

140 .
	`desc
("Number of instructions handled by decode")

141 .
	`´”eq
(
decodeDecodedIn¡s
);

142 
decodeSquashedIn¡s


143 .
	`Çme
(name() + ".SquashedInsts")

144 .
	`desc
("Number of squashed instructions handled by decode")

145 .
	`´”eq
(
decodeSquashedIn¡s
);

146 
	}
}

148 
	g‹m¶©e
<
şass
 
	gIm¶
>

150 
	gDeçuÉDecode
<
	gIm¶
>::
£tTimeBufãr
(
TimeBufãr
<
TimeSŒuù
> *
tb_±r
)

152 
timeBufãr
 = 
tb_±r
;

155 
	gtoF‘ch
 = 
timeBufãr
->
g‘Wœe
(0);

158 
	gäomR’ame
 = 
timeBufãr
->
g‘Wœe
(-
»ÇmeToDecodeD–ay
);

159 
	gäomIEW
 = 
timeBufãr
->
g‘Wœe
(-
›wToDecodeD–ay
);

160 
	gäomComm™
 = 
timeBufãr
->
g‘Wœe
(-
comm™ToDecodeD–ay
);

163 
	g‹m¶©e
<
şass
 
	gIm¶
>

165 
	gDeçuÉDecode
<
	gIm¶
>::
£tDecodeQueue
(
TimeBufãr
<
DecodeSŒuù
> *
dq_±r
)

167 
decodeQueue
 = 
dq_±r
;

170 
	gtoR’ame
 = 
decodeQueue
->
g‘Wœe
(0);

173 
	g‹m¶©e
<
şass
 
	gIm¶
>

175 
	gDeçuÉDecode
<
	gIm¶
>::
£tF‘chQueue
(
TimeBufãr
<
F‘chSŒuù
> *
fq_±r
)

177 
ãtchQueue
 = 
fq_±r
;

180 
	gäomF‘ch
 = 
ãtchQueue
->
g‘Wœe
(-
ãtchToDecodeD–ay
);

183 
	g‹m¶©e
<
şass
 
	gIm¶
>

185 
	gDeçuÉDecode
<
	gIm¶
>::
£tAùiveTh»ads
(
¡d
::
li¡
<
Th»adID
> *
©_±r
)

187 
aùiveTh»ads
 = 
©_±r
;

190 
	g‹m¶©e
 <
şass
 
	gIm¶
>

192 
	gDeçuÉDecode
<
	gIm¶
>::
	$d¿šSª™yCheck
() const

194 
Th»adID
 
tid
 = 0;id < 
numTh»ads
; ++tid) {

195 
	`as£¹
(
š¡s
[
tid
].
	`em±y
());

196 
	`as£¹
(
skidBufãr
[
tid
].
	`em±y
());

198 
	}
}

200 
	g‹m¶©e
<
şass
 
	gIm¶
>

201 
boŞ


202 
	gDeçuÉDecode
<
	gIm¶
>::
	$checkSÎ
(
Th»adID
 
tid
) const

204 
boŞ
 
»t_v®
 = 
çl£
;

206 ià(
¡®ls
[
tid
].
»Çme
) {

207 
	`DPRINTF
(
Decode
,"[tid:%i]: SÎ fom R’am¡agd‘eùed.\n", 
tid
);

208 
»t_v®
 = 
Œue
;

209 } ià(
¡®ls
[
tid
].
›w
) {

210 
	`DPRINTF
(
Decode
,"[tid:%i]: SÎ fom IEW sgd‘eùed.\n", 
tid
);

211 
»t_v®
 = 
Œue
;

212 } ià(
¡®ls
[
tid
].
comm™
) {

213 
	`DPRINTF
(
Decode
,"[tid:%i]: SÎ fom Comm™ sgd‘eùed.\n", 
tid
);

214 
»t_v®
 = 
Œue
;

217  
»t_v®
;

218 
	}
}

220 
	g‹m¶©e
<
şass
 
	gIm¶
>

221 
šlše
 
boŞ


222 
	gDeçuÉDecode
<
	gIm¶
>::
	$ãtchIn¡sV®id
()

224  
äomF‘ch
->
size
 > 0;

225 
	}
}

227 
	g‹m¶©e
<
şass
 
	gIm¶
>

228 
boŞ


229 
	gDeçuÉDecode
<
	gIm¶
>::
	$block
(
Th»adID
 
tid
)

231 
	`DPRINTF
(
Decode
, "[tid:%u]: Blockšg.\n", 
tid
);

235 
	`skidIn£¹
(
tid
);

240 ià(
decodeStus
[
tid
] !ğ
Blocked
) {

242 
decodeStus
[
tid
] = 
Blocked
;

244 ià(
decodeStus
[
tid
] !ğ
Unblockšg
) {

245 
toF‘ch
->
decodeBlock
[
tid
] = 
Œue
;

246 
wrÙeToTimeBufãr
 = 
Œue
;

249  
Œue
;

252  
çl£
;

253 
	}
}

255 
	g‹m¶©e
<
şass
 
	gIm¶
>

256 
boŞ


257 
	gDeçuÉDecode
<
	gIm¶
>::
	$unblock
(
Th»adID
 
tid
)

260 ià(
skidBufãr
[
tid
].
	`em±y
()) {

261 
	`DPRINTF
(
Decode
, "[tid:%u]: DÚunblockšg.\n", 
tid
);

262 
toF‘ch
->
decodeUnblock
[
tid
] = 
Œue
;

263 
wrÙeToTimeBufãr
 = 
Œue
;

265 
decodeStus
[
tid
] = 
RuÂšg
;

266  
Œue
;

269 
	`DPRINTF
(
Decode
, "[tid:%u]: Cu¼’y unblockšg.\n", 
tid
);

271  
çl£
;

272 
	}
}

274 
	g‹m¶©e
<
şass
 
	gIm¶
>

276 
	gDeçuÉDecode
<
	gIm¶
>::
	$squash
(
DynIn¡PŒ
 &
š¡
, 
Th»adID
 
tid
)

278 
	`DPRINTF
(
Decode
, "[tid:%i]: [sn:%i] Squashing dueo incorrect branch "

279 "´ediùiÚ d‘eùed‡ˆdecode.\n", 
tid
, 
š¡
->
£qNum
);

282 
toF‘ch
->
decodeInfo
[
tid
].
b¿nchMi¥»diù
 = 
Œue
;

283 
toF‘ch
->
decodeInfo
[
tid
].
´edIncÜ»ù
 = 
Œue
;

284 
toF‘ch
->
decodeInfo
[
tid
].
mi¥»diùIn¡
 = 
š¡
;

285 
toF‘ch
->
decodeInfo
[
tid
].
squash
 = 
Œue
;

286 
toF‘ch
->
decodeInfo
[
tid
].
dÚeSeqNum
 = 
š¡
->
£qNum
;

287 
toF‘ch
->
decodeInfo
[
tid
].
ÃxtPC
 = 
š¡
->
	`b¿nchT¬g‘
();

288 
toF‘ch
->
decodeInfo
[
tid
].
b¿nchTak’
 = 
š¡
->
	`pcS‹
().
	`b¿nchšg
();

289 
toF‘ch
->
decodeInfo
[
tid
].
squashIn¡
 = 
š¡
;

290 ià(
toF‘ch
->
decodeInfo
[
tid
].
mi¥»diùIn¡
->
	`isUncÚdCŒl
()) {

291 
toF‘ch
->
decodeInfo
[
tid
].
b¿nchTak’
 = 
Œue
;

294 
In¡SeqNum
 
squash_£q_num
 = 
š¡
->
£qNum
;

297 ià(
decodeStus
[
tid
] =ğ
Blocked
 ||

298 
decodeStus
[
tid
] =ğ
Unblockšg
) {

299 
toF‘ch
->
decodeUnblock
[
tid
] = 1;

303 
decodeStus
[
tid
] = 
Squashšg
;

305 
i
=0; i<
äomF‘ch
->
size
; i++) {

306 ià(
äomF‘ch
->
š¡s
[
i
]->
th»adNumb”
 =ğ
tid
 &&

307 
äomF‘ch
->
š¡s
[
i
]->
£qNum
 > 
squash_£q_num
) {

308 
äomF‘ch
->
š¡s
[
i
]->
	`£tSquashed
();

314 !
š¡s
[
tid
].
	`em±y
()) {

315 
š¡s
[
tid
].
	`pİ
();

318 !
skidBufãr
[
tid
].
	`em±y
()) {

319 
skidBufãr
[
tid
].
	`pİ
();

323 
ıu
->
	`»moveIn¡sUÁ
(
squash_£q_num
, 
tid
);

324 
	}
}

326 
	g‹m¶©e
<
şass
 
	gIm¶
>

328 
	gDeçuÉDecode
<
	gIm¶
>::
	$squash
(
Th»adID
 
tid
)

330 
	`DPRINTF
(
Decode
, "[tid:%i]: Squashšg.\n",
tid
);

332 ià(
decodeStus
[
tid
] =ğ
Blocked
 ||

333 
decodeStus
[
tid
] =ğ
Unblockšg
) {

334 ià(
FuÎSy¡em
) {

335 
toF‘ch
->
decodeUnblock
[
tid
] = 1;

341 ià(
toF‘ch
->
decodeBlock
[
tid
])

342 
toF‘ch
->
decodeBlock
[
tid
] = 0;

344 
toF‘ch
->
decodeUnblock
[
tid
] = 1;

349 
decodeStus
[
tid
] = 
Squashšg
;

352 
squash_couÁ
 = 0;

354 
i
=0; i<
äomF‘ch
->
size
; i++) {

355 ià(
äomF‘ch
->
š¡s
[
i
]->
th»adNumb”
 =ğ
tid
) {

356 
äomF‘ch
->
š¡s
[
i
]->
	`£tSquashed
();

357 
squash_couÁ
++;

363 !
š¡s
[
tid
].
	`em±y
()) {

364 
š¡s
[
tid
].
	`pİ
();

367 !
skidBufãr
[
tid
].
	`em±y
()) {

368 
skidBufãr
[
tid
].
	`pİ
();

371  
squash_couÁ
;

372 
	}
}

374 
	g‹m¶©e
<
şass
 
	gIm¶
>

376 
	gDeçuÉDecode
<
	gIm¶
>::
	$skidIn£¹
(
Th»adID
 
tid
)

378 
DynIn¡PŒ
 
š¡
 = 
NULL
;

380 !
š¡s
[
tid
].
	`em±y
()) {

381 
š¡
 = 
š¡s
[
tid
].
	`äÚt
();

383 
š¡s
[
tid
].
	`pİ
();

385 
	`as£¹
(
tid
 =ğ
š¡
->
th»adNumb”
);

387 
	`DPRINTF
(
Decode
,"Inserting [sn:%lli] PC: %s into decode skidBuffer %i\n",

388 
š¡
->
£qNum
, in¡->
	`pcS‹
(), in¡->
th»adNumb”
);

390 
skidBufãr
[
tid
].
	`push
(
š¡
);

395 
	`as£¹
(
skidBufãr
[
tid
].
	`size
(è<ğ
skidBufãrMax
);

396 
	}
}

398 
	g‹m¶©e
<
şass
 
	gIm¶
>

399 
boŞ


400 
	gDeçuÉDecode
<
	gIm¶
>::
	$skidsEm±y
()

402 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

403 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

405 
th»ads
 !ğ
’d
) {

406 
Th»adID
 
tid
 = *
th»ads
++;

407 ià(!
skidBufãr
[
tid
].
	`em±y
())

408  
çl£
;

411  
Œue
;

412 
	}
}

414 
	g‹m¶©e
<
şass
 
	gIm¶
>

416 
	gDeçuÉDecode
<
	gIm¶
>::
	$upd©eStus
()

418 
boŞ
 
ªy_unblockšg
 = 
çl£
;

420 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

421 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

423 
th»ads
 !ğ
’d
) {

424 
Th»adID
 
tid
 = *
th»ads
++;

426 ià(
decodeStus
[
tid
] =ğ
Unblockšg
) {

427 
ªy_unblockšg
 = 
Œue
;

433 ià(
ªy_unblockšg
) {

434 ià(
_¡©us
 =ğ
IÇùive
) {

435 
_¡©us
 = 
Aùive
;

437 
	`DPRINTF
(
Aùiv™y
, "Activating stage.\n");

439 
ıu
->
	`aùiv©eSge
(
O3CPU
::
DecodeIdx
);

444 ià(
_¡©us
 =ğ
Aùive
) {

445 
_¡©us
 = 
IÇùive
;

446 
	`DPRINTF
(
Aùiv™y
, "Deactivating stage.\n");

448 
ıu
->
	`d—ùiv©eSge
(
O3CPU
::
DecodeIdx
);

451 
	}
}

453 
	g‹m¶©e
 <
şass
 
	gIm¶
>

455 
	gDeçuÉDecode
<
	gIm¶
>::
	$sÜtIn¡s
()

457 
š¡s_äom_ãtch
 = 
äomF‘ch
->
size
;

458 
i
 = 0; i < 
š¡s_äom_ãtch
; ++i) {

459 
š¡s
[
äomF‘ch
->š¡s[
i
]->
th»adNumb”
].
	`push
(fromFetch->insts[i]);

461 
	}
}

463 
	g‹m¶©e
<
şass
 
	gIm¶
>

465 
	gDeçuÉDecode
<
	gIm¶
>::
	$»adSÎSigÇls
(
Th»adID
 
tid
)

467 ià(
äomR’ame
->
»ÇmeBlock
[
tid
]) {

468 
¡®ls
[
tid
].
»Çme
 = 
Œue
;

471 ià(
äomR’ame
->
»ÇmeUnblock
[
tid
]) {

472 
	`as£¹
(
¡®ls
[
tid
].
»Çme
);

473 
¡®ls
[
tid
].
»Çme
 = 
çl£
;

476 ià(
äomIEW
->
›wBlock
[
tid
]) {

477 
¡®ls
[
tid
].
›w
 = 
Œue
;

480 ià(
äomIEW
->
›wUnblock
[
tid
]) {

481 
	`as£¹
(
¡®ls
[
tid
].
›w
);

482 
¡®ls
[
tid
].
›w
 = 
çl£
;

485 ià(
äomComm™
->
comm™Block
[
tid
]) {

486 
¡®ls
[
tid
].
comm™
 = 
Œue
;

489 ià(
äomComm™
->
comm™Unblock
[
tid
]) {

490 
	`as£¹
(
¡®ls
[
tid
].
comm™
);

491 
¡®ls
[
tid
].
comm™
 = 
çl£
;

493 
	}
}

495 
	g‹m¶©e
 <
şass
 
	gIm¶
>

496 
boŞ


497 
	gDeçuÉDecode
<
	gIm¶
>::
	$checkSigÇlsAndUpd©e
(
Th»adID
 
tid
)

508 
	`»adSÎSigÇls
(
tid
);

511 ià(
äomComm™
->
comm™Info
[
tid
].
squash
) {

513 
	`DPRINTF
(
Decode
, "[tid:%u]: Squashing instructions dueo squash "

514 "äom comm™.\n", 
tid
);

516 
	`squash
(
tid
);

518  
Œue
;

522 ià(
äomComm™
->
comm™Info
[
tid
].
robSquashšg
) {

523 
	`DPRINTF
(
Decode
, "[tid:%u]: ROB i ¡Èsquashšg.\n", 
tid
);

526 
decodeStus
[
tid
] = 
Squashšg
;

528  
Œue
;

531 ià(
	`checkSÎ
(
tid
)) {

532  
	`block
(
tid
);

535 ià(
decodeStus
[
tid
] =ğ
Blocked
) {

536 
	`DPRINTF
(
Decode
, "[tid:%u]: Done blocking, switchingo unblocking.\n",

537 
tid
);

539 
decodeStus
[
tid
] = 
Unblockšg
;

541 
	`unblock
(
tid
);

543  
Œue
;

546 ià(
decodeStus
[
tid
] =ğ
Squashšg
) {

549 
	`DPRINTF
(
Decode
, "[tid:%u]: Done squashing, switchingo„unning.\n",

550 
tid
);

552 
decodeStus
[
tid
] = 
RuÂšg
;

554  
çl£
;

559  
çl£
;

560 
	}
}

562 
	g‹m¶©e
<
şass
 
	gIm¶
>

564 
	gDeçuÉDecode
<
	gIm¶
>::
	$tick
()

566 
wrÙeToTimeBufãr
 = 
çl£
;

568 
boŞ
 
¡©us_chªge
 = 
çl£
;

570 
toR’ameIndex
 = 0;

572 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

573 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

575 
	`sÜtIn¡s
();

578 
th»ads
 !ğ
’d
) {

579 
Th»adID
 
tid
 = *
th»ads
++;

581 
	`DPRINTF
(
Decode
,"Proûssšg [tid:%i]\n",
tid
);

582 
¡©us_chªge
 = 
	`checkSigÇlsAndUpd©e
(
tid
) || status_change;

584 
	`decode
(
¡©us_chªge
, 
tid
);

587 ià(
¡©us_chªge
) {

588 
	`upd©eStus
();

591 ià(
wrÙeToTimeBufãr
) {

592 
	`DPRINTF
(
Aùiv™y
, "Activityhis cycle.\n");

594 
ıu
->
	`aùiv™yThisCyşe
();

596 
	}
}

598 
	g‹m¶©e
<
şass
 
	gIm¶
>

600 
	gDeçuÉDecode
<
	gIm¶
>::
	$decode
(
boŞ
 &
¡©us_chªge
, 
Th»adID
 
tid
)

609 ià(
decodeStus
[
tid
] =ğ
Blocked
) {

610 ++
decodeBlockedCyşes
;

611 } ià(
decodeStus
[
tid
] =ğ
Squashšg
) {

612 ++
decodeSquashCyşes
;

617 ià(
decodeStus
[
tid
] =ğ
RuÂšg
 ||

618 
decodeStus
[
tid
] =ğ
IdË
) {

619 
	`DPRINTF
(
Decode
, "[tid:%u]: Not blocked, so‡ttemptingo„un "

620 "¡age.\n",
tid
);

622 
	`decodeIn¡s
(
tid
);

623 } ià(
decodeStus
[
tid
] =ğ
Unblockšg
) {

626 
	`as£¹
(!
	`skidsEm±y
());

631 
	`decodeIn¡s
(
tid
);

633 ià(
	`ãtchIn¡sV®id
()) {

636 
	`skidIn£¹
(
tid
);

639 
¡©us_chªge
 = 
	`unblock
(
tid
) || status_change;

641 
	}
}

643 
	g‹m¶©e
 <
şass
 
	gIm¶
>

645 
	gDeçuÉDecode
<
	gIm¶
>::
	$decodeIn¡s
(
Th»adID
 
tid
)

649 
š¡s_avaabË
 = 
decodeStus
[
tid
] =ğ
Unblockšg
 ?

650 
skidBufãr
[
tid
].
	`size
(è: 
š¡s
[tid].size();

652 ià(
š¡s_avaabË
 == 0) {

653 
	`DPRINTF
(
Decode
, "[tid:%u] Nothingo do, breaking out"

654 "ƒ¬ly.\n",
tid
);

656 ++
decodeIdËCyşes
;

658 } ià(
decodeStus
[
tid
] =ğ
Unblockšg
) {

659 
	`DPRINTF
(
Decode
, "[tid:%u] Unblocking,„emoving insts from skid "

660 "bufãr.\n",
tid
);

661 ++
decodeUnblockCyşes
;

662 } ià(
decodeStus
[
tid
] =ğ
RuÂšg
) {

663 ++
decodeRunCyşes
;

666 
DynIn¡PŒ
 
š¡
;

668 
¡d
::
queue
<
DynIn¡PŒ
>

669 &
š¡s_to_decode
 = 
decodeStus
[
tid
] =ğ
Unblockšg
 ?

670 
skidBufãr
[
tid
] : 
š¡s
[tid];

672 
	`DPRINTF
(
Decode
, "[tid:%u]: S’dšg in¡ruùiÚØ»Çme.\n",
tid
);

674 
š¡s_avaabË
 > 0 && 
toR’ameIndex
 < 
decodeWidth
) {

675 
	`as£¹
(!
š¡s_to_decode
.
	`em±y
());

677 
š¡
 = 
š¡s_to_decode
.
	`äÚt
();

679 
š¡s_to_decode
.
	`pİ
();

681 
	`DPRINTF
(
Decode
, "[tid:%u]: Processing instruction [sn:%lli] with "

682 "PC %s\n", 
tid
, 
š¡
->
£qNum
, in¡->
	`pcS‹
());

684 ià(
š¡
->
	`isSquashed
()) {

685 
	`DPRINTF
(
Decode
, "[tid:%u]: Instruction %i with PC %s is "

687 
tid
, 
š¡
->
£qNum
, in¡->
	`pcS‹
());

689 ++
decodeSquashedIn¡s
;

691 --
š¡s_avaabË
;

700 ià(
š¡
->
	`numSrcRegs
() == 0) {

701 
š¡
->
	`£tCªIssue
();

707 
toR’ame
->
š¡s
[
toR’ameIndex
] = 
š¡
;

709 ++(
toR’ame
->
size
);

710 ++
toR’ameIndex
;

711 ++
decodeDecodedIn¡s
;

712 --
š¡s_avaabË
;

714 #ià
TRACING_ON


715 
š¡
->
decodeTick
 = 
	`curTick
(è- in¡->
ãtchTick
;

720 ià(
š¡
->
	`»adP»dTak’
(è&& !š¡->
	`isCÚŒŞ
()) {

721 
	`·nic
("Instruction…redicted‡s‡ branch!");

723 ++
decodeCÚŒŞMi¥»d
;

727 
	`squash
(
š¡
, in¡->
th»adNumb”
);

733 ià(
š¡
->
	`isDœeùCŒl
(è&& in¡->
	`isUncÚdCŒl
()) {

734 ++
decodeB¿nchResŞved
;

736 ià(!(
š¡
->
	`b¿nchT¬g‘
(è=ğš¡->
	`»adP»dT¬g
())) {

737 ++
decodeB¿nchMi¥»d
;

741 
	`squash
(
š¡
, in¡->
th»adNumb”
);

742 
TheISA
::
PCS‹
 
rg‘
 = 
š¡
->
	`b¿nchT¬g‘
();

744 
	`DPRINTF
(
Decode
, "[sn:%i]: Updating…redictions: PredPC: %s\n",

745 
š¡
->
£qNum
, 
rg‘
);

747 
š¡
->
	`£tP»dT¬g
(
rg‘
);

755 ià(!
š¡s_to_decode
.
	`em±y
()) {

756 
	`block
(
tid
);

761 ià(
toR’ameIndex
) {

762 
wrÙeToTimeBufãr
 = 
Œue
;

764 
	}
}

	@dep_graph.hh

43 #iâdeà
__CPU_O3_DEP_GRAPH_HH__


44 
	#__CPU_O3_DEP_GRAPH_HH__


	)

46 
	~"ıu/o3/comm.hh
"

49 
	g‹m¶©e
 <
şass
 
	gDynIn¡PŒ
>

50 şas 
	cD•’d’cyEÁry


52 
	mpublic
:

53 
	$D•’d’cyEÁry
()

54 : 
	`š¡
(
NULL
), 
	$Ãxt
(
NULL
)

57 
DynIn¡PŒ
 
š¡
;

60 
D•’d’cyEÁry
<
DynIn¡PŒ
> *
Ãxt
;

61 
	}
};

72 
	g‹m¶©e
 <
şass
 
	gDynIn¡PŒ
>

73 şas 
	cD•’d’cyG¿ph


75 
	mpublic
:

76 
D•’d’cyEÁry
<
	tDynIn¡PŒ
> 
	tD•EÁry
;

79 
	$D•’d’cyG¿ph
()

80 : 
	`numEÁr›s
(0), 
	`memAÎocCouÁ”
(0), 
	`nodesT¿v”£d
(0), 
	$nodesRemoved
(0)

83 ~
	`D•’d’cyG¿ph
();

86 
	`»size
(
num_’Œ›s
);

89 
	`»£t
();

92 
	`š£¹
(
PhysRegIndex
 
idx
, 
DynIn¡PŒ
 &
Ãw_š¡
);

95 
	$£tIn¡
(
PhysRegIndex
 
idx
, 
DynIn¡PŒ
 &
Ãw_š¡
)

96 { 
d•’dG¿ph
[
idx
].
š¡
 = 
Ãw_š¡
; 
	}
}

99 
	$ş—rIn¡
(
PhysRegIndex
 
idx
)

100 { 
d•’dG¿ph
[
idx
].
š¡
 = 
NULL
; 
	}
}

103 
»move
(
PhysRegIndex
 
idx
, 
DynIn¡PŒ
 &
š¡_to_»move
);

106 
DynIn¡PŒ
 
pİ
(
PhysRegIndex
 
idx
);

109 
boŞ
 
	$em±y
() const;

112 
boŞ
 
	$em±y
(
PhysRegIndex
 
idx
ècÚ¡ {  !
d•’dG¿ph
[idx].
Ãxt
; 
	}
}

116 
dump
();

118 
	g´iv©e
:

125 
D•EÁry
 *
d•’dG¿ph
;

128 
	gnumEÁr›s
;

131 
	gmemAÎocCouÁ”
;

133 
	gpublic
:

135 
ušt64_t
 
nodesT¿v”£d
;

137 
ušt64_t
 
	gnodesRemoved
;

140 
	g‹m¶©e
 <
şass
 
	gDynIn¡PŒ
>

141 
	gD•’d’cyG¿ph
<
	gDynIn¡PŒ
>::~
	$D•’d’cyG¿ph
()

143 
d–‘e
 [] 
d•’dG¿ph
;

144 
	}
}

146 
	g‹m¶©e
 <
şass
 
	gDynIn¡PŒ
>

148 
	gD•’d’cyG¿ph
<
	gDynIn¡PŒ
>::
	$»size
(
num_’Œ›s
)

150 
numEÁr›s
 = 
num_’Œ›s
;

151 
d•’dG¿ph
 = 
Ãw
 
D•EÁry
[
numEÁr›s
];

152 
	}
}

154 
	g‹m¶©e
 <
şass
 
	gDynIn¡PŒ
>

156 
	gD•’d’cyG¿ph
<
	gDynIn¡PŒ
>::
	$»£t
()

159 
D•EÁry
 *
cu¼
;

160 
D•EÁry
 *
´ev
;

162 
i
 = 0; i < 
numEÁr›s
; ++i) {

163 
cu¼
 = 
d•’dG¿ph
[
i
].
Ãxt
;

165 
cu¼
) {

166 
memAÎocCouÁ”
--;

168 
´ev
 = 
cu¼
;

169 
cu¼
 = 
´ev
->
Ãxt
;

170 
´ev
->
š¡
 = 
NULL
;

172 
d–‘e
 
´ev
;

175 ià(
d•’dG¿ph
[
i
].
š¡
) {

176 
d•’dG¿ph
[
i
].
š¡
 = 
NULL
;

179 
d•’dG¿ph
[
i
].
Ãxt
 = 
NULL
;

181 
	}
}

183 
	g‹m¶©e
 <
şass
 
	gDynIn¡PŒ
>

185 
	gD•’d’cyG¿ph
<
	gDynIn¡PŒ
>::
	$š£¹
(
PhysRegIndex
 
idx
, 
DynIn¡PŒ
 &
Ãw_š¡
)

192 
D•EÁry
 *
Ãw_’Œy
 = 
Ãw
 DepEntry;

193 
Ãw_’Œy
->
Ãxt
 = 
d•’dG¿ph
[
idx
].next;

194 
Ãw_’Œy
->
š¡
 = 
Ãw_š¡
;

197 
d•’dG¿ph
[
idx
].
Ãxt
 = 
Ãw_’Œy
;

199 ++
memAÎocCouÁ”
;

200 
	}
}

203 
	g‹m¶©e
 <
şass
 
	gDynIn¡PŒ
>

205 
	gD•’d’cyG¿ph
<
	gDynIn¡PŒ
>::
	$»move
(
PhysRegIndex
 
idx
,

206 
DynIn¡PŒ
 &
š¡_to_»move
)

208 
D•EÁry
 *
´ev
 = &
d•’dG¿ph
[
idx
];

209 
D•EÁry
 *
cu¼
 = 
d•’dG¿ph
[
idx
].
Ãxt
;

215 ià(
cu¼
 =ğ
NULL
) {

219 
nodesRemoved
++;

222 
cu¼
->
š¡
 !ğ
š¡_to_»move
) {

223 
´ev
 = 
cu¼
;

224 
cu¼
 = cu¼->
Ãxt
;

225 
nodesT¿v”£d
++;

227 
	`as£¹
(
cu¼
 !ğ
NULL
);

231 
´ev
->
Ãxt
 = 
cu¼
->next;

233 --
memAÎocCouÁ”
;

236 
cu¼
->
š¡
 = 
NULL
;

238 
d–‘e
 
cu¼
;

239 
	}
}

241 
	g‹m¶©e
 <
şass
 
	gDynIn¡PŒ
>

242 
DynIn¡PŒ


243 
	gD•’d’cyG¿ph
<
	gDynIn¡PŒ
>::
	$pİ
(
PhysRegIndex
 
idx
)

245 
D•EÁry
 *
node
;

246 
node
 = 
d•’dG¿ph
[
idx
].
Ãxt
;

247 
DynIn¡PŒ
 
š¡
 = 
NULL
;

248 ià(
node
) {

249 
š¡
 = 
node
->inst;

250 
d•’dG¿ph
[
idx
].
Ãxt
 = 
node
->next;

251 
node
->
š¡
 = 
NULL
;

252 
memAÎocCouÁ”
--;

253 
d–‘e
 
node
;

255  
š¡
;

256 
	}
}

258 
	g‹m¶©e
 <
şass
 
	gDynIn¡PŒ
>

259 
boŞ


260 
	gD•’d’cyG¿ph
<
	gDynIn¡PŒ
>::
	$em±y
() const

262 
i
 = 0; i < 
numEÁr›s
; ++i) {

263 ià(!
	`em±y
(
i
))

264  
çl£
;

266  
Œue
;

267 
	}
}

269 
	g‹m¶©e
 <
şass
 
	gDynIn¡PŒ
>

271 
	gD•’d’cyG¿ph
<
	gDynIn¡PŒ
>::
	$dump
()

273 
D•EÁry
 *
cu¼
;

275 
i
 = 0; i < 
numEÁr›s
; ++i)

277 
cu¼
 = &
d•’dG¿ph
[
i
];

279 ià(
cu¼
->
š¡
) {

280 
	`ırštf
("dependGraph[%i]:…roducer: %s [sn:%lli] consumer: ",

281 
i
, 
cu¼
->
š¡
->
	`pcS‹
(), cu¼->š¡->
£qNum
);

283 
	`ırštf
("d•’dG¿ph[%i]: NØ´oduûr. cÚsum”: ", 
i
);

286 
cu¼
->
Ãxt
 !ğ
NULL
) {

287 
cu¼
 = cu¼->
Ãxt
;

289 
	`ırštf
("%s [sn:%lli] ",

290 
cu¼
->
š¡
->
	`pcS‹
(), cu¼->š¡->
£qNum
);

293 
	`ırštf
("\n");

295 
	`ırštf
("memAÎocCouÁ”: %i\n", 
memAÎocCouÁ”
);

296 
	}
}

	@deriv.cc

31 
	~<¡ršg
>

33 
	~"ıu/o3/d”iv.hh
"

34 
	~"·¿ms/D”ivO3CPU.hh
"

36 
D”ivO3CPU
 *

37 
	gD”ivO3CPUP¬ams
::
	$ü—‹
()

39 
Th»adID
 
aùu®_num_th»ads
;

40 ià(
FuÎSy¡em
) {

42 
aùu®_num_th»ads
 = 1;

44 ià(
wÜklßd
.
	`size
(è> 
numTh»ads
) {

45 
	`çl
("Workload Size (%i) > Max Supported Threads (%i) on This CPU",

46 
wÜklßd
.
	`size
(), 
numTh»ads
);

47 } ià(
wÜklßd
.
	`size
() == 0) {

48 
	`çl
("Must specify‡t†east one workload!");

53 
aùu®_num_th»ads
 =

54 (
numTh»ads
 >ğ
wÜklßd
.
	`size
()) ?‚umThreads : workload.size();

57 
numTh»ads
 = 
aùu®_num_th»ads
;

60 
¡d
::
¡ršg
 
round_robš_pŞicy
 = "RoundRobin";

61 
¡d
::
¡ršg
 
sšgË_th»ad
 = "SingleThread";

63 ià(
aùu®_num_th»ads
 > 1 && 
sšgË_th»ad
.
	`com·»
(
smtF‘chPŞicy
) == 0)

64 
smtF‘chPŞicy
 = 
round_robš_pŞicy
;

66 
smtF‘chPŞicy
 = smtFetchPolicy;

68 
š¡ShiáAmt
 = 2;

70  
Ãw
 
	`D”ivO3CPU
(
this
);

71 
	}
}

	@deriv.hh

31 #iâdeà
__CPU_O3_DERIV_HH__


32 
	#__CPU_O3_DERIV_HH__


	)

34 
	~"ıu/o3/ıu.hh
"

35 
	~"ıu/o3/im¶.hh
"

36 
	~"·¿ms/D”ivO3CPU.hh
"

38 
şass
 
	gD”ivO3CPU
 : 
public
 
FuÎO3CPU
<
O3CPUIm¶
>

40 
public
:

41 
D”ivO3CPU
(
D”ivO3CPUP¬ams
 *
p
)

42 : 
FuÎO3CPU
<
O3CPUIm¶
>(
p
)

	@dyn_inst.cc

31 
	~"ıu/o3/dyn_š¡_im¶.hh
"

32 
	~"ıu/o3/im¶.hh
"

36 
‹m¶©e
 
şass
 
	gBa£O3DynIn¡
<
	gO3CPUIm¶
>;

	@dyn_inst.hh

43 #iâdeà
__CPU_O3_DYN_INST_HH__


44 
	#__CPU_O3_DYN_INST_HH__


	)

46 
	~"¬ch/i§_Œa™s.hh
"

47 
	~"cÚfig/the_i§.hh
"

48 
	~"ıu/o3/ıu.hh
"

49 
	~"ıu/o3/i§_¥ecific.hh
"

50 
	~"ıu/ba£_dyn_š¡.hh
"

51 
	~"ıu/š¡_£q.hh
"

53 
şass
 
	gPack‘
;

62 
	g‹m¶©e
 <
şass
 
	gIm¶
>

63 
şass
 
	gBa£O3DynIn¡
 : 
public
 
Ba£DynIn¡
<
Im¶
>

65 
public
:

67 
ty³Çme
 
	tIm¶
::
	tO3CPU
 O3CPU;

70 
	gTheISA
::
	tMachIn¡
 MachInst;

72 
	gTheISA
::
	tExtMachIn¡
 ExtMachInst;

74 
	gTheISA
::
	tRegIndex
 RegIndex;

76 
	gTheISA
::
	tIÁReg
 IntReg;

77 
	gTheISA
::
	tFlßtReg
 FloatReg;

78 
	gTheISA
::
	tFlßtRegB™s
 FloatRegBits;

80 
	gTheISA
::
	tMiscReg
 MiscReg;

83 
	gMaxIn¡SrcRegs
 = 
TheISA
::
MaxIn¡SrcRegs
,

84 
	gMaxIn¡De¡Regs
 = 
TheISA
::
MaxIn¡De¡Regs


87 
	gpublic
:

89 
Ba£O3DynIn¡
(
SticIn¡PŒ
 
¡©icIn¡
, SticIn¡PŒ 
maüoİ
,

90 
TheISA
::
PCS‹
 
pc
, TheISA::PCS‹ 
´edPC
,

91 
In¡SeqNum
 
£q_num
, 
O3CPU
 *
ıu
);

94 
Ba£O3DynIn¡
(
SticIn¡PŒ
 
_¡©icIn¡
, SticIn¡PŒ 
_maüoİ
);

96 ~
Ba£O3DynIn¡
();

99 
FauÉ
 
execu‹
();

102 
FauÉ
 
š™Ÿ‹Acc
();

105 
FauÉ
 
com¶‘eAcc
(
Pack‘PŒ
 
pkt
);

107 
	g´iv©e
:

109 
š™V¬s
();

111 
	g´Ùeùed
:

113 
MiscReg
 
_de¡MiscRegV®
[
TheISA
::
MaxMiscDe¡Regs
];

119 
	g_de¡MiscRegIdx
[
TheISA
::
MaxMiscDe¡Regs
];

122 
ušt8_t
 
	g_numDe¡MiscRegs
;

125 
	gpublic
:

126 #ià
TRACING_ON


128 
Tick
 
ãtchTick
;

129 
št32_t
 
	gdecodeTick
;

130 
št32_t
 
	g»ÇmeTick
;

131 
št32_t
 
	gdi¥©chTick
;

132 
št32_t
 
	gissueTick
;

133 
št32_t
 
	gcom¶‘eTick
;

134 
št32_t
 
	gcomm™Tick
;

140 
MiscReg
 
»adMiscReg
(
misc_»g
)

142  
	gthis
->
	gıu
->
»adMiscReg
(
misc_»g
, 
this
->
th»adNumb”
);

148 
£tMiscReg
(
misc_»g
, cÚ¡ 
MiscReg
 &
v®
)

153 
as£¹
(
_numDe¡MiscRegs
 < 
TheISA
::
MaxMiscDe¡Regs
);

154 
	g_de¡MiscRegIdx
[
_numDe¡MiscRegs
] = 
misc_»g
;

155 
	g_de¡MiscRegV®
[
_numDe¡MiscRegs
] = 
v®
;

156 
	g_numDe¡MiscRegs
++;

162 
	gTheISA
::
MiscReg
 
»adMiscRegO³¿nd
(cÚ¡ 
SticIn¡
 *
si
, 
idx
)

164  
	gthis
->
	gıu
->
»adMiscReg
(

165 
si
->
¤cRegIdx
(
idx
è- 
TheISA
::
CŒl_Ba£_D•Tag
,

166 
this
->
th»adNumb”
);

172 
£tMiscRegO³¿nd
(cÚ¡ 
SticIn¡
 *
si
, 
idx
,

173 cÚ¡ 
MiscReg
 &
v®
)

175 
	gmisc_»g
 = 
si
->
de¡RegIdx
(
idx
è- 
TheISA
::
CŒl_Ba£_D•Tag
;

176 
£tMiscReg
(
misc_»g
, 
v®
);

180 
upd©eMiscRegs
()

186 
boŞ
 
	gno_squash_äom_TC
 = 
this
->
th»ad
->
noSquashFromTC
;

187 
	gthis
->
	gth»ad
->
	gnoSquashFromTC
 = 
Œue
;

189 
	gi
 = 0; i < 
	g_numDe¡MiscRegs
; i++)

190 
	gthis
->
	gıu
->
£tMiscReg
(

191 
_de¡MiscRegIdx
[
i
], 
_de¡MiscRegV®
[i], 
this
->
th»adNumb”
);

193 
	gthis
->
	gth»ad
->
	gnoSquashFromTC
 = 
no_squash_äom_TC
;

196 
fÜw¬dOldRegs
()

199 
	gidx
 = 0; idx < 
	gthis
->
numDe¡Regs
(); idx++) {

200 
PhysRegIndex
 
	g´ev_phys_»g
 = 
this
->
´evDe¡RegIdx
(
idx
);

201 
	gTheISA
::
RegIndex
 
Üigš®_de¡_»g
 = 
this
->
¡©icIn¡
->
de¡RegIdx
(
idx
);

202 ià(
	gÜigš®_de¡_»g
 < 
	gTheISA
::
FP_Ba£_D•Tag
)

203 
this
->
£tIÁRegO³¿nd
Ñhis->
¡©icIn¡
.
g‘
(), 
idx
,his->
ıu
->
»adIÁReg
(
´ev_phys_»g
));

204 ià(
	gÜigš®_de¡_»g
 < 
	gTheISA
::
CŒl_Ba£_D•Tag
)

205 
this
->
£tFlßtRegO³¿ndB™s
Ñhis->
¡©icIn¡
.
g‘
(), 
idx
,his->
ıu
->
»adFlßtRegB™s
(
´ev_phys_»g
));

209 
FauÉ
 
hw»i
();

211 
Œ­
(
FauÉ
 
çuÉ
);

212 
boŞ
 
simP®Check
(
·lFunc
);

215 
sysÿÎ
(
št64_t
 
ÿÎnum
);

217 
	gpublic
:

230 
ušt64_t
 
»adIÁRegO³¿nd
(cÚ¡ 
SticIn¡
 *
si
, 
idx
)

232  
	gthis
->
	gıu
->
»adIÁReg
(
this
->
_¤cRegIdx
[
idx
]);

235 
FlßtReg
 
»adFlßtRegO³¿nd
(cÚ¡ 
SticIn¡
 *
si
, 
idx
)

237  
	gthis
->
	gıu
->
»adFlßtReg
(
this
->
_¤cRegIdx
[
idx
]);

240 
FlßtRegB™s
 
»adFlßtRegO³¿ndB™s
(cÚ¡ 
SticIn¡
 *
si
, 
idx
)

242  
	gthis
->
	gıu
->
»adFlßtRegB™s
(
this
->
_¤cRegIdx
[
idx
]);

248 
£tIÁRegO³¿nd
(cÚ¡ 
SticIn¡
 *
si
, 
idx
, 
ušt64_t
 
v®
)

250 
	gthis
->
	gıu
->
£tIÁReg
(
this
->
_de¡RegIdx
[
idx
], 
v®
);

251 
	gBa£DynIn¡
<
	gIm¶
>::
£tIÁRegO³¿nd
(
si
, 
idx
, 
v®
);

254 
£tFlßtRegO³¿nd
(cÚ¡ 
SticIn¡
 *
si
, 
idx
, 
FlßtReg
 
v®
)

256 
	gthis
->
	gıu
->
£tFlßtReg
(
this
->
_de¡RegIdx
[
idx
], 
v®
);

257 
	gBa£DynIn¡
<
	gIm¶
>::
£tFlßtRegO³¿nd
(
si
, 
idx
, 
v®
);

260 
£tFlßtRegO³¿ndB™s
(cÚ¡ 
SticIn¡
 *
si
, 
idx
,

261 
FlßtRegB™s
 
v®
)

263 
	gthis
->
	gıu
->
£tFlßtRegB™s
(
this
->
_de¡RegIdx
[
idx
], 
v®
);

264 
	gBa£DynIn¡
<
	gIm¶
>::
£tFlßtRegO³¿ndB™s
(
si
, 
idx
, 
v®
);

267 #ià
THE_ISA
 =ğ
MIPS_ISA


268 
ušt64_t
 
»adRegOth”Th»ad
(
misc_»g
)

270 
·nic
("MIPS MT‚ot defined for O3 CPU.\n");

274 
£tRegOth”Th»ad
(
misc_»g
, cÚ¡ 
TheISA
::
MiscReg
 &
v®
)

276 
·nic
("MIPS MT‚ot defined for O3 CPU.\n");

280 
	gpublic
:

285 
FauÉ
 
ÿlcEA
()

287  
this
->
¡©icIn¡
->
—CompIn¡
()->
execu‹
Ñhis,his->
ŒaûD©a
);

294 
FauÉ
 
memAcûss
()

296  
	gthis
->
	g¡©icIn¡
->
memAccIn¡
()->
execu‹
(
this
,his->
ŒaûD©a
);

	@dyn_inst_impl.hh

43 
	~"ba£/ı_ªnÙ©e.hh
"

44 
	~"ıu/o3/dyn_š¡.hh
"

45 
	~"sim/fuÎ_sy¡em.hh
"

46 
	~"debug/O3PeV›w.hh
"

48 
	g‹m¶©e
 <
şass
 
	gIm¶
>

49 
	gBa£O3DynIn¡
<
	gIm¶
>::
Ba£O3DynIn¡
(
SticIn¡PŒ
 
¡©icIn¡
,

50 
SticIn¡PŒ
 
maüoİ
,

51 
TheISA
::
PCS‹
 
pc
, TheISA::PCS‹ 
´edPC
,

52 
In¡SeqNum
 
£q_num
, 
O3CPU
 *
ıu
)

53 : 
Ba£DynIn¡
<
Im¶
>(
¡©icIn¡
, 
	gmaüoİ
, 
	gpc
, 
	g´edPC
, 
	g£q_num
, 
	gıu
)

55 
š™V¬s
();

58 
	g‹m¶©e
 <
şass
 
	gIm¶
>

59 
	gBa£O3DynIn¡
<
	gIm¶
>::
	$Ba£O3DynIn¡
(
SticIn¡PŒ
 
_¡©icIn¡
,

60 
SticIn¡PŒ
 
_maüoİ
)

61 : 
Ba£DynIn¡
<
Im¶
>(
_¡©icIn¡
, 
_maüoİ
)

63 
	`š™V¬s
();

64 
	}
}

66 
	g‹m¶©e
 <
şass
 
	gIm¶
>
	gBa£O3DynIn¡
<Im¶>::~
	$Ba£O3DynIn¡
()

68 #ià
TRACING_ON


69 
Tick
 
v®
, 
ãtch
 = 
this
->
ãtchTick
;

71 
	`DPRINTFR
(
O3PeV›w
, "O3PipeView:fetch:%llu:0x%08llx:%d:%llu:%s\n",

72 
ãtch
,

73 
this
->
	`š¡Addr
(),

74 
this
->
	`miüoPC
(),

75 
this
->
£qNum
,

76 
this
->
¡©icIn¡
->
	`di§s£mbË
Ñhis->
	`š¡Addr
()));

77 
v®
 = (
this
->
decodeTick
 =ğ-1è? 0 : 
ãtch
 +his->decodeTick;

78 
	`DPRINTFR
(
O3PeV›w
, "O3PeV›w:decode:%Îu\n", 
v®
);

79 
v®
 = (
this
->
»ÇmeTick
 =ğ-1è? 0 : 
ãtch
 +his->renameTick;

80 
	`DPRINTFR
(
O3PeV›w
, "O3PeV›w:»Çme:%Îu\n", 
v®
);

81 
v®
 = (
this
->
di¥©chTick
 =ğ-1è? 0 : 
ãtch
 +his->dispatchTick;

82 
	`DPRINTFR
(
O3PeV›w
, "O3PeV›w:di¥©ch:%Îu\n", 
v®
);

83 
v®
 = (
this
->
issueTick
 =ğ-1è? 0 : 
ãtch
 +his->issueTick;

84 
	`DPRINTFR
(
O3PeV›w
, "O3PeV›w:issue:%Îu\n", 
v®
);

85 
v®
 = (
this
->
com¶‘eTick
 =ğ-1è? 0 : 
ãtch
 +his->completeTick;

86 
	`DPRINTFR
(
O3PeV›w
, "O3PeV›w:com¶‘e:%Îu\n", 
v®
);

87 
v®
 = (
this
->
comm™Tick
 =ğ-1è? 0 : 
ãtch
 +his->commitTick;

88 
	`DPRINTFR
(
O3PeV›w
, "O3PeV›w:»tœe:%Îu\n", 
v®
);

90 
	}
};

93 
	g‹m¶©e
 <
şass
 
	gIm¶
>

95 
	gBa£O3DynIn¡
<
	gIm¶
>::
	$š™V¬s
()

100 
i
 = 0; i < 
this
->
¡©icIn¡
->
	`numDe¡Regs
(); i++) {

101 
this
->
_de¡RegIdx
[
i
] =his->
¡©icIn¡
->
	`de¡RegIdx
(i);

104 
i
 = 0; i < 
this
->
¡©icIn¡
->
	`numSrcRegs
(); i++) {

105 
this
->
_¤cRegIdx
[
i
] =his->
¡©icIn¡
->
	`¤cRegIdx
(i);

108 
this
->
_»adySrcRegIdx
.
	`»£t
();

110 
_numDe¡MiscRegs
 = 0;

112 #ià
TRACING_ON


115 
ãtchTick
 = -1;

116 
decodeTick
 = -1;

117 
»ÇmeTick
 = -1;

118 
di¥©chTick
 = -1;

119 
issueTick
 = -1;

120 
com¶‘eTick
 = -1;

121 
comm™Tick
 = -1;

123 
	}
}

125 
	g‹m¶©e
 <
şass
 
	gIm¶
>

126 
FauÉ


127 
	gBa£O3DynIn¡
<
	gIm¶
>::
	$execu‹
()

133 
boŞ
 
no_squash_äom_TC
 = 
this
->
th»ad
->
noSquashFromTC
;

134 
this
->
th»ad
->
noSquashFromTC
 = 
Œue
;

136 
this
->
çuÉ
 =his->
¡©icIn¡
->
	`execu‹
Ñhis,his->
ŒaûD©a
);

138 
this
->
th»ad
->
noSquashFromTC
 = 
no_squash_äom_TC
;

140  
this
->
çuÉ
;

141 
	}
}

143 
	g‹m¶©e
 <
şass
 
	gIm¶
>

144 
FauÉ


145 
	gBa£O3DynIn¡
<
	gIm¶
>::
	$š™Ÿ‹Acc
()

151 
boŞ
 
no_squash_äom_TC
 = 
this
->
th»ad
->
noSquashFromTC
;

152 
this
->
th»ad
->
noSquashFromTC
 = 
Œue
;

154 
this
->
çuÉ
 =his->
¡©icIn¡
->
	`š™Ÿ‹Acc
Ñhis,his->
ŒaûD©a
);

156 
this
->
th»ad
->
noSquashFromTC
 = 
no_squash_äom_TC
;

158  
this
->
çuÉ
;

159 
	}
}

161 
	g‹m¶©e
 <
şass
 
	gIm¶
>

162 
FauÉ


163 
	gBa£O3DynIn¡
<
	gIm¶
>::
	$com¶‘eAcc
(
Pack‘PŒ
 
pkt
)

169 
boŞ
 
no_squash_äom_TC
 = 
this
->
th»ad
->
noSquashFromTC
;

170 
this
->
th»ad
->
noSquashFromTC
 = 
Œue
;

172 ià(
this
->
ıu
->
check”
) {

173 ià(
this
->
	`isStÜeCÚd™iÚ®
()) {

174 
this
->
»qToV”ify
->
	`£tExŒaD©a
(
pkt
->
»q
->
	`g‘ExŒaD©a
());

178 
this
->
çuÉ
 =his->
¡©icIn¡
->
	`com¶‘eAcc
(
pkt
,his,his->
ŒaûD©a
);

180 
this
->
th»ad
->
noSquashFromTC
 = 
no_squash_äom_TC
;

182  
this
->
çuÉ
;

183 
	}
}

185 
	g‹m¶©e
 <
şass
 
	gIm¶
>

186 
FauÉ


187 
	gBa£O3DynIn¡
<
	gIm¶
>::
	$hw»i
()

189 #ià
THE_ISA
 =ğ
ALPHA_ISA


191 ià(!(
this
->
	`š¡Addr
() & 0x3))

192  
Ãw
 
AÍhaISA
::
Unim¶em’‹dOpcodeFauÉ
;

195 
AÍhaISA
::
PCS‹
 
pc
 = 
this
->
	`pcS‹
();

196 
pc
.
	`Åc
(
this
->
ıu
->
	`»adMiscRegNoEfãù
(
AÍhaISA
::
IPR_EXC_ADDR
,

197 
this
->
th»adNumb”
));

198 
this
->
	`pcS‹
(
pc
);

199 ià(
CPA
::
	`avaabË
()) {

200 
Th»adCÚ‹xt
 *
tc
 = 
this
->
ıu
->
	`tcBa£
Ñhis->
th»adNumb”
);

201 
CPA
::
	`ıa
()->
	`swAutoBegš
(
tc
, 
this
->
	`ÃxtIn¡Addr
());

205 
this
->
ıu
->
	`hw»i
Ñhis->
th»adNumb”
);

210  
NoFauÉ
;

211 
	}
}

213 
	g‹m¶©e
 <
şass
 
	gIm¶
>

215 
	gBa£O3DynIn¡
<
	gIm¶
>::
	$Œ­
(
FauÉ
 
çuÉ
)

217 
this
->
ıu
->
	`Œ­
(
çuÉ
,his->
th»adNumb”
,his->
¡©icIn¡
);

218 
	}
}

220 
	g‹m¶©e
 <
şass
 
	gIm¶
>

221 
boŞ


222 
	gBa£O3DynIn¡
<
	gIm¶
>::
	$simP®Check
(
·lFunc
)

224 #ià
THE_ISA
 !ğ
ALPHA_ISA


225 
	`·nic
("simPalCheck called, but PAL onlyƒxists in Alpha!\n");

227  
this
->
ıu
->
	`simP®Check
(
·lFunc
,his->
th»adNumb”
);

228 
	}
}

230 
	g‹m¶©e
 <
şass
 
	gIm¶
>

232 
	gBa£O3DynIn¡
<
	gIm¶
>::
	$sysÿÎ
(
št64_t
 
ÿÎnum
)

234 ià(
FuÎSy¡em
)

235 
	`·nic
("Syscallƒmulation isn't‡vailable in FS mode.\n");

240 
TheISA
::
PCS‹
 
curPC
 = 
this
->
ıu
->
	`pcS‹
Ñhis->
th»adNumb”
);

241 
this
->
ıu
->
	`sysÿÎ
(
ÿÎnum
,his->
th»adNumb”
);

242 
TheISA
::
PCS‹
 
ÃwPC
 = 
this
->
ıu
->
	`pcS‹
Ñhis->
th»adNumb”
);

243 ià(!(
curPC
 =ğ
ÃwPC
)) {

244 
this
->
	`pcS‹
(
ÃwPC
);

246 
	}
}

	@fetch.cc

31 
	~"ıu/o3/ãtch_im¶.hh
"

32 
	~"ıu/o3/i§_¥ecific.hh
"

34 
‹m¶©e
 
şass
 
	gDeçuÉF‘ch
<
	gO3CPUIm¶
>;

	@fetch.hh

44 #iâdeà
__CPU_O3_FETCH_HH__


45 
	#__CPU_O3_FETCH_HH__


	)

47 
	~"¬ch/decod”.hh
"

48 
	~"¬ch/ut™y.hh
"

49 
	~"ba£/¡©i¡ics.hh
"

50 
	~"cÚfig/the_i§.hh
"

51 
	~"ıu/pc_ev’t.hh
"

52 
	~"ıu/timebuf.hh
"

53 
	~"ıu/Œª¦©iÚ.hh
"

54 
	~"mem/·ck‘.hh
"

55 
	~"mem/pÜt.hh
"

56 
	~"sim/ev’tq.hh
"

58 
	gD”ivO3CPUP¬ams
;

68 
	g‹m¶©e
 <
şass
 
	gIm¶
>

69 şas 
	cDeçuÉF‘ch


71 
	mpublic
:

73 
ty³Çme
 
	tIm¶
::
	tCPUPŞ
 CPUPol;

74 
ty³Çme
 
	tIm¶
::
	tDynIn¡
 DynInst;

75 
ty³Çme
 
	tIm¶
::
	tDynIn¡PŒ
 DynInstPtr;

76 
ty³Çme
 
	tIm¶
::
	tO3CPU
 O3CPU;

79 
ty³Çme
 
	tCPUPŞ
::
	tBP»dUn™
 BPredUnit;

80 
ty³Çme
 
	tCPUPŞ
::
	tF‘chSŒuù
 FetchStruct;

81 
ty³Çme
 
	tCPUPŞ
::
	tTimeSŒuù
 TimeStruct;

84 
	mTheISA
::
	tMachIn¡
 MachInst;

85 
	mTheISA
::
	tExtMachIn¡
 ExtMachInst;

87 şas 
	cF‘chT¿n¦©iÚ
 : 
public
 
Ba£TLB
::
T¿n¦©iÚ


89 
´Ùeùed
:

90 
DeçuÉF‘ch
<
Im¶
> *
ãtch
;

92 
	mpublic
:

93 
F‘chT¿n¦©iÚ
(
DeçuÉF‘ch
<
Im¶
> *
_ãtch
)

94 : 
ãtch
(
_ãtch
)

98 
m¬kD–ayed
()

102 
fšish
(
FauÉ
 
çuÉ
, 
Reque¡PŒ
 
»q
, 
Th»adCÚ‹xt
 *
tc
,

103 
Ba£TLB
::
Mode
 
mode
)

105 
as£¹
(
mode
 =ğ
Ba£TLB
::
Execu‹
);

106 
	mãtch
->
fšishT¿n¦©iÚ
(
çuÉ
, 
»q
);

107 
d–‘e
 
	mthis
;

111 
	g´iv©e
:

115 şas 
	cFšishT¿n¦©iÚEv’t
 : 
public
 
Ev’t


117 
´iv©e
:

118 
DeçuÉF‘ch
<
Im¶
> *
ãtch
;

119 
FauÉ
 
	gçuÉ
;

120 
Reque¡PŒ
 
	g»q
;

122 
	gpublic
:

123 
FšishT¿n¦©iÚEv’t
(
DeçuÉF‘ch
<
Im¶
> *
_ãtch
)

124 : 
ãtch
(
_ãtch
)

127 
¡d
::
¡ršg
 
g‘ObjeùId
() const

129  
ãtch
->
ıu
->
g‘ObjeùId
();

132 
£tFauÉ
(
FauÉ
 
_çuÉ
)

134 
	gçuÉ
 = 
_çuÉ
;

137 
£tReq
(
Reque¡PŒ
 
_»q
)

139 
	g»q
 = 
_»q
;

143 
´oûss
()

145 
as£¹
(
ãtch
->
numIn¡
 < f‘ch->
ãtchWidth
);

146 
	gãtch
->
fšishT¿n¦©iÚ
(
çuÉ
, 
»q
);

149 cÚ¡ *
desütiÚ
() const

155 
	gpublic
:

159 
	eF‘chStus
 {

160 
Aùive
,

161 
	gIÇùive


165 
	eTh»adStus
 {

166 
	gRuÂšg
,

167 
	gIdË
,

168 
	gSquashšg
,

169 
	gBlocked
,

170 
	gF‘chšg
,

171 
	gT¿pP’dšg
,

172 
	gQu›sûP’dšg
,

173 
	gIbWa™
,

174 
	gIÿcheWa™Re¥Ú£
,

175 
	gIÿcheWa™R‘ry
,

176 
	gIÿcheAcûssCom¶‘e
,

177 
	gNoGoodAddr


181 
	eF‘chPriÜ™y
 {

182 
	gSšgËTh»ad
,

183 
	gRoundRobš
,

184 
	gB¿nch
,

185 
	gIQ
,

186 
	gLSQ


189 
	g´iv©e
:

191 
F‘chStus
 
_¡©us
;

194 
Th»adStus
 
	gãtchStus
[
Im¶
::
MaxTh»ads
];

197 
F‘chPriÜ™y
 
	gãtchPŞicy
;

200 
	g¡d
::
li¡
<
Th»adID
> 
´iÜ™yLi¡
;

202 
	gpublic
:

204 
DeçuÉF‘ch
(
O3CPU
 *
_ıu
, 
D”ivO3CPUP¬ams
 *
·¿ms
);

207 
	g¡d
::
¡ršg
 
	$Çme
() const;

210 
	`»gSts
();

213 
	`£tTimeBufãr
(
TimeBufãr
<
TimeSŒuù
> *
time_bufãr
);

216 
	`£tAùiveTh»ads
(
¡d
::
li¡
<
Th»adID
> *
©_±r
);

219 
	`£tF‘chQueue
(
TimeBufãr
<
F‘chSŒuù
> *
fq_±r
);

222 
	`¡¬tupSge
();

225 
	`£tIÿche
();

228 
	`»cvR‘ry
();

231 
	`´oûssCacheCom¶‘iÚ
(
Pack‘PŒ
 
pkt
);

234 
	`d¿šResume
();

237 
	$d¿šSª™yCheck
() const;

240 
boŞ
 
	$isD¿šed
() const;

243 
	`keOv”From
();

254 
	`d¿šSÎ
(
Th»adID
 
tid
);

257 
	`wakeFromQu›sû
();

259 
´iv©e
:

261 
	`»£tSge
();

266 
šlše
 
	`sw™chToAùive
();

271 
šlše
 
	`sw™chToIÇùive
();

282 
boŞ
 
	`lookupAndUpd©eNextPC
(
DynIn¡PŒ
 &
š¡
, 
TheISA
::
PCS‹
 &
pc
);

295 
boŞ
 
	`ãtchCacheLše
(
Addr
 
vaddr
, 
Th»adID
 
tid
, Add¸
pc
);

296 
	`fšishT¿n¦©iÚ
(
FauÉ
 
çuÉ
, 
Reque¡PŒ
 
mem_»q
);

301 
boŞ


302 
	$checkIÁ”ru±
(
Addr
 
pc
)

304  (
š‹¼u±P’dšg
 && (
THE_ISA
 !ğ
ALPHA_ISA
 || !(
pc
 & 0x3)));

305 
	}
}

308 
šlše
 
doSquash
(cÚ¡ 
TheISA
::
PCS‹
 &
ÃwPC
,

309 cÚ¡ 
DynIn¡PŒ
 
squashIn¡
, 
Th»adID
 
tid
);

314 
squashFromDecode
(cÚ¡ 
TheISA
::
PCS‹
 &
ÃwPC
,

315 cÚ¡ 
DynIn¡PŒ
 
squashIn¡
,

316 cÚ¡ 
In¡SeqNum
 
£q_num
, 
Th»adID
 
tid
);

319 
boŞ
 
	$checkSÎ
(
Th»adID
 
tid
) const;

323 
F‘chStus
 
	`upd©eF‘chStus
();

325 
public
:

330 
	`squash
(cÚ¡ 
TheISA
::
PCS‹
 &
ÃwPC
, cÚ¡ 
In¡SeqNum
 
£q_num
,

331 
DynIn¡PŒ
 
squashIn¡
, 
Th»adID
 
tid
);

336 
	`tick
();

341 
boŞ
 
	`checkSigÇlsAndUpd©e
(
Th»adID
 
tid
);

348 
	`ãtch
(
boŞ
 &
¡©us_chªge
);

351 
Addr
 
	$iÿcheBlockAlignPC
(
Addr
 
addr
)

353  (
addr
 & ~(
ÿcheBlkMask
));

354 
	}
}

357 
	gTheISA
::
Decod”
 *
decod”
[
Im¶
::
MaxTh»ads
];

359 
	g´iv©e
:

360 
DynIn¡PŒ
 
budIn¡
(
Th»adID
 
tid
, 
SticIn¡PŒ
 
¡©icIn¡
,

361 
SticIn¡PŒ
 
curMaüoİ
, 
TheISA
::
PCS‹
 
thisPC
,

362 
TheISA
::
PCS‹
 
ÃxtPC
, 
boŞ
 
Œaû
);

365 
Th»adID
 
g‘F‘chšgTh»ad
(
F‘chPriÜ™y
 &
ãtch_´iÜ™y
);

368 
Th»adID
 
roundRobš
();

371 
Th»adID
 
iqCouÁ
();

374 
Th»adID
 
lsqCouÁ
();

378 
Th»adID
 
b¿nchCouÁ
();

381 
p–šeIÿcheAcûs£s
(
Th»adID
 
tid
);

384 
´ofeSÎ
(
Th»adID
 
tid
);

386 
	g´iv©e
:

388 
O3CPU
 *
ıu
;

391 
	gTimeBufãr
<
	gTimeSŒuù
> *
	gtimeBufãr
;

394 
ty³Çme
 
	gTimeBufãr
<
	gTimeSŒuù
>::
wœe
 
äomDecode
;

397 
ty³Çme
 
	gTimeBufãr
<
	gTimeSŒuù
>::
wœe
 
äomR’ame
;

400 
ty³Çme
 
	gTimeBufãr
<
	gTimeSŒuù
>::
wœe
 
äomIEW
;

403 
ty³Çme
 
	gTimeBufãr
<
	gTimeSŒuù
>::
wœe
 
äomComm™
;

406 
	gTimeBufãr
<
	gF‘chSŒuù
> *
	gãtchQueue
;

410 
ty³Çme
 
	gTimeBufãr
<
	gF‘chSŒuù
>::
wœe
 
toDecode
;

413 
BP»dUn™
 
	gb¿nchP»d
;

415 
	gTheISA
::
PCS‹
 
pc
[
Im¶
::
MaxTh»ads
];

417 
Addr
 
	gãtchOff£t
[
Im¶
::
MaxTh»ads
];

419 
SticIn¡PŒ
 
	gmaüoİ
[
Im¶
::
MaxTh»ads
];

422 
boŞ
 
	gd–ayedComm™
[
Im¶
::
MaxTh»ads
];

425 
Reque¡PŒ
 
	gmemReq
[
Im¶
::
MaxTh»ads
];

430 
boŞ
 
	gwrÙeToTimeBufãr
;

433 
	gnumIn¡
;

436 
	sSÎs
 {

437 
boŞ
 
	gdecode
;

438 
boŞ
 
	g»Çme
;

439 
boŞ
 
	g›w
;

440 
boŞ
 
	gcomm™
;

441 
boŞ
 
	gd¿š
;

445 
SÎs
 
	g¡®ls
[
Im¶
::
MaxTh»ads
];

448 
Cyşes
 
	gdecodeToF‘chD–ay
;

451 
Cyşes
 
	g»ÇmeToF‘chD–ay
;

454 
Cyşes
 
	g›wToF‘chD–ay
;

457 
Cyşes
 
	gcomm™ToF‘chD–ay
;

460 
	gãtchWidth
;

463 
boŞ
 
	gÿcheBlocked
;

466 
Pack‘PŒ
 
	g»ŒyPkt
;

469 
Th»adID
 
	g»ŒyTid
;

472 
	gÿcheBlkSize
;

475 
Addr
 
	gÿcheBlkMask
;

478 
ušt8_t
 *
	gÿcheD©a
[
Im¶
::
MaxTh»ads
];

481 
Addr
 
	gÿcheD©aPC
[
Im¶
::
MaxTh»ads
];

484 
boŞ
 
	gÿcheD©aV®id
[
Im¶
::
MaxTh»ads
];

487 
	gš¡Size
;

490 
CouÁ”
 
	gÏ¡IÿcheSÎ
[
Im¶
::
MaxTh»ads
];

493 
	g¡d
::
li¡
<
Th»adID
> *
aùiveTh»ads
;

496 
Th»adID
 
	gnumTh»ads
;

499 
Th»adID
 
	gnumF‘chšgTh»ads
;

502 
Th»adID
 
	gth»adF‘ched
;

507 
boŞ
 
	gš‹¼u±P’dšg
;

510 
boŞ
 
	gissueP–šedIãtch
[
Im¶
::
MaxTh»ads
];

513 
FšishT¿n¦©iÚEv’t
 
	gfšishT¿n¦©iÚEv’t
;

517 
	gSts
::
SÿÏr
 
iÿcheSÎCyşes
;

519 
	gSts
::
SÿÏr
 
ãtchedIn¡s
;

521 
	gSts
::
SÿÏr
 
ãtchedB¿nches
;

523 
	gSts
::
SÿÏr
 
´ediùedB¿nches
;

525 
	gSts
::
SÿÏr
 
ãtchCyşes
;

527 
	gSts
::
SÿÏr
 
ãtchSquashCyşes
;

529 
	gSts
::
SÿÏr
 
ãtchTlbCyşes
;

533 
	gSts
::
SÿÏr
 
ãtchIdËCyşes
;

535 
	gSts
::
SÿÏr
 
ãtchBlockedCyşes
;

537 
	gSts
::
SÿÏr
 
ãtchMiscSÎCyşes
;

539 
	gSts
::
SÿÏr
 
ãtchP’dšgD¿šCyşes
;

541 
	gSts
::
SÿÏr
 
ãtchNoAùiveTh»adSÎCyşes
;

543 
	gSts
::
SÿÏr
 
ãtchP’dšgT¿pSÎCyşes
;

545 
	gSts
::
SÿÏr
 
ãtchP’dšgQu›sûSÎCyşes
;

547 
	gSts
::
SÿÏr
 
ãtchIÿcheWa™R‘rySÎCyşes
;

549 
	gSts
::
SÿÏr
 
ãtchedCacheLšes
;

553 
	gSts
::
SÿÏr
 
ãtchIÿcheSquashes
;

557 
	gSts
::
SÿÏr
 
ãtchTlbSquashes
;

559 
	gSts
::
Di¡ributiÚ
 
ãtchNi¢Di¡
;

561 
	gSts
::
FÜmuÏ
 
idËR©e
;

563 
	gSts
::
FÜmuÏ
 
b¿nchR©e
;

565 
	gSts
::
FÜmuÏ
 
ãtchR©e
;

	@fetch_impl.hh

44 
	~<®gÜ™hm
>

45 
	~<c¡ršg
>

46 
	~<li¡
>

47 
	~<m­
>

48 
	~<queue
>

50 
	~"¬ch/i§_Œa™s.hh
"

51 
	~"¬ch/b.hh
"

52 
	~"¬ch/ut™y.hh
"

53 
	~"¬ch/vtİhys.hh
"

54 
	~"ba£/ty³s.hh
"

55 
	~"cÚfig/the_i§.hh
"

56 
	~"ıu/ba£.hh
"

58 
	~"ıu/o3/ãtch.hh
"

59 
	~"ıu/ex‘¿û.hh
"

60 
	~"debug/Aùiv™y.hh
"

61 
	~"debug/D¿š.hh
"

62 
	~"debug/F‘ch.hh
"

63 
	~"mem/·ck‘.hh
"

64 
	~"·¿ms/D”ivO3CPU.hh
"

65 
	~"sim/by‹sw­.hh
"

66 
	~"sim/cÜe.hh
"

67 
	~"sim/ev’tq.hh
"

68 
	~"sim/fuÎ_sy¡em.hh
"

69 
	~"sim/sy¡em.hh
"

71 
usšg
 
Çme¥aû
 
	g¡d
;

73 
	g‹m¶©e
<
şass
 
	gIm¶
>

74 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$DeçuÉF‘ch
(
O3CPU
 *
_ıu
, 
D”ivO3CPUP¬ams
 *
·¿ms
)

75 : 
	`ıu
(
_ıu
),

76 
	`b¿nchP»d
(
·¿ms
),

77 
	`decodeToF‘chD–ay
(
·¿ms
->
decodeToF‘chD–ay
),

78 
	`»ÇmeToF‘chD–ay
(
·¿ms
->
»ÇmeToF‘chD–ay
),

79 
	`›wToF‘chD–ay
(
·¿ms
->
›wToF‘chD–ay
),

80 
	`comm™ToF‘chD–ay
(
·¿ms
->
comm™ToF‘chD–ay
),

81 
	`ãtchWidth
(
·¿ms
->
ãtchWidth
),

82 
	`»ŒyPkt
(
NULL
),

83 
	`»ŒyTid
(
Inv®idTh»adID
),

84 
	`numTh»ads
(
·¿ms
->
numTh»ads
),

85 
	`numF‘chšgTh»ads
(
·¿ms
->
smtNumF‘chšgTh»ads
),

86 
	$fšishT¿n¦©iÚEv’t
(
this
)

88 ià(
numTh»ads
 > 
Im¶
::
MaxTh»ads
)

89 
	`çl
("numThreads (%d) is†argerhan compiled†imit (%d),\n"

91 
numTh»ads
, 
¡©ic_ÿ¡
<>(
Im¶
::
MaxTh»ads
));

92 ià(
ãtchWidth
 > 
Im¶
::
MaxWidth
)

93 
	`çl
("fetchWidth (%d) is†argerhan compiled†imit (%d),\n"

95 
ãtchWidth
, 
¡©ic_ÿ¡
<>(
Im¶
::
MaxWidth
));

97 
¡d
::
¡ršg
 
pŞicy
 = 
·¿ms
->
smtF‘chPŞicy
;

100 
¡d
::
	`ŒªsfÜm
(
pŞicy
.
	`begš
(),…Şicy.
	`’d
(),…olicy.begin(),

101 ((*)()è
tŞow”
);

104 ià(
pŞicy
 == "singlethread") {

105 
ãtchPŞicy
 = 
SšgËTh»ad
;

106 ià(
numTh»ads
 > 1)

107 
	`·nic
("Invalid Fetch Policy for‡ SMT workload.");

108 } ià(
pŞicy
 == "roundrobin") {

109 
ãtchPŞicy
 = 
RoundRobš
;

110 
	`DPRINTF
(
F‘ch
, "Fetch…olicy seto Round Robin\n");

111 } ià(
pŞicy
 == "branch") {

112 
ãtchPŞicy
 = 
B¿nch
;

113 
	`DPRINTF
(
F‘ch
, "Fetch…olicy seto Branch Count\n");

114 } ià(
pŞicy
 == "iqcount") {

115 
ãtchPŞicy
 = 
IQ
;

116 
	`DPRINTF
(
F‘ch
, "Fetch…olicy seto IQ count\n");

117 } ià(
pŞicy
 == "lsqcount") {

118 
ãtchPŞicy
 = 
LSQ
;

119 
	`DPRINTF
(
F‘ch
, "Fetch…olicy seto LSQ count\n");

121 
	`çl
("Invalid Fetch Policy. Options Are: {SingleThread,"

126 
š¡Size
 = (
TheISA
::
MachIn¡
);

128 
i
 = 0; i < 
Im¶
::
MaxTh»ads
; i++) {

129 
ÿcheD©a
[
i
] = 
NULL
;

130 
decod”
[
i
] = 
Ãw
 
TheISA
::
Decod”
;

132 
	}
}

134 
	g‹m¶©e
 <
şass
 
	gIm¶
>

135 
	g¡d
::
¡ršg


136 
DeçuÉF‘ch
<
Im¶
>::
	$Çme
() const

138  
ıu
->
	`Çme
() + ".fetch";

139 
	}
}

141 
	g‹m¶©e
 <
şass
 
	gIm¶
>

143 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$»gSts
()

145 
iÿcheSÎCyşes


146 .
	`Çme
(name() + ".icacheStallCycles")

147 .
	`desc
("Number of cycles fetch is stalled on‡n Icache miss")

148 .
	`´”eq
(
iÿcheSÎCyşes
);

150 
ãtchedIn¡s


151 .
	`Çme
(name() + ".Insts")

152 .
	`desc
("Number of instructions fetch has…rocessed")

153 .
	`´”eq
(
ãtchedIn¡s
);

155 
ãtchedB¿nches


156 .
	`Çme
(name() + ".Branches")

157 .
	`desc
("Number of brancheshat fetchƒncountered")

158 .
	`´”eq
(
ãtchedB¿nches
);

160 
´ediùedB¿nches


161 .
	`Çme
(name() + ".predictedBranches")

162 .
	`desc
("Number of brancheshat fetch has…redictedaken")

163 .
	`´”eq
(
´ediùedB¿nches
);

165 
ãtchCyşes


166 .
	`Çme
(name() + ".Cycles")

167 .
	`desc
("Number of cycles fetch has„un‡nd was‚ot squashing or"

169 .
	`´”eq
(
ãtchCyşes
);

171 
ãtchSquashCyşes


172 .
	`Çme
(name() + ".SquashCycles")

173 .
	`desc
("Number of cycles fetch has spent squashing")

174 .
	`´”eq
(
ãtchSquashCyşes
);

176 
ãtchTlbCyşes


177 .
	`Çme
(name() + ".TlbCycles")

178 .
	`desc
("Number of cycles fetch has spent waiting forlb")

179 .
	`´”eq
(
ãtchTlbCyşes
);

181 
ãtchIdËCyşes


182 .
	`Çme
(name() + ".IdleCycles")

183 .
	`desc
("Number of cycles fetch was idle")

184 .
	`´”eq
(
ãtchIdËCyşes
);

186 
ãtchBlockedCyşes


187 .
	`Çme
(name() + ".BlockedCycles")

188 .
	`desc
("Number of cycles fetch has spent blocked")

189 .
	`´”eq
(
ãtchBlockedCyşes
);

191 
ãtchedCacheLšes


192 .
	`Çme
(name() + ".CacheLines")

193 .
	`desc
("Number of cache†ines fetched")

194 .
	`´”eq
(
ãtchedCacheLšes
);

196 
ãtchMiscSÎCyşes


197 .
	`Çme
(name() + ".MiscStallCycles")

198 .
	`desc
("Number of cycles fetch has spent waiting on interrupts, or "

200 .
	`´”eq
(
ãtchMiscSÎCyşes
);

202 
ãtchP’dšgD¿šCyşes


203 .
	`Çme
(name() + ".PendingDrainCycles")

204 .
	`desc
("Number of cycles fetch has spent waiting on…ipeso drain")

205 .
	`´”eq
(
ãtchP’dšgD¿šCyşes
);

207 
ãtchNoAùiveTh»adSÎCyşes


208 .
	`Çme
(name() + ".NoActiveThreadStallCycles")

209 .
	`desc
("Number of stall cycles dueo‚o‡ctivehreado fetch from")

210 .
	`´”eq
(
ãtchNoAùiveTh»adSÎCyşes
);

212 
ãtchP’dšgT¿pSÎCyşes


213 .
	`Çme
(name() + ".PendingTrapStallCycles")

214 .
	`desc
("Number of stall cycles dueo…endingraps")

215 .
	`´”eq
(
ãtchP’dšgT¿pSÎCyşes
);

217 
ãtchP’dšgQu›sûSÎCyşes


218 .
	`Çme
(name() + ".PendingQuiesceStallCycles")

219 .
	`desc
("Number of stall cycles dueo…ending quiesce instructions")

220 .
	`´”eq
(
ãtchP’dšgQu›sûSÎCyşes
);

222 
ãtchIÿcheWa™R‘rySÎCyşes


223 .
	`Çme
(name() + ".IcacheWaitRetryStallCycles")

224 .
	`desc
("Number of stall cycles dueo full MSHR")

225 .
	`´”eq
(
ãtchIÿcheWa™R‘rySÎCyşes
);

227 
ãtchIÿcheSquashes


228 .
	`Çme
(name() + ".IcacheSquashes")

229 .
	`desc
("Number of outstanding Icache misseshat were squashed")

230 .
	`´”eq
(
ãtchIÿcheSquashes
);

232 
ãtchTlbSquashes


233 .
	`Çme
(name() + ".ItlbSquashes")

234 .
	`desc
("Number of outstanding ITLB misseshat were squashed")

235 .
	`´”eq
(
ãtchTlbSquashes
);

237 
ãtchNi¢Di¡


238 .
	`š™
( 0,

239  
ãtchWidth
,

241 .
	`Çme
(name() + ".rateDist")

242 .
	`desc
("Number of instructions fetchedƒach cycle (Total)")

243 .
	`æags
(
Sts
::
pdf
);

245 
idËR©e


246 .
	`Çme
(name() + ".idleRate")

247 .
	`desc
("Percent of cycles fetch was idle")

248 .
	`´”eq
(
idËR©e
);

249 
idËR©e
 = 
ãtchIdËCyşes
 * 100 / 
ıu
->
numCyşes
;

251 
b¿nchR©e


252 .
	`Çme
(name() + ".branchRate")

253 .
	`desc
("Number of branch fetches…er cycle")

254 .
	`æags
(
Sts
::
tÙ®
);

255 
b¿nchR©e
 = 
ãtchedB¿nches
 / 
ıu
->
numCyşes
;

257 
ãtchR©e


258 .
	`Çme
(name() + ".rate")

259 .
	`desc
("Number of inst fetches…er cycle")

260 .
	`æags
(
Sts
::
tÙ®
);

261 
ãtchR©e
 = 
ãtchedIn¡s
 / 
ıu
->
numCyşes
;

263 
b¿nchP»d
.
	`»gSts
();

264 
	}
}

266 
	g‹m¶©e
<
şass
 
	gIm¶
>

268 
	gDeçuÉF‘ch
<
	gIm¶
>::
£tTimeBufãr
(
TimeBufãr
<
TimeSŒuù
> *
time_bufãr
)

270 
timeBufãr
 = 
time_bufãr
;

273 
	gäomDecode
 = 
timeBufãr
->
g‘Wœe
(-
decodeToF‘chD–ay
);

274 
	gäomR’ame
 = 
timeBufãr
->
g‘Wœe
(-
»ÇmeToF‘chD–ay
);

275 
	gäomIEW
 = 
timeBufãr
->
g‘Wœe
(-
›wToF‘chD–ay
);

276 
	gäomComm™
 = 
timeBufãr
->
g‘Wœe
(-
comm™ToF‘chD–ay
);

279 
	g‹m¶©e
<
şass
 
	gIm¶
>

281 
	gDeçuÉF‘ch
<
	gIm¶
>::
£tAùiveTh»ads
(
¡d
::
li¡
<
Th»adID
> *
©_±r
)

283 
aùiveTh»ads
 = 
©_±r
;

286 
	g‹m¶©e
<
şass
 
	gIm¶
>

288 
	gDeçuÉF‘ch
<
	gIm¶
>::
£tF‘chQueue
(
TimeBufãr
<
F‘chSŒuù
> *
fq_±r
)

290 
ãtchQueue
 = 
fq_±r
;

293 
	gtoDecode
 = 
ãtchQueue
->
g‘Wœe
(0);

296 
	g‹m¶©e
<
şass
 
	gIm¶
>

298 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$¡¬tupSge
()

300 
	`as£¹
(
´iÜ™yLi¡
.
	`em±y
());

301 
	`»£tSge
();

305 
	`sw™chToAùive
();

306 
	}
}

308 
	g‹m¶©e
<
şass
 
	gIm¶
>

310 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$»£tSge
()

312 
numIn¡
 = 0;

313 
š‹¼u±P’dšg
 = 
çl£
;

314 
ÿcheBlocked
 = 
çl£
;

316 
´iÜ™yLi¡
.
	`ş—r
();

319 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

320 
ãtchStus
[
tid
] = 
RuÂšg
;

321 
pc
[
tid
] = 
ıu
->
	`pcS‹
(tid);

322 
ãtchOff£t
[
tid
] = 0;

323 
maüoİ
[
tid
] = 
NULL
;

325 
d–ayedComm™
[
tid
] = 
çl£
;

326 
memReq
[
tid
] = 
NULL
;

328 
¡®ls
[
tid
].
decode
 = 
çl£
;

329 
¡®ls
[
tid
].
»Çme
 = 
çl£
;

330 
¡®ls
[
tid
].
›w
 = 
çl£
;

331 
¡®ls
[
tid
].
comm™
 = 
çl£
;

332 
¡®ls
[
tid
].
d¿š
 = 
çl£
;

334 
´iÜ™yLi¡
.
	`push_back
(
tid
);

337 
wrÙeToTimeBufãr
 = 
çl£
;

338 
_¡©us
 = 
IÇùive
;

344 ià(
ıu
->
	`g‘In¡PÜt
().
	`isCÚÃùed
())

345 
	`£tIÿche
();

346 
	}
}

348 
	g‹m¶©e
<
şass
 
	gIm¶
>

350 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$£tIÿche
()

352 
	`as£¹
(
ıu
->
	`g‘In¡PÜt
().
	`isCÚÃùed
());

355 
ÿcheBlkSize
 = 
ıu
->
	`g‘In¡PÜt
().
	`³”BlockSize
();

358 
ÿcheBlkMask
 = (
ÿcheBlkSize
 - 1);

360 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

362 ià(!
ÿcheD©a
[
tid
])

363 
ÿcheD©a
[
tid
] = 
Ãw
 
ušt8_t
[
ÿcheBlkSize
];

364 
ÿcheD©aPC
[
tid
] = 0;

365 
ÿcheD©aV®id
[
tid
] = 
çl£
;

367 
	}
}

369 
	g‹m¶©e
<
şass
 
	gIm¶
>

371 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$´oûssCacheCom¶‘iÚ
(
Pack‘PŒ
 
pkt
)

373 
Th»adID
 
tid
 = 
pkt
->
»q
->
	`th»adId
();

375 
	`DPRINTF
(
F‘ch
, "[tid:%u] Wakšg u°äom cachmiss.\n", 
tid
);

376 
	`as£¹
(!
ıu
->
	`sw™chedOut
());

380 ià(
ãtchStus
[
tid
] !ğ
IÿcheWa™Re¥Ú£
 ||

381 
pkt
->
»q
 !ğ
memReq
[
tid
]) {

382 ++
ãtchIÿcheSquashes
;

383 
d–‘e
 
pkt
->
»q
;

384 
d–‘e
 
pkt
;

388 
	`memıy
(
ÿcheD©a
[
tid
], 
pkt
->
g‘PŒ
<
ušt8_t
>(), 
ÿcheBlkSize
);

389 
ÿcheD©aV®id
[
tid
] = 
Œue
;

393 
ıu
->
	`wakeCPU
();

395 
	`DPRINTF
(
Aùiv™y
, "[tid:%u] Activating fetch dueo cache completion\n",

396 
tid
);

398 
	`sw™chToAùive
();

401 ià(
	`checkSÎ
(
tid
)) {

402 
ãtchStus
[
tid
] = 
Blocked
;

404 
ãtchStus
[
tid
] = 
IÿcheAcûssCom¶‘e
;

408 
d–‘e
 
pkt
->
»q
;

409 
d–‘e
 
pkt
;

410 
memReq
[
tid
] = 
NULL
;

411 
	}
}

413 
	g‹m¶©e
 <
şass
 
	gIm¶
>

415 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$d¿šResume
()

417 
Th»adID
 
i
 = 0; i < 
Im¶
::
MaxTh»ads
; ++i)

418 
¡®ls
[
i
].
d¿š
 = 
çl£
;

419 
	}
}

421 
	g‹m¶©e
 <
şass
 
	gIm¶
>

423 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$d¿šSª™yCheck
() const

425 
	`as£¹
(
	`isD¿šed
());

426 
	`as£¹
(
»ŒyPkt
 =ğ
NULL
);

427 
	`as£¹
(
»ŒyTid
 =ğ
Inv®idTh»adID
);

428 
	`as£¹
(
ÿcheBlocked
 =ğ
çl£
);

429 
	`as£¹
(
š‹¼u±P’dšg
 =ğ
çl£
);

431 
Th»adID
 
i
 = 0; i < 
numTh»ads
; ++i) {

432 
	`as£¹
(!
memReq
[
i
]);

433 
	`as£¹
(!
¡®ls
[
i
].
decode
);

434 
	`as£¹
(!
¡®ls
[
i
].
»Çme
);

435 
	`as£¹
(!
¡®ls
[
i
].
›w
);

436 
	`as£¹
(!
¡®ls
[
i
].
comm™
);

437 
	`as£¹
(
ãtchStus
[
i
] =ğ
IdË
 || 
¡®ls
[i].
d¿š
);

440 
b¿nchP»d
.
	`d¿šSª™yCheck
();

441 
	}
}

443 
	g‹m¶©e
 <
şass
 
	gIm¶
>

444 
boŞ


445 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$isD¿šed
() const

453 
Th»adID
 
i
 = 0; i < 
numTh»ads
; ++i) {

454 ià(!(
ãtchStus
[
i
] =ğ
IdË
 ||

455 (
ãtchStus
[
i
] =ğ
Blocked
 && 
¡®ls
[i].
d¿š
)))

456  
çl£
;

463  !
fšishT¿n¦©iÚEv’t
.
	`scheduËd
();

464 
	}
}

466 
	g‹m¶©e
 <
şass
 
	gIm¶
>

468 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$keOv”From
()

470 
	`as£¹
(
ıu
->
	`g‘In¡PÜt
().
	`isCÚÃùed
());

471 
	`»£tSge
();

473 
b¿nchP»d
.
	`keOv”From
();

474 
	}
}

476 
	g‹m¶©e
 <
şass
 
	gIm¶
>

478 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$d¿šSÎ
(
Th»adID
 
tid
)

480 
	`as£¹
(
ıu
->
	`isD¿ššg
());

481 
	`as£¹
(!
¡®ls
[
tid
].
d¿š
);

482 
	`DPRINTF
(
D¿š
, "%i: Th»ad d¿šed.\n", 
tid
);

483 
¡®ls
[
tid
].
d¿š
 = 
Œue
;

484 
	}
}

486 
	g‹m¶©e
 <
şass
 
	gIm¶
>

488 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$wakeFromQu›sû
()

490 
	`DPRINTF
(
F‘ch
, "Waking up from quiesce\n");

493 
ãtchStus
[0] = 
RuÂšg
;

494 
	}
}

496 
	g‹m¶©e
 <
şass
 
	gIm¶
>

497 
šlše
 

498 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$sw™chToAùive
()

500 ià(
_¡©us
 =ğ
IÇùive
) {

501 
	`DPRINTF
(
Aùiv™y
, "Activating stage.\n");

503 
ıu
->
	`aùiv©eSge
(
O3CPU
::
F‘chIdx
);

505 
_¡©us
 = 
Aùive
;

507 
	}
}

509 
	g‹m¶©e
 <
şass
 
	gIm¶
>

510 
šlše
 

511 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$sw™chToIÇùive
()

513 ià(
_¡©us
 =ğ
Aùive
) {

514 
	`DPRINTF
(
Aùiv™y
, "Deactivating stage.\n");

516 
ıu
->
	`d—ùiv©eSge
(
O3CPU
::
F‘chIdx
);

518 
_¡©us
 = 
IÇùive
;

520 
	}
}

522 
	g‹m¶©e
 <
şass
 
	gIm¶
>

523 
boŞ


524 
	gDeçuÉF‘ch
<
	gIm¶
>::
lookupAndUpd©eNextPC
(

525 
DynIn¡PŒ
 &
š¡
, 
TheISA
::
PCS‹
 &
ÃxtPC
)

530 
boŞ
 
´ediù_k’
;

532 ià(!
	gš¡
->
isCÚŒŞ
()) {

533 
	gTheISA
::
advªûPC
(
ÃxtPC
, 
š¡
->
¡©icIn¡
);

534 
	gš¡
->
£tP»dT¬g
(
ÃxtPC
);

535 
	gš¡
->
£tP»dTak’
(
çl£
);

536  
	gçl£
;

539 
Th»adID
 
	gtid
 = 
š¡
->
th»adNumb”
;

540 
	g´ediù_k’
 = 
b¿nchP»d
.
´ediù
(
š¡
, 
ÃxtPC
, 
tid
);

542 ià(
	g´ediù_k’
) {

543 
DPRINTF
(
F‘ch
, "[tid:%i]: [sn:%i]: Branch…redictedo beakeno %s.\n",

544 
tid
, 
š¡
->
£qNum
, 
ÃxtPC
);

546 
DPRINTF
(
F‘ch
, "[tid:%i]: [sn:%i]:Branch…redictedo be‚otaken.\n",

547 
tid
, 
š¡
->
£qNum
);

550 
DPRINTF
(
F‘ch
, "[tid:%i]: [sn:%i] Branch…redictedo goo %s.\n",

551 
tid
, 
š¡
->
£qNum
, 
ÃxtPC
);

552 
	gš¡
->
£tP»dT¬g
(
ÃxtPC
);

553 
	gš¡
->
£tP»dTak’
(
´ediù_k’
);

555 ++
	gãtchedB¿nches
;

557 ià(
	g´ediù_k’
) {

558 ++
	g´ediùedB¿nches
;

561  
	g´ediù_k’
;

564 
	g‹m¶©e
 <
şass
 
	gIm¶
>

565 
boŞ


566 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$ãtchCacheLše
(
Addr
 
vaddr
, 
Th»adID
 
tid
, Add¸
pc
)

568 
FauÉ
 
çuÉ
 = 
NoFauÉ
;

570 
	`as£¹
(!
ıu
->
	`sw™chedOut
());

574 ià(
ÿcheBlocked
) {

575 
	`DPRINTF
(
F‘ch
, "[tid:%i] Can't fetch cache†ine, cache blocked\n",

576 
tid
);

577  
çl£
;

578 } ià(
	`checkIÁ”ru±
(
pc
è&& !
d–ayedComm™
[
tid
]) {

583 
	`DPRINTF
(
F‘ch
, "[tid:%i] Can't fetch cache†ine, interrupt…ending\n",

584 
tid
);

585  
çl£
;

589 
Addr
 
block_PC
 = 
	`iÿcheBlockAlignPC
(
vaddr
);

591 
	`DPRINTF
(
F‘ch
, "[tid:%i] Fetching cache†ine %#x for‡ddr %#x\n",

592 
tid
, 
block_PC
, 
vaddr
);

597 
Reque¡PŒ
 
mem_»q
 =

598 
Ãw
 
	`Reque¡
(
tid
, 
block_PC
, 
ÿcheBlkSize
, 
Reque¡
::
INST_FETCH
,

599 
ıu
->
	`š¡Ma¡”Id
(), 
pc
, cpu->
th»ad
[
tid
]->
	`cÚ‹xtId
(),id);

601 
memReq
[
tid
] = 
mem_»q
;

604 
ãtchStus
[
tid
] = 
IbWa™
;

605 
F‘chT¿n¦©iÚ
 *
Œªs
 = 
Ãw
 
	`F‘chT¿n¦©iÚ
(
this
);

606 
ıu
->
™b
->
	`Œª¦©eTimšg
(
mem_»q
, cpu->
th»ad
[
tid
]->
	`g‘TC
(),

607 
Œªs
, 
Ba£TLB
::
Execu‹
);

608  
Œue
;

609 
	}
}

611 
	g‹m¶©e
 <
şass
 
	gIm¶
>

613 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$fšishT¿n¦©iÚ
(
FauÉ
 
çuÉ
, 
Reque¡PŒ
 
mem_»q
)

615 
Th»adID
 
tid
 = 
mem_»q
->
	`th»adId
();

616 
Addr
 
block_PC
 = 
mem_»q
->
	`g‘Vaddr
();

618 
	`as£¹
(!
ıu
->
	`sw™chedOut
());

621 
ıu
->
	`wakeCPU
();

623 ià(
ãtchStus
[
tid
] !ğ
IbWa™
 || 
mem_»q
 !ğ
memReq
[tid] ||

624 
mem_»q
->
	`g‘Vaddr
(è!ğ
memReq
[
tid
]->getVaddr()) {

625 
	`DPRINTF
(
F‘ch
, "[tid:%i] Ignoring itlb completed‡fter squash\n",

626 
tid
);

627 ++
ãtchTlbSquashes
;

628 
d–‘e
 
mem_»q
;

634 ià(
çuÉ
 =ğ
NoFauÉ
) {

638 ià(!
ıu
->
sy¡em
->
	`isMemAddr
(
mem_»q
->
	`g‘Paddr
())) {

639 
	`w¬n
("Address %#x is outside of…hysical memory, stopping fetch\n",

640 
mem_»q
->
	`g‘Paddr
());

641 
ãtchStus
[
tid
] = 
NoGoodAddr
;

642 
d–‘e
 
mem_»q
;

643 
memReq
[
tid
] = 
NULL
;

648 
Pack‘PŒ
 
d©a_pkt
 = 
Ãw
 
	`Pack‘
(
mem_»q
, 
MemCmd
::
R—dReq
);

649 
d©a_pkt
->
	`d©aDyÇmicA¼ay
(
Ãw
 
ušt8_t
[
ÿcheBlkSize
]);

651 
ÿcheD©aPC
[
tid
] = 
block_PC
;

652 
ÿcheD©aV®id
[
tid
] = 
çl£
;

653 
	`DPRINTF
(
F‘ch
, "Fetch: Doing instruction„ead.\n");

655 
ãtchedCacheLšes
++;

658 ià(!
ıu
->
	`g‘In¡PÜt
().
	`£ndTimšgReq
(
d©a_pkt
)) {

659 
	`as£¹
(
»ŒyPkt
 =ğ
NULL
);

660 
	`as£¹
(
»ŒyTid
 =ğ
Inv®idTh»adID
);

661 
	`DPRINTF
(
F‘ch
, "[tid:%i] OuˆoàMSHRs!\n", 
tid
);

663 
ãtchStus
[
tid
] = 
IÿcheWa™R‘ry
;

664 
»ŒyPkt
 = 
d©a_pkt
;

665 
»ŒyTid
 = 
tid
;

666 
ÿcheBlocked
 = 
Œue
;

668 
	`DPRINTF
(
F‘ch
, "[tid:%i]: Došg Iÿchacûss.\n", 
tid
);

669 
	`DPRINTF
(
Aùiv™y
, "[tid:%i]: Activity: Waiting on I-cache "

670 "»¥Ú£.\n", 
tid
);

672 
Ï¡IÿcheSÎ
[
tid
] = 
	`curTick
();

673 
ãtchStus
[
tid
] = 
IÿcheWa™Re¥Ú£
;

676 ià(!(
numIn¡
 < 
ãtchWidth
)) {

677 
	`as£¹
(!
fšishT¿n¦©iÚEv’t
.
	`scheduËd
());

678 
fšishT¿n¦©iÚEv’t
.
	`£tFauÉ
(
çuÉ
);

679 
fšishT¿n¦©iÚEv’t
.
	`£tReq
(
mem_»q
);

680 
ıu
->
	`scheduË
(
fšishT¿n¦©iÚEv’t
,

681 
ıu
->
	`şockEdge
(
	`Cyşes
(1)));

684 
	`DPRINTF
(
F‘ch
, "[tid:%i] Got back„eq with‡ddr %#x butƒxpected %#x\n",

685 
tid
, 
mem_»q
->
	`g‘Vaddr
(), 
memReq
[tid]->getVaddr());

687 
d–‘e
 
mem_»q
;

688 
memReq
[
tid
] = 
NULL
;

693 
TheISA
::
PCS‹
 
ãtchPC
 = 
pc
[
tid
];

695 
	`DPRINTF
(
F‘ch
, "[tid:%i]: T¿n¦©iÚ fauÉed, budšg‚oİ.\n", 
tid
);

697 
DynIn¡PŒ
 
š¡ruùiÚ
 = 
	`budIn¡
(
tid
,

698 
decod”
[
tid
]->
	`decode
(
TheISA
::
NoİMachIn¡
, 
ãtchPC
.
	`š¡Addr
()),

699 
NULL
, 
ãtchPC
, f‘chPC, 
çl£
);

701 
š¡ruùiÚ
->
	`£tP»dT¬g
(
ãtchPC
);

702 
š¡ruùiÚ
->
çuÉ
 = fault;

703 
wrÙeToTimeBufãr
 = 
Œue
;

705 
	`DPRINTF
(
Aùiv™y
, "Activityhis cycle.\n");

706 
ıu
->
	`aùiv™yThisCyşe
();

708 
ãtchStus
[
tid
] = 
T¿pP’dšg
;

710 
	`DPRINTF
(
F‘ch
, "[tid:%i]: Blocked,‚“dØhªdËhŒ­.\n", 
tid
);

711 
	`DPRINTF
(
F‘ch
, "[tid:%i]: fault (%s) detected @ PC %s.\n",

712 
tid
, 
çuÉ
->
	`Çme
(), 
pc
[tid]);

714 
_¡©us
 = 
	`upd©eF‘chStus
();

715 
	}
}

717 
	g‹m¶©e
 <
şass
 
	gIm¶
>

718 
šlše
 

719 
	gDeçuÉF‘ch
<
	gIm¶
>::
doSquash
(cÚ¡ 
TheISA
::
PCS‹
 &
ÃwPC
,

720 cÚ¡ 
DynIn¡PŒ
 
squashIn¡
, 
Th»adID
 
tid
)

722 
DPRINTF
(
F‘ch
, "[tid:%i]: Squashing, setting PCo: %s.\n",

723 
tid
, 
ÃwPC
);

725 
	gpc
[
tid
] = 
ÃwPC
;

726 
	gãtchOff£t
[
tid
] = 0;

727 ià(
	gsquashIn¡
 && squashIn¡->
pcS‹
().
š¡Addr
(è=ğ
ÃwPC
.instAddr())

728 
maüoİ
[
tid
] = 
squashIn¡
->macroop;

730 
	gmaüoİ
[
tid
] = 
NULL
;

731 
	gdecod”
[
tid
]->
»£t
();

734 ià(
	gãtchStus
[
tid
] =ğ
IÿcheWa™Re¥Ú£
) {

735 
DPRINTF
(
F‘ch
, "[tid:%i]: Squashing outstanding Icache miss.\n",

736 
tid
);

737 
	gmemReq
[
tid
] = 
NULL
;

738 } ià(
	gãtchStus
[
tid
] =ğ
IbWa™
) {

739 
DPRINTF
(
F‘ch
, "[tid:%i]: Squashing outstanding ITLB miss.\n",

740 
tid
);

741 
	gmemReq
[
tid
] = 
NULL
;

745 ià(
	g»ŒyTid
 =ğ
tid
) {

746 
as£¹
(
ÿcheBlocked
);

747 ià(
	g»ŒyPkt
) {

748 
d–‘e
 
	g»ŒyPkt
->
	g»q
;

749 
d–‘e
 
	g»ŒyPkt
;

751 
	g»ŒyPkt
 = 
NULL
;

752 
	g»ŒyTid
 = 
Inv®idTh»adID
;

755 
	gãtchStus
[
tid
] = 
Squashšg
;

762 
	gd–ayedComm™
[
tid
] = 
Œue
;

764 ++
	gãtchSquashCyşes
;

767 
	g‹m¶©e
<
şass
 
	gIm¶
>

769 
	gDeçuÉF‘ch
<
	gIm¶
>::
squashFromDecode
(cÚ¡ 
TheISA
::
PCS‹
 &
ÃwPC
,

770 cÚ¡ 
DynIn¡PŒ
 
squashIn¡
,

771 cÚ¡ 
In¡SeqNum
 
£q_num
, 
Th»adID
 
tid
)

773 
DPRINTF
(
F‘ch
, "[tid:%i]: Squashšg from decode.\n", 
tid
);

775 
doSquash
(
ÃwPC
, 
squashIn¡
, 
tid
);

779 
	gıu
->
»moveIn¡sUÁ
(
£q_num
, 
tid
);

782 
	g‹m¶©e
<
şass
 
	gIm¶
>

783 
boŞ


784 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$checkSÎ
(
Th»adID
 
tid
) const

786 
boŞ
 
»t_v®
 = 
çl£
;

788 ià(
ıu
->
cÚ‹xtSw™ch
) {

789 
	`DPRINTF
(
F‘ch
,"[tid:%i]: SÎšg fÜ‡ cÚ‹xˆsw™ch.\n",
tid
);

790 
»t_v®
 = 
Œue
;

791 } ià(
¡®ls
[
tid
].
d¿š
) {

792 
	`as£¹
(
ıu
->
	`isD¿ššg
());

793 
	`DPRINTF
(
F‘ch
,"[tid:%i]: D¿š sÎ d‘eùed.\n",
tid
);

794 
»t_v®
 = 
Œue
;

795 } ià(
¡®ls
[
tid
].
decode
) {

796 
	`DPRINTF
(
F‘ch
,"[tid:%i]: SÎ from Decod¡agd‘eùed.\n",
tid
);

797 
»t_v®
 = 
Œue
;

798 } ià(
¡®ls
[
tid
].
»Çme
) {

799 
	`DPRINTF
(
F‘ch
,"[tid:%i]: SÎ from R’am¡agd‘eùed.\n",
tid
);

800 
»t_v®
 = 
Œue
;

801 } ià(
¡®ls
[
tid
].
›w
) {

802 
	`DPRINTF
(
F‘ch
,"[tid:%i]: SÎ from IEW sgd‘eùed.\n",
tid
);

803 
»t_v®
 = 
Œue
;

804 } ià(
¡®ls
[
tid
].
comm™
) {

805 
	`DPRINTF
(
F‘ch
,"[tid:%i]: SÎ from Comm™ sgd‘eùed.\n",
tid
);

806 
»t_v®
 = 
Œue
;

809  
»t_v®
;

810 
	}
}

812 
	g‹m¶©e
<
şass
 
	gIm¶
>

813 
ty³Çme
 
	gDeçuÉF‘ch
<
	gIm¶
>::
F‘chStus


814 
DeçuÉF‘ch
<
Im¶
>::
	$upd©eF‘chStus
()

817 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

818 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

820 
th»ads
 !ğ
’d
) {

821 
Th»adID
 
tid
 = *
th»ads
++;

823 ià(
ãtchStus
[
tid
] =ğ
RuÂšg
 ||

824 
ãtchStus
[
tid
] =ğ
Squashšg
 ||

825 
ãtchStus
[
tid
] =ğ
IÿcheAcûssCom¶‘e
) {

827 ià(
_¡©us
 =ğ
IÇùive
) {

828 
	`DPRINTF
(
Aùiv™y
, "[tid:%i]: Aùiv©šg sge.\n",
tid
);

830 ià(
ãtchStus
[
tid
] =ğ
IÿcheAcûssCom¶‘e
) {

831 
	`DPRINTF
(
Aùiv™y
, "[tid:%i]: Activating fetch dueo cache"

832 "com¶‘iÚ\n",
tid
);

835 
ıu
->
	`aùiv©eSge
(
O3CPU
::
F‘chIdx
);

838  
Aùive
;

843 ià(
_¡©us
 =ğ
Aùive
) {

844 
	`DPRINTF
(
Aùiv™y
, "Deactivating stage.\n");

846 
ıu
->
	`d—ùiv©eSge
(
O3CPU
::
F‘chIdx
);

849  
IÇùive
;

850 
	}
}

852 
	g‹m¶©e
 <
şass
 
	gIm¶
>

854 
	gDeçuÉF‘ch
<
	gIm¶
>::
squash
(cÚ¡ 
TheISA
::
PCS‹
 &
ÃwPC
,

855 cÚ¡ 
In¡SeqNum
 
£q_num
, 
DynIn¡PŒ
 
squashIn¡
,

856 
Th»adID
 
tid
)

858 
DPRINTF
(
F‘ch
, "[tid:%u]: Squash from comm™.\n", 
tid
);

860 
doSquash
(
ÃwPC
, 
squashIn¡
, 
tid
);

863 
	gıu
->
»moveIn¡sNÙInROB
(
tid
);

866 
	g‹m¶©e
 <
şass
 
	gIm¶
>

868 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$tick
()

870 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

871 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

872 
boŞ
 
¡©us_chªge
 = 
çl£
;

874 
wrÙeToTimeBufãr
 = 
çl£
;

876 
Th»adID
 
i
 = 0; i < 
Im¶
::
MaxTh»ads
; ++i) {

877 
issueP–šedIãtch
[
i
] = 
çl£
;

880 
th»ads
 !ğ
’d
) {

881 
Th»adID
 
tid
 = *
th»ads
++;

885 
boŞ
 
upd©ed_¡©us
 = 
	`checkSigÇlsAndUpd©e
(
tid
);

886 
¡©us_chªge
 = stus_chªg|| 
upd©ed_¡©us
;

889 
	`DPRINTF
(
F‘ch
, "Running stage.\n");

891 ià(
FuÎSy¡em
) {

892 ià(
äomComm™
->
comm™Info
[0].
š‹¼u±P’dšg
) {

893 
š‹¼u±P’dšg
 = 
Œue
;

896 ià(
äomComm™
->
comm™Info
[0].
ş—rIÁ”ru±
) {

897 
š‹¼u±P’dšg
 = 
çl£
;

901 
th»adF‘ched
 = 0;h»adF‘ched < 
numF‘chšgTh»ads
;

902 
th»adF‘ched
++) {

904 
	`ãtch
(
¡©us_chªge
);

908 
ãtchNi¢Di¡
.
	`§m¶e
(
numIn¡
);

910 ià(
¡©us_chªge
) {

912 
_¡©us
 = 
	`upd©eF‘chStus
();

916 ià(
wrÙeToTimeBufãr
 || 
ıu
->
cÚ‹xtSw™ch
) {

917 
	`DPRINTF
(
Aùiv™y
, "Activityhis cycle.\n");

919 
ıu
->
	`aùiv™yThisCyşe
();

923 
Th»adID
 
i
 = 0; i < 
Im¶
::
MaxTh»ads
; ++i) {

924 ià(
issueP–šedIãtch
[
i
]) {

925 
	`p–šeIÿcheAcûs£s
(
i
);

930 
numIn¡
 = 0;

931 
	}
}

933 
	g‹m¶©e
 <
şass
 
	gIm¶
>

934 
boŞ


935 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$checkSigÇlsAndUpd©e
(
Th»adID
 
tid
)

938 ià(
äomDecode
->
decodeBlock
[
tid
]) {

939 
¡®ls
[
tid
].
decode
 = 
Œue
;

942 ià(
äomDecode
->
decodeUnblock
[
tid
]) {

943 
	`as£¹
(
¡®ls
[
tid
].
decode
);

944 
	`as£¹
(!
äomDecode
->
decodeBlock
[
tid
]);

945 
¡®ls
[
tid
].
decode
 = 
çl£
;

948 ià(
äomR’ame
->
»ÇmeBlock
[
tid
]) {

949 
¡®ls
[
tid
].
»Çme
 = 
Œue
;

952 ià(
äomR’ame
->
»ÇmeUnblock
[
tid
]) {

953 
	`as£¹
(
¡®ls
[
tid
].
»Çme
);

954 
	`as£¹
(!
äomR’ame
->
»ÇmeBlock
[
tid
]);

955 
¡®ls
[
tid
].
»Çme
 = 
çl£
;

958 ià(
äomIEW
->
›wBlock
[
tid
]) {

959 
¡®ls
[
tid
].
›w
 = 
Œue
;

962 ià(
äomIEW
->
›wUnblock
[
tid
]) {

963 
	`as£¹
(
¡®ls
[
tid
].
›w
);

964 
	`as£¹
(!
äomIEW
->
›wBlock
[
tid
]);

965 
¡®ls
[
tid
].
›w
 = 
çl£
;

968 ià(
äomComm™
->
comm™Block
[
tid
]) {

969 
¡®ls
[
tid
].
comm™
 = 
Œue
;

972 ià(
äomComm™
->
comm™Unblock
[
tid
]) {

973 
	`as£¹
(
¡®ls
[
tid
].
comm™
);

974 
	`as£¹
(!
äomComm™
->
comm™Block
[
tid
]);

975 
¡®ls
[
tid
].
comm™
 = 
çl£
;

979 ià(
äomComm™
->
comm™Info
[
tid
].
squash
) {

981 
	`DPRINTF
(
F‘ch
, "[tid:%u]: Squashing instructions dueo squash "

982 "äom comm™.\n",
tid
);

984 
	`squash
(
äomComm™
->
comm™Info
[
tid
].
pc
,

985 
äomComm™
->
comm™Info
[
tid
].
dÚeSeqNum
,

986 
äomComm™
->
comm™Info
[
tid
].
squashIn¡
,id);

991 ià(
äomComm™
->
comm™Info
[
tid
].
mi¥»diùIn¡
 &&

992 
äomComm™
->
comm™Info
[
tid
].
mi¥»diùIn¡
->
	`isCÚŒŞ
()) {

993 
b¿nchP»d
.
	`squash
(
äomComm™
->
comm™Info
[
tid
].
dÚeSeqNum
,

994 
äomComm™
->
comm™Info
[
tid
].
pc
,

995 
äomComm™
->
comm™Info
[
tid
].
b¿nchTak’
,

996 
tid
);

998 
b¿nchP»d
.
	`squash
(
äomComm™
->
comm™Info
[
tid
].
dÚeSeqNum
,

999 
tid
);

1002  
Œue
;

1003 } ià(
äomComm™
->
comm™Info
[
tid
].
dÚeSeqNum
) {

1006 
b¿nchP»d
.
	`upd©e
(
äomComm™
->
comm™Info
[
tid
].
dÚeSeqNum
,id);

1010 ià(
äomComm™
->
comm™Info
[
tid
].
robSquashšg
) {

1011 
	`DPRINTF
(
F‘ch
, "[tid:%u]: ROB i ¡Èsquashšg.\n", 
tid
);

1014 
ãtchStus
[
tid
] = 
Squashšg
;

1016  
Œue
;

1020 ià(
äomDecode
->
decodeInfo
[
tid
].
squash
) {

1021 
	`DPRINTF
(
F‘ch
, "[tid:%u]: Squashing instructions dueo squash "

1022 "äom decode.\n",
tid
);

1025 ià(
äomDecode
->
decodeInfo
[
tid
].
b¿nchMi¥»diù
) {

1026 
b¿nchP»d
.
	`squash
(
äomDecode
->
decodeInfo
[
tid
].
dÚeSeqNum
,

1027 
äomDecode
->
decodeInfo
[
tid
].
ÃxtPC
,

1028 
äomDecode
->
decodeInfo
[
tid
].
b¿nchTak’
,

1029 
tid
);

1031 
b¿nchP»d
.
	`squash
(
äomDecode
->
decodeInfo
[
tid
].
dÚeSeqNum
,

1032 
tid
);

1035 ià(
ãtchStus
[
tid
] !ğ
Squashšg
) {

1037 
	`DPRINTF
(
F‘ch
, "Squashing from decode with PC = %s\n",

1038 
äomDecode
->
decodeInfo
[
tid
].
ÃxtPC
);

1040 
	`squashFromDecode
(
äomDecode
->
decodeInfo
[
tid
].
ÃxtPC
,

1041 
äomDecode
->
decodeInfo
[
tid
].
squashIn¡
,

1042 
äomDecode
->
decodeInfo
[
tid
].
dÚeSeqNum
,

1043 
tid
);

1045  
Œue
;

1049 ià(
	`checkSÎ
(
tid
) &&

1050 
ãtchStus
[
tid
] !ğ
IÿcheWa™Re¥Ú£
 &&

1051 
ãtchStus
[
tid
] !ğ
IÿcheWa™R‘ry
) {

1052 
	`DPRINTF
(
F‘ch
, "[tid:%i]: S‘tšgØblocked\n",
tid
);

1054 
ãtchStus
[
tid
] = 
Blocked
;

1056  
Œue
;

1059 ià(
ãtchStus
[
tid
] =ğ
Blocked
 ||

1060 
ãtchStus
[
tid
] =ğ
Squashšg
) {

1063 
	`DPRINTF
(
F‘ch
, "[tid:%i]: Done squashing, switchingo„unning.\n",

1064 
tid
);

1066 
ãtchStus
[
tid
] = 
RuÂšg
;

1068  
Œue
;

1073  
çl£
;

1074 
	}
}

1076 
	g‹m¶©e
<
şass
 
	gIm¶
>

1077 
ty³Çme
 
	gIm¶
::
DynIn¡PŒ


1078 
DeçuÉF‘ch
<
Im¶
>::
budIn¡
(
Th»adID
 
tid
, 
SticIn¡PŒ
 
¡©icIn¡
,

1079 
SticIn¡PŒ
 
curMaüoİ
, 
TheISA
::
PCS‹
 
thisPC
,

1080 
TheISA
::
PCS‹
 
ÃxtPC
, 
boŞ
 
Œaû
)

1083 
In¡SeqNum
 
	g£q
 = 
ıu
->
g‘AndInüem’tIn¡Seq
();

1086 
DynIn¡PŒ
 
	gš¡ruùiÚ
 =

1087 
Ãw
 
DynIn¡
(
¡©icIn¡
, 
curMaüoİ
, 
thisPC
, 
ÃxtPC
, 
£q
, 
ıu
);

1088 
	gš¡ruùiÚ
->
£tTid
(
tid
);

1090 
	gš¡ruùiÚ
->
£tASID
(
tid
);

1092 
	gš¡ruùiÚ
->
£tTh»adS‹
(
ıu
->
th»ad
[
tid
]);

1094 
DPRINTF
(
F‘ch
, "[tid:%i]: Instruction PC %#x (%d) created "

1095 "[¢:%Îi].\n", 
tid
, 
thisPC
.
š¡Addr
(),

1096 
thisPC
.
miüoPC
(), 
£q
);

1098 
DPRINTF
(
F‘ch
, "[tid:%i]: In¡ruùiÚ is: %s\n", 
tid
,

1099 
š¡ruùiÚ
->
¡©icIn¡
->

1100 
di§s£mbË
(
thisPC
.
š¡Addr
()));

1102 #ià
TRACING_ON


1103 ià(
	gŒaû
) {

1104 
	gš¡ruùiÚ
->
	gŒaûD©a
 =

1105 
ıu
->
g‘T¿ûr
()->
g‘In¡RecÜd
(
curTick
(), cpu->
tcBa£
(
tid
),

1106 
š¡ruùiÚ
->
¡©icIn¡
, 
thisPC
, 
curMaüoİ
);

1109 
	gš¡ruùiÚ
->
	gŒaûD©a
 = 
NULL
;

1113 
	gš¡ruùiÚ
->
£tIn¡Li¡It
(
ıu
->
addIn¡
(
š¡ruùiÚ
));

1117 
as£¹
(
numIn¡
 < 
ãtchWidth
);

1118 
	gtoDecode
->
	gš¡s
[
toDecode
->
size
++] = 
š¡ruùiÚ
;

1121 
	gd–ayedComm™
[
tid
] = 
š¡ruùiÚ
->
isD–ayedComm™
();

1123  
	gš¡ruùiÚ
;

1126 
	g‹m¶©e
<
şass
 
	gIm¶
>

1128 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$ãtch
(
boŞ
 &
¡©us_chªge
)

1133 
Th»adID
 
tid
 = 
	`g‘F‘chšgTh»ad
(
ãtchPŞicy
);

1135 
	`as£¹
(!
ıu
->
	`sw™chedOut
());

1137 ià(
tid
 =ğ
Inv®idTh»adID
) {

1139 
th»adF‘ched
 = 
numF‘chšgTh»ads
;

1141 ià(
numTh»ads
 == 1) {

1142 
	`´ofeSÎ
(0);

1148 
	`DPRINTF
(
F‘ch
, "A‰em±šgØãtch from [tid:%i]\n", 
tid
);

1151 
TheISA
::
PCS‹
 
thisPC
 = 
pc
[
tid
];

1153 
Addr
 
pcOff£t
 = 
ãtchOff£t
[
tid
];

1154 
Addr
 
ãtchAddr
 = (
thisPC
.
	`š¡Addr
(è+ 
pcOff£t
è& 
Ba£CPU
::
PCMask
;

1156 
boŞ
 
šRom
 = 
	`isRomMiüoPC
(
thisPC
.
	`miüoPC
());

1161 ià(
ãtchStus
[
tid
] =ğ
IÿcheAcûssCom¶‘e
) {

1162 
	`DPRINTF
(
F‘ch
, "[tid:%i]: Iÿchmis i com¶‘e.\n", 
tid
);

1164 
ãtchStus
[
tid
] = 
RuÂšg
;

1165 
¡©us_chªge
 = 
Œue
;

1166 } ià(
ãtchStus
[
tid
] =ğ
RuÂšg
) {

1168 
Addr
 
block_PC
 = 
	`iÿcheBlockAlignPC
(
ãtchAddr
);

1173 ià(!(
ÿcheD©aV®id
[
tid
] && 
block_PC
 =ğ
ÿcheD©aPC
[tid])

1174 && !
šRom
 && !
maüoİ
[
tid
]) {

1175 
	`DPRINTF
(
F‘ch
, "[tid:%i]: Attemptingoranslate‡nd„ead "

1176 "š¡ruùiÚ, s¹šg‡ˆPC %s.\n", 
tid
, 
thisPC
);

1178 
	`ãtchCacheLše
(
ãtchAddr
, 
tid
, 
thisPC
.
	`š¡Addr
());

1180 ià(
ãtchStus
[
tid
] =ğ
IÿcheWa™Re¥Ú£
)

1181 ++
iÿcheSÎCyşes
;

1182 ià(
ãtchStus
[
tid
] =ğ
IbWa™
)

1183 ++
ãtchTlbCyşes
;

1185 ++
ãtchMiscSÎCyşes
;

1187 } ià((
	`checkIÁ”ru±
(
thisPC
.
	`š¡Addr
()è&& !
d–ayedComm™
[
tid
])) {

1191 ++
ãtchMiscSÎCyşes
;

1192 
	`DPRINTF
(
F‘ch
, "[tid:%i]: F‘ch i ¡®Ëd!\n", 
tid
);

1196 ià(
ãtchStus
[
tid
] =ğ
IdË
) {

1197 ++
ãtchIdËCyşes
;

1198 
	`DPRINTF
(
F‘ch
, "[tid:%i]: F‘ch i idË!\n", 
tid
);

1205 ++
ãtchCyşes
;

1207 
TheISA
::
PCS‹
 
ÃxtPC
 = 
thisPC
;

1209 
SticIn¡PŒ
 
¡©icIn¡
 = 
NULL
;

1210 
SticIn¡PŒ
 
curMaüoİ
 = 
maüoİ
[
tid
];

1216 
	`DPRINTF
(
F‘ch
, "[tid:%i]: Adding instructionso queueo "

1217 "decode.\n", 
tid
);

1221 
boŞ
 
´ediùedB¿nch
 = 
çl£
;

1223 
TheISA
::
MachIn¡
 *
ÿcheIn¡s
 =

1224 
»š‹½»t_ÿ¡
<
TheISA
::
MachIn¡
 *>(
ÿcheD©a
[
tid
]);

1226 cÚ¡ 
numIn¡s
 = 
ÿcheBlkSize
 / 
š¡Size
;

1227 
blkOff£t
 = (
ãtchAddr
 - 
ÿcheD©aPC
[
tid
]è/ 
š¡Size
;

1232 
numIn¡
 < 
ãtchWidth
 && !
´ediùedB¿nch
) {

1237 
boŞ
 
ÃedMem
 = !
šRom
 && !
curMaüoİ
 &&

1238 !
decod”
[
tid
]->
	`š¡R—dy
();

1239 
ãtchAddr
 = (
thisPC
.
	`š¡Addr
(è+ 
pcOff£t
è& 
Ba£CPU
::
PCMask
;

1240 
Addr
 
block_PC
 = 
	`iÿcheBlockAlignPC
(
ãtchAddr
);

1242 ià(
ÃedMem
) {

1245 ià(!
ÿcheD©aV®id
[
tid
] || 
block_PC
 !ğ
ÿcheD©aPC
[tid])

1248 ià(
blkOff£t
 >ğ
numIn¡s
) {

1254 ià(
ISA_HAS_DELAY_SLOT
 && 
pcOff£t
 == 0) {

1256 
Addr
 
pcAddr
 = 
thisPC
.
	`š¡Addr
(è& 
Ba£CPU
::
PCMask
;

1257 
ãtchAddr
 !ğ
pcAddr
 && 
blkOff£t
 < 
numIn¡s
) {

1258 
blkOff£t
++;

1259 
ãtchAddr
 +ğ
š¡Size
;

1261 ià(
blkOff£t
 >ğ
numIn¡s
)

1265 
MachIn¡
 
š¡
 = 
TheISA
::
	`gtoh
(
ÿcheIn¡s
[
blkOff£t
]);

1266 
decod”
[
tid
]->
	`mÜeBy‹s
(
thisPC
, 
ãtchAddr
, 
š¡
);

1268 ià(
decod”
[
tid
]->
	`ÃedMÜeBy‹s
()) {

1269 
blkOff£t
++;

1270 
ãtchAddr
 +ğ
š¡Size
;

1271 
pcOff£t
 +ğ
š¡Size
;

1278 ià(!(
curMaüoİ
 || 
šRom
)) {

1279 ià(
decod”
[
tid
]->
	`š¡R—dy
()) {

1280 
¡©icIn¡
 = 
decod”
[
tid
]->
	`decode
(
thisPC
);

1283 ++
ãtchedIn¡s
;

1285 ià(
¡©icIn¡
->
	`isMaüoİ
()) {

1286 
curMaüoİ
 = 
¡©icIn¡
;

1288 
pcOff£t
 = 0;

1299 
boŞ
 
ÃwMaüo
 = 
çl£
;

1300 ià(
curMaüoİ
 || 
šRom
) {

1301 ià(
šRom
) {

1302 
¡©icIn¡
 = 
ıu
->
miüocodeRom
.
	`ãtchMiüoİ
(

1303 
thisPC
.
	`miüoPC
(), 
curMaüoİ
);

1305 
¡©icIn¡
 = 
curMaüoİ
->
	`ãtchMiüoİ
(
thisPC
.
	`miüoPC
());

1307 
ÃwMaüo
 |ğ
¡©icIn¡
->
	`isLa¡Miüoİ
();

1310 
DynIn¡PŒ
 
š¡ruùiÚ
 =

1311 
	`budIn¡
(
tid
, 
¡©icIn¡
, 
curMaüoİ
,

1312 
thisPC
, 
ÃxtPC
, 
Œue
);

1314 
numIn¡
++;

1316 #ià
TRACING_ON


1317 
š¡ruùiÚ
->
ãtchTick
 = 
	`curTick
();

1320 
ÃxtPC
 = 
thisPC
;

1324 
´ediùedB¿nch
 |ğ
thisPC
.
	`b¿nchšg
();

1325 
´ediùedB¿nch
 |=

1326 
	`lookupAndUpd©eNextPC
(
š¡ruùiÚ
, 
ÃxtPC
);

1327 ià(
´ediùedB¿nch
) {

1328 
	`DPRINTF
(
F‘ch
, "B¿nch d‘eùed w™h PC = %s\n", 
thisPC
);

1331 
ÃwMaüo
 |ğ
thisPC
.
	`š¡Addr
(è!ğ
ÃxtPC
.instAddr();

1334 
thisPC
 = 
ÃxtPC
;

1335 
šRom
 = 
	`isRomMiüoPC
(
thisPC
.
	`miüoPC
());

1337 ià(
ÃwMaüo
) {

1338 
ãtchAddr
 = 
thisPC
.
	`š¡Addr
(è& 
Ba£CPU
::
PCMask
;

1339 
blkOff£t
 = (
ãtchAddr
 - 
ÿcheD©aPC
[
tid
]è/ 
š¡Size
;

1340 
pcOff£t
 = 0;

1341 
curMaüoİ
 = 
NULL
;

1344 ià(
š¡ruùiÚ
->
	`isQu›sû
()) {

1345 
	`DPRINTF
(
F‘ch
,

1347 
ãtchStus
[
tid
] = 
Qu›sûP’dšg
;

1348 
¡©us_chªge
 = 
Œue
;

1351 } (
curMaüoİ
 || 
decod”
[
tid
]->
	`š¡R—dy
()) &&

1352 
numIn¡
 < 
ãtchWidth
);

1355 ià(
´ediùedB¿nch
) {

1356 
	`DPRINTF
(
F‘ch
, "[tid:%i]: Done fetching,…redicted branch "

1357 "š¡ruùiÚƒncouÁ”ed.\n", 
tid
);

1358 } ià(
numIn¡
 >ğ
ãtchWidth
) {

1359 
	`DPRINTF
(
F‘ch
, "[tid:%i]: Done fetching,„eached fetch bandwidth "

1360 "fÜhi cyşe.\n", 
tid
);

1361 } ià(
blkOff£t
 >ğ
ÿcheBlkSize
) {

1362 
	`DPRINTF
(
F‘ch
, "[tid:%i]: Done fetching,„eachedheƒnd of cache "

1363 "block.\n", 
tid
);

1366 
maüoİ
[
tid
] = 
curMaüoİ
;

1367 
ãtchOff£t
[
tid
] = 
pcOff£t
;

1369 ià(
numIn¡
 > 0) {

1370 
wrÙeToTimeBufãr
 = 
Œue
;

1373 
pc
[
tid
] = 
thisPC
;

1377 
ãtchAddr
 = (
thisPC
.
	`š¡Addr
(è+ 
pcOff£t
è& 
Ba£CPU
::
PCMask
;

1378 
Addr
 
block_PC
 = 
	`iÿcheBlockAlignPC
(
ãtchAddr
);

1379 
issueP–šedIãtch
[
tid
] = 
block_PC
 !ğ
ÿcheD©aPC
[tid] &&

1380 
ãtchStus
[
tid
] !ğ
IÿcheWa™Re¥Ú£
 &&

1381 
ãtchStus
[
tid
] !ğ
IbWa™
 &&

1382 
ãtchStus
[
tid
] !ğ
IÿcheWa™R‘ry
 &&

1383 
ãtchStus
[
tid
] !ğ
Qu›sûP’dšg
 &&

1384 !
curMaüoİ
;

1385 
	}
}

1387 
	g‹m¶©e
<
şass
 
	gIm¶
>

1389 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$»cvR‘ry
()

1391 ià(
»ŒyPkt
 !ğ
NULL
) {

1392 
	`as£¹
(
ÿcheBlocked
);

1393 
	`as£¹
(
»ŒyTid
 !ğ
Inv®idTh»adID
);

1394 
	`as£¹
(
ãtchStus
[
»ŒyTid
] =ğ
IÿcheWa™R‘ry
);

1396 ià(
ıu
->
	`g‘In¡PÜt
().
	`£ndTimšgReq
(
»ŒyPkt
)) {

1397 
ãtchStus
[
»ŒyTid
] = 
IÿcheWa™Re¥Ú£
;

1398 
»ŒyPkt
 = 
NULL
;

1399 
»ŒyTid
 = 
Inv®idTh»adID
;

1400 
ÿcheBlocked
 = 
çl£
;

1403 
	`as£¹
(
»ŒyTid
 =ğ
Inv®idTh»adID
);

1406 
ÿcheBlocked
 = 
çl£
;

1408 
	}
}

1415 
	g‹m¶©e
<
şass
 
	gIm¶
>

1416 
Th»adID


1417 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$g‘F‘chšgTh»ad
(
F‘chPriÜ™y
 &
ãtch_´iÜ™y
)

1419 ià(
numTh»ads
 > 1) {

1420 
ãtch_´iÜ™y
) {

1422 
SšgËTh»ad
:

1425 
RoundRobš
:

1426  
	`roundRobš
();

1428 
IQ
:

1429  
	`iqCouÁ
();

1431 
LSQ
:

1432  
	`lsqCouÁ
();

1434 
B¿nch
:

1435  
	`b¿nchCouÁ
();

1438  
Inv®idTh»adID
;

1441 
li¡
<
Th»adID
>::
™”©Ü
 
th»ad
 = 
aùiveTh»ads
->
	`begš
();

1442 ià(
th»ad
 =ğ
aùiveTh»ads
->
	`’d
()) {

1443  
Inv®idTh»adID
;

1446 
Th»adID
 
tid
 = *
th»ad
;

1448 ià(
ãtchStus
[
tid
] =ğ
RuÂšg
 ||

1449 
ãtchStus
[
tid
] =ğ
IÿcheAcûssCom¶‘e
 ||

1450 
ãtchStus
[
tid
] =ğ
IdË
) {

1451  
tid
;

1453  
Inv®idTh»adID
;

1456 
	}
}

1459 
	g‹m¶©e
<
şass
 
	gIm¶
>

1460 
Th»adID


1461 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$roundRobš
()

1463 
li¡
<
Th»adID
>::
™”©Ü
 
´i_™”
 = 
´iÜ™yLi¡
.
	`begš
();

1464 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
´iÜ™yLi¡
.
	`’d
();

1466 
Th»adID
 
high_´i
;

1468 
´i_™”
 !ğ
’d
) {

1469 
high_´i
 = *
´i_™”
;

1471 
	`as£¹
(
high_´i
 <ğ
numTh»ads
);

1473 ià(
ãtchStus
[
high_´i
] =ğ
RuÂšg
 ||

1474 
ãtchStus
[
high_´i
] =ğ
IÿcheAcûssCom¶‘e
 ||

1475 
ãtchStus
[
high_´i
] =ğ
IdË
) {

1477 
´iÜ™yLi¡
.
	`”a£
(
´i_™”
);

1478 
´iÜ™yLi¡
.
	`push_back
(
high_´i
);

1480  
high_´i
;

1483 
´i_™”
++;

1486  
Inv®idTh»adID
;

1487 
	}
}

1489 
	g‹m¶©e
<
şass
 
	gIm¶
>

1490 
Th»adID


1491 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$iqCouÁ
()

1493 
¡d
::
´iÜ™y_queue
<> 
PQ
;

1494 
¡d
::
m­
<, 
Th»adID
> 
th»adM­
;

1496 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

1497 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

1499 
th»ads
 !ğ
’d
) {

1500 
Th»adID
 
tid
 = *
th»ads
++;

1501 
iqCouÁ
 = 
äomIEW
->
›wInfo
[
tid
].iqCount;

1503 
PQ
.
	`push
(
iqCouÁ
);

1504 
th»adM­
[
iqCouÁ
] = 
tid
;

1507 !
PQ
.
	`em±y
()) {

1508 
Th»adID
 
high_´i
 = 
th»adM­
[
PQ
.
	`tİ
()];

1510 ià(
ãtchStus
[
high_´i
] =ğ
RuÂšg
 ||

1511 
ãtchStus
[
high_´i
] =ğ
IÿcheAcûssCom¶‘e
 ||

1512 
ãtchStus
[
high_´i
] =ğ
IdË
)

1513  
high_´i
;

1515 
PQ
.
	`pİ
();

1519  
Inv®idTh»adID
;

1520 
	}
}

1522 
	g‹m¶©e
<
şass
 
	gIm¶
>

1523 
Th»adID


1524 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$lsqCouÁ
()

1526 
¡d
::
´iÜ™y_queue
<> 
PQ
;

1527 
¡d
::
m­
<, 
Th»adID
> 
th»adM­
;

1529 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

1530 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

1532 
th»ads
 !ğ
’d
) {

1533 
Th»adID
 
tid
 = *
th»ads
++;

1534 
ld¡qCouÁ
 = 
äomIEW
->
›wInfo
[
tid
].ldstqCount;

1536 
PQ
.
	`push
(
ld¡qCouÁ
);

1537 
th»adM­
[
ld¡qCouÁ
] = 
tid
;

1540 !
PQ
.
	`em±y
()) {

1541 
Th»adID
 
high_´i
 = 
th»adM­
[
PQ
.
	`tİ
()];

1543 ià(
ãtchStus
[
high_´i
] =ğ
RuÂšg
 ||

1544 
ãtchStus
[
high_´i
] =ğ
IÿcheAcûssCom¶‘e
 ||

1545 
ãtchStus
[
high_´i
] =ğ
IdË
)

1546  
high_´i
;

1548 
PQ
.
	`pİ
();

1551  
Inv®idTh»adID
;

1552 
	}
}

1554 
	g‹m¶©e
<
şass
 
	gIm¶
>

1555 
Th»adID


1556 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$b¿nchCouÁ
()

1559 
li¡
<
Th»adID
>::
™”©Ü
 
th»ad
 = 
aùiveTh»ads
->
	`begš
();

1560 
	`as£¹
(
th»ad
 !ğ
aùiveTh»ads
->
	`’d
());

1561 
Th»adID
 
tid
 = *
th»ad
;

1564 
	`·nic
("Branch Count Fetch…olicy unimplemented\n");

1565  
Inv®idTh»adID
;

1566 
	}
}

1568 
	g‹m¶©e
<
şass
 
	gIm¶
>

1570 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$p–šeIÿcheAcûs£s
(
Th»adID
 
tid
)

1572 ià(!
issueP–šedIãtch
[
tid
]) {

1577 
TheISA
::
PCS‹
 
thisPC
 = 
pc
[
tid
];

1579 ià(
	`isRomMiüoPC
(
thisPC
.
	`miüoPC
())) {

1583 
Addr
 
pcOff£t
 = 
ãtchOff£t
[
tid
];

1584 
Addr
 
ãtchAddr
 = (
thisPC
.
	`š¡Addr
(è+ 
pcOff£t
è& 
Ba£CPU
::
PCMask
;

1587 
Addr
 
block_PC
 = 
	`iÿcheBlockAlignPC
(
ãtchAddr
);

1590 ià(!(
ÿcheD©aV®id
[
tid
] && 
block_PC
 =ğ
ÿcheD©aPC
[tid])) {

1591 
	`DPRINTF
(
F‘ch
, "[tid:%i]: Issuing‡…ipelined I-cache‡ccess, "

1592 "¡¬tšg‡ˆPC %s.\n", 
tid
, 
thisPC
);

1594 
	`ãtchCacheLše
(
ãtchAddr
, 
tid
, 
thisPC
.
	`š¡Addr
());

1596 
	}
}

1598 
	g‹m¶©e
<
şass
 
	gIm¶
>

1600 
	gDeçuÉF‘ch
<
	gIm¶
>::
	$´ofeSÎ
(
Th»adID
 
tid
) {

1601 
	`DPRINTF
(
F‘ch
,"There‡re‚o morehreads‡vailableo fetch from.\n");

1605 ià(
¡®ls
[
tid
].
d¿š
) {

1606 ++
ãtchP’dšgD¿šCyşes
;

1607 
	`DPRINTF
(
F‘ch
, "Fetch is waiting for‡ drain!\n");

1608 } ià(
aùiveTh»ads
->
	`em±y
()) {

1609 ++
ãtchNoAùiveTh»adSÎCyşes
;

1610 
	`DPRINTF
(
F‘ch
, "Fetch has‚o‡ctivehread!\n");

1611 } ià(
ãtchStus
[
tid
] =ğ
Blocked
) {

1612 ++
ãtchBlockedCyşes
;

1613 
	`DPRINTF
(
F‘ch
, "[tid:%i]: F‘ch i blocked!\n", 
tid
);

1614 } ià(
ãtchStus
[
tid
] =ğ
Squashšg
) {

1615 ++
ãtchSquashCyşes
;

1616 
	`DPRINTF
(
F‘ch
, "[tid:%i]: F‘ch i squashšg!\n", 
tid
);

1617 } ià(
ãtchStus
[
tid
] =ğ
IÿcheWa™Re¥Ú£
) {

1618 ++
iÿcheSÎCyşes
;

1619 
	`DPRINTF
(
F‘ch
, "[tid:%i]: Fetch is waiting cache„esponse!\n",

1620 
tid
);

1621 } ià(
ãtchStus
[
tid
] =ğ
IbWa™
) {

1622 ++
ãtchTlbCyşes
;

1623 
	`DPRINTF
(
F‘ch
, "[tid:%i]: Fetch is waiting ITLB walko "

1624 "fšish!\n", 
tid
);

1625 } ià(
ãtchStus
[
tid
] =ğ
T¿pP’dšg
) {

1626 ++
ãtchP’dšgT¿pSÎCyşes
;

1627 
	`DPRINTF
(
F‘ch
, "[tid:%i]: Fetch is waiting for‡…endingrap!\n",

1628 
tid
);

1629 } ià(
ãtchStus
[
tid
] =ğ
Qu›sûP’dšg
) {

1630 ++
ãtchP’dšgQu›sûSÎCyşes
;

1631 
	`DPRINTF
(
F‘ch
, "[tid:%i]: Fetch is waiting for‡…ending quiesce "

1632 "š¡ruùiÚ!\n", 
tid
);

1633 } ià(
ãtchStus
[
tid
] =ğ
IÿcheWa™R‘ry
) {

1634 ++
ãtchIÿcheWa™R‘rySÎCyşes
;

1635 
	`DPRINTF
(
F‘ch
, "[tid:%i]: Fetch is waiting for‡n I-cache„etry!\n",

1636 
tid
);

1637 } ià(
ãtchStus
[
tid
] =ğ
NoGoodAddr
) {

1638 
	`DPRINTF
(
F‘ch
, "[tid:%i]: Fetch…redicted‚on-executable‡ddress\n",

1639 
tid
);

1641 
	`DPRINTF
(
F‘ch
, "[tid:%i]: Unexpected fetch stall„eason (Status: %i).\n",

1642 
tid
, 
ãtchStus
[tid]);

1644 
	}
}

	@free_list.cc

31 
	~"ba£/Œaû.hh
"

32 
	~"ıu/o3/ä“_li¡.hh
"

33 
	~"debug/F»eLi¡.hh
"

35 
	gSim¶eF»eLi¡
::
	$Sim¶eF»eLi¡
(
Th»adID
 
aùiveTh»ads
,

36 
_numLogiÿlIÁRegs
,

37 
_numPhysiÿlIÁRegs
,

38 
_numLogiÿlFlßtRegs
,

39 
_numPhysiÿlFlßtRegs
)

40 : 
	`numLogiÿlIÁRegs
(
_numLogiÿlIÁRegs
),

41 
	`numPhysiÿlIÁRegs
(
_numPhysiÿlIÁRegs
),

42 
	`numLogiÿlFlßtRegs
(
_numLogiÿlFlßtRegs
),

43 
	`numPhysiÿlFlßtRegs
(
_numPhysiÿlFlßtRegs
),

44 
	`numPhysiÿlRegs
(
numPhysiÿlIÁRegs
 + 
numPhysiÿlFlßtRegs
)

46 
	`DPRINTF
(
F»eLi¡
, "Creating‚ew free†ist object.\n");

50 
PhysRegIndex
 
i
 = 
numLogiÿlIÁRegs
 * 
aùiveTh»ads
;

51 
i
 < 
numPhysiÿlIÁRegs
; ++i)

53 
ä“IÁRegs
.
	`push
(
i
);

60 
PhysRegIndex
 
i
 = 
numPhysiÿlIÁRegs
 + (
numLogiÿlFlßtRegs
 * 
aùiveTh»ads
);

62  ; 
i
 < 
numPhysiÿlRegs
; ++i)

64 
ä“FlßtRegs
.
	`push
(
i
);

66 
	}
}

68 
	g¡d
::
¡ršg


69 
Sim¶eF»eLi¡
::
	$Çme
() const

72 
	}
}

	@free_list.hh

31 #iâdeà
__CPU_O3_FREE_LIST_HH__


32 
	#__CPU_O3_FREE_LIST_HH__


	)

34 
	~<io¡»am
>

35 
	~<queue
>

37 
	~"¬ch/»gi¡”s.hh
"

38 
	~"ba£/misc.hh
"

39 
	~"ba£/Œaû.hh
"

40 
	~"cÚfig/the_i§.hh
"

41 
	~"ıu/o3/comm.hh
"

42 
	~"debug/F»eLi¡.hh
"

57 şas 
	cSim¶eF»eLi¡


59 
	m´iv©e
:

61 
¡d
::
queue
<
PhysRegIndex
> 
ä“IÁRegs
;

64 
	m¡d
::
queue
<
PhysRegIndex
> 
ä“FlßtRegs
;

67 
	mnumLogiÿlIÁRegs
;

70 
	mnumPhysiÿlIÁRegs
;

73 
	mnumLogiÿlFlßtRegs
;

76 
	mnumPhysiÿlFlßtRegs
;

79 
	mnumPhysiÿlRegs
;

81 
	mpublic
:

89 
Sim¶eF»eLi¡
(
Th»adID
 
aùiveTh»ads
,

90 
_numLogiÿlIÁRegs
,

91 
_numPhysiÿlIÁRegs
,

92 
_numLogiÿlFlßtRegs
,

93 
_numPhysiÿlFlßtRegs
);

96 
	m¡d
::
¡ršg
 
	$Çme
() const;

99 
šlše
 
PhysRegIndex
 
	`g‘IÁReg
();

102 
šlše
 
PhysRegIndex
 
	`g‘FlßtReg
();

105 
šlše
 
	`addReg
(
PhysRegIndex
 
ä“d_»g
);

108 
šlše
 
	`addIÁReg
(
PhysRegIndex
 
ä“d_»g
);

111 
šlše
 
	`addFlßtReg
(
PhysRegIndex
 
ä“d_»g
);

114 
boŞ
 
	$hasF»eIÁRegs
()

115 {  !
ä“IÁRegs
.
	`em±y
(); }

118 
boŞ
 
	$hasF»eFlßtRegs
()

119 {  !
ä“FlßtRegs
.
	`em±y
(); 
	}
}

122 
	$numF»eIÁRegs
()

123 {  
ä“IÁRegs
.
	`size
(); 
	}
}

126 
	$numF»eFlßtRegs
()

127 {  
ä“FlßtRegs
.
	`size
(); 
	}
}

130 
šlše
 
PhysRegIndex


131 
	gSim¶eF»eLi¡
::
	$g‘IÁReg
()

133 
	`DPRINTF
(
F»eLi¡
, "Tryingo get free integer„egister.\n");

135 ià(
ä“IÁRegs
.
	`em±y
()) {

136 
	`·nic
("No free integer„egisters!");

139 
PhysRegIndex
 
ä“_»g
 = 
ä“IÁRegs
.
	`äÚt
();

141 
ä“IÁRegs
.
	`pİ
();

143 (
ä“_»g
);

144 
	}
}

146 
šlše
 
PhysRegIndex


147 
	gSim¶eF»eLi¡
::
	$g‘FlßtReg
()

149 
	`DPRINTF
(
F»eLi¡
, "Tryingo get free float„egister.\n");

151 ià(
ä“FlßtRegs
.
	`em±y
()) {

152 
	`·nic
("No free integer„egisters!");

155 
PhysRegIndex
 
ä“_»g
 = 
ä“FlßtRegs
.
	`äÚt
();

157 
ä“FlßtRegs
.
	`pİ
();

159 (
ä“_»g
);

160 
	}
}

162 
šlše
 

163 
	gSim¶eF»eLi¡
::
	$addReg
(
PhysRegIndex
 
ä“d_»g
)

165 
	`DPRINTF
(
F»eLi¡
,"F»ešg„egi¡” %i.\n", 
ä“d_»g
);

168 ià(
ä“d_»g
 < 
numPhysiÿlIÁRegs
) {

169 ià(
ä“d_»g
 !ğ
TheISA
::
Z”oReg
)

170 
ä“IÁRegs
.
	`push
(
ä“d_»g
);

171 } ià(
ä“d_»g
 < 
numPhysiÿlRegs
) {

172 #ià
THE_ISA
 =ğ
ALPHA_ISA


173 ià(
ä“d_»g
 !ğ(
TheISA
::
Z”oReg
 + 
numPhysiÿlIÁRegs
))

175 
ä“FlßtRegs
.
	`push
(
ä“d_»g
);

189 
	}
}

191 
šlše
 

192 
	gSim¶eF»eLi¡
::
	$addIÁReg
(
PhysRegIndex
 
ä“d_»g
)

194 
	`DPRINTF
(
F»eLi¡
,"F»ešg iÁ„egi¡” %i.\n", 
ä“d_»g
);

196 
ä“IÁRegs
.
	`push
(
ä“d_»g
);

197 
	}
}

199 
šlše
 

200 
	gSim¶eF»eLi¡
::
	$addFlßtReg
(
PhysRegIndex
 
ä“d_»g
)

202 
	`DPRINTF
(
F»eLi¡
,"F»ešg flßˆ»gi¡” %i.\n", 
ä“d_»g
);

204 
ä“FlßtRegs
.
	`push
(
ä“d_»g
);

205 
	}
}

	@fu_pool.cc

43 
	~<s¡»am
>

45 
	~"ıu/o3/fu_poŞ.hh
"

46 
	~"ıu/func_un™.hh
"

48 
usšg
 
Çme¥aû
 
	g¡d
;

55 
šlše
 

56 
	gFUPoŞ
::
FUIdxQueue
::
	$addFU
(
fu_idx
)

58 
funcUn™sIdx
.
	`push_back
(
fu_idx
);

59 ++
size
;

60 
	}
}

62 
šlše
 

63 
	gFUPoŞ
::
FUIdxQueue
::
	$g‘FU
()

65 
»tv®
 = 
funcUn™sIdx
[
idx
++];

67 ià(
idx
 =ğ
size
)

68 
idx
 = 0;

70  
»tv®
;

71 
	}
}

73 
	gFUPoŞ
::~
	$FUPoŞ
()

75 
fuLi¡I‹¿tÜ
 
i
 = 
funcUn™s
.
	`begš
();

76 
fuLi¡I‹¿tÜ
 
’d
 = 
funcUn™s
.
	`’d
();

77 ; 
i
 !ğ
’d
; ++i)

78 
d–‘e
 *
i
;

79 
	}
}

83 
	gFUPoŞ
::
	$FUPoŞ
(cÚ¡ 
P¬ams
 *
p
)

84 : 
	$SimObjeù
(
p
)

86 
numFU
 = 0;

88 
funcUn™s
.
	`ş—r
();

90 
i
 = 0; i < 
Num_OpCÏs£s
; ++i) {

91 
maxOpL©’c›s
[
i
] = 
	`Cyşes
(0);

92 
maxIssueL©’c›s
[
i
] = 
	`Cyşes
(0);

98 cÚ¡ 
veùÜ
<
FUDesc
 *> &
·¿mLi¡
 = 
p
->
FULi¡
;

99 
FUDD™”©Ü
 
i
 = 
·¿mLi¡
.
	`begš
(); i !ğ·¿mLi¡.
	`’d
(); ++i) {

104 ià((*
i
)->
numb”
) {

112 
FuncUn™
 *
fu
 = 
Ãw
 FuncUnit;

114 
OPDD™”©Ü
 
j
 = (*
i
)->
İDescLi¡
.
	`begš
();

115 
OPDD™”©Ü
 
’d
 = (*
i
)->
İDescLi¡
.
	`’d
();

116 ; 
j
 !ğ
’d
; ++j) {

118 
ÿ·b™yLi¡
.
	`£t
((*
j
)->
İCÏss
);

122 
k
 = 0; k < (*
i
)->
numb”
; ++k)

123 
fuP”C­Li¡
[(*
j
)->
İCÏss
].
	`addFU
(
numFU
 + 
k
);

126 
fu
->
	`addC­ab™y
((*
j
)->
İCÏss
, (*j)->
İL©
, (*j)->
issueL©
);

128 ià((*
j
)->
İL©
 > 
maxOpL©’c›s
[(*j)->
İCÏss
])

129 
maxOpL©’c›s
[(*
j
)->
İCÏss
] = (*j)->
İL©
;

131 ià((*
j
)->
issueL©
 > 
maxIssueL©’c›s
[(*j)->
İCÏss
])

132 
maxIssueL©’c›s
[(*
j
)->
İCÏss
] = (*j)->
issueL©
;

135 
numFU
++;

138 
o¡ršg¡»am
 
s
;

140 
s
 << (*
i
)->
	`Çme
() << "(0)";

141 
fu
->
Çme
 = 
s
.
	`¡r
();

142 
funcUn™s
.
	`push_back
(
fu
);

144 
c
 = 1; c < (*
i
)->
numb”
; ++c) {

145 
o¡ršg¡»am
 
s
;

146 
numFU
++;

147 
FuncUn™
 *
fu2
 = 
Ãw
 
	`FuncUn™
(*
fu
);

149 
s
 << (*
i
)->
	`Çme
(è<< "(" << 
c
 << ")";

150 
fu2
->
Çme
 = 
s
.
	`¡r
();

151 
funcUn™s
.
	`push_back
(
fu2
);

156 
un™Busy
.
	`»size
(
numFU
);

158 
i
 = 0; i < 
numFU
; i++) {

159 
un™Busy
[
i
] = 
çl£
;

161 
	}
}

164 
	gFUPoŞ
::
	$ªnÙ©eMemÜyUn™s
(
Cyşes
 
h™_Ï‹ncy
)

166 
maxOpL©’c›s
[
MemR—dOp
] = 
h™_Ï‹ncy
;

168 
fuLi¡I‹¿tÜ
 
i
 = 
funcUn™s
.
	`begš
();

169 
fuLi¡I‹¿tÜ
 
›nd
 = 
funcUn™s
.
	`’d
();

170 ; 
i
 !ğ
›nd
; ++i) {

171 ià((*
i
)->
	`´ovides
(
MemR—dOp
))

172 (*
i
)->
	`İL©’cy
(
MemR—dOp
èğ
h™_Ï‹ncy
;

174 ià((*
i
)->
	`´ovides
(
MemWr™eOp
))

175 (*
i
)->
	`İL©’cy
(
MemWr™eOp
èğ
h™_Ï‹ncy
;

177 
	}
}

180 
	gFUPoŞ
::
	$g‘Un™
(
OpCÏss
 
ÿ·b™y
)

184 ià(!
ÿ·b™yLi¡
[
ÿ·b™y
])

187 
fu_idx
 = 
fuP”C­Li¡
[
ÿ·b™y
].
	`g‘FU
();

188 
¡¬t_idx
 = 
fu_idx
;

192 
un™Busy
[
fu_idx
]) {

193 
fu_idx
 = 
fuP”C­Li¡
[
ÿ·b™y
].
	`g‘FU
();

194 ià(
fu_idx
 =ğ
¡¬t_idx
) {

200 
	`as£¹
(
fu_idx
 < 
numFU
);

202 
un™Busy
[
fu_idx
] = 
Œue
;

204  
fu_idx
;

205 
	}
}

208 
	gFUPoŞ
::
	$ä“Un™NextCyşe
(
fu_idx
)

210 
	`as£¹
(
un™Busy
[
fu_idx
]);

211 
un™sToBeF»ed
.
	`push_back
(
fu_idx
);

212 
	}
}

215 
	gFUPoŞ
::
	$´oûssF»eUn™s
()

217 !
un™sToBeF»ed
.
	`em±y
()) {

218 
fu_idx
 = 
un™sToBeF»ed
.
	`back
();

219 
un™sToBeF»ed
.
	`pİ_back
();

221 
	`as£¹
(
un™Busy
[
fu_idx
]);

223 
un™Busy
[
fu_idx
] = 
çl£
;

225 
	}
}

228 
	gFUPoŞ
::
	$dump
()

230 
cout
 << "FunùiÚ Un™ PoŞ (" << 
	`Çme
() << ")\n";

231 
cout
 << "======================================\n";

232 
cout
 << "Free List:\n";

234 
i
 = 0; i < 
numFU
; ++i) {

235 ià(
un™Busy
[
i
]) {

239 
cout
 << " [" << 
i
 << "] : ";

241 
cout
 << 
funcUn™s
[
i
]->
Çme
 << " ";

243 
cout
 << "\n";

246 
cout
 << "======================================\n";

247 
cout
 << "Busy List:\n";

248 
i
 = 0; i < 
numFU
; ++i) {

249 ià(!
un™Busy
[
i
]) {

253 
cout
 << " [" << 
i
 << "] : ";

255 
cout
 << 
funcUn™s
[
i
]->
Çme
 << " ";

257 
cout
 << "\n";

259 
	}
}

262 
	gFUPoŞ
::
	$d¿šSª™yCheck
() const

264 
	`as£¹
(
un™sToBeF»ed
.
	`em±y
());

265 
i
 = 0; i < 
numFU
; i++)

266 
	`as£¹
(!
un™Busy
[
i
]);

267 
	}
}

284 
FUPoŞ
 *

285 
	gFUPoŞP¬ams
::
	$ü—‹
()

287  
Ãw
 
	`FUPoŞ
(
this
);

288 
	}
}

	@fu_pool.hh

43 #iâdeà
__CPU_O3_FU_POOL_HH__


44 
	#__CPU_O3_FU_POOL_HH__


	)

46 
	~<b™£t
>

47 
	~<li¡
>

48 
	~<¡ršg
>

49 
	~<veùÜ
>

51 
	~"ıu/İ_şass.hh
"

52 
	~"·¿ms/FUPoŞ.hh
"

53 
	~"sim/sim_objeù.hh
"

55 
şass
 
	gFUDesc
;

56 
şass
 
	gFuncUn™
;

70 şas 
	cFUPoŞ
 : 
public
 
SimObjeù


72 
´iv©e
:

74 
Cyşes
 
maxOpL©’c›s
[
Num_OpCÏs£s
];

76 
Cyşes
 
	mmaxIssueL©’c›s
[
Num_OpCÏs£s
];

79 
	m¡d
::
b™£t
<
Num_OpCÏs£s
> 
ÿ·b™yLi¡
;

82 
	m¡d
::
veùÜ
<
boŞ
> 
un™Busy
;

85 
	m¡d
::
veùÜ
<> 
un™sToBeF»ed
;

93 şas 
	cFUIdxQueue
 {

94 
	mpublic
:

96 
FUIdxQueue
()

97 : 
idx
(0), 
size
(0)

101 
šlše
 
addFU
(
fu_idx
);

106 
šlše
 
g‘FU
();

108 
	m´iv©e
:

110 
idx
;

113 
	msize
;

116 
	m¡d
::
veùÜ
<> 
funcUn™sIdx
;

120 
FUIdxQueue
 
	gfuP”C­Li¡
[
Num_OpCÏs£s
];

123 
	gnumFU
;

126 
	g¡d
::
veùÜ
<
FuncUn™
 *> 
funcUn™s
;

128 
	g¡d
::
	tveùÜ
<
	tFuncUn™
 *>::
	t™”©Ü
 
	tfuLi¡I‹¿tÜ
;

130 
	gpublic
:

131 
FUPoŞP¬ams
 
	tP¬ams
;

133 
FUPoŞ
(cÚ¡ 
P¬ams
 *
p
);

134 ~
FUPoŞ
();

139 
ªnÙ©eMemÜyUn™s
(
Cyşes
 
h™_Ï‹ncy
);

148 
g‘Un™
(
OpCÏss
 
ÿ·b™y
);

151 
ä“Un™NextCyşe
(
fu_idx
);

154 
´oûssF»eUn™s
();

157 
	$size
(è{  
numFU
; 
	}
}

160 
dump
();

163 
Cyşes
 
	$g‘OpL©’cy
(
OpCÏss
 
ÿ·b™y
) {

164  
maxOpL©’c›s
[
ÿ·b™y
];

165 
	}
}

168 
Cyşes
 
	$g‘IssueL©’cy
(
OpCÏss
 
ÿ·b™y
) {

169  
maxIssueL©’c›s
[
ÿ·b™y
];

170 
	}
}

173 
	$d¿šSª™yCheck
() const;

176 
	$keOv”From
(è{
	}
};

	@iew.cc

31 
	~"ıu/o3/›w_im¶.hh
"

32 
	~"ıu/o3/š¡_queue.hh
"

33 
	~"ıu/o3/i§_¥ecific.hh
"

35 
‹m¶©e
 
şass
 
	gDeçuÉIEW
<
	gO3CPUIm¶
>;

	@iew.hh

43 #iâdeà
__CPU_O3_IEW_HH__


44 
	#__CPU_O3_IEW_HH__


	)

46 
	~<queue
>

47 
	~<£t
>

49 
	~"ba£/¡©i¡ics.hh
"

50 
	~"ıu/o3/comm.hh
"

51 
	~"ıu/o3/lsq.hh
"

52 
	~"ıu/o3/scÜebßrd.hh
"

53 
	~"ıu/timebuf.hh
"

54 
	~"debug/IEW.hh
"

56 
	gD”ivO3CPUP¬ams
;

57 
şass
 
	gFUPoŞ
;

78 
	g‹m¶©e
<
şass
 
	gIm¶
>

79 şas 
	cDeçuÉIEW


81 
	m´iv©e
:

83 
ty³Çme
 
	tIm¶
::
	tCPUPŞ
 CPUPol;

84 
ty³Çme
 
	tIm¶
::
	tDynIn¡PŒ
 DynInstPtr;

85 
ty³Çme
 
	tIm¶
::
	tO3CPU
 O3CPU;

87 
ty³Çme
 
	tCPUPŞ
::
	tIQ
 IQ;

88 
ty³Çme
 
	tCPUPŞ
::
	tR’ameM­
 RenameMap;

89 
ty³Çme
 
	tCPUPŞ
::
	tLSQ
 LSQ;

91 
ty³Çme
 
	tCPUPŞ
::
	tTimeSŒuù
 TimeStruct;

92 
ty³Çme
 
	tCPUPŞ
::
	tIEWSŒuù
 IEWStruct;

93 
ty³Çme
 
	tCPUPŞ
::
	tR’ameSŒuù
 RenameStruct;

94 
ty³Çme
 
	tCPUPŞ
::
	tIssueSŒuù
 IssueStruct;

96 
	mpublic
:

100 
	eStus
 {

101 
Aùive
,

102 
	mIÇùive


106 
	eSgeStus
 {

107 
	gRuÂšg
,

108 
	gBlocked
,

109 
	gIdË
,

110 
	gS¹Squash
,

111 
	gSquashšg
,

112 
	gUnblockšg


115 
	g´iv©e
:

117 
Stus
 
_¡©us
;

119 
SgeStus
 
	gdi¥©chStus
[
Im¶
::
MaxTh»ads
];

121 
SgeStus
 
	gexeStus
;

123 
SgeStus
 
	gwbStus
;

125 
	gpublic
:

127 
DeçuÉIEW
(
O3CPU
 *
_ıu
, 
D”ivO3CPUP¬ams
 *
·¿ms
);

130 
	g¡d
::
¡ršg
 
	$Çme
() const;

133 
	`»gSts
();

136 
	`¡¬tupSge
();

139 
	`£tTimeBufãr
(
TimeBufãr
<
TimeSŒuù
> *
tb_±r
);

142 
	`£tR’ameQueue
(
TimeBufãr
<
R’ameSŒuù
> *
rq_±r
);

145 
	`£tIEWQueue
(
TimeBufãr
<
IEWSŒuù
> *
iq_±r
);

148 
	`£tAùiveTh»ads
(
¡d
::
li¡
<
Th»adID
> *
©_±r
);

151 
	`£tScÜebßrd
(
ScÜebßrd
 *
sb_±r
);

154 
	$d¿šSª™yCheck
() const;

157 
boŞ
 
	$isD¿šed
() const;

160 
	`keOv”From
();

163 
	`squash
(
Th»adID
 
tid
);

166 
	`wakeD•’d’ts
(
DynIn¡PŒ
 &
š¡
);

171 
	`»scheduËMemIn¡
(
DynIn¡PŒ
 &
š¡
);

174 
	`»¶ayMemIn¡
(
DynIn¡PŒ
 &
š¡
);

177 
	`š¡ToComm™
(
DynIn¡PŒ
 &
š¡
);

180 
	`skidIn£¹
(
Th»adID
 
tid
);

183 
	`skidCouÁ
();

186 
boŞ
 
	`skidsEm±y
();

189 
	`upd©eStus
();

192 
	`»£tEÁr›s
();

197 
	`wakeCPU
();

200 
	`aùiv™yThisCyşe
();

203 
šlše
 
	`aùiv©eSge
();

206 
šlše
 
	`d—ùiv©eSge
();

209 
boŞ
 
	$hasStÜesToWB
(è{  
ld¡Queue
.
	`hasStÜesToWB
(); 
	}
}

212 
boŞ
 
	$hasStÜesToWB
(
Th»adID
 
tid
è{  
ld¡Queue
.
	`hasStÜesToWB
Ñid); 
	}
}

214 
	$šüWb
(
In¡SeqNum
 &
¢
)

216 ++
wbOut¡ªdšg
;

217 ià(
wbOut¡ªdšg
 =ğ
wbMax
)

218 
abËToIssue
 = 
çl£
;

219 
	`DPRINTF
(
IEW
, "wbOut¡ªdšg: %˜[¢:%Îi]\n", 
wbOut¡ªdšg
, 
¢
);

220 
	`as£¹
(
wbOut¡ªdšg
 <ğ
wbMax
);

221 #ifdeà
DEBUG


222 
wbLi¡
.
	`š£¹
(
¢
);

224 
	}
}

226 
	$deüWb
(
In¡SeqNum
 &
¢
)

228 ià(
wbOut¡ªdšg
 =ğ
wbMax
)

229 
abËToIssue
 = 
Œue
;

230 
wbOut¡ªdšg
--;

231 
	`DPRINTF
(
IEW
, "wbOut¡ªdšg: %˜[¢:%Îi]\n", 
wbOut¡ªdšg
, 
¢
);

232 
	`as£¹
(
wbOut¡ªdšg
 >= 0);

233 #ifdeà
DEBUG


234 
	`as£¹
(
wbLi¡
.
	`fšd
(
¢
è!ğwbLi¡.
	`’d
());

235 
wbLi¡
.
	`”a£
(
¢
);

237 
	}
}

239 #ifdeà
DEBUG


240 
	g¡d
::
£t
<
In¡SeqNum
> 
wbLi¡
;

242 
	$dumpWb
()

244 
¡d
::
£t
<
In¡SeqNum
>::
™”©Ü
 
wb_™
 = 
wbLi¡
.
	`begš
();

245 
wb_™
 !ğ
wbLi¡
.
	`’d
()) {

246 
	`ırštf
("[sn:%lli]\n",

247 (*
wb_™
));

248 
wb_™
++;

250 
	}
}

253 
boŞ
 
	$ÿnIssue
(è{  
abËToIssue
; 
	}
}

255 
boŞ
 
	gabËToIssue
;

258 
checkMi¥»diùiÚ
(
DynIn¡PŒ
 &
š¡
);

260 
	g´iv©e
:

264 
squashDueToB¿nch
(
DynIn¡PŒ
 &
š¡
, 
Th»adID
 
tid
);

269 
squashDueToMemOrd”
(
DynIn¡PŒ
 &
š¡
, 
Th»adID
 
tid
);

274 
squashDueToMemBlocked
(
DynIn¡PŒ
 &
š¡
, 
Th»adID
 
tid
);

277 
block
(
Th»adID
 
tid
);

282 
unblock
(
Th»adID
 
tid
);

285 
di¥©ch
(
Th»adID
 
tid
);

288 
di¥©chIn¡s
(
Th»adID
 
tid
);

294 
execu‹In¡s
();

301 
wr™ebackIn¡s
();

306 
v®idIn¡sFromR’ame
();

309 
»adSÎSigÇls
(
Th»adID
 
tid
);

312 
boŞ
 
checkSÎ
(
Th»adID
 
tid
);

315 
checkSigÇlsAndUpd©e
(
Th»adID
 
tid
);

318 
em±yR’ameIn¡s
(
Th»adID
 
tid
);

321 
sÜtIn¡s
();

323 
	gpublic
:

327 
tick
();

329 
	g´iv©e
:

331 
upd©eExeIn¡Sts
(
DynIn¡PŒ
 &
š¡
);

334 
	gTimeBufãr
<
	gTimeSŒuù
> *
	gtimeBufãr
;

337 
ty³Çme
 
	gTimeBufãr
<
	gTimeSŒuù
>::
wœe
 
toF‘ch
;

340 
ty³Çme
 
	gTimeBufãr
<
	gTimeSŒuù
>::
wœe
 
äomComm™
;

343 
ty³Çme
 
	gTimeBufãr
<
	gTimeSŒuù
>::
wœe
 
toR’ame
;

346 
	gTimeBufãr
<
	gR’ameSŒuù
> *
	g»ÇmeQueue
;

349 
ty³Çme
 
	gTimeBufãr
<
	gR’ameSŒuù
>::
wœe
 
äomR’ame
;

352 
	gTimeBufãr
<
	gIssueSŒuù
> 
	gissueToExecQueue
;

355 
ty³Çme
 
	gTimeBufãr
<
	gIssueSŒuù
>::
wœe
 
äomIssue
;

361 
	gTimeBufãr
<
	gIEWSŒuù
> *
	g›wQueue
;

364 
ty³Çme
 
	gTimeBufãr
<
	gIEWSŒuù
>::
wœe
 
toComm™
;

367 
	g¡d
::
queue
<
DynIn¡PŒ
> 
š¡s
[
Im¶
::
MaxTh»ads
];

370 
	g¡d
::
queue
<
DynIn¡PŒ
> 
skidBufãr
[
Im¶
::
MaxTh»ads
];

373 
ScÜebßrd
* 
	gscÜebßrd
;

375 
	g´iv©e
:

377 
O3CPU
 *
ıu
;

382 
boŞ
 
	gwrÙeToTimeBufãr
;

385 
	sSÎs
 {

386 
boŞ
 
	gcomm™
;

390 
SÎs
 
	g¡®ls
[
Im¶
::
MaxTh»ads
];

393 
´štAvaabËIn¡s
();

395 
	gpublic
:

397 
IQ
 
š¡Queue
;

400 
LSQ
 
	gld¡Queue
;

403 
FUPoŞ
 *
	gfuPoŞ
;

407 
boŞ
 
	gupd©eLSQNextCyşe
;

409 
	g´iv©e
:

411 
boŞ
 
ãtchRedœeù
[
Im¶
::
MaxTh»ads
];

416 
boŞ
 
	gupd©edQueues
;

419 
Cyşes
 
	gcomm™ToIEWD–ay
;

422 
Cyşes
 
	g»ÇmeToIEWD–ay
;

429 
Cyşes
 
	gissueToExecu‹D–ay
;

432 
	gdi¥©chWidth
;

435 
	gissueWidth
;

438 
	gwbNumIn¡
;

445 
	gwbCyşe
;

450 
	gwbOut¡ªdšg
;

453 
	gwbWidth
;

458 
	gwbMax
;

461 
Th»adID
 
	gnumTh»ads
;

464 
	g¡d
::
li¡
<
Th»adID
> *
aùiveTh»ads
;

467 
	gskidBufãrMax
;

470 
	gSts
::
SÿÏr
 
›wIdËCyşes
;

472 
	gSts
::
SÿÏr
 
›wSquashCyşes
;

474 
	gSts
::
SÿÏr
 
›wBlockCyşes
;

476 
	gSts
::
SÿÏr
 
›wUnblockCyşes
;

478 
	gSts
::
SÿÏr
 
›wDi¥©chedIn¡s
;

480 
	gSts
::
SÿÏr
 
›wDi¥SquashedIn¡s
;

482 
	gSts
::
SÿÏr
 
›wDi¥LßdIn¡s
;

484 
	gSts
::
SÿÏr
 
›wDi¥StÜeIn¡s
;

486 
	gSts
::
SÿÏr
 
›wDi¥NÚS³cIn¡s
;

488 
	gSts
::
SÿÏr
 
›wIQFuÎEv’ts
;

490 
	gSts
::
SÿÏr
 
›wLSQFuÎEv’ts
;

492 
	gSts
::
SÿÏr
 
memOrd”ViŞ©iÚEv’ts
;

494 
	gSts
::
SÿÏr
 
´ediùedTak’IncÜ»ù
;

496 
	gSts
::
SÿÏr
 
´ediùedNÙTak’IncÜ»ù
;

498 
	gSts
::
FÜmuÏ
 
b¿nchMi¥»diùs
;

501 
	gSts
::
SÿÏr
 
›wExecu‹dIn¡s
;

503 
	gSts
::
VeùÜ
 
›wExecLßdIn¡s
;

507 
	gSts
::
SÿÏr
 
›wExecSquashedIn¡s
;

509 
	gSts
::
VeùÜ
 
›wExecu‹dSwp
;

511 
	gSts
::
VeùÜ
 
›wExecu‹dNİ
;

513 
	gSts
::
VeùÜ
 
›wExecu‹dRefs
;

515 
	gSts
::
VeùÜ
 
›wExecu‹dB¿nches
;

517 
	gSts
::
FÜmuÏ
 
›wExecStÜeIn¡s
;

519 
	gSts
::
FÜmuÏ
 
›wExecR©e
;

522 
	gSts
::
VeùÜ
 
›wIn¡sToComm™
;

524 
	gSts
::
VeùÜ
 
wr™ebackCouÁ
;

526 
	gSts
::
VeùÜ
 
´oduûrIn¡
;

528 
	gSts
::
VeùÜ
 
cÚsum”In¡
;

532 
	gSts
::
VeùÜ
 
wbP’®ized
;

534 
	gSts
::
FÜmuÏ
 
wbR©e
;

536 
	gSts
::
FÜmuÏ
 
wbFªout
;

538 
	gSts
::
FÜmuÏ
 
wbP’®izedR©e
;

	@iew_impl.hh

47 
	~<queue
>

49 
	~"¬ch/ut™y.hh
"

50 
	~"cÚfig/the_i§.hh
"

51 
	~"ıu/check”/ıu.hh
"

52 
	~"ıu/o3/fu_poŞ.hh
"

53 
	~"ıu/o3/›w.hh
"

54 
	~"ıu/timebuf.hh
"

55 
	~"debug/Aùiv™y.hh
"

56 
	~"debug/Decode.hh
"

57 
	~"debug/D¿š.hh
"

58 
	~"debug/IEW.hh
"

59 
	~"·¿ms/D”ivO3CPU.hh
"

61 
usšg
 
Çme¥aû
 
	g¡d
;

63 
	g‹m¶©e
<
şass
 
	gIm¶
>

64 
	gDeçuÉIEW
<
	gIm¶
>::
	$DeçuÉIEW
(
O3CPU
 *
_ıu
, 
D”ivO3CPUP¬ams
 *
·¿ms
)

65 : 
	`issueToExecQueue
(
·¿ms
->
backComSize
,…¬ams->
fÜw¬dComSize
),

66 
	`ıu
(
_ıu
),

67 
	`š¡Queue
(
_ıu
, 
this
, 
·¿ms
),

68 
	`ld¡Queue
(
_ıu
, 
this
, 
·¿ms
),

69 
	`fuPoŞ
(
·¿ms
->
fuPoŞ
),

70 
	`comm™ToIEWD–ay
(
·¿ms
->
comm™ToIEWD–ay
),

71 
	`»ÇmeToIEWD–ay
(
·¿ms
->
»ÇmeToIEWD–ay
),

72 
	`issueToExecu‹D–ay
(
·¿ms
->
issueToExecu‹D–ay
),

73 
	`di¥©chWidth
(
·¿ms
->
di¥©chWidth
),

74 
	`issueWidth
(
·¿ms
->
issueWidth
),

75 
	`wbOut¡ªdšg
(0),

76 
	`wbWidth
(
·¿ms
->
wbWidth
),

77 
	`numTh»ads
(
·¿ms
->
numTh»ads
)

79 
_¡©us
 = 
Aùive
;

80 
exeStus
 = 
RuÂšg
;

81 
wbStus
 = 
IdË
;

84 
äomIssue
 = 
issueToExecQueue
.
	`g‘Wœe
(-
issueToExecu‹D–ay
);

87 
š¡Queue
.
	`£tIssueToExecu‹Queue
(&
issueToExecQueue
);

89 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

90 
di¥©chStus
[
tid
] = 
RuÂšg
;

91 
¡®ls
[
tid
].
comm™
 = 
çl£
;

92 
ãtchRedœeù
[
tid
] = 
çl£
;

95 
wbMax
 = 
wbWidth
 * 
·¿ms
->
wbD•th
;

97 
upd©eLSQNextCyşe
 = 
çl£
;

99 
abËToIssue
 = 
Œue
;

101 
skidBufãrMax
 = (3 * (
»ÇmeToIEWD–ay
 * 
·¿ms
->
»ÇmeWidth
)è+ 
issueWidth
;

102 
	}
}

104 
	g‹m¶©e
 <
şass
 
	gIm¶
>

105 
	g¡d
::
¡ršg


106 
DeçuÉIEW
<
Im¶
>::
	$Çme
() const

108  
ıu
->
	`Çme
() + ".iew";

109 
	}
}

111 
	g‹m¶©e
 <
şass
 
	gIm¶
>

113 
	gDeçuÉIEW
<
	gIm¶
>::
	$»gSts
()

115 
usšg
 
Çme¥aû
 
Sts
;

117 
š¡Queue
.
	`»gSts
();

118 
ld¡Queue
.
	`»gSts
();

120 
›wIdËCyşes


121 .
	`Çme
(name() + ".iewIdleCycles")

122 .
	`desc
("Number of cycles IEW is idle");

124 
›wSquashCyşes


125 .
	`Çme
(name() + ".iewSquashCycles")

126 .
	`desc
("Number of cycles IEW is squashing");

128 
›wBlockCyşes


129 .
	`Çme
(name() + ".iewBlockCycles")

130 .
	`desc
("Number of cycles IEW is blocking");

132 
›wUnblockCyşes


133 .
	`Çme
(name() + ".iewUnblockCycles")

134 .
	`desc
("Number of cycles IEW is unblocking");

136 
›wDi¥©chedIn¡s


137 .
	`Çme
(name() + ".iewDispatchedInsts")

138 .
	`desc
("Number of instructions dispatchedo IQ");

140 
›wDi¥SquashedIn¡s


141 .
	`Çme
(name() + ".iewDispSquashedInsts")

142 .
	`desc
("Number of squashed instructions skipped by dispatch");

144 
›wDi¥LßdIn¡s


145 .
	`Çme
(name() + ".iewDispLoadInsts")

146 .
	`desc
("Number of dispatched†oad instructions");

148 
›wDi¥StÜeIn¡s


149 .
	`Çme
(name() + ".iewDispStoreInsts")

150 .
	`desc
("Number of dispatched store instructions");

152 
›wDi¥NÚS³cIn¡s


153 .
	`Çme
(name() + ".iewDispNonSpecInsts")

154 .
	`desc
("Number of dispatched‚on-speculative instructions");

156 
›wIQFuÎEv’ts


157 .
	`Çme
(name() + ".iewIQFullEvents")

158 .
	`desc
("Number ofimeshe IQ has become full, causing‡ stall");

160 
›wLSQFuÎEv’ts


161 .
	`Çme
(name() + ".iewLSQFullEvents")

162 .
	`desc
("Number ofimeshe LSQ has become full, causing‡ stall");

164 
memOrd”ViŞ©iÚEv’ts


165 .
	`Çme
(name() + ".memOrderViolationEvents")

166 .
	`desc
("Number of memory order violations");

168 
´ediùedTak’IncÜ»ù


169 .
	`Çme
(name() + ".predictedTakenIncorrect")

170 .
	`desc
("Number of brancheshat were…redictedaken incorrectly");

172 
´ediùedNÙTak’IncÜ»ù


173 .
	`Çme
(name() + ".predictedNotTakenIncorrect")

174 .
	`desc
("Number of brancheshat were…redicted‚otaken incorrectly");

176 
b¿nchMi¥»diùs


177 .
	`Çme
(name() + ".branchMispredicts")

178 .
	`desc
("Number of branch mispredicts detected‡tƒxecute");

180 
b¿nchMi¥»diùs
 = 
´ediùedTak’IncÜ»ù
 + 
´ediùedNÙTak’IncÜ»ù
;

182 
›wExecu‹dIn¡s


183 .
	`Çme
(name() + ".iewExecutedInsts")

184 .
	`desc
("Number ofƒxecuted instructions");

186 
›wExecLßdIn¡s


187 .
	`š™
(
ıu
->
numTh»ads
)

188 .
	`Çme
(name() + ".iewExecLoadInsts")

189 .
	`desc
("Number of†oad instructionsƒxecuted")

190 .
	`æags
(
tÙ®
);

192 
›wExecSquashedIn¡s


193 .
	`Çme
(name() + ".iewExecSquashedInsts")

194 .
	`desc
("Number of squashed instructions skipped inƒxecute");

196 
›wExecu‹dSwp


197 .
	`š™
(
ıu
->
numTh»ads
)

198 .
	`Çme
(name() + ".exec_swp")

199 .
	`desc
("number of swp instsƒxecuted")

200 .
	`æags
(
tÙ®
);

202 
›wExecu‹dNİ


203 .
	`š™
(
ıu
->
numTh»ads
)

204 .
	`Çme
(name() + ".exec_nop")

205 .
	`desc
("number of‚op instsƒxecuted")

206 .
	`æags
(
tÙ®
);

208 
›wExecu‹dRefs


209 .
	`š™
(
ıu
->
numTh»ads
)

210 .
	`Çme
(name() + ".exec_refs")

211 .
	`desc
("number of memory„eference instsƒxecuted")

212 .
	`æags
(
tÙ®
);

214 
›wExecu‹dB¿nches


215 .
	`š™
(
ıu
->
numTh»ads
)

216 .
	`Çme
(name() + ".exec_branches")

217 .
	`desc
("Number of branchesƒxecuted")

218 .
	`æags
(
tÙ®
);

220 
›wExecStÜeIn¡s


221 .
	`Çme
(name() + ".exec_stores")

222 .
	`desc
("Number of storesƒxecuted")

223 .
	`æags
(
tÙ®
);

224 
›wExecStÜeIn¡s
 = 
›wExecu‹dRefs
 - 
›wExecLßdIn¡s
;

226 
›wExecR©e


227 .
	`Çme
(name() + ".exec_rate")

228 .
	`desc
("Instƒxecution„ate")

229 .
	`æags
(
tÙ®
);

231 
›wExecR©e
 = 
›wExecu‹dIn¡s
 / 
ıu
->
numCyşes
;

233 
›wIn¡sToComm™


234 .
	`š™
(
ıu
->
numTh»ads
)

235 .
	`Çme
(name() + ".wb_sent")

236 .
	`desc
("cumulative count of insts sento commit")

237 .
	`æags
(
tÙ®
);

239 
wr™ebackCouÁ


240 .
	`š™
(
ıu
->
numTh»ads
)

241 .
	`Çme
(name() + ".wb_count")

242 .
	`desc
("cumulative count of insts written-back")

243 .
	`æags
(
tÙ®
);

245 
´oduûrIn¡


246 .
	`š™
(
ıu
->
numTh»ads
)

247 .
	`Çme
(name() + ".wb_producers")

248 .
	`desc
("num instructions…roducing‡ value")

249 .
	`æags
(
tÙ®
);

251 
cÚsum”In¡


252 .
	`š™
(
ıu
->
numTh»ads
)

253 .
	`Çme
(name() + ".wb_consumers")

254 .
	`desc
("num instructions consuming‡ value")

255 .
	`æags
(
tÙ®
);

257 
wbP’®ized


258 .
	`š™
(
ıu
->
numTh»ads
)

259 .
	`Çme
(name() + ".wb_penalized")

260 .
	`desc
("number of instrctions„equiredo writeo 'other' IQ")

261 .
	`æags
(
tÙ®
);

263 
wbP’®izedR©e


264 .
	`Çme
(name() + ".wb_penalized_rate")

265 .
	`desc
 ("fraction of instructions written-backhat wroteo 'other' IQ")

266 .
	`æags
(
tÙ®
);

268 
wbP’®izedR©e
 = 
wbP’®ized
 / 
wr™ebackCouÁ
;

270 
wbFªout


271 .
	`Çme
(name() + ".wb_fanout")

272 .
	`desc
("average fanout of values written-back")

273 .
	`æags
(
tÙ®
);

275 
wbFªout
 = 
´oduûrIn¡
 / 
cÚsum”In¡
;

277 
wbR©e


278 .
	`Çme
(name() + ".wb_rate")

279 .
	`desc
("insts written-back…er cycle")

280 .
	`æags
(
tÙ®
);

281 
wbR©e
 = 
wr™ebackCouÁ
 / 
ıu
->
numCyşes
;

282 
	}
}

284 
	g‹m¶©e
<
şass
 
	gIm¶
>

286 
	gDeçuÉIEW
<
	gIm¶
>::
	$¡¬tupSge
()

288 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

289 
toR’ame
->
›wInfo
[
tid
].
u£dIQ
 = 
Œue
;

290 
toR’ame
->
›wInfo
[
tid
].
ä“IQEÁr›s
 =

291 
š¡Queue
.
	`numF»eEÁr›s
(
tid
);

293 
toR’ame
->
›wInfo
[
tid
].
u£dLSQ
 = 
Œue
;

294 
toR’ame
->
›wInfo
[
tid
].
ä“LSQEÁr›s
 =

295 
ld¡Queue
.
	`numF»eEÁr›s
(
tid
);

299 ià(
ıu
->
check”
) {

300 
ıu
->
check”
->
	`£tDÿchePÜt
(&ıu->
	`g‘D©aPÜt
());

303 
ıu
->
	`aùiv©eSge
(
O3CPU
::
IEWIdx
);

304 
	}
}

306 
	g‹m¶©e
<
şass
 
	gIm¶
>

308 
	gDeçuÉIEW
<
	gIm¶
>::
£tTimeBufãr
(
TimeBufãr
<
TimeSŒuù
> *
tb_±r
)

310 
timeBufãr
 = 
tb_±r
;

313 
	gäomComm™
 = 
timeBufãr
->
g‘Wœe
(-
comm™ToIEWD–ay
);

316 
	gtoR’ame
 = 
timeBufãr
->
g‘Wœe
(0);

318 
	gtoF‘ch
 = 
timeBufãr
->
g‘Wœe
(0);

321 
	gš¡Queue
.
£tTimeBufãr
(
tb_±r
);

324 
	g‹m¶©e
<
şass
 
	gIm¶
>

326 
	gDeçuÉIEW
<
	gIm¶
>::
£tR’ameQueue
(
TimeBufãr
<
R’ameSŒuù
> *
rq_±r
)

328 
»ÇmeQueue
 = 
rq_±r
;

331 
	gäomR’ame
 = 
»ÇmeQueue
->
g‘Wœe
(-
»ÇmeToIEWD–ay
);

334 
	g‹m¶©e
<
şass
 
	gIm¶
>

336 
	gDeçuÉIEW
<
	gIm¶
>::
£tIEWQueue
(
TimeBufãr
<
IEWSŒuù
> *
iq_±r
)

338 
›wQueue
 = 
iq_±r
;

341 
	gtoComm™
 = 
›wQueue
->
g‘Wœe
(0);

344 
	g‹m¶©e
<
şass
 
	gIm¶
>

346 
	gDeçuÉIEW
<
	gIm¶
>::
£tAùiveTh»ads
(
li¡
<
Th»adID
> *
©_±r
)

348 
aùiveTh»ads
 = 
©_±r
;

350 
	gld¡Queue
.
£tAùiveTh»ads
(
©_±r
);

351 
	gš¡Queue
.
£tAùiveTh»ads
(
©_±r
);

354 
	g‹m¶©e
<
şass
 
	gIm¶
>

356 
	gDeçuÉIEW
<
	gIm¶
>::
	$£tScÜebßrd
(
ScÜebßrd
 *
sb_±r
)

358 
scÜebßrd
 = 
sb_±r
;

359 
	}
}

361 
	g‹m¶©e
 <
şass
 
	gIm¶
>

362 
boŞ


363 
	gDeçuÉIEW
<
	gIm¶
>::
	$isD¿šed
() const

365 
boŞ
 
	`d¿šed
(
ld¡Queue
.
	`isD¿šed
());

367 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

368 ià(!
š¡s
[
tid
].
	`em±y
()) {

369 
	`DPRINTF
(
D¿š
, "%i: In¡ nÙƒm±y.\n", 
tid
);

370 
d¿šed
 = 
çl£
;

372 ià(!
skidBufãr
[
tid
].
	`em±y
()) {

373 
	`DPRINTF
(
D¿š
, "%i: Skid bufã¸nÙƒm±y.\n", 
tid
);

374 
d¿šed
 = 
çl£
;

378  
d¿šed
;

379 
	}
}

381 
	g‹m¶©e
 <
şass
 
	gIm¶
>

383 
	gDeçuÉIEW
<
	gIm¶
>::
	$d¿šSª™yCheck
() const

385 
	`as£¹
(
	`isD¿šed
());

387 
š¡Queue
.
	`d¿šSª™yCheck
();

388 
ld¡Queue
.
	`d¿šSª™yCheck
();

389 
fuPoŞ
->
	`d¿šSª™yCheck
();

390 
	}
}

392 
	g‹m¶©e
 <
şass
 
	gIm¶
>

394 
	gDeçuÉIEW
<
	gIm¶
>::
	$keOv”From
()

397 
_¡©us
 = 
Aùive
;

398 
exeStus
 = 
RuÂšg
;

399 
wbStus
 = 
IdË
;

401 
š¡Queue
.
	`keOv”From
();

402 
ld¡Queue
.
	`keOv”From
();

403 
fuPoŞ
->
	`keOv”From
();

405 
	`¡¬tupSge
();

406 
ıu
->
	`aùiv™yThisCyşe
();

408 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

409 
di¥©chStus
[
tid
] = 
RuÂšg
;

410 
¡®ls
[
tid
].
comm™
 = 
çl£
;

411 
ãtchRedœeù
[
tid
] = 
çl£
;

414 
upd©eLSQNextCyşe
 = 
çl£
;

416 
i
 = 0; i < 
issueToExecQueue
.
	`g‘Size
(); ++i) {

417 
issueToExecQueue
.
	`advªû
();

419 
	}
}

421 
	g‹m¶©e
<
şass
 
	gIm¶
>

423 
	gDeçuÉIEW
<
	gIm¶
>::
	$squash
(
Th»adID
 
tid
)

425 
	`DPRINTF
(
IEW
, "[tid:%i]: Squashšg‡Î in¡ruùiÚs.\n", 
tid
);

428 
š¡Queue
.
	`squash
(
tid
);

431 
ld¡Queue
.
	`squash
(
äomComm™
->
comm™Info
[
tid
].
dÚeSeqNum
,id);

432 
upd©edQueues
 = 
Œue
;

435 
	`DPRINTF
(
IEW
, "[tid:%i]: Removing skidbuffer instructions until [sn:%i].\n",

436 
tid
, 
äomComm™
->
comm™Info
[tid].
dÚeSeqNum
);

438 !
skidBufãr
[
tid
].
	`em±y
()) {

439 ià(
skidBufãr
[
tid
].
	`äÚt
()->
	`isLßd
() ||

440 
skidBufãr
[
tid
].
	`äÚt
()->
	`isStÜe
() ) {

441 
toR’ame
->
›wInfo
[
tid
].
di¥©chedToLSQ
++;

444 
toR’ame
->
›wInfo
[
tid
].
di¥©ched
++;

446 
skidBufãr
[
tid
].
	`pİ
();

449 
	`em±yR’ameIn¡s
(
tid
);

450 
	}
}

452 
	g‹m¶©e
<
şass
 
	gIm¶
>

454 
	gDeçuÉIEW
<
	gIm¶
>::
	$squashDueToB¿nch
(
DynIn¡PŒ
 &
š¡
, 
Th»adID
 
tid
)

456 
	`DPRINTF
(
IEW
, "[tid:%i]: Squashing from‡ specific instruction, PC: %s "

457 "[¢:%i].\n", 
tid
, 
š¡
->
	`pcS‹
(), in¡->
£qNum
);

459 ià(
toComm™
->
squash
[
tid
] =ğ
çl£
 ||

460 
š¡
->
£qNum
 < 
toComm™
->
squashedSeqNum
[
tid
]) {

461 
toComm™
->
squash
[
tid
] = 
Œue
;

462 
toComm™
->
squashedSeqNum
[
tid
] = 
š¡
->
£qNum
;

463 
toComm™
->
b¿nchTak’
[
tid
] = 
š¡
->
	`pcS‹
().
	`b¿nchšg
();

465 
TheISA
::
PCS‹
 
pc
 = 
š¡
->
	`pcS‹
();

466 
TheISA
::
	`advªûPC
(
pc
, 
š¡
->
¡©icIn¡
);

468 
toComm™
->
pc
[
tid
] =…c;

469 
toComm™
->
mi¥»diùIn¡
[
tid
] = 
š¡
;

470 
toComm™
->
šşudeSquashIn¡
[
tid
] = 
çl£
;

472 
wrÙeToTimeBufãr
 = 
Œue
;

475 
	}
}

477 
	g‹m¶©e
<
şass
 
	gIm¶
>

479 
	gDeçuÉIEW
<
	gIm¶
>::
	$squashDueToMemOrd”
(
DynIn¡PŒ
 &
š¡
, 
Th»adID
 
tid
)

481 
	`DPRINTF
(
IEW
, "[tid:%i]: Memory violation, squashing violator‡nd younger "

482 "š¡s, PC: % [¢:%i].\n", 
tid
, 
š¡
->
	`pcS‹
(), in¡->
£qNum
);

489 ià(
toComm™
->
squash
[
tid
] =ğ
çl£
 ||

490 
š¡
->
£qNum
 <ğ
toComm™
->
squashedSeqNum
[
tid
]) {

491 
toComm™
->
squash
[
tid
] = 
Œue
;

493 
toComm™
->
squashedSeqNum
[
tid
] = 
š¡
->
£qNum
;

494 
toComm™
->
pc
[
tid
] = 
š¡
->
	`pcS‹
();

495 
toComm™
->
mi¥»diùIn¡
[
tid
] = 
NULL
;

498 
toComm™
->
šşudeSquashIn¡
[
tid
] = 
Œue
;

500 
wrÙeToTimeBufãr
 = 
Œue
;

502 
	}
}

504 
	g‹m¶©e
<
şass
 
	gIm¶
>

506 
	gDeçuÉIEW
<
	gIm¶
>::
	$squashDueToMemBlocked
(
DynIn¡PŒ
 &
š¡
, 
Th»adID
 
tid
)

508 
	`DPRINTF
(
IEW
, "[tid:%i]: Memory blocked, squashing†oad‡nd younger insts, "

509 "PC: % [¢:%i].\n", 
tid
, 
š¡
->
	`pcS‹
(), in¡->
£qNum
);

510 ià(
toComm™
->
squash
[
tid
] =ğ
çl£
 ||

511 
š¡
->
£qNum
 < 
toComm™
->
squashedSeqNum
[
tid
]) {

512 
toComm™
->
squash
[
tid
] = 
Œue
;

514 
toComm™
->
squashedSeqNum
[
tid
] = 
š¡
->
£qNum
;

515 
toComm™
->
pc
[
tid
] = 
š¡
->
	`pcS‹
();

516 
toComm™
->
mi¥»diùIn¡
[
tid
] = 
NULL
;

519 
toComm™
->
šşudeSquashIn¡
[
tid
] = 
Œue
;

521 
ld¡Queue
.
	`£tLßdBlockedHªdËd
(
tid
);

523 
wrÙeToTimeBufãr
 = 
Œue
;

525 
	}
}

527 
	g‹m¶©e
<
şass
 
	gIm¶
>

529 
	gDeçuÉIEW
<
	gIm¶
>::
	$block
(
Th»adID
 
tid
)

531 
	`DPRINTF
(
IEW
, "[tid:%u]: Blockšg.\n", 
tid
);

533 ià(
di¥©chStus
[
tid
] !ğ
Blocked
 &&

534 
di¥©chStus
[
tid
] !ğ
Unblockšg
) {

535 
toR’ame
->
›wBlock
[
tid
] = 
Œue
;

536 
wrÙeToTimeBufãr
 = 
Œue
;

541 
	`skidIn£¹
(
tid
);

543 
di¥©chStus
[
tid
] = 
Blocked
;

544 
	}
}

546 
	g‹m¶©e
<
şass
 
	gIm¶
>

548 
	gDeçuÉIEW
<
	gIm¶
>::
	$unblock
(
Th»adID
 
tid
)

550 
	`DPRINTF
(
IEW
, "[tid:%i]: Reading instructions out ofhe skid "

551 "bufã¸%u.\n",
tid
,id);

555 ià(
skidBufãr
[
tid
].
	`em±y
()) {

556 
toR’ame
->
›wUnblock
[
tid
] = 
Œue
;

557 
wrÙeToTimeBufãr
 = 
Œue
;

558 
	`DPRINTF
(
IEW
, "[tid:%i]: DÚunblockšg.\n",
tid
);

559 
di¥©chStus
[
tid
] = 
RuÂšg
;

561 
	}
}

563 
	g‹m¶©e
<
şass
 
	gIm¶
>

565 
	gDeçuÉIEW
<
	gIm¶
>::
	$wakeD•’d’ts
(
DynIn¡PŒ
 &
š¡
)

567 
š¡Queue
.
	`wakeD•’d’ts
(
š¡
);

568 
	}
}

570 
	g‹m¶©e
<
şass
 
	gIm¶
>

572 
	gDeçuÉIEW
<
	gIm¶
>::
	$»scheduËMemIn¡
(
DynIn¡PŒ
 &
š¡
)

574 
š¡Queue
.
	`»scheduËMemIn¡
(
š¡
);

575 
	}
}

577 
	g‹m¶©e
<
şass
 
	gIm¶
>

579 
	gDeçuÉIEW
<
	gIm¶
>::
	$»¶ayMemIn¡
(
DynIn¡PŒ
 &
š¡
)

581 
š¡Queue
.
	`»¶ayMemIn¡
(
š¡
);

582 
	}
}

584 
	g‹m¶©e
<
şass
 
	gIm¶
>

586 
	gDeçuÉIEW
<
	gIm¶
>::
	$š¡ToComm™
(
DynIn¡PŒ
 &
š¡
)

598 (*
›wQueue
)[
wbCyşe
].
š¡s
[
wbNumIn¡
]) {

599 ++
wbNumIn¡
;

600 ià(
wbNumIn¡
 =ğ
wbWidth
) {

601 ++
wbCyşe
;

602 
wbNumIn¡
 = 0;

605 
	`as£¹
((
wbCyşe
 * 
wbWidth
 + 
wbNumIn¡
è<ğ
wbMax
);

608 
	`DPRINTF
(
IEW
, "Current wb cycle: %i, width: %i,‚umInst: %i\nwbActual:%i\n",

609 
wbCyşe
, 
wbWidth
, 
wbNumIn¡
, wbCycle * wbWidth + wbNumInst);

611 (*
›wQueue
)[
wbCyşe
].
š¡s
[
wbNumIn¡
] = 
š¡
;

612 (*
›wQueue
)[
wbCyşe
].
size
++;

613 
	}
}

615 
	g‹m¶©e
 <
şass
 
	gIm¶
>

617 
	gDeçuÉIEW
<
	gIm¶
>::
	$v®idIn¡sFromR’ame
()

619 
š¡_couÁ
 = 0;

621 
i
=0; i<
äomR’ame
->
size
; i++) {

622 ià(!
äomR’ame
->
š¡s
[
i
]->
	`isSquashed
())

623 
š¡_couÁ
++;

626  
š¡_couÁ
;

627 
	}
}

629 
	g‹m¶©e
<
şass
 
	gIm¶
>

631 
	gDeçuÉIEW
<
	gIm¶
>::
	$skidIn£¹
(
Th»adID
 
tid
)

633 
DynIn¡PŒ
 
š¡
 = 
NULL
;

635 !
š¡s
[
tid
].
	`em±y
()) {

636 
š¡
 = 
š¡s
[
tid
].
	`äÚt
();

638 
š¡s
[
tid
].
	`pİ
();

640 
	`DPRINTF
(
Decode
,"[tid:%i]: Inserting [sn:%lli] PC:%s into "

641 "di¥©ch skidBufã¸%i\n",
tid
, 
š¡
->
£qNum
,

642 
š¡
->
	`pcS‹
(),
tid
);

644 
skidBufãr
[
tid
].
	`push
(
š¡
);

647 
	`as£¹
(
skidBufãr
[
tid
].
	`size
(è<ğ
skidBufãrMax
 &&

649 
	}
}

651 
	g‹m¶©e
<
şass
 
	gIm¶
>

653 
	gDeçuÉIEW
<
	gIm¶
>::
	$skidCouÁ
()

655 
max
=0;

657 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

658 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

660 
th»ads
 !ğ
’d
) {

661 
Th»adID
 
tid
 = *
th»ads
++;

662 
th»ad_couÁ
 = 
skidBufãr
[
tid
].
	`size
();

663 ià(
max
 < 
th»ad_couÁ
)

664 
max
 = 
th»ad_couÁ
;

667  
max
;

668 
	}
}

670 
	g‹m¶©e
<
şass
 
	gIm¶
>

671 
boŞ


672 
	gDeçuÉIEW
<
	gIm¶
>::
	$skidsEm±y
()

674 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

675 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

677 
th»ads
 !ğ
’d
) {

678 
Th»adID
 
tid
 = *
th»ads
++;

680 ià(!
skidBufãr
[
tid
].
	`em±y
())

681  
çl£
;

684  
Œue
;

685 
	}
}

687 
	g‹m¶©e
 <
şass
 
	gIm¶
>

689 
	gDeçuÉIEW
<
	gIm¶
>::
	$upd©eStus
()

691 
boŞ
 
ªy_unblockšg
 = 
çl£
;

693 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

694 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

696 
th»ads
 !ğ
’d
) {

697 
Th»adID
 
tid
 = *
th»ads
++;

699 ià(
di¥©chStus
[
tid
] =ğ
Unblockšg
) {

700 
ªy_unblockšg
 = 
Œue
;

708 
š¡Queue
.
štIn¡QueueR—ds
++;

709 ià(
_¡©us
 =ğ
Aùive
 && !
š¡Queue
.
	`hasR—dyIn¡s
() &&

710 !
ld¡Queue
.
	`wlWB
(è&& !
ªy_unblockšg
) {

711 
	`DPRINTF
(
IEW
, "IEW switchingo idle\n");

713 
	`d—ùiv©eSge
();

715 
_¡©us
 = 
IÇùive
;

716 } ià(
_¡©us
 =ğ
IÇùive
 && (
š¡Queue
.
	`hasR—dyIn¡s
() ||

717 
ld¡Queue
.
	`wlWB
() ||

718 
ªy_unblockšg
)) {

720 
	`DPRINTF
(
IEW
, "IEW switchingo‡ctive\n");

722 
	`aùiv©eSge
();

724 
_¡©us
 = 
Aùive
;

726 
	}
}

728 
	g‹m¶©e
 <
şass
 
	gIm¶
>

730 
	gDeçuÉIEW
<
	gIm¶
>::
	$»£tEÁr›s
()

732 
š¡Queue
.
	`»£tEÁr›s
();

733 
ld¡Queue
.
	`»£tEÁr›s
();

734 
	}
}

736 
	g‹m¶©e
 <
şass
 
	gIm¶
>

738 
	gDeçuÉIEW
<
	gIm¶
>::
	$»adSÎSigÇls
(
Th»adID
 
tid
)

740 ià(
äomComm™
->
comm™Block
[
tid
]) {

741 
¡®ls
[
tid
].
comm™
 = 
Œue
;

744 ià(
äomComm™
->
comm™Unblock
[
tid
]) {

745 
	`as£¹
(
¡®ls
[
tid
].
comm™
);

746 
¡®ls
[
tid
].
comm™
 = 
çl£
;

748 
	}
}

750 
	g‹m¶©e
 <
şass
 
	gIm¶
>

751 
boŞ


752 
	gDeçuÉIEW
<
	gIm¶
>::
	$checkSÎ
(
Th»adID
 
tid
)

754 
boŞ
 
	`»t_v®
(
çl£
);

756 ià(
¡®ls
[
tid
].
comm™
) {

757 
	`DPRINTF
(
IEW
,"[tid:%i]: SÎ from Comm™ sgd‘eùed.\n",
tid
);

758 
»t_v®
 = 
Œue
;

759 } ià(
š¡Queue
.
	`isFuÎ
(
tid
)) {

760 
	`DPRINTF
(
IEW
,"[tid:%i]: SÎ: IQ i fuÎ.\n",
tid
);

761 
»t_v®
 = 
Œue
;

762 } ià(
ld¡Queue
.
	`isFuÎ
(
tid
)) {

763 
	`DPRINTF
(
IEW
,"[tid:%i]: SÎ: LSQ i fuÎ\n",
tid
);

765 ià(
ld¡Queue
.
	`numLßds
(
tid
) > 0 ) {

767 
	`DPRINTF
(
IEW
,"[tid:%i]: LSQ oldest†oad: [sn:%i] \n",

768 
tid
,
ld¡Queue
.
	`g‘LßdH—dSeqNum
(tid));

771 ià(
ld¡Queue
.
	`numStÜes
(
tid
) > 0) {

773 
	`DPRINTF
(
IEW
,"[tid:%i]: LSQ oldest store: [sn:%i] \n",

774 
tid
,
ld¡Queue
.
	`g‘StÜeH—dSeqNum
(tid));

777 
»t_v®
 = 
Œue
;

778 } ià(
ld¡Queue
.
	`isSÎed
(
tid
)) {

779 
	`DPRINTF
(
IEW
,"[tid:%i]: SÎ: LSQ sÎ d‘eùed.\n",
tid
);

780 
»t_v®
 = 
Œue
;

783  
»t_v®
;

784 
	}
}

786 
	g‹m¶©e
 <
şass
 
	gIm¶
>

788 
	gDeçuÉIEW
<
	gIm¶
>::
	$checkSigÇlsAndUpd©e
(
Th»adID
 
tid
)

797 
	`»adSÎSigÇls
(
tid
);

799 ià(
äomComm™
->
comm™Info
[
tid
].
squash
) {

800 
	`squash
(
tid
);

802 ià(
di¥©chStus
[
tid
] =ğ
Blocked
 ||

803 
di¥©chStus
[
tid
] =ğ
Unblockšg
) {

804 
toR’ame
->
›wUnblock
[
tid
] = 
Œue
;

805 
wrÙeToTimeBufãr
 = 
Œue
;

808 
di¥©chStus
[
tid
] = 
Squashšg
;

809 
ãtchRedœeù
[
tid
] = 
çl£
;

813 ià(
äomComm™
->
comm™Info
[
tid
].
robSquashšg
) {

814 
	`DPRINTF
(
IEW
, "[tid:%i]: ROB i ¡Èsquashšg.\n", 
tid
);

816 
di¥©chStus
[
tid
] = 
Squashšg
;

817 
	`em±yR’ameIn¡s
(
tid
);

818 
wrÙeToTimeBufãr
 = 
Œue
;

822 ià(
	`checkSÎ
(
tid
)) {

823 
	`block
(
tid
);

824 
di¥©chStus
[
tid
] = 
Blocked
;

828 ià(
di¥©chStus
[
tid
] =ğ
Blocked
) {

831 
	`DPRINTF
(
IEW
, "[tid:%i]: Done blocking, switchingo unblocking.\n",

832 
tid
);

834 
di¥©chStus
[
tid
] = 
Unblockšg
;

836 
	`unblock
(
tid
);

841 ià(
di¥©chStus
[
tid
] =ğ
Squashšg
) {

844 
	`DPRINTF
(
IEW
, "[tid:%i]: Done squashing, switchingo„unning.\n",

845 
tid
);

847 
di¥©chStus
[
tid
] = 
RuÂšg
;

851 
	}
}

853 
	g‹m¶©e
 <
şass
 
	gIm¶
>

855 
	gDeçuÉIEW
<
	gIm¶
>::
	$sÜtIn¡s
()

857 
š¡s_äom_»Çme
 = 
äomR’ame
->
size
;

858 #ifdeà
DEBUG


859 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++)

860 
	`as£¹
(
š¡s
[
tid
].
	`em±y
());

862 
i
 = 0; i < 
š¡s_äom_»Çme
; ++i) {

863 
š¡s
[
äomR’ame
->š¡s[
i
]->
th»adNumb”
].
	`push
(fromRename->insts[i]);

865 
	}
}

867 
	g‹m¶©e
 <
şass
 
	gIm¶
>

869 
	gDeçuÉIEW
<
	gIm¶
>::
	$em±yR’ameIn¡s
(
Th»adID
 
tid
)

871 
	`DPRINTF
(
IEW
, "[tid:%i]: Removšg incomšg„’amš¡ruùiÚs\n", 
tid
);

873 !
š¡s
[
tid
].
	`em±y
()) {

875 ià(
š¡s
[
tid
].
	`äÚt
()->
	`isLßd
() ||

876 
š¡s
[
tid
].
	`äÚt
()->
	`isStÜe
() ) {

877 
toR’ame
->
›wInfo
[
tid
].
di¥©chedToLSQ
++;

880 
toR’ame
->
›wInfo
[
tid
].
di¥©ched
++;

882 
š¡s
[
tid
].
	`pİ
();

884 
	}
}

886 
	g‹m¶©e
 <
şass
 
	gIm¶
>

888 
	gDeçuÉIEW
<
	gIm¶
>::
	$wakeCPU
()

890 
ıu
->
	`wakeCPU
();

891 
	}
}

893 
	g‹m¶©e
 <
şass
 
	gIm¶
>

895 
	gDeçuÉIEW
<
	gIm¶
>::
	$aùiv™yThisCyşe
()

897 
	`DPRINTF
(
Aùiv™y
, "Activityhis cycle.\n");

898 
ıu
->
	`aùiv™yThisCyşe
();

899 
	}
}

901 
	g‹m¶©e
 <
şass
 
	gIm¶
>

902 
šlše
 

903 
	gDeçuÉIEW
<
	gIm¶
>::
	$aùiv©eSge
()

905 
	`DPRINTF
(
Aùiv™y
, "Activating stage.\n");

906 
ıu
->
	`aùiv©eSge
(
O3CPU
::
IEWIdx
);

907 
	}
}

909 
	g‹m¶©e
 <
şass
 
	gIm¶
>

910 
šlše
 

911 
	gDeçuÉIEW
<
	gIm¶
>::
	$d—ùiv©eSge
()

913 
	`DPRINTF
(
Aùiv™y
, "Deactivating stage.\n");

914 
ıu
->
	`d—ùiv©eSge
(
O3CPU
::
IEWIdx
);

915 
	}
}

917 
	g‹m¶©e
<
şass
 
	gIm¶
>

919 
	gDeçuÉIEW
<
	gIm¶
>::
	$di¥©ch
(
Th»adID
 
tid
)

928 ià(
di¥©chStus
[
tid
] =ğ
Blocked
) {

929 ++
›wBlockCyşes
;

931 } ià(
di¥©chStus
[
tid
] =ğ
Squashšg
) {

932 ++
›wSquashCyşes
;

937 ià(
di¥©chStus
[
tid
] =ğ
RuÂšg
 ||

938 
di¥©chStus
[
tid
] =ğ
IdË
) {

939 
	`DPRINTF
(
IEW
, "[tid:%i] Not blocked, so‡ttemptingo„un "

940 "di¥©ch.\n", 
tid
);

942 
	`di¥©chIn¡s
(
tid
);

943 } ià(
di¥©chStus
[
tid
] =ğ
Unblockšg
) {

946 
	`as£¹
(!
	`skidsEm±y
());

951 
	`di¥©chIn¡s
(
tid
);

953 ++
›wUnblockCyşes
;

955 ià(
	`v®idIn¡sFromR’ame
()) {

958 
	`skidIn£¹
(
tid
);

961 
	`unblock
(
tid
);

963 
	}
}

965 
	g‹m¶©e
 <
şass
 
	gIm¶
>

967 
	gDeçuÉIEW
<
	gIm¶
>::
	$di¥©chIn¡s
(
Th»adID
 
tid
)

971 
¡d
::
queue
<
DynIn¡PŒ
> &
š¡s_to_di¥©ch
 =

972 
di¥©chStus
[
tid
] =ğ
Unblockšg
 ?

973 
skidBufãr
[
tid
] : 
š¡s
[tid];

975 
š¡s_to_add
 = 
š¡s_to_di¥©ch
.
	`size
();

977 
DynIn¡PŒ
 
š¡
;

978 
boŞ
 
add_to_iq
 = 
çl£
;

979 
dis_num_š¡
 = 0;

983  ; 
dis_num_š¡
 < 
š¡s_to_add
 &&

984 
dis_num_š¡
 < 
di¥©chWidth
;

985 ++
dis_num_š¡
)

987 
š¡
 = 
š¡s_to_di¥©ch
.
	`äÚt
();

989 ià(
di¥©chStus
[
tid
] =ğ
Unblockšg
) {

990 
	`DPRINTF
(
IEW
, "[tid:%i]: Issue: Examining instruction from skid "

991 "bufãr\n", 
tid
);

995 
	`as£¹
(
š¡
);

997 
	`DPRINTF
(
IEW
, "[tid:%i]: Issue: Adding PC %s [sn:%lli] [tid:%i]o "

999 
tid
, 
š¡
->
	`pcS‹
(), in¡->
£qNum
, in¡->
th»adNumb”
);

1006 ià(
š¡
->
	`isSquashed
()) {

1007 
	`DPRINTF
(
IEW
, "[tid:%i]: Issue: Squashed instructionƒncountered, "

1008 "nÙ‡ddšgØIQ.\n", 
tid
);

1010 ++
›wDi¥SquashedIn¡s
;

1012 
š¡s_to_di¥©ch
.
	`pİ
();

1015 ià(
š¡
->
	`isLßd
(è|| in¡->
	`isStÜe
()) {

1016 
toR’ame
->
›wInfo
[
tid
].
di¥©chedToLSQ
++;

1018 
toR’ame
->
›wInfo
[
tid
].
di¥©ched
++;

1024 ià(
š¡Queue
.
	`isFuÎ
(
tid
)) {

1025 
	`DPRINTF
(
IEW
, "[tid:%i]: Issue: IQ ha becomfuÎ.\n", 
tid
);

1028 
	`block
(
tid
);

1033 
toR’ame
->
›wUnblock
[
tid
] = 
çl£
;

1035 ++
›wIQFuÎEv’ts
;

1037 } ià(
ld¡Queue
.
	`isFuÎ
(
tid
)) {

1038 
	`DPRINTF
(
IEW
, "[tid:%i]: Issue: LSQ ha becomfuÎ.\n",
tid
);

1041 
	`block
(
tid
);

1046 
toR’ame
->
›wUnblock
[
tid
] = 
çl£
;

1048 ++
›wLSQFuÎEv’ts
;

1053 ià(
š¡
->
	`isLßd
()) {

1054 
	`DPRINTF
(
IEW
, "[tid:%i]: Issue: Memory instruction "

1055 "’couÁ”ed,‡ddšgØLSQ.\n", 
tid
);

1059 
ld¡Queue
.
	`š£¹Lßd
(
š¡
);

1061 ++
›wDi¥LßdIn¡s
;

1063 
add_to_iq
 = 
Œue
;

1065 
toR’ame
->
›wInfo
[
tid
].
di¥©chedToLSQ
++;

1066 } ià(
š¡
->
	`isStÜe
()) {

1067 
	`DPRINTF
(
IEW
, "[tid:%i]: Issue: Memory instruction "

1068 "’couÁ”ed,‡ddšgØLSQ.\n", 
tid
);

1070 
ld¡Queue
.
	`š£¹StÜe
(
š¡
);

1072 ++
›wDi¥StÜeIn¡s
;

1074 ià(
š¡
->
	`isStÜeCÚd™iÚ®
()) {

1079 
š¡
->
	`£tCªComm™
();

1080 
š¡Queue
.
	`š£¹NÚS³c
(
š¡
);

1081 
add_to_iq
 = 
çl£
;

1083 ++
›wDi¥NÚS³cIn¡s
;

1085 
add_to_iq
 = 
Œue
;

1088 
toR’ame
->
›wInfo
[
tid
].
di¥©chedToLSQ
++;

1089 } ià(
š¡
->
	`isMemB¬r›r
(è|| in¡->
	`isWr™eB¬r›r
()) {

1091 
š¡
->
	`£tCªComm™
();

1092 
š¡Queue
.
	`š£¹B¬r›r
(
š¡
);

1093 
add_to_iq
 = 
çl£
;

1094 } ià(
š¡
->
	`isNİ
()) {

1095 
	`DPRINTF
(
IEW
, "[tid:%i]: Issue: Nop instructionƒncountered, "

1096 "skpšg.\n", 
tid
);

1098 
š¡
->
	`£tIssued
();

1099 
š¡
->
	`£tExecu‹d
();

1100 
š¡
->
	`£tCªComm™
();

1102 
š¡Queue
.
	`»cÜdProduûr
(
š¡
);

1104 
›wExecu‹dNİ
[
tid
]++;

1106 
add_to_iq
 = 
çl£
;

1107 } ià(
š¡
->
	`isExecu‹d
()) {

1108 
	`as£¹
(0 && "Instruction shouldn't beƒxecuted.\n");

1109 
	`DPRINTF
(
IEW
, "Issue: Executed branchƒncountered, "

1112 
š¡
->
	`£tIssued
();

1113 
š¡
->
	`£tCªComm™
();

1115 
š¡Queue
.
	`»cÜdProduûr
(
š¡
);

1117 
add_to_iq
 = 
çl£
;

1119 
add_to_iq
 = 
Œue
;

1121 ià(
š¡
->
	`isNÚS³cuÏtive
()) {

1122 
	`DPRINTF
(
IEW
, "[tid:%i]: Issue: Nonspeculative instruction "

1123 "’couÁ”ed, skpšg.\n", 
tid
);

1126 
š¡
->
	`£tCªComm™
();

1129 
š¡Queue
.
	`š£¹NÚS³c
(
š¡
);

1131 ++
›wDi¥NÚS³cIn¡s
;

1133 
add_to_iq
 = 
çl£
;

1138 ià(
add_to_iq
) {

1139 
š¡Queue
.
	`š£¹
(
š¡
);

1142 
š¡s_to_di¥©ch
.
	`pİ
();

1144 
toR’ame
->
›wInfo
[
tid
].
di¥©ched
++;

1146 ++
›wDi¥©chedIn¡s
;

1148 #ià
TRACING_ON


1149 
š¡
->
di¥©chTick
 = 
	`curTick
(è- in¡->
ãtchTick
;

1153 ià(!
š¡s_to_di¥©ch
.
	`em±y
()) {

1154 
	`DPRINTF
(
IEW
,"[tid:%i]: Issue: Bªdwidth FuÎ. Blockšg.\n", 
tid
);

1155 
	`block
(
tid
);

1156 
toR’ame
->
›wUnblock
[
tid
] = 
çl£
;

1159 ià(
di¥©chStus
[
tid
] =ğ
IdË
 && 
dis_num_š¡
) {

1160 
di¥©chStus
[
tid
] = 
RuÂšg
;

1162 
upd©edQueues
 = 
Œue
;

1165 
dis_num_š¡
 = 0;

1166 
	}
}

1168 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1170 
	gDeçuÉIEW
<
	gIm¶
>::
	$´štAvaabËIn¡s
()

1172 
š¡
 = 0;

1174 
¡d
::
cout
 << "Available Instructions: ";

1176 
äomIssue
->
š¡s
[
š¡
]) {

1178 ià(
š¡
%3==0è
¡d
::
cout
 << "\n\t";

1180 
¡d
::
cout
 << "PC: " << 
äomIssue
->
š¡s
[
š¡
]->
	`pcS‹
()

1181 << " TN: " << 
äomIssue
->
š¡s
[
š¡
]->
th»adNumb”


1182 << " SN: " << 
äomIssue
->
š¡s
[
š¡
]->
£qNum
 << " | ";

1184 
š¡
++;

1188 
¡d
::
cout
 << "\n";

1189 
	}
}

1191 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1193 
	gDeçuÉIEW
<
	gIm¶
>::
	$execu‹In¡s
()

1195 
wbNumIn¡
 = 0;

1196 
wbCyşe
 = 0;

1198 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

1199 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

1201 
th»ads
 !ğ
’d
) {

1202 
Th»adID
 
tid
 = *
th»ads
++;

1203 
ãtchRedœeù
[
tid
] = 
çl£
;

1211 
š¡s_to_execu‹
 = 
äomIssue
->
size
;

1212 
š¡_num
 = 0;

1213 ; 
š¡_num
 < 
š¡s_to_execu‹
;

1214 ++
š¡_num
) {

1216 
	`DPRINTF
(
IEW
, "Execute: Executing instructions from IQ.\n");

1218 
DynIn¡PŒ
 
š¡
 = 
š¡Queue
.
	`g‘In¡ToExecu‹
();

1220 
	`DPRINTF
(
IEW
, "Execute: Processing PC %s, [tid:%i] [sn:%i].\n",

1221 
š¡
->
	`pcS‹
(), in¡->
th»adNumb”
,š¡->
£qNum
);

1224 ià(
š¡
->
	`isSquashed
()) {

1225 
	`DPRINTF
(
IEW
, "Execute: Instruction was squashed. PC: %s, [tid:%i]"

1226 " [¢:%i]\n", 
š¡
->
	`pcS‹
(), in¡->
th»adNumb”
,

1227 
š¡
->
£qNum
);

1231 
š¡
->
	`£tExecu‹d
();

1235 
š¡
->
	`£tCªComm™
();

1237 ++
›wExecSquashedIn¡s
;

1239 
	`deüWb
(
š¡
->
£qNum
);

1243 
FauÉ
 
çuÉ
 = 
NoFauÉ
;

1248 ià(
š¡
->
	`isMemRef
()) {

1249 
	`DPRINTF
(
IEW
, "Execute: Calculating‡ddress for memory "

1253 ià(
š¡
->
	`isLßd
()) {

1256 
çuÉ
 = 
ld¡Queue
.
	`execu‹Lßd
(
š¡
);

1258 ià(
š¡
->
	`isT¿n¦©iÚD–ayed
() &&

1259 
çuÉ
 =ğ
NoFauÉ
) {

1262 
	`DPRINTF
(
IEW
, "Execute: Delayedranslation, deferring "

1264 
š¡Queue
.
	`deãrMemIn¡
(
š¡
);

1268 ià(
š¡
->
	`isD©aP»ãtch
(è|| in¡->
	`isIn¡P»ãtch
()) {

1269 
š¡
->
çuÉ
 = 
NoFauÉ
;

1271 } ià(
š¡
->
	`isStÜe
()) {

1272 
çuÉ
 = 
ld¡Queue
.
	`execu‹StÜe
(
š¡
);

1274 ià(
š¡
->
	`isT¿n¦©iÚD–ayed
() &&

1275 
çuÉ
 =ğ
NoFauÉ
) {

1278 
	`DPRINTF
(
IEW
, "Execute: Delayedranslation, deferring "

1280 
š¡Queue
.
	`deãrMemIn¡
(
š¡
);

1285 ià(
çuÉ
 !ğ
NoFauÉ
 || 
š¡
->
	`»adP»diÿ‹
(è=ğ
çl£
 ||

1286 !
š¡
->
	`isStÜeCÚd™iÚ®
()) {

1291 
š¡
->
	`£tExecu‹d
();

1292 
	`š¡ToComm™
(
š¡
);

1293 
	`aùiv™yThisCyşe
();

1300 
	`·nic
("Unexpected memoryype!\n");

1308 ià(
š¡
->
	`g‘FauÉ
(è=ğ
NoFauÉ
) {

1309 
š¡
->
	`execu‹
();

1310 ià(
š¡
->
	`»adP»diÿ‹
(è=ğ
çl£
)

1311 
š¡
->
	`fÜw¬dOldRegs
();

1314 
š¡
->
	`£tExecu‹d
();

1316 
	`š¡ToComm™
(
š¡
);

1319 
	`upd©eExeIn¡Sts
(
š¡
);

1329 
Th»adID
 
tid
 = 
š¡
->
th»adNumb”
;

1331 ià(!
ãtchRedœeù
[
tid
] ||

1332 !
toComm™
->
squash
[
tid
] ||

1333 
toComm™
->
squashedSeqNum
[
tid
] > 
š¡
->
£qNum
) {

1337 
boŞ
 
lßdNÙExecu‹d
 = !
š¡
->
	`isExecu‹d
(è&& in¡->
	`isLßd
();

1339 ià(
š¡
->
	`mi¥»diùed
(è&& !
lßdNÙExecu‹d
) {

1340 
ãtchRedœeù
[
tid
] = 
Œue
;

1342 
	`DPRINTF
(
IEW
, "Execute: Branch mispredict detected.\n");

1343 
	`DPRINTF
(
IEW
, "Predictedarget was PC: %s.\n",

1344 
š¡
->
	`»adP»dT¬g
());

1345 
	`DPRINTF
(
IEW
, "Execute: Redirecting fetcho PC: %s.\n",

1346 
š¡
->
	`pcS‹
());

1348 
	`squashDueToB¿nch
(
š¡
, 
tid
);

1350 ià(
š¡
->
	`»adP»dTak’
()) {

1351 
´ediùedTak’IncÜ»ù
++;

1353 
´ediùedNÙTak’IncÜ»ù
++;

1355 } ià(
ld¡Queue
.
	`viŞ©iÚ
(
tid
)) {

1356 
	`as£¹
(
š¡
->
	`isMemRef
());

1360 
DynIn¡PŒ
 
viŞ©Ü
;

1361 
viŞ©Ü
 = 
ld¡Queue
.
	`g‘MemD•ViŞ©Ü
(
tid
);

1363 
	`DPRINTF
(
IEW
, "LDSTQ detected‡ violation. Violator PC: %s "

1365 
viŞ©Ü
->
	`pcS‹
(), viŞ©Ü->
£qNum
,

1366 
š¡
->
	`pcS‹
(), in¡->
£qNum
, in¡->
physEffAddr
);

1368 
ãtchRedœeù
[
tid
] = 
Œue
;

1371 
š¡Queue
.
	`viŞ©iÚ
(
š¡
, 
viŞ©Ü
);

1374 
	`squashDueToMemOrd”
(
viŞ©Ü
, 
tid
);

1376 ++
memOrd”ViŞ©iÚEv’ts
;

1377 } ià(
ld¡Queue
.
	`lßdBlocked
(
tid
) &&

1378 !
ld¡Queue
.
	`isLßdBlockedHªdËd
(
tid
)) {

1379 
ãtchRedœeù
[
tid
] = 
Œue
;

1381 
	`DPRINTF
(
IEW
, "Load operation couldn'tƒxecute becausehe "

1383 
š¡
->
	`pcS‹
(), in¡->
£qNum
);

1385 
	`squashDueToMemBlocked
(
š¡
, 
tid
);

1390 ià(
ld¡Queue
.
	`viŞ©iÚ
(
tid
)) {

1391 
	`as£¹
(
š¡
->
	`isMemRef
());

1393 
DynIn¡PŒ
 
viŞ©Ü
 = 
ld¡Queue
.
	`g‘MemD•ViŞ©Ü
(
tid
);

1395 
	`DPRINTF
(
IEW
, "LDSTQ detected‡ violation. Violator PC: "

1397 
viŞ©Ü
->
	`pcS‹
(), 
š¡
->pcState(),

1398 
š¡
->
physEffAddr
);

1399 
	`DPRINTF
(
IEW
, "Violation will‚ot be handled because "

1402 ++
memOrd”ViŞ©iÚEv’ts
;

1404 ià(
ld¡Queue
.
	`lßdBlocked
(
tid
) &&

1405 !
ld¡Queue
.
	`isLßdBlockedHªdËd
(
tid
)) {

1406 
	`DPRINTF
(
IEW
, "Load operation couldn'tƒxecute becausehe "

1408 
š¡
->
	`pcS‹
(), in¡->
£qNum
);

1409 
	`DPRINTF
(
IEW
, "Blocked†oad will‚ot be handled because "

1412 
ld¡Queue
.
	`£tLßdBlockedHªdËd
(
tid
);

1419 ià(
š¡_num
) {

1420 ià(
exeStus
 =ğ
IdË
) {

1421 
exeStus
 = 
RuÂšg
;

1424 
upd©edQueues
 = 
Œue
;

1426 
ıu
->
	`aùiv™yThisCyşe
();

1432 
wbNumIn¡
 = 0;

1434 
	}
}

1436 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1438 
	gDeçuÉIEW
<
	gIm¶
>::
	$wr™ebackIn¡s
()

1445 
š¡_num
 = 0; in¡_num < 
wbWidth
 &&

1446 
toComm™
->
š¡s
[
š¡_num
]; inst_num++) {

1447 
DynIn¡PŒ
 
š¡
 = 
toComm™
->
š¡s
[
š¡_num
];

1448 
Th»adID
 
tid
 = 
š¡
->
th»adNumb”
;

1450 
	`DPRINTF
(
IEW
, "Sending instructionso commit, [sn:%lli] PC %s.\n",

1451 
š¡
->
£qNum
, in¡->
	`pcS‹
());

1453 
›wIn¡sToComm™
[
tid
]++;

1460 ià(!
š¡
->
	`isSquashed
(è&& in¡->
	`isExecu‹d
(è&& in¡->
	`g‘FauÉ
(è=ğ
NoFauÉ
) {

1461 
d•’d’ts
 = 
š¡Queue
.
	`wakeD•’d’ts
(
š¡
);

1463 
i
 = 0; i < 
š¡
->
	`numDe¡Regs
(); i++) {

1465 
	`DPRINTF
(
IEW
,"Setting Destination Register %i\n",

1466 
š¡
->
	`»ÇmedDe¡RegIdx
(
i
));

1467 
scÜebßrd
->
	`£tReg
(
š¡
->
	`»ÇmedDe¡RegIdx
(
i
));

1470 ià(
d•’d’ts
) {

1471 
´oduûrIn¡
[
tid
]++;

1472 
cÚsum”In¡
[
tid
]+ğ
d•’d’ts
;

1474 
wr™ebackCouÁ
[
tid
]++;

1477 
	`deüWb
(
š¡
->
£qNum
);

1479 
	}
}

1481 
	g‹m¶©e
<
şass
 
	gIm¶
>

1483 
	gDeçuÉIEW
<
	gIm¶
>::
	$tick
()

1485 
wbNumIn¡
 = 0;

1486 
wbCyşe
 = 0;

1488 
wrÙeToTimeBufãr
 = 
çl£
;

1489 
upd©edQueues
 = 
çl£
;

1491 
	`sÜtIn¡s
();

1494 
fuPoŞ
->
	`´oûssF»eUn™s
();

1496 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

1497 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

1500 
th»ads
 !ğ
’d
) {

1501 
Th»adID
 
tid
 = *
th»ads
++;

1503 
	`DPRINTF
(
IEW
,"Issue: Proûssšg [tid:%i]\n",
tid
);

1505 
	`checkSigÇlsAndUpd©e
(
tid
);

1506 
	`di¥©ch
(
tid
);

1509 ià(
exeStus
 !ğ
Squashšg
) {

1510 
	`execu‹In¡s
();

1512 
	`wr™ebackIn¡s
();

1517 
š¡Queue
.
	`scheduËR—dyIn¡s
();

1521 
issueToExecQueue
.
	`advªû
();

1524 
boŞ
 
brßdÿ¡_ä“_’Œ›s
 = 
çl£
;

1526 ià(
upd©edQueues
 || 
exeStus
 =ğ
RuÂšg
 || 
upd©eLSQNextCyşe
) {

1527 
exeStus
 = 
IdË
;

1528 
upd©eLSQNextCyşe
 = 
çl£
;

1530 
brßdÿ¡_ä“_’Œ›s
 = 
Œue
;

1534 
ld¡Queue
.
	`wr™ebackStÜes
();

1541 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

1542 
th»ads
 !ğ
’d
) {

1543 
Th»adID
 
tid
 = (*
th»ads
++);

1545 
	`DPRINTF
(
IEW
,"Proûssšg [tid:%i]\n",
tid
);

1548 ià(
äomComm™
->
comm™Info
[
tid
].
dÚeSeqNum
 != 0 &&

1549 !
äomComm™
->
comm™Info
[
tid
].
squash
 &&

1550 !
äomComm™
->
comm™Info
[
tid
].
robSquashšg
) {

1552 
ld¡Queue
.
	`comm™StÜes
(
äomComm™
->
comm™Info
[
tid
].
dÚeSeqNum
,tid);

1554 
ld¡Queue
.
	`comm™Lßds
(
äomComm™
->
comm™Info
[
tid
].
dÚeSeqNum
,tid);

1556 
upd©eLSQNextCyşe
 = 
Œue
;

1557 
š¡Queue
.
	`comm™
(
äomComm™
->
comm™Info
[
tid
].
dÚeSeqNum
,tid);

1560 ià(
äomComm™
->
comm™Info
[
tid
].
nÚS³cSeqNum
 != 0) {

1563 ià(
äomComm™
->
comm™Info
[
tid
].
unÿched
) {

1564 
š¡Queue
.
	`»¶ayMemIn¡
(
äomComm™
->
comm™Info
[
tid
].
unÿchedLßd
);

1565 
äomComm™
->
comm™Info
[
tid
].
unÿchedLßd
->
	`£tAtComm™
();

1567 
š¡Queue
.
	`scheduËNÚS³c
(

1568 
äomComm™
->
comm™Info
[
tid
].
nÚS³cSeqNum
);

1572 ià(
brßdÿ¡_ä“_’Œ›s
) {

1573 
toF‘ch
->
›wInfo
[
tid
].
iqCouÁ
 =

1574 
š¡Queue
.
	`g‘CouÁ
(
tid
);

1575 
toF‘ch
->
›wInfo
[
tid
].
ld¡qCouÁ
 =

1576 
ld¡Queue
.
	`g‘CouÁ
(
tid
);

1578 
toR’ame
->
›wInfo
[
tid
].
u£dIQ
 = 
Œue
;

1579 
toR’ame
->
›wInfo
[
tid
].
ä“IQEÁr›s
 =

1580 
š¡Queue
.
	`numF»eEÁr›s
();

1581 
toR’ame
->
›wInfo
[
tid
].
u£dLSQ
 = 
Œue
;

1582 
toR’ame
->
›wInfo
[
tid
].
ä“LSQEÁr›s
 =

1583 
ld¡Queue
.
	`numF»eEÁr›s
(
tid
);

1585 
wrÙeToTimeBufãr
 = 
Œue
;

1588 
	`DPRINTF
(
IEW
, "[tid:%i], Dispatch dispatched %i instructions.\n",

1589 
tid
, 
toR’ame
->
›wInfo
[tid].
di¥©ched
);

1592 
	`DPRINTF
(
IEW
, "IQ has %i freeƒntries (Can schedule: %i). "

1594 
š¡Queue
.
	`numF»eEÁr›s
(), in¡Queue.
	`hasR—dyIn¡s
(),

1595 
ld¡Queue
.
	`numF»eEÁr›s
());

1597 
	`upd©eStus
();

1599 ià(
wrÙeToTimeBufãr
) {

1600 
	`DPRINTF
(
Aùiv™y
, "Activityhis cycle.\n");

1601 
ıu
->
	`aùiv™yThisCyşe
();

1603 
	}
}

1605 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1607 
	gDeçuÉIEW
<
	gIm¶
>::
	$upd©eExeIn¡Sts
(
DynIn¡PŒ
 &
š¡
)

1609 
Th»adID
 
tid
 = 
š¡
->
th»adNumb”
;

1611 
›wExecu‹dIn¡s
++;

1613 #ià
TRACING_ON


1614 
š¡
->
com¶‘eTick
 = 
	`curTick
(è- in¡->
ãtchTick
;

1620 ià(
š¡
->
	`isCÚŒŞ
())

1621 
›wExecu‹dB¿nches
[
tid
]++;

1626 ià(
š¡
->
	`isMemRef
()) {

1627 
›wExecu‹dRefs
[
tid
]++;

1629 ià(
š¡
->
	`isLßd
()) {

1630 
›wExecLßdIn¡s
[
tid
]++;

1633 
	}
}

1635 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1637 
	gDeçuÉIEW
<
	gIm¶
>::
	$checkMi¥»diùiÚ
(
DynIn¡PŒ
 &
š¡
)

1639 
Th»adID
 
tid
 = 
š¡
->
th»adNumb”
;

1641 ià(!
ãtchRedœeù
[
tid
] ||

1642 !
toComm™
->
squash
[
tid
] ||

1643 
toComm™
->
squashedSeqNum
[
tid
] > 
š¡
->
£qNum
) {

1645 ià(
š¡
->
	`mi¥»diùed
()) {

1646 
ãtchRedœeù
[
tid
] = 
Œue
;

1648 
	`DPRINTF
(
IEW
, "Execute: Branch mispredict detected.\n");

1649 
	`DPRINTF
(
IEW
, "Predictedarget was PC:%#x, NPC:%#x.\n",

1650 
š¡
->
	`´edIn¡Addr
(), in¡->
	`´edNextIn¡Addr
());

1651 
	`DPRINTF
(
IEW
, "Execute: Redirecting fetcho PC: %#x,"

1652 " NPC: %#x.\n", 
š¡
->
	`ÃxtIn¡Addr
(),

1653 
š¡
->
	`ÃxtIn¡Addr
());

1655 
	`squashDueToB¿nch
(
š¡
, 
tid
);

1657 ià(
š¡
->
	`»adP»dTak’
()) {

1658 
´ediùedTak’IncÜ»ù
++;

1660 
´ediùedNÙTak’IncÜ»ù
++;

1664 
	}
}

	@impl.hh

31 #iâdeà
__CPU_O3_IMPL_HH__


32 
	#__CPU_O3_IMPL_HH__


	)

34 
	~"¬ch/i§_Œa™s.hh
"

35 
	~"cÚfig/the_i§.hh
"

36 
	~"ıu/o3/ıu_pŞicy.hh
"

39 
	g‹m¶©e
 <
şass
 
	gIm¶
>

40 
şass
 
	gBa£O3DynIn¡
;

42 
	g‹m¶©e
 <
şass
 
	gIm¶
>

43 
şass
 
	gFuÎO3CPU
;

53 
	sO3CPUIm¶


56 
	mTheISA
::
	tMachIn¡
 MachInst;

59 
	mSim¶eCPUPŞicy
<
	tO3CPUIm¶
> 
	tCPUPŞ
;

62 
	mBa£O3DynIn¡
<
	tO3CPUIm¶
> 
	tDynIn¡
;

67 
	mRefCouÁšgPŒ
<
	tDynIn¡
> 
	tDynIn¡PŒ
;

70 
	mFuÎO3CPU
<
	tO3CPUIm¶
> 
	tO3CPU
;

76 
O3CPU
 
	tCPUTy³
;

79 
	mMaxWidth
 = 8,

80 
	mMaxTh»ads
 = 4

	@inst_queue.cc

31 
	~"ıu/o3/š¡_queue_im¶.hh
"

32 
	~"ıu/o3/i§_¥ecific.hh
"

35 
‹m¶©e
 
şass
 
	gIn¡ruùiÚQueue
<
	gO3CPUIm¶
>;

	@inst_queue.hh

43 #iâdeà
__CPU_O3_INST_QUEUE_HH__


44 
	#__CPU_O3_INST_QUEUE_HH__


	)

46 
	~<li¡
>

47 
	~<m­
>

48 
	~<queue
>

49 
	~<veùÜ
>

51 
	~"ba£/¡©i¡ics.hh
"

52 
	~"ba£/ty³s.hh
"

53 
	~"ıu/o3/d•_g¿ph.hh
"

54 
	~"ıu/š¡_£q.hh
"

55 
	~"ıu/İ_şass.hh
"

56 
	~"ıu/timebuf.hh
"

57 
	~"sim/ev’tq.hh
"

59 
	gD”ivO3CPUP¬ams
;

60 
şass
 
	gFUPoŞ
;

61 
şass
 
	gMemIÁ”çû
;

80 
	g‹m¶©e
 <
şass
 
	gIm¶
>

81 şas 
	cIn¡ruùiÚQueue


83 
	mpublic
:

85 
ty³Çme
 
	tIm¶
::
	tO3CPU
 O3CPU;

86 
ty³Çme
 
	tIm¶
::
	tDynIn¡PŒ
 DynInstPtr;

88 
ty³Çme
 
	tIm¶
::
	tCPUPŞ
::
	tIEW
 IEW;

89 
ty³Çme
 
	tIm¶
::
	tCPUPŞ
::
	tMemD•Un™
 MemDepUnit;

90 
ty³Çme
 
	tIm¶
::
	tCPUPŞ
::
	tIssueSŒuù
 IssueStruct;

91 
ty³Çme
 
	tIm¶
::
	tCPUPŞ
::
	tTimeSŒuù
 TimeStruct;

94 
ty³Çme
 
	t¡d
::
	tli¡
<
	tDynIn¡PŒ
>::
	t™”©Ü
 
	tLi¡It
;

97 şas 
	cFUCom¶‘iÚ
 : 
public
 
Ev’t
 {

98 
´iv©e
:

100 
DynIn¡PŒ
 
š¡
;

103 
	mfuIdx
;

106 
	mIn¡ruùiÚQueue
<
	mIm¶
> *
	miqPŒ
;

111 
boŞ
 
	mä“FU
;

113 
	mpublic
:

115 
FUCom¶‘iÚ
(
DynIn¡PŒ
 &
_š¡
, 
fu_idx
,

116 
In¡ruùiÚQueue
<
Im¶
> *
iq_±r
);

118 
	m¡d
::
¡ršg
 
g‘ObjeùId
() const

120  
iqPŒ
->
ıu
->
g‘ObjeùId
();

123 
vœtu®
 
´oûss
();

124 
vœtu®
 cÚ¡ *
desütiÚ
() const;

125 
£tF»eFU
(è{ 
	mä“FU
 = 
Œue
; }

129 
In¡ruùiÚQueue
(
O3CPU
 *
ıu_±r
, 
IEW
 *
›w_±r
, 
D”ivO3CPUP¬ams
 *
·¿ms
);

132 ~
In¡ruùiÚQueue
();

135 
	g¡d
::
¡ršg
 
	$Çme
() const;

138 
	`»gSts
();

141 
	`»£tS‹
();

144 
	`£tAùiveTh»ads
(
¡d
::
li¡
<
Th»adID
> *
©_±r
);

147 
	`£tIssueToExecu‹Queue
(
TimeBufãr
<
IssueSŒuù
> *
i2eQueue
);

150 
	`£tTimeBufãr
(
TimeBufãr
<
TimeSŒuù
> *
tb_±r
);

153 
	$d¿šSª™yCheck
() const;

156 
	`keOv”From
();

159 
	`’ŒyAmouÁ
(
Th»adID
 
num_th»ads
);

162 
	`»£tEÁr›s
();

165 
	`numF»eEÁr›s
();

168 
	`numF»eEÁr›s
(
Th»adID
 
tid
);

171 
boŞ
 
	`isFuÎ
();

174 
boŞ
 
	`isFuÎ
(
Th»adID
 
tid
);

177 
boŞ
 
	`hasR—dyIn¡s
();

180 
	`š£¹
(
DynIn¡PŒ
 &
Ãw_š¡
);

183 
	`š£¹NÚS³c
(
DynIn¡PŒ
 &
Ãw_š¡
);

188 
	`š£¹B¬r›r
(
DynIn¡PŒ
 &
b¬r_š¡
);

193 
DynIn¡PŒ
 
	`g‘In¡ToExecu‹
();

198 
DynIn¡PŒ
 
	`g‘Deã¼edMemIn¡ToExecu‹
();

204 
	$»cÜdProduûr
(
DynIn¡PŒ
 &
š¡
)

205 { 
	`addToProduûrs
(
š¡
); 
	}
}

208 
´oûssFUCom¶‘iÚ
(
DynIn¡PŒ
 &
š¡
, 
fu_idx
);

214 
scheduËR—dyIn¡s
();

217 
scheduËNÚS³c
(cÚ¡ 
In¡SeqNum
 &
š¡
);

223 
comm™
(cÚ¡ 
In¡SeqNum
 &
š¡
, 
Th»adID
 
tid
 = 0);

226 
wakeD•’d’ts
(
DynIn¡PŒ
 &
com¶‘ed_š¡
);

229 
addR—dyMemIn¡
(
DynIn¡PŒ
 &
»ady_š¡
);

235 
»scheduËMemIn¡
(
DynIn¡PŒ
 &
»sched_š¡
);

238 
»¶ayMemIn¡
(
DynIn¡PŒ
 &
»¶ay_š¡
);

241 
com¶‘eMemIn¡
(
DynIn¡PŒ
 &
com¶‘ed_š¡
);

247 
deãrMemIn¡
(
DynIn¡PŒ
 &
deã¼ed_š¡
);

250 
viŞ©iÚ
(
DynIn¡PŒ
 &
¡Üe
, DynIn¡PŒ &
çuÉšg_lßd
);

256 
squash
(
Th»adID
 
tid
);

259 
	$g‘CouÁ
(
Th»adID
 
tid
è{  
couÁ
[tid]; 
	}
};

262 
´štIn¡s
();

264 
	g´iv©e
:

266 
doSquash
(
Th»adID
 
tid
);

273 
O3CPU
 *
	gıu
;

276 
MemIÁ”çû
 *
	gdÿcheIÁ”çû
;

279 
IEW
 *
	g›wSge
;

284 
MemD•Un™
 
	gmemD•Un™
[
Im¶
::
MaxTh»ads
];

289 
	gTimeBufãr
<
	gIssueSŒuù
> *
	gissueToExecu‹Queue
;

292 
	gTimeBufãr
<
	gTimeSŒuù
> *
	gtimeBufãr
;

295 
ty³Çme
 
	gTimeBufãr
<
	gTimeSŒuù
>::
wœe
 
äomComm™
;

298 
FUPoŞ
 *
	gfuPoŞ
;

305 
	g¡d
::
li¡
<
DynIn¡PŒ
> 
š¡Li¡
[
Im¶
::
MaxTh»ads
];

308 
	g¡d
::
li¡
<
DynIn¡PŒ
> 
š¡sToExecu‹
;

313 
	g¡d
::
li¡
<
DynIn¡PŒ
> 
deã¼edMemIn¡s
;

322 
	spqCom·»
 {

323 
boŞ
 
İ”©Ü
(è(cÚ¡ 
	gDynIn¡PŒ
 &
	glhs
, cÚ¡ DynIn¡PŒ &
	grhs
) const

325  
	glhs
->
	g£qNum
 > 
	grhs
->seqNum;

329 
	g¡d
::
	t´iÜ™y_queue
<
	tDynIn¡PŒ
, 
	t¡d
::
	tveùÜ
<DynIn¡PŒ>, 
	tpqCom·»
>

330 
	tR—dyIn¡Queue
;

335 
R—dyIn¡Queue
 
	g»adyIn¡s
[
Num_OpCÏs£s
];

344 
	g¡d
::
m­
<
In¡SeqNum
, 
	gDynIn¡PŒ
> 
	gnÚS³cIn¡s
;

346 
ty³Çme
 
	t¡d
::
	tm­
<
	tIn¡SeqNum
, 
	tDynIn¡PŒ
>::
	t™”©Ü
 
	tNÚS³cM­It
;

349 
	sLi¡Ord”EÁry
 {

350 
OpCÏss
 
	gqueueTy³
;

351 
In¡SeqNum
 
	gŞde¡In¡
;

361 
	g¡d
::
li¡
<
Li¡Ord”EÁry
> 
li¡Ord”
;

363 
ty³Çme
 
	t¡d
::
	tli¡
<
	tLi¡Ord”EÁry
>::
	t™”©Ü
 
	tLi¡Ord”It
;

366 
boŞ
 
	gqueueOnLi¡
[
Num_OpCÏs£s
];

371 
Li¡Ord”It
 
	g»adyIt
[
Num_OpCÏs£s
];

374 
addToOrd”Li¡
(
OpCÏss
 
İ_şass
);

380 
moveToYoung”In¡
(
Li¡Ord”It
 
age_Üd”_™
);

382 
	gD•’d’cyG¿ph
<
	gDynIn¡PŒ
> 
	gd•’dG¿ph
;

389 
	eIQPŞicy
 {

390 
	gDyÇmic
,

391 
	gP¬t™iÚed
,

392 
	gTh»shŞd


396 
IQPŞicy
 
	giqPŞicy
;

399 
Th»adID
 
	gnumTh»ads
;

402 
	g¡d
::
li¡
<
Th»adID
> *
aùiveTh»ads
;

405 
	gcouÁ
[
Im¶
::
MaxTh»ads
];

408 
	gmaxEÁr›s
[
Im¶
::
MaxTh»ads
];

411 
	gä“EÁr›s
;

414 
	gnumEÁr›s
;

417 
	gtÙ®Width
;

420 
	gnumPhysRegs
;

423 
	gnumPhysIÁRegs
;

426 
	gnumPhysFlßtRegs
;

431 
Cyşes
 
	gcomm™ToIEWD–ay
;

434 
In¡SeqNum
 
	gsquashedSeqNum
[
Im¶
::
MaxTh»ads
];

442 
	g¡d
::
veùÜ
<
boŞ
> 
»gScÜebßrd
;

445 
boŞ
 
addToD•’d’ts
(
DynIn¡PŒ
 &
Ãw_š¡
);

448 
addToProduûrs
(
DynIn¡PŒ
 &
Ãw_š¡
);

451 
addIfR—dy
(
DynIn¡PŒ
 &
š¡
);

457 
couÁIn¡s
();

463 
dumpLi¡s
();

468 
dumpIn¡s
();

471 
	gSts
::
SÿÏr
 
iqIn¡sAdded
;

473 
	gSts
::
SÿÏr
 
iqNÚS³cIn¡sAdded
;

475 
	gSts
::
SÿÏr
 
iqIn¡sIssued
;

477 
	gSts
::
SÿÏr
 
iqIÁIn¡sIssued
;

479 
	gSts
::
SÿÏr
 
iqFlßtIn¡sIssued
;

481 
	gSts
::
SÿÏr
 
iqB¿nchIn¡sIssued
;

483 
	gSts
::
SÿÏr
 
iqMemIn¡sIssued
;

485 
	gSts
::
SÿÏr
 
iqMiscIn¡sIssued
;

487 
	gSts
::
SÿÏr
 
iqSquashedIn¡sIssued
;

489 
	gSts
::
SÿÏr
 
iqSquashedIn¡sExamšed
;

493 
	gSts
::
SÿÏr
 
iqSquashedO³¿ndsExamšed
;

496 
	gSts
::
SÿÏr
 
iqSquashedNÚS³cRemoved
;

504 
	gSts
::
Di¡ributiÚ
 
numIssuedDi¡
;

513 
	gSts
::
VeùÜ
 
¡©FuBusy
;

516 
	gSts
::
VeùÜ2d
 
¡©IssuedIn¡Ty³
;

519 
	gSts
::
FÜmuÏ
 
issueR©e
;

522 
	gSts
::
VeùÜ
 
fuBusy
;

524 
	gSts
::
FÜmuÏ
 
fuBusyR©e
;

525 
	gpublic
:

526 
Sts
::
SÿÏr
 
štIn¡QueueR—ds
;

527 
	gSts
::
SÿÏr
 
štIn¡QueueWr™es
;

528 
	gSts
::
SÿÏr
 
štIn¡QueueWakeupAcûs£s
;

529 
	gSts
::
SÿÏr
 
åIn¡QueueR—ds
;

530 
	gSts
::
SÿÏr
 
åIn¡QueueWr™es
;

531 
	gSts
::
SÿÏr
 
åIn¡QueueWakeupQcûs£s
;

533 
	gSts
::
SÿÏr
 
štAluAcûs£s
;

534 
	gSts
::
SÿÏr
 
åAluAcûs£s
;

	@inst_queue_impl.hh

44 
	~<lim™s
>

45 
	~<veùÜ
>

47 
	~"ıu/o3/fu_poŞ.hh
"

48 
	~"ıu/o3/š¡_queue.hh
"

49 
	~"debug/IQ.hh
"

50 
	~"’ums/OpCÏss.hh
"

51 
	~"·¿ms/D”ivO3CPU.hh
"

52 
	~"sim/cÜe.hh
"

56 
usšg
 
	g¡d
::
li¡
;

58 
	g‹m¶©e
 <
şass
 
	gIm¶
>

59 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
FUCom¶‘iÚ
::FUCom¶‘iÚ(
DynIn¡PŒ
 &
_š¡
,

60 
fu_idx
, 
In¡ruùiÚQueue
<
Im¶
> *
iq_±r
)

61 : 
Ev’t
(
St_Ev’t_Pri
, 
AutoD–‘e
),

62 
š¡
(
_š¡
), 
fuIdx
(
fu_idx
), 
iqPŒ
(
iq_±r
), 
	$ä“FU
(
çl£
)

64 
	}
}

66 
	g‹m¶©e
 <
şass
 
	gIm¶
>

68 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
FUCom¶‘iÚ
::
	$´oûss
()

70 
iqPŒ
->
	`´oûssFUCom¶‘iÚ
(
š¡
, 
ä“FU
 ? 
fuIdx
 : -1);

71 
š¡
 = 
NULL
;

72 
	}
}

75 
	g‹m¶©e
 <
şass
 
	gIm¶
>

77 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
FUCom¶‘iÚ
::
	$desütiÚ
() const

80 
	}
}

82 
	g‹m¶©e
 <
şass
 
	gIm¶
>

83 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$In¡ruùiÚQueue
(
O3CPU
 *
ıu_±r
, 
IEW
 *
›w_±r
,

84 
D”ivO3CPUP¬ams
 *
·¿ms
)

85 : 
	`ıu
(
ıu_±r
),

86 
	`›wSge
(
›w_±r
),

87 
	`fuPoŞ
(
·¿ms
->
fuPoŞ
),

88 
	`numEÁr›s
(
·¿ms
->
numIQEÁr›s
),

89 
	`tÙ®Width
(
·¿ms
->
issueWidth
),

90 
	`numPhysIÁRegs
(
·¿ms
->
numPhysIÁRegs
),

91 
	`numPhysFlßtRegs
(
·¿ms
->
numPhysFlßtRegs
),

92 
	`comm™ToIEWD–ay
(
·¿ms
->
comm™ToIEWD–ay
)

94 
	`as£¹
(
fuPoŞ
);

96 
numTh»ads
 = 
·¿ms
->numThreads;

99 
numPhysRegs
 = 
numPhysIÁRegs
 + 
numPhysFlßtRegs
;

103 
d•’dG¿ph
.
	`»size
(
numPhysRegs
);

106 
»gScÜebßrd
.
	`»size
(
numPhysRegs
);

109 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

110 
memD•Un™
[
tid
].
	`š™
(
·¿ms
,id);

111 
memD•Un™
[
tid
].
	`£tIQ
(
this
);

114 
	`»£tS‹
();

116 
¡d
::
¡ršg
 
pŞicy
 = 
·¿ms
->
smtIQPŞicy
;

119 
¡d
::
	`ŒªsfÜm
(
pŞicy
.
	`begš
(),…Şicy.
	`’d
(),…olicy.begin(),

120 ((*)()è
tŞow”
);

123 ià(
pŞicy
 == "dynamic") {

124 
iqPŞicy
 = 
DyÇmic
;

127 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

128 
maxEÁr›s
[
tid
] = 
numEÁr›s
;

131 } ià(
pŞicy
 == "partitioned") {

132 
iqPŞicy
 = 
P¬t™iÚed
;

135 
·¹_amt
 = 
numEÁr›s
 / 
numTh»ads
;

138 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

139 
maxEÁr›s
[
tid
] = 
·¹_amt
;

142 
	`DPRINTF
(
IQ
, "IQ sharing…olicy seto Partitioned:"

143 "%˜’Œ› ³¸th»ad.\n",
·¹_amt
);

144 } ià(
pŞicy
 == "threshold") {

145 
iqPŞicy
 = 
Th»shŞd
;

147 
th»shŞd
 = ()
·¿ms
->
smtIQTh»shŞd
 / 100;

149 
th»shŞdIQ
 = ()(()
th»shŞd
 * 
numEÁr›s
);

152 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

153 
maxEÁr›s
[
tid
] = 
th»shŞdIQ
;

156 
	`DPRINTF
(
IQ
, "IQ sharing…olicy seto Threshold:"

157 "%˜’Œ› ³¸th»ad.\n",
th»shŞdIQ
);

159 
	`as£¹
(0 && "Invalid IQ Sharing Policy.Options Are:{Dynamic,"

162 
	}
}

164 
	g‹m¶©e
 <
şass
 
	gIm¶
>

165 
	gIn¡ruùiÚQueue
<
	gIm¶
>::~
	$In¡ruùiÚQueue
()

167 
d•’dG¿ph
.
	`»£t
();

168 #ifdeà
DEBUG


169 
	`ırštf
("Nodesraversed: %i,„emoved: %i\n",

170 
d•’dG¿ph
.
nodesT¿v”£d
, d•’dG¿ph.
nodesRemoved
);

172 
	}
}

174 
	g‹m¶©e
 <
şass
 
	gIm¶
>

175 
	g¡d
::
¡ršg


176 
In¡ruùiÚQueue
<
Im¶
>::
	$Çme
() const

178  
ıu
->
	`Çme
() + ".iq";

179 
	}
}

181 
	g‹m¶©e
 <
şass
 
	gIm¶
>

183 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$»gSts
()

185 
usšg
 
Çme¥aû
 
Sts
;

186 
iqIn¡sAdded


187 .
	`Çme
(name() + ".iqInstsAdded")

188 .
	`desc
("Number of instructions‡ddedohe IQ (excludes‚on-spec)")

189 .
	`´”eq
(
iqIn¡sAdded
);

191 
iqNÚS³cIn¡sAdded


192 .
	`Çme
(name() + ".iqNonSpecInstsAdded")

193 .
	`desc
("Number of‚on-speculative instructions‡ddedohe IQ")

194 .
	`´”eq
(
iqNÚS³cIn¡sAdded
);

196 
iqIn¡sIssued


197 .
	`Çme
(name() + ".iqInstsIssued")

198 .
	`desc
("Number of instructions issued")

199 .
	`´”eq
(
iqIn¡sIssued
);

201 
iqIÁIn¡sIssued


202 .
	`Çme
(name() + ".iqIntInstsIssued")

203 .
	`desc
("Number of integer instructions issued")

204 .
	`´”eq
(
iqIÁIn¡sIssued
);

206 
iqFlßtIn¡sIssued


207 .
	`Çme
(name() + ".iqFloatInstsIssued")

208 .
	`desc
("Number of float instructions issued")

209 .
	`´”eq
(
iqFlßtIn¡sIssued
);

211 
iqB¿nchIn¡sIssued


212 .
	`Çme
(name() + ".iqBranchInstsIssued")

213 .
	`desc
("Number of branch instructions issued")

214 .
	`´”eq
(
iqB¿nchIn¡sIssued
);

216 
iqMemIn¡sIssued


217 .
	`Çme
(name() + ".iqMemInstsIssued")

218 .
	`desc
("Number of memory instructions issued")

219 .
	`´”eq
(
iqMemIn¡sIssued
);

221 
iqMiscIn¡sIssued


222 .
	`Çme
(name() + ".iqMiscInstsIssued")

223 .
	`desc
("Number of miscellaneous instructions issued")

224 .
	`´”eq
(
iqMiscIn¡sIssued
);

226 
iqSquashedIn¡sIssued


227 .
	`Çme
(name() + ".iqSquashedInstsIssued")

228 .
	`desc
("Number of squashed instructions issued")

229 .
	`´”eq
(
iqSquashedIn¡sIssued
);

231 
iqSquashedIn¡sExamšed


232 .
	`Çme
(name() + ".iqSquashedInstsExamined")

233 .
	`desc
("Number of squashed instructions iterated over during squash;"

235 .
	`´”eq
(
iqSquashedIn¡sExamšed
);

237 
iqSquashedO³¿ndsExamšed


238 .
	`Çme
(name() + ".iqSquashedOperandsExamined")

239 .
	`desc
("Number of squashed operandshat‡reƒxamined‡nd…ossibly "

241 .
	`´”eq
(
iqSquashedO³¿ndsExamšed
);

243 
iqSquashedNÚS³cRemoved


244 .
	`Çme
(name() + ".iqSquashedNonSpecRemoved")

245 .
	`desc
("Number of squashed‚on-spec instructionshat were„emoved")

246 .
	`´”eq
(
iqSquashedNÚS³cRemoved
);

258 
numIssuedDi¡


259 .
	`š™
(0,
tÙ®Width
,1)

260 .
	`Çme
(name() + ".issued_per_cycle")

261 .
	`desc
("Number of insts issuedƒach cycle")

262 .
	`æags
(
pdf
)

275 
¡©IssuedIn¡Ty³


276 .
	`š™
(
numTh»ads
,
Enums
::
Num_OpCÏss
)

277 .
	`Çme
(name() + ".FU_type")

278 .
	`desc
("Type of FU issued")

279 .
	`æags
(
tÙ®
 | 
pdf
 | 
di¡
)

281 
¡©IssuedIn¡Ty³
.
	`ysubÇmes
(
Enums
::
OpCÏssSŒšgs
);

300 
issueR©e


301 .
	`Çme
(name() + ".rate")

302 .
	`desc
("Inst issue„ate")

303 .
	`æags
(
tÙ®
)

305 
issueR©e
 = 
iqIn¡sIssued
 / 
ıu
->
numCyşes
;

307 
¡©FuBusy


308 .
	`š™
(
Num_OpCÏs£s
)

309 .
	`Çme
(name() + ".fu_full")

310 .
	`desc
("attemptso use FU when‚one‡vailable")

311 .
	`æags
(
pdf
 | 
di¡
)

313 
i
=0; i < 
Num_OpCÏs£s
; ++i) {

314 
¡©FuBusy
.
	`subÇme
(
i
, 
Enums
::
OpCÏssSŒšgs
[i]);

317 
fuBusy


318 .
	`š™
(
numTh»ads
)

319 .
	`Çme
(name() + ".fu_busy_cnt")

320 .
	`desc
("FU busy when„equested")

321 .
	`æags
(
tÙ®
)

324 
fuBusyR©e


325 .
	`Çme
(name() + ".fu_busy_rate")

326 .
	`desc
("FU busy„ate (busyƒvents/executed inst)")

327 .
	`æags
(
tÙ®
)

329 
fuBusyR©e
 = 
fuBusy
 / 
iqIn¡sIssued
;

331 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

333 
memD•Un™
[
tid
].
	`»gSts
();

336 
štIn¡QueueR—ds


337 .
	`Çme
(name() + ".int_inst_queue_reads")

338 .
	`desc
("Number of integer instruction queue„eads")

339 .
	`æags
(
tÙ®
);

341 
štIn¡QueueWr™es


342 .
	`Çme
(name() + ".int_inst_queue_writes")

343 .
	`desc
("Number of integer instruction queue writes")

344 .
	`æags
(
tÙ®
);

346 
štIn¡QueueWakeupAcûs£s


347 .
	`Çme
(name() + ".int_inst_queue_wakeup_accesses")

348 .
	`desc
("Number of integer instruction queue wakeup‡ccesses")

349 .
	`æags
(
tÙ®
);

351 
åIn¡QueueR—ds


352 .
	`Çme
(name() + ".fp_inst_queue_reads")

353 .
	`desc
("Number of floating instruction queue„eads")

354 .
	`æags
(
tÙ®
);

356 
åIn¡QueueWr™es


357 .
	`Çme
(name() + ".fp_inst_queue_writes")

358 .
	`desc
("Number of floating instruction queue writes")

359 .
	`æags
(
tÙ®
);

361 
åIn¡QueueWakeupQcûs£s


362 .
	`Çme
(name() + ".fp_inst_queue_wakeup_accesses")

363 .
	`desc
("Number of floating instruction queue wakeup‡ccesses")

364 .
	`æags
(
tÙ®
);

366 
štAluAcûs£s


367 .
	`Çme
(name() + ".int_alu_accesses")

368 .
	`desc
("Number of integer‡lu‡ccesses")

369 .
	`æags
(
tÙ®
);

371 
åAluAcûs£s


372 .
	`Çme
(name() + ".fp_alu_accesses")

373 .
	`desc
("Number of floating…oint‡lu‡ccesses")

374 .
	`æags
(
tÙ®
);

376 
	}
}

378 
	g‹m¶©e
 <
şass
 
	gIm¶
>

380 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$»£tS‹
()

383 
Th»adID
 
tid
 = 0;id <
numTh»ads
;id++) {

384 
couÁ
[
tid
] = 0;

385 
š¡Li¡
[
tid
].
	`ş—r
();

389 
ä“EÁr›s
 = 
numEÁr›s
;

396 
i
 = 0; i < 
numPhysRegs
; ++i) {

397 
»gScÜebßrd
[
i
] = 
çl£
;

400 
Th»adID
 
tid
 = 0;id < 
numTh»ads
; ++tid) {

401 
squashedSeqNum
[
tid
] = 0;

404 
i
 = 0; i < 
Num_OpCÏs£s
; ++i) {

405 !
»adyIn¡s
[
i
].
	`em±y
())

406 
»adyIn¡s
[
i
].
	`pİ
();

407 
queueOnLi¡
[
i
] = 
çl£
;

408 
»adyIt
[
i
] = 
li¡Ord”
.
	`’d
();

410 
nÚS³cIn¡s
.
	`ş—r
();

411 
li¡Ord”
.
	`ş—r
();

412 
deã¼edMemIn¡s
.
	`ş—r
();

413 
	}
}

415 
	g‹m¶©e
 <
şass
 
	gIm¶
>

417 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
£tAùiveTh»ads
(
li¡
<
Th»adID
> *
©_±r
)

419 
aùiveTh»ads
 = 
©_±r
;

422 
	g‹m¶©e
 <
şass
 
	gIm¶
>

424 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
£tIssueToExecu‹Queue
(
TimeBufãr
<
IssueSŒuù
> *
i2e_±r
)

426 
issueToExecu‹Queue
 = 
i2e_±r
;

429 
	g‹m¶©e
 <
şass
 
	gIm¶
>

431 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
£tTimeBufãr
(
TimeBufãr
<
TimeSŒuù
> *
tb_±r
)

433 
timeBufãr
 = 
tb_±r
;

435 
	gäomComm™
 = 
timeBufãr
->
g‘Wœe
(-
comm™ToIEWD–ay
);

438 
	g‹m¶©e
 <
şass
 
	gIm¶
>

440 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$d¿šSª™yCheck
() const

442 
	`as£¹
(
d•’dG¿ph
.
	`em±y
());

443 
	`as£¹
(
š¡sToExecu‹
.
	`em±y
());

444 
Th»adID
 
tid
 = 0;id < 
numTh»ads
; ++tid)

445 
memD•Un™
[
tid
].
	`d¿šSª™yCheck
();

446 
	}
}

448 
	g‹m¶©e
 <
şass
 
	gIm¶
>

450 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$keOv”From
()

452 
	`»£tS‹
();

453 
	}
}

455 
	g‹m¶©e
 <
şass
 
	gIm¶
>

457 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$’ŒyAmouÁ
(
Th»adID
 
num_th»ads
)

459 ià(
iqPŞicy
 =ğ
P¬t™iÚed
) {

460  
numEÁr›s
 / 
num_th»ads
;

464 
	}
}

467 
	g‹m¶©e
 <
şass
 
	gIm¶
>

469 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$»£tEÁr›s
()

471 ià(
iqPŞicy
 !ğ
DyÇmic
 || 
numTh»ads
 > 1) {

472 
aùive_th»ads
 = 
aùiveTh»ads
->
	`size
();

474 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

475 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

477 
th»ads
 !ğ
’d
) {

478 
Th»adID
 
tid
 = *
th»ads
++;

480 ià(
iqPŞicy
 =ğ
P¬t™iÚed
) {

481 
maxEÁr›s
[
tid
] = 
numEÁr›s
 / 
aùive_th»ads
;

482 } if(
iqPŞicy
 =ğ
Th»shŞd
 && 
aùive_th»ads
 == 1) {

483 
maxEÁr›s
[
tid
] = 
numEÁr›s
;

487 
	}
}

489 
	g‹m¶©e
 <
şass
 
	gIm¶
>

491 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$numF»eEÁr›s
()

493  
ä“EÁr›s
;

494 
	}
}

496 
	g‹m¶©e
 <
şass
 
	gIm¶
>

498 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$numF»eEÁr›s
(
Th»adID
 
tid
)

500  
maxEÁr›s
[
tid
] - 
couÁ
[tid];

501 
	}
}

505 
	g‹m¶©e
 <
şass
 
	gIm¶
>

506 
boŞ


507 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$isFuÎ
()

509 ià(
ä“EÁr›s
 == 0) {

510 (
Œue
);

512 (
çl£
);

514 
	}
}

516 
	g‹m¶©e
 <
şass
 
	gIm¶
>

517 
boŞ


518 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$isFuÎ
(
Th»adID
 
tid
)

520 ià(
	`numF»eEÁr›s
(
tid
) == 0) {

521 (
Œue
);

523 (
çl£
);

525 
	}
}

527 
	g‹m¶©e
 <
şass
 
	gIm¶
>

528 
boŞ


529 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$hasR—dyIn¡s
()

531 ià(!
li¡Ord”
.
	`em±y
()) {

532  
Œue
;

535 
i
 = 0; i < 
Num_OpCÏs£s
; ++i) {

536 ià(!
»adyIn¡s
[
i
].
	`em±y
()) {

537  
Œue
;

541  
çl£
;

542 
	}
}

544 
	g‹m¶©e
 <
şass
 
	gIm¶
>

546 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$š£¹
(
DynIn¡PŒ
 &
Ãw_š¡
)

548 
Ãw_š¡
->
	`isFlßtšg
(è? 
åIn¡QueueWr™es
++ : 
štIn¡QueueWr™es
++;

550 
	`as£¹
(
Ãw_š¡
);

552 
	`DPRINTF
(
IQ
, "Adding instruction [sn:%lli] PC %sohe IQ.\n",

553 
Ãw_š¡
->
£qNum
,‚ew_š¡->
	`pcS‹
());

555 
	`as£¹
(
ä“EÁr›s
 != 0);

557 
š¡Li¡
[
Ãw_š¡
->
th»adNumb”
].
	`push_back
(new_inst);

559 --
ä“EÁr›s
;

561 
Ãw_š¡
->
	`£tInIQ
();

565 
	`addToD•’d’ts
(
Ãw_š¡
);

569 
	`addToProduûrs
(
Ãw_š¡
);

571 ià(
Ãw_š¡
->
	`isMemRef
()) {

572 
memD•Un™
[
Ãw_š¡
->
th»adNumb”
].
	`š£¹
(new_inst);

574 
	`addIfR—dy
(
Ãw_š¡
);

577 ++
iqIn¡sAdded
;

579 
couÁ
[
Ãw_š¡
->
th»adNumb”
]++;

581 
	`as£¹
(
ä“EÁr›s
 =ğ(
numEÁr›s
 - 
	`couÁIn¡s
()));

582 
	}
}

584 
	g‹m¶©e
 <
şass
 
	gIm¶
>

586 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$š£¹NÚS³c
(
DynIn¡PŒ
 &
Ãw_š¡
)

590 
Ãw_š¡
->
	`isFlßtšg
(è? 
åIn¡QueueWr™es
++ : 
štIn¡QueueWr™es
++;

592 
	`as£¹
(
Ãw_š¡
);

594 
nÚS³cIn¡s
[
Ãw_š¡
->
£qNum
] =‚ew_inst;

596 
	`DPRINTF
(
IQ
, "Adding‚on-speculative instruction [sn:%lli] PC %s "

598 
Ãw_š¡
->
£qNum
,‚ew_š¡->
	`pcS‹
());

600 
	`as£¹
(
ä“EÁr›s
 != 0);

602 
š¡Li¡
[
Ãw_š¡
->
th»adNumb”
].
	`push_back
(new_inst);

604 --
ä“EÁr›s
;

606 
Ãw_š¡
->
	`£tInIQ
();

610 
	`addToProduûrs
(
Ãw_š¡
);

614 ià(
Ãw_š¡
->
	`isMemRef
()) {

615 
memD•Un™
[
Ãw_š¡
->
th»adNumb”
].
	`š£¹NÚS³c
(new_inst);

618 ++
iqNÚS³cIn¡sAdded
;

620 
couÁ
[
Ãw_š¡
->
th»adNumb”
]++;

622 
	`as£¹
(
ä“EÁr›s
 =ğ(
numEÁr›s
 - 
	`couÁIn¡s
()));

623 
	}
}

625 
	g‹m¶©e
 <
şass
 
	gIm¶
>

627 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$š£¹B¬r›r
(
DynIn¡PŒ
 &
b¬r_š¡
)

629 
memD•Un™
[
b¬r_š¡
->
th»adNumb”
].
	`š£¹B¬r›r
(barr_inst);

631 
	`š£¹NÚS³c
(
b¬r_š¡
);

632 
	}
}

634 
	g‹m¶©e
 <
şass
 
	gIm¶
>

635 
ty³Çme
 
	gIm¶
::
DynIn¡PŒ


636 
In¡ruùiÚQueue
<
Im¶
>::
	$g‘In¡ToExecu‹
()

638 
	`as£¹
(!
š¡sToExecu‹
.
	`em±y
());

639 
DynIn¡PŒ
 
š¡
 = 
š¡sToExecu‹
.
	`äÚt
();

640 
š¡sToExecu‹
.
	`pİ_äÚt
();

641 ià(
š¡
->
	`isFlßtšg
()){

642 
åIn¡QueueR—ds
++;

644 
štIn¡QueueR—ds
++;

646  
š¡
;

647 
	}
}

649 
	g‹m¶©e
 <
şass
 
	gIm¶
>

651 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$addToOrd”Li¡
(
OpCÏss
 
İ_şass
)

653 
	`as£¹
(!
»adyIn¡s
[
İ_şass
].
	`em±y
());

655 
Li¡Ord”EÁry
 
queue_’Œy
;

657 
queue_’Œy
.
queueTy³
 = 
İ_şass
;

659 
queue_’Œy
.
Şde¡In¡
 = 
»adyIn¡s
[
İ_şass
].
	`tİ
()->
£qNum
;

661 
Li¡Ord”It
 
li¡_™
 = 
li¡Ord”
.
	`begš
();

662 
Li¡Ord”It
 
li¡_’d_™
 = 
li¡Ord”
.
	`’d
();

664 
li¡_™
 !ğ
li¡_’d_™
) {

665 ià((*
li¡_™
).
Şde¡In¡
 > 
queue_’Œy
.oldestInst) {

669 
li¡_™
++;

672 
»adyIt
[
İ_şass
] = 
li¡Ord”
.
	`š£¹
(
li¡_™
, 
queue_’Œy
);

673 
queueOnLi¡
[
İ_şass
] = 
Œue
;

674 
	}
}

676 
	g‹m¶©e
 <
şass
 
	gIm¶
>

678 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$moveToYoung”In¡
(
Li¡Ord”It
 
li¡_Üd”_™
)

685 
Li¡Ord”EÁry
 
queue_’Œy
;

686 
OpCÏss
 
İ_şass
 = (*
li¡_Üd”_™
).
queueTy³
;

687 
Li¡Ord”It
 
Ãxt_™
 = 
li¡_Üd”_™
;

689 ++
Ãxt_™
;

691 
queue_’Œy
.
queueTy³
 = 
İ_şass
;

692 
queue_’Œy
.
Şde¡In¡
 = 
»adyIn¡s
[
İ_şass
].
	`tİ
()->
£qNum
;

694 
Ãxt_™
 !ğ
li¡Ord”
.
	`’d
() &&

695 (*
Ãxt_™
).
Şde¡In¡
 < 
queue_’Œy
.oldestInst) {

696 ++
Ãxt_™
;

699 
»adyIt
[
İ_şass
] = 
li¡Ord”
.
	`š£¹
(
Ãxt_™
, 
queue_’Œy
);

700 
	}
}

702 
	g‹m¶©e
 <
şass
 
	gIm¶
>

704 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$´oûssFUCom¶‘iÚ
(
DynIn¡PŒ
 &
š¡
, 
fu_idx
)

706 
	`DPRINTF
(
IQ
, "Proûssšg FU com¶‘iÚ [¢:%Îi]\n", 
š¡
->
£qNum
);

707 
	`as£¹
(!
ıu
->
	`sw™chedOut
());

710 
›wSge
->
	`wakeCPU
();

712 ià(
fu_idx
 > -1)

713 
fuPoŞ
->
	`ä“Un™NextCyşe
(
fu_idx
);

718 
issueToExecu‹Queue
->
	`acûss
(-1)->
size
++;

719 
š¡sToExecu‹
.
	`push_back
(
š¡
);

720 
	}
}

725 
	g‹m¶©e
 <
şass
 
	gIm¶
>

727 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$scheduËR—dyIn¡s
()

729 
	`DPRINTF
(
IQ
, "Attemptingo schedule„eady instructions from "

732 
IssueSŒuù
 *
i2e_šfo
 = 
issueToExecu‹Queue
->
	`acûss
(0);

734 
DynIn¡PŒ
 
deã¼ed_mem_š¡
;

735 
tÙ®_deã¼ed_mem_issued
 = 0;

736 
tÙ®_deã¼ed_mem_issued
 < 
tÙ®Width
 &&

737 (
deã¼ed_mem_š¡
 = 
	`g‘Deã¼edMemIn¡ToExecu‹
()) != 0) {

738 
issueToExecu‹Queue
->
	`acûss
(0)->
size
++;

739 
š¡sToExecu‹
.
	`push_back
(
deã¼ed_mem_š¡
);

740 
tÙ®_deã¼ed_mem_issued
++;

751 
Li¡Ord”It
 
Üd”_™
 = 
li¡Ord”
.
	`begš
();

752 
Li¡Ord”It
 
Üd”_’d_™
 = 
li¡Ord”
.
	`’d
();

753 
tÙ®_issued
 = 0;

755 
tÙ®_issued
 < (
tÙ®Width
 - 
tÙ®_deã¼ed_mem_issued
) &&

756 
›wSge
->
	`ÿnIssue
() &&

757 
Üd”_™
 !ğ
Üd”_’d_™
) {

758 
OpCÏss
 
İ_şass
 = (*
Üd”_™
).
queueTy³
;

760 
	`as£¹
(!
»adyIn¡s
[
İ_şass
].
	`em±y
());

762 
DynIn¡PŒ
 
issušg_š¡
 = 
»adyIn¡s
[
İ_şass
].
	`tİ
();

764 
issušg_š¡
->
	`isFlßtšg
(è? 
åIn¡QueueR—ds
++ : 
štIn¡QueueR—ds
++;

766 
	`as£¹
(
issušg_š¡
->
£qNum
 =ğ(*
Üd”_™
).
Şde¡In¡
);

768 ià(
issušg_š¡
->
	`isSquashed
()) {

769 
»adyIn¡s
[
İ_şass
].
	`pİ
();

771 ià(!
»adyIn¡s
[
İ_şass
].
	`em±y
()) {

772 
	`moveToYoung”In¡
(
Üd”_™
);

774 
»adyIt
[
İ_şass
] = 
li¡Ord”
.
	`’d
();

775 
queueOnLi¡
[
İ_şass
] = 
çl£
;

778 
li¡Ord”
.
	`”a£
(
Üd”_™
++);

780 ++
iqSquashedIn¡sIssued
;

785 
idx
 = -2;

786 
Cyşes
 
İ_Ï‹ncy
 = 
	`Cyşes
(1);

787 
Th»adID
 
tid
 = 
issušg_š¡
->
th»adNumb”
;

789 ià(
İ_şass
 !ğ
No_OpCÏss
) {

790 
idx
 = 
fuPoŞ
->
	`g‘Un™
(
İ_şass
);

791 
issušg_š¡
->
	`isFlßtšg
(è? 
åAluAcûs£s
++ : 
štAluAcûs£s
++;

792 ià(
idx
 > -1) {

793 
İ_Ï‹ncy
 = 
fuPoŞ
->
	`g‘OpL©’cy
(
İ_şass
);

799 ià(
idx
 == -2 || idx != -1) {

800 ià(
İ_Ï‹ncy
 =ğ
	`Cyşes
(1)) {

801 
i2e_šfo
->
size
++;

802 
š¡sToExecu‹
.
	`push_back
(
issušg_š¡
);

806 ià(
idx
 >= 0)

807 
fuPoŞ
->
	`ä“Un™NextCyşe
(
idx
);

809 
Cyşes
 
issue_Ï‹ncy
 = 
fuPoŞ
->
	`g‘IssueL©’cy
(
İ_şass
);

811 
FUCom¶‘iÚ
 *
executiÚ
 = 
Ãw
 
	`FUCom¶‘iÚ
(
issušg_š¡
,

812 
idx
, 
this
);

814 
ıu
->
	`scheduË
(
executiÚ
,

815 
ıu
->
	`şockEdge
(
	`Cyşes
(
İ_Ï‹ncy
 - 1)));

818 ià(
issue_Ï‹ncy
 > 
	`Cyşes
(1)) {

821 
executiÚ
->
	`£tF»eFU
();

824 
fuPoŞ
->
	`ä“Un™NextCyşe
(
idx
);

828 
	`DPRINTF
(
IQ
, "Thread %i: Issuing instruction PC %s "

830 
tid
, 
issušg_š¡
->
	`pcS‹
(),

831 
issušg_š¡
->
£qNum
);

833 
»adyIn¡s
[
İ_şass
].
	`pİ
();

835 ià(!
»adyIn¡s
[
İ_şass
].
	`em±y
()) {

836 
	`moveToYoung”In¡
(
Üd”_™
);

838 
»adyIt
[
İ_şass
] = 
li¡Ord”
.
	`’d
();

839 
queueOnLi¡
[
İ_şass
] = 
çl£
;

842 
issušg_š¡
->
	`£tIssued
();

843 ++
tÙ®_issued
;

845 #ià
TRACING_ON


846 
issušg_š¡
->
issueTick
 = 
	`curTick
(è- issušg_š¡->
ãtchTick
;

849 ià(!
issušg_š¡
->
	`isMemRef
()) {

852 ++
ä“EÁr›s
;

853 
couÁ
[
tid
]--;

854 
issušg_š¡
->
	`ş—rInIQ
();

856 
memD•Un™
[
tid
].
	`issue
(
issušg_š¡
);

859 
li¡Ord”
.
	`”a£
(
Üd”_™
++);

860 
¡©IssuedIn¡Ty³
[
tid
][
İ_şass
]++;

861 
›wSge
->
	`šüWb
(
issušg_š¡
->
£qNum
);

863 
¡©FuBusy
[
İ_şass
]++;

864 
fuBusy
[
tid
]++;

865 ++
Üd”_™
;

869 
numIssuedDi¡
.
	`§m¶e
(
tÙ®_issued
);

870 
iqIn¡sIssued
+ğ
tÙ®_issued
;

876 ià(
tÙ®_issued
 || 
tÙ®_deã¼ed_mem_issued
 || 
deã¼edMemIn¡s
.
	`size
()) {

877 
ıu
->
	`aùiv™yThisCyşe
();

879 
	`DPRINTF
(
IQ
, "Not‡bleo schedule‡ny instructions.\n");

881 
	}
}

883 
	g‹m¶©e
 <
şass
 
	gIm¶
>

885 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$scheduËNÚS³c
(cÚ¡ 
In¡SeqNum
 &
š¡
)

887 
	`DPRINTF
(
IQ
, "Marking‚onspeculative instruction [sn:%lli]‡s„eady "

888 "tØexecu‹.\n", 
š¡
);

890 
NÚS³cM­It
 
š¡_™
 = 
nÚS³cIn¡s
.
	`fšd
(
š¡
);

892 
	`as£¹
(
š¡_™
 !ğ
nÚS³cIn¡s
.
	`’d
());

894 
Th»adID
 
tid
 = (*
š¡_™
).
£cÚd
->
th»adNumb”
;

896 (*
š¡_™
).
£cÚd
->
	`£tAtComm™
();

898 (*
š¡_™
).
£cÚd
->
	`£tCªIssue
();

900 ià(!(*
š¡_™
).
£cÚd
->
	`isMemRef
()) {

901 
	`addIfR—dy
((*
š¡_™
).
£cÚd
);

903 
memD•Un™
[
tid
].
	`nÚS³cIn¡R—dy
((*
š¡_™
).
£cÚd
);

906 (*
š¡_™
).
£cÚd
 = 
NULL
;

908 
nÚS³cIn¡s
.
	`”a£
(
š¡_™
);

909 
	}
}

911 
	g‹m¶©e
 <
şass
 
	gIm¶
>

913 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$comm™
(cÚ¡ 
In¡SeqNum
 &
š¡
, 
Th»adID
 
tid
)

915 
	`DPRINTF
(
IQ
, "[tid:%i]: Committing instructions olderhan [sn:%i]\n",

916 
tid
,
š¡
);

918 
Li¡It
 
iq_™
 = 
š¡Li¡
[
tid
].
	`begš
();

920 
iq_™
 !ğ
š¡Li¡
[
tid
].
	`’d
() &&

921 (*
iq_™
)->
£qNum
 <ğ
š¡
) {

922 ++
iq_™
;

923 
š¡Li¡
[
tid
].
	`pİ_äÚt
();

926 
	`as£¹
(
ä“EÁr›s
 =ğ(
numEÁr›s
 - 
	`couÁIn¡s
()));

927 
	}
}

929 
	g‹m¶©e
 <
şass
 
	gIm¶
>

931 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$wakeD•’d’ts
(
DynIn¡PŒ
 &
com¶‘ed_š¡
)

933 
d•’d’ts
 = 0;

936 ià(
com¶‘ed_š¡
->
	`isFlßtšg
()) {

937 
åIn¡QueueWakeupQcûs£s
++;

939 
štIn¡QueueWakeupAcûs£s
++;

942 
	`DPRINTF
(
IQ
, "Waking dependents of completed instruction.\n");

944 
	`as£¹
(!
com¶‘ed_š¡
->
	`isSquashed
());

952 ià(
com¶‘ed_š¡
->
	`isMemRef
()) {

953 
memD•Un™
[
com¶‘ed_š¡
->
th»adNumb”
].
	`wakeD•’d’ts
(completed_inst);

954 
	`com¶‘eMemIn¡
(
com¶‘ed_š¡
);

955 } ià(
com¶‘ed_š¡
->
	`isMemB¬r›r
() ||

956 
com¶‘ed_š¡
->
	`isWr™eB¬r›r
()) {

957 
memD•Un™
[
com¶‘ed_š¡
->
th»adNumb”
].
	`com¶‘eB¬r›r
(completed_inst);

960 
de¡_»g_idx
 = 0;

961 
de¡_»g_idx
 < 
com¶‘ed_š¡
->
	`numDe¡Regs
();

962 
de¡_»g_idx
++)

964 
PhysRegIndex
 
de¡_»g
 =

965 
com¶‘ed_š¡
->
	`»ÇmedDe¡RegIdx
(
de¡_»g_idx
);

970 ià(
de¡_»g
 >ğ
numPhysRegs
) {

971 
	`DPRINTF
(
IQ
, "de¡_»g :%d,‚umPhysRegs: %d\n", 
de¡_»g
,

972 
numPhysRegs
);

976 
	`DPRINTF
(
IQ
, "Waking‡ny dependents on„egister %i.\n",

977 (è
de¡_»g
);

981 
DynIn¡PŒ
 
d•_š¡
 = 
d•’dG¿ph
.
	`pİ
(
de¡_»g
);

983 
d•_š¡
) {

984 
	`DPRINTF
(
IQ
, "Waking up‡ dependent instruction, [sn:%lli] "

985 "PC %s.\n", 
d•_š¡
->
£qNum
, d•_š¡->
	`pcS‹
());

991 
d•_š¡
->
	`m¬kSrcRegR—dy
();

993 
	`addIfR—dy
(
d•_š¡
);

995 
d•_š¡
 = 
d•’dG¿ph
.
	`pİ
(
de¡_»g
);

997 ++
d•’d’ts
;

1002 
	`as£¹
(
d•’dG¿ph
.
	`em±y
(
de¡_»g
));

1003 
d•’dG¿ph
.
	`ş—rIn¡
(
de¡_»g
);

1006 
»gScÜebßrd
[
de¡_»g
] = 
Œue
;

1008  
d•’d’ts
;

1009 
	}
}

1011 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1013 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$addR—dyMemIn¡
(
DynIn¡PŒ
 &
»ady_š¡
)

1015 
OpCÏss
 
İ_şass
 = 
»ady_š¡
->
	`İCÏss
();

1017 
»adyIn¡s
[
İ_şass
].
	`push
(
»ady_š¡
);

1021 ià(!
queueOnLi¡
[
İ_şass
]) {

1022 
	`addToOrd”Li¡
(
İ_şass
);

1023 } ià(
»adyIn¡s
[
İ_şass
].
	`tİ
()->
£qNum
 <

1024 (*
»adyIt
[
İ_şass
]).
Şde¡In¡
) {

1025 
li¡Ord”
.
	`”a£
(
»adyIt
[
İ_şass
]);

1026 
	`addToOrd”Li¡
(
İ_şass
);

1029 
	`DPRINTF
(
IQ
, "Instruction is„eadyo issue,…utting it onto "

1031 
»ady_š¡
->
	`pcS‹
(), 
İ_şass
,„—dy_š¡->
£qNum
);

1032 
	}
}

1034 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1036 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$»scheduËMemIn¡
(
DynIn¡PŒ
 &
»sched_š¡
)

1038 
	`DPRINTF
(
IQ
, "Reschedulšg mem in¡ [¢:%Îi]\n", 
»sched_š¡
->
£qNum
);

1041 
»sched_š¡
->
	`Œª¦©iÚS¹ed
(
çl£
);

1042 
»sched_š¡
->
	`Œª¦©iÚCom¶‘ed
(
çl£
);

1044 
»sched_š¡
->
	`ş—rCªIssue
();

1045 
memD•Un™
[
»sched_š¡
->
th»adNumb”
].
	`»scheduË
(resched_inst);

1046 
	}
}

1048 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1050 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$»¶ayMemIn¡
(
DynIn¡PŒ
 &
»¶ay_š¡
)

1052 
memD•Un™
[
»¶ay_š¡
->
th»adNumb”
].
	`»¶ay
(replay_inst);

1053 
	}
}

1055 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1057 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$com¶‘eMemIn¡
(
DynIn¡PŒ
 &
com¶‘ed_š¡
)

1059 
Th»adID
 
tid
 = 
com¶‘ed_š¡
->
th»adNumb”
;

1061 
	`DPRINTF
(
IQ
, "Completing mem instruction PC: %s [sn:%lli]\n",

1062 
com¶‘ed_š¡
->
	`pcS‹
(), com¶‘ed_š¡->
£qNum
);

1064 ++
ä“EÁr›s
;

1066 
com¶‘ed_š¡
->
	`memOpDÚe
(
Œue
);

1068 
memD•Un™
[
tid
].
	`com¶‘ed
(
com¶‘ed_š¡
);

1069 
couÁ
[
tid
]--;

1070 
	}
}

1072 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1074 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$deãrMemIn¡
(
DynIn¡PŒ
 &
deã¼ed_š¡
)

1076 
deã¼edMemIn¡s
.
	`push_back
(
deã¼ed_š¡
);

1077 
	}
}

1079 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1080 
ty³Çme
 
	gIm¶
::
DynIn¡PŒ


1081 
In¡ruùiÚQueue
<
Im¶
>::
	$g‘Deã¼edMemIn¡ToExecu‹
()

1083 
Li¡It
 
™
 = 
deã¼edMemIn¡s
.
	`begš
(); iˆ!ğdeã¼edMemIn¡s.
	`’d
();

1084 ++
™
) {

1085 ià((*
™
)->
	`Œª¦©iÚCom¶‘ed
(è|| (*™)->
	`isSquashed
()) {

1086 
DynIn¡PŒ
 
»t
 = *
™
;

1087 
deã¼edMemIn¡s
.
	`”a£
(
™
);

1088  
»t
;

1091  
NULL
;

1092 
	}
}

1094 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1096 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$viŞ©iÚ
(
DynIn¡PŒ
 &
¡Üe
,

1097 
DynIn¡PŒ
 &
çuÉšg_lßd
)

1099 
štIn¡QueueWr™es
++;

1100 
memD•Un™
[
¡Üe
->
th»adNumb”
].
	`viŞ©iÚ
(¡Üe, 
çuÉšg_lßd
);

1101 
	}
}

1103 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1105 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$squash
(
Th»adID
 
tid
)

1107 
	`DPRINTF
(
IQ
, "[tid:%i]: Startingo squash instructions in "

1108 "thIQ.\n", 
tid
);

1112 
squashedSeqNum
[
tid
] = 
äomComm™
->
comm™Info
[tid].
dÚeSeqNum
;

1115 ià(
couÁ
[
tid
] > 0) {

1116 
	`doSquash
(
tid
);

1120 
memD•Un™
[
tid
].
	`squash
(
squashedSeqNum
[tid],id);

1121 
	}
}

1123 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1125 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$doSquash
(
Th»adID
 
tid
)

1128 
Li¡It
 
squash_™
 = 
š¡Li¡
[
tid
].
	`’d
();

1129 --
squash_™
;

1131 
	`DPRINTF
(
IQ
, "[tid:%i]: Squashing until sequence‚umber %i!\n",

1132 
tid
, 
squashedSeqNum
[tid]);

1136 
squash_™
 !ğ
š¡Li¡
[
tid
].
	`’d
() &&

1137 (*
squash_™
)->
£qNum
 > 
squashedSeqNum
[
tid
]) {

1139 
DynIn¡PŒ
 
squashed_š¡
 = (*
squash_™
);

1140 
squashed_š¡
->
	`isFlßtšg
(è? 
åIn¡QueueWr™es
++ : 
štIn¡QueueWr™es
++;

1144 ià(
squashed_š¡
->
th»adNumb”
 !ğ
tid
 ||

1145 
squashed_š¡
->
	`isSquashedInIQ
()) {

1146 --
squash_™
;

1150 ià(!
squashed_š¡
->
	`isIssued
() ||

1151 (
squashed_š¡
->
	`isMemRef
() &&

1152 !
squashed_š¡
->
	`memOpDÚe
())) {

1154 
	`DPRINTF
(
IQ
, "[tid:%i]: Instruction [sn:%lli] PC %s squashed.\n",

1155 
tid
, 
squashed_š¡
->
£qNum
, squashed_š¡->
	`pcS‹
());

1158 ià(!
squashed_š¡
->
	`isNÚS³cuÏtive
() &&

1159 !
squashed_š¡
->
	`isStÜeCÚd™iÚ®
() &&

1160 !
squashed_š¡
->
	`isMemB¬r›r
() &&

1161 !
squashed_š¡
->
	`isWr™eB¬r›r
()) {

1163 
¤c_»g_idx
 = 0;

1164 
¤c_»g_idx
 < 
squashed_š¡
->
	`numSrcRegs
();

1165 
¤c_»g_idx
++)

1167 
PhysRegIndex
 
¤c_»g
 =

1168 
squashed_š¡
->
	`»ÇmedSrcRegIdx
(
¤c_»g_idx
);

1179 ià(!
squashed_š¡
->
	`isR—dySrcRegIdx
(
¤c_»g_idx
) &&

1180 
¤c_»g
 < 
numPhysRegs
) {

1181 
d•’dG¿ph
.
	`»move
(
¤c_»g
, 
squashed_š¡
);

1185 ++
iqSquashedO³¿ndsExamšed
;

1187 } ià(!
squashed_š¡
->
	`isStÜeCÚd™iÚ®
() ||

1188 !
squashed_š¡
->
	`isCom¶‘ed
()) {

1189 
NÚS³cM­It
 
ns_š¡_™
 =

1190 
nÚS³cIn¡s
.
	`fšd
(
squashed_š¡
->
£qNum
);

1192 ià(
ns_š¡_™
 =ğ
nÚS³cIn¡s
.
	`’d
()) {

1193 
	`as£¹
(
squashed_š¡
->
	`g‘FauÉ
(è!ğ
NoFauÉ
);

1196 (*
ns_š¡_™
).
£cÚd
 = 
NULL
;

1198 
nÚS³cIn¡s
.
	`”a£
(
ns_š¡_™
);

1200 ++
iqSquashedNÚS³cRemoved
;

1207 
squashed_š¡
->
	`£tSquashedInIQ
();

1211 
squashed_š¡
->
	`£tIssued
();

1212 
squashed_š¡
->
	`£tCªComm™
();

1213 
squashed_š¡
->
	`ş—rInIQ
();

1216 
couÁ
[
squashed_š¡
->
th»adNumb”
]--;

1218 ++
ä“EÁr›s
;

1221 
š¡Li¡
[
tid
].
	`”a£
(
squash_™
--);

1222 ++
iqSquashedIn¡sExamšed
;

1224 
	}
}

1226 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1227 
boŞ


1228 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$addToD•’d’ts
(
DynIn¡PŒ
 &
Ãw_š¡
)

1232 
št8_t
 
tÙ®_¤c_»gs
 = 
Ãw_š¡
->
	`numSrcRegs
();

1233 
boŞ
 
»tuº_v®
 = 
çl£
;

1235 
¤c_»g_idx
 = 0;

1236 
¤c_»g_idx
 < 
tÙ®_¤c_»gs
;

1237 
¤c_»g_idx
++)

1240 ià(!
Ãw_š¡
->
	`isR—dySrcRegIdx
(
¤c_»g_idx
)) {

1241 
PhysRegIndex
 
¤c_»g
 = 
Ãw_š¡
->
	`»ÇmedSrcRegIdx
(
¤c_»g_idx
);

1247 ià(
¤c_»g
 >ğ
numPhysRegs
) {

1249 } ià(
»gScÜebßrd
[
¤c_»g
] =ğ
çl£
) {

1250 
	`DPRINTF
(
IQ
, "Instruction PC %s has src„eg %ihat "

1252 
Ãw_š¡
->
	`pcS‹
(), 
¤c_»g
);

1254 
d•’dG¿ph
.
	`š£¹
(
¤c_»g
, 
Ãw_š¡
);

1258 
»tuº_v®
 = 
Œue
;

1260 
	`DPRINTF
(
IQ
, "Instruction PC %s has src„eg %ihat "

1262 
Ãw_š¡
->
	`pcS‹
(), 
¤c_»g
);

1264 
Ãw_š¡
->
	`m¬kSrcRegR—dy
(
¤c_»g_idx
);

1269  
»tuº_v®
;

1270 
	}
}

1272 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1274 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$addToProduûrs
(
DynIn¡PŒ
 &
Ãw_š¡
)

1280 
št8_t
 
tÙ®_de¡_»gs
 = 
Ãw_š¡
->
	`numDe¡Regs
();

1282 
de¡_»g_idx
 = 0;

1283 
de¡_»g_idx
 < 
tÙ®_de¡_»gs
;

1284 
de¡_»g_idx
++)

1286 
PhysRegIndex
 
de¡_»g
 = 
Ãw_š¡
->
	`»ÇmedDe¡RegIdx
(
de¡_»g_idx
);

1292 ià(
de¡_»g
 >ğ
numPhysRegs
) {

1296 ià(!
d•’dG¿ph
.
	`em±y
(
de¡_»g
)) {

1297 
d•’dG¿ph
.
	`dump
();

1298 
	`·nic
("D•’d’cy g¿ph %˜nÙƒm±y!", 
de¡_»g
);

1301 
d•’dG¿ph
.
	`£tIn¡
(
de¡_»g
, 
Ãw_š¡
);

1304 
»gScÜebßrd
[
de¡_»g
] = 
çl£
;

1306 
	}
}

1308 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1310 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$addIfR—dy
(
DynIn¡PŒ
 &
š¡
)

1314 ià(
š¡
->
	`»adyToIssue
()) {

1317 ià(
š¡
->
	`isMemRef
()) {

1319 
	`DPRINTF
(
IQ
, "Checking if memory instruction can issue.\n");

1323 
memD•Un™
[
š¡
->
th»adNumb”
].
	`»gsR—dy
(inst);

1328 
OpCÏss
 
İ_şass
 = 
š¡
->
	`İCÏss
();

1330 
	`DPRINTF
(
IQ
, "Instruction is„eadyo issue,…utting it onto "

1332 
š¡
->
	`pcS‹
(), 
İ_şass
, in¡->
£qNum
);

1334 
»adyIn¡s
[
İ_şass
].
	`push
(
š¡
);

1338 ià(!
queueOnLi¡
[
İ_şass
]) {

1339 
	`addToOrd”Li¡
(
İ_şass
);

1340 } ià(
»adyIn¡s
[
İ_şass
].
	`tİ
()->
£qNum
 <

1341 (*
»adyIt
[
İ_şass
]).
Şde¡In¡
) {

1342 
li¡Ord”
.
	`”a£
(
»adyIt
[
İ_şass
]);

1343 
	`addToOrd”Li¡
(
İ_şass
);

1346 
	}
}

1348 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1350 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$couÁIn¡s
()

1357 
tÙ®_š¡s
 = 0;

1359 
Th»adID
 
tid
 = 0;id < 
numTh»ads
; ++tid) {

1360 
Li¡It
 
couÁ_™
 = 
š¡Li¡
[
tid
].
	`begš
();

1362 
couÁ_™
 !ğ
š¡Li¡
[
tid
].
	`’d
()) {

1363 ià(!(*
couÁ_™
)->
	`isSquashed
(è&& !(*couÁ_™)->
	`isSquashedInIQ
()) {

1364 ià(!(*
couÁ_™
)->
	`isIssued
()) {

1365 ++
tÙ®_š¡s
;

1366 } ià((*
couÁ_™
)->
	`isMemRef
() &&

1367 !(*
couÁ_™
)->
memOpDÚe
) {

1370 ++
tÙ®_š¡s
;

1374 ++
couÁ_™
;

1378  
tÙ®_š¡s
;

1380  
numEÁr›s
 - 
ä“EÁr›s
;

1382 
	}
}

1384 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1386 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$dumpLi¡s
()

1388 
i
 = 0; i < 
Num_OpCÏs£s
; ++i) {

1389 
	`ırštf
("R—dy†i¡ %˜size: %i\n", 
i
, 
»adyIn¡s
[i].
	`size
());

1391 
	`ırštf
("\n");

1394 
	`ırštf
("NÚ s³cuÏtivli¡ size: %i\n", 
nÚS³cIn¡s
.
	`size
());

1396 
NÚS³cM­It
 
nÚ_¥ec_™
 = 
nÚS³cIn¡s
.
	`begš
();

1397 
NÚS³cM­It
 
nÚ_¥ec_’d_™
 = 
nÚS³cIn¡s
.
	`’d
();

1399 
	`ırštf
("Non speculative†ist: ");

1401 
nÚ_¥ec_™
 !ğ
nÚ_¥ec_’d_™
) {

1402 
	`ırštf
("% [¢:%Îi]", (*
nÚ_¥ec_™
).
£cÚd
->
	`pcS‹
(),

1403 (*
nÚ_¥ec_™
).
£cÚd
->
£qNum
);

1404 ++
nÚ_¥ec_™
;

1407 
	`ırštf
("\n");

1409 
Li¡Ord”It
 
li¡_Üd”_™
 = 
li¡Ord”
.
	`begš
();

1410 
Li¡Ord”It
 
li¡_Üd”_’d_™
 = 
li¡Ord”
.
	`’d
();

1411 
i
 = 1;

1413 
	`ırštf
("List order: ");

1415 
li¡_Üd”_™
 !ğ
li¡_Üd”_’d_™
) {

1416 
	`ırštf
("%˜OpCÏss:%˜[¢:%Îi] ", 
i
, (*
li¡_Üd”_™
).
queueTy³
,

1417 (*
li¡_Üd”_™
).
Şde¡In¡
);

1419 ++
li¡_Üd”_™
;

1420 ++
i
;

1423 
	`ırštf
("\n");

1424 
	}
}

1427 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1429 
	gIn¡ruùiÚQueue
<
	gIm¶
>::
	$dumpIn¡s
()

1431 
Th»adID
 
tid
 = 0;id < 
numTh»ads
; ++tid) {

1432 
num
 = 0;

1433 
v®id_num
 = 0;

1434 
Li¡It
 
š¡_li¡_™
 = 
š¡Li¡
[
tid
].
	`begš
();

1436 
š¡_li¡_™
 !ğ
š¡Li¡
[
tid
].
	`’d
()) {

1437 
	`ırštf
("In¡ruùiÚ:%i\n", 
num
);

1438 ià(!(*
š¡_li¡_™
)->
	`isSquashed
()) {

1439 ià(!(*
š¡_li¡_™
)->
	`isIssued
()) {

1440 ++
v®id_num
;

1441 
	`ırštf
("CouÁ:%i\n", 
v®id_num
);

1442 } ià((*
š¡_li¡_™
)->
	`isMemRef
() &&

1443 !(*
š¡_li¡_™
)->
	`memOpDÚe
()) {

1446 ++
v®id_num
;

1447 
	`ırštf
("CouÁ:%i\n", 
v®id_num
);

1451 
	`ırštf
("PC: %s\n[sn:%lli]\n[tid:%i]\n"

1453 (*
š¡_li¡_™
)->
	`pcS‹
(),

1454 (*
š¡_li¡_™
)->
£qNum
,

1455 (*
š¡_li¡_™
)->
th»adNumb”
,

1456 (*
š¡_li¡_™
)->
	`isIssued
(),

1457 (*
š¡_li¡_™
)->
	`isSquashed
());

1459 ià((*
š¡_li¡_™
)->
	`isMemRef
()) {

1460 
	`ırštf
("MemOpDÚe:%i\n", (*
š¡_li¡_™
)->
	`memOpDÚe
());

1463 
	`ırštf
("\n");

1465 
š¡_li¡_™
++;

1466 ++
num
;

1470 
	`ırštf
("Instso Execute†ist:\n");

1472 
num
 = 0;

1473 
v®id_num
 = 0;

1474 
Li¡It
 
š¡_li¡_™
 = 
š¡sToExecu‹
.
	`begš
();

1476 
š¡_li¡_™
 !ğ
š¡sToExecu‹
.
	`’d
())

1478 
	`ırštf
("Instruction:%i\n",

1479 
num
);

1480 ià(!(*
š¡_li¡_™
)->
	`isSquashed
()) {

1481 ià(!(*
š¡_li¡_™
)->
	`isIssued
()) {

1482 ++
v®id_num
;

1483 
	`ırštf
("CouÁ:%i\n", 
v®id_num
);

1484 } ià((*
š¡_li¡_™
)->
	`isMemRef
() &&

1485 !(*
š¡_li¡_™
)->
	`memOpDÚe
()) {

1488 ++
v®id_num
;

1489 
	`ırštf
("CouÁ:%i\n", 
v®id_num
);

1493 
	`ırštf
("PC: %s\n[sn:%lli]\n[tid:%i]\n"

1495 (*
š¡_li¡_™
)->
	`pcS‹
(),

1496 (*
š¡_li¡_™
)->
£qNum
,

1497 (*
š¡_li¡_™
)->
th»adNumb”
,

1498 (*
š¡_li¡_™
)->
	`isIssued
(),

1499 (*
š¡_li¡_™
)->
	`isSquashed
());

1501 ià((*
š¡_li¡_™
)->
	`isMemRef
()) {

1502 
	`ırštf
("MemOpDÚe:%i\n", (*
š¡_li¡_™
)->
	`memOpDÚe
());

1505 
	`ırštf
("\n");

1507 
š¡_li¡_™
++;

1508 ++
num
;

1510 
	}
}

	@isa_specific.hh

31 
	~"ıu/o3/dyn_š¡.hh
"

32 
	~"ıu/o3/im¶.hh
"

33 
	~"ıu/ba£.hh
"

	@lsq.cc

31 
	~"ıu/o3/i§_¥ecific.hh
"

32 
	~"ıu/o3/lsq_im¶.hh
"

35 
‹m¶©e
 
şass
 
	gLSQ
<
	gO3CPUIm¶
>;

	@lsq.hh

43 #iâdeà
__CPU_O3_LSQ_HH__


44 
	#__CPU_O3_LSQ_HH__


	)

46 
	~<m­
>

47 
	~<queue
>

49 
	~"ıu/o3/lsq_un™.hh
"

50 
	~"ıu/š¡_£q.hh
"

51 
	~"mem/pÜt.hh
"

52 
	~"sim/sim_objeù.hh
"

54 
	gD”ivO3CPUP¬ams
;

56 
	g‹m¶©e
 <
şass
 
	gIm¶
>

57 şas 
	cLSQ
 {

58 
	mpublic
:

59 
ty³Çme
 
	tIm¶
::
	tO3CPU
 O3CPU;

60 
ty³Çme
 
	tIm¶
::
	tDynIn¡PŒ
 DynInstPtr;

61 
ty³Çme
 
	tIm¶
::
	tCPUPŞ
::
	tIEW
 IEW;

62 
ty³Çme
 
	tIm¶
::
	tCPUPŞ
::
	tLSQUn™
 LSQUnit;

65 
	eLSQPŞicy
 {

66 
	mDyÇmic
,

67 
	mP¬t™iÚed
,

68 
	mTh»shŞd


72 
LSQ
(
O3CPU
 *
ıu_±r
, 
IEW
 *
›w_±r
, 
D”ivO3CPUP¬ams
 *
·¿ms
);

75 
	g¡d
::
¡ršg
 
	$Çme
() const;

78 
	`»gSts
();

81 
	`£tAùiveTh»ads
(
¡d
::
li¡
<
Th»adID
> *
©_±r
);

84 
	$d¿šSª™yCheck
() const;

86 
boŞ
 
	$isD¿šed
() const;

88 
	`keOv”From
();

91 
	`’ŒyAmouÁ
(
Th»adID
 
num_th»ads
);

92 
	`»moveEÁr›s
(
Th»adID
 
tid
);

94 
	`»£tEÁr›s
();

96 
	`»sizeEÁr›s
(
size
, 
Th»adID
 
tid
);

99 
	`tick
();

101 
	$tick
(
Th»adID
 
tid
)

102 { 
th»ad
[
tid
].
	`tick
(); 
	}
}

105 
š£¹Lßd
(
DynIn¡PŒ
 &
lßd_š¡
);

107 
š£¹StÜe
(
DynIn¡PŒ
 &
¡Üe_š¡
);

110 
FauÉ
 
execu‹Lßd
(
DynIn¡PŒ
 &
š¡
);

113 
FauÉ
 
execu‹StÜe
(
DynIn¡PŒ
 &
š¡
);

118 
	$comm™Lßds
(
In¡SeqNum
 &
younge¡_š¡
, 
Th»adID
 
tid
)

119 { 
th»ad
[
tid
].
	`comm™Lßds
(
younge¡_š¡
); 
	}
}

124 
	$comm™StÜes
(
In¡SeqNum
 &
younge¡_š¡
, 
Th»adID
 
tid
)

125 { 
th»ad
[
tid
].
	`comm™StÜes
(
younge¡_š¡
); 
	}
}

131 
wr™ebackStÜes
();

133 
wr™ebackStÜes
(
Th»adID
 
tid
);

138 
	$squash
(cÚ¡ 
In¡SeqNum
 &
squashed_num
, 
Th»adID
 
tid
)

139 { 
th»ad
[
tid
].
	`squash
(
squashed_num
); 
	}
}

142 
boŞ
 
viŞ©iÚ
();

147 
boŞ
 
	$viŞ©iÚ
(
Th»adID
 
tid
)

148 {  
th»ad
[
tid
].
	`viŞ©iÚ
(); 
	}
}

153 
boŞ
 
	$lßdBlocked
(
Th»adID
 
tid
)

154 {  
th»ad
[
tid
].
	`lßdBlocked
(); 
	}
}

156 
boŞ
 
	$isLßdBlockedHªdËd
(
Th»adID
 
tid
)

157 {  
th»ad
[
tid
].
	`isLßdBlockedHªdËd
(); 
	}
}

159 
	$£tLßdBlockedHªdËd
(
Th»adID
 
tid
)

160 { 
th»ad
[
tid
].
	`£tLßdBlockedHªdËd
(); 
	}
}

163 
DynIn¡PŒ
 
	$g‘MemD•ViŞ©Ü
(
Th»adID
 
tid
)

164 {  
th»ad
[
tid
].
	`g‘MemD•ViŞ©Ü
(); 
	}
}

167 
	$g‘LßdH—d
(
Th»adID
 
tid
)

168 {  
th»ad
[
tid
].
	`g‘LßdH—d
(); 
	}
}

171 
In¡SeqNum
 
	$g‘LßdH—dSeqNum
(
Th»adID
 
tid
)

173  
th»ad
[
tid
].
	`g‘LßdH—dSeqNum
();

174 
	}
}

177 
	$g‘StÜeH—d
(
Th»adID
 
tid
)

178 {  
th»ad
[
tid
].
	`g‘StÜeH—d
(); 
	}
}

181 
In¡SeqNum
 
	$g‘StÜeH—dSeqNum
(
Th»adID
 
tid
)

183  
th»ad
[
tid
].
	`g‘StÜeH—dSeqNum
();

184 
	}
}

187 
g‘CouÁ
();

189 
	$g‘CouÁ
(
Th»adID
 
tid
)

190 {  
th»ad
[
tid
].
	`g‘CouÁ
(); 
	}
}

193 
numLßds
();

195 
	$numLßds
(
Th»adID
 
tid
)

196 {  
th»ad
[
tid
].
	`numLßds
(); 
	}
}

199 
numStÜes
();

201 
	$numStÜes
(
Th»adID
 
tid
)

202 {  
th»ad
[
tid
].
	`numStÜes
(); 
	}
}

205 
numF»eEÁr›s
();

207 
numF»eEÁr›s
(
Th»adID
 
tid
);

210 
boŞ
 
isFuÎ
();

215 
boŞ
 
isFuÎ
(
Th»adID
 
tid
);

218 
boŞ
 
	$isEm±y
() const;

220 
boŞ
 
	$lqEm±y
() const;

222 
boŞ
 
	$sqEm±y
() const;

225 
boŞ
 
	`lqFuÎ
();

227 
boŞ
 
	`lqFuÎ
(
Th»adID
 
tid
);

230 
boŞ
 
	`sqFuÎ
();

232 
boŞ
 
	`sqFuÎ
(
Th»adID
 
tid
);

238 
boŞ
 
	`isSÎed
();

243 
boŞ
 
	`isSÎed
(
Th»adID
 
tid
);

246 
boŞ
 
	`hasStÜesToWB
();

251 
boŞ
 
	$hasStÜesToWB
(
Th»adID
 
tid
)

252 {  
th»ad
[
tid
].
	`hasStÜesToWB
(); 
	}
}

255 
	$numStÜesToWB
(
Th»adID
 
tid
)

256 {  
th»ad
[
tid
].
	`numStÜesToWB
(); 
	}
}

259 
boŞ
 
wlWB
();

263 
boŞ
 
	$wlWB
(
Th»adID
 
tid
)

264 {  
th»ad
[
tid
].
	`wlWB
(); 
	}
}

267 
boŞ
 
	$ÿcheBlocked
() const

268 {  
»ŒyTid
 !ğ
Inv®idTh»adID
; 
	}
}

272 
	$£tR‘ryTid
(
Th»adID
 
tid
)

273 { 
»ŒyTid
 = 
tid
; 
	}
}

276 
	$dumpIn¡s
() const;

278 
	$dumpIn¡s
(
Th»adID
 
tid
) const

279 { 
th»ad
[
tid
].
	`dumpIn¡s
(); 
	}
}

284 
FauÉ
 
»ad
(
Reque¡PŒ
 
»q
, Reque¡PŒ 
¤eqLow
, Reque¡PŒ 
¤eqHigh
,

285 
ušt8_t
 *
d©a
, 
lßd_idx
);

290 
FauÉ
 
wr™e
(
Reque¡PŒ
 
»q
, Reque¡PŒ 
¤eqLow
, Reque¡PŒ 
¤eqHigh
,

291 
ušt8_t
 *
d©a
, 
¡Üe_idx
);

296 
»cvR‘ry
();

304 
boŞ
 
»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
);

306 
»cvTimšgSnoİReq
(
Pack‘PŒ
 
pkt
);

309 
O3CPU
 *
	gıu
;

312 
IEW
 *
	g›wSge
;

314 
	g´Ùeùed
:

316 
LSQPŞicy
 
lsqPŞicy
;

319 
LSQUn™
 
	gth»ad
[
Im¶
::
MaxTh»ads
];

322 
	g¡d
::
li¡
<
Th»adID
> *
aùiveTh»ads
;

325 
	gLQEÁr›s
;

327 
	gSQEÁr›s
;

330 
	gmaxLQEÁr›s
;

333 
	gmaxSQEÁr›s
;

336 
Th»adID
 
	gnumTh»ads
;

340 
Th»adID
 
	g»ŒyTid
;

343 
	g‹m¶©e
 <
şass
 
	gIm¶
>

344 
FauÉ


345 
	gLSQ
<
	gIm¶
>::
	$»ad
(
Reque¡PŒ
 
»q
, Reque¡PŒ 
¤eqLow
, Reque¡PŒ 
¤eqHigh
,

346 
ušt8_t
 *
d©a
, 
lßd_idx
)

348 
Th»adID
 
tid
 = 
»q
->
	`th»adId
();

350  
th»ad
[
tid
].
	`»ad
(
»q
, 
¤eqLow
, 
¤eqHigh
, 
d©a
, 
lßd_idx
);

351 
	}
}

353 
	g‹m¶©e
 <
şass
 
	gIm¶
>

354 
FauÉ


355 
	gLSQ
<
	gIm¶
>::
	$wr™e
(
Reque¡PŒ
 
»q
, Reque¡PŒ 
¤eqLow
, Reque¡PŒ 
¤eqHigh
,

356 
ušt8_t
 *
d©a
, 
¡Üe_idx
)

358 
Th»adID
 
tid
 = 
»q
->
	`th»adId
();

360  
th»ad
[
tid
].
	`wr™e
(
»q
, 
¤eqLow
, 
¤eqHigh
, 
d©a
, 
¡Üe_idx
);

361 
	}
}

	@lsq_impl.hh

43 
	~<®gÜ™hm
>

44 
	~<li¡
>

45 
	~<¡ršg
>

47 
	~"ıu/o3/lsq.hh
"

48 
	~"debug/D¿š.hh
"

49 
	~"debug/F‘ch.hh
"

50 
	~"debug/LSQ.hh
"

51 
	~"debug/Wr™eback.hh
"

52 
	~"·¿ms/D”ivO3CPU.hh
"

54 
usšg
 
Çme¥aû
 
	g¡d
;

56 
	g‹m¶©e
 <
şass
 
	gIm¶
>

57 
	gLSQ
<
	gIm¶
>::
	$LSQ
(
O3CPU
 *
ıu_±r
, 
IEW
 *
›w_±r
, 
D”ivO3CPUP¬ams
 *
·¿ms
)

58 : 
	`ıu
(
ıu_±r
), 
	`›wSge
(
›w_±r
),

59 
	`LQEÁr›s
(
·¿ms
->
LQEÁr›s
),

60 
	`SQEÁr›s
(
·¿ms
->
SQEÁr›s
),

61 
	`numTh»ads
(
·¿ms
->
numTh»ads
),

62 
	`»ŒyTid
(-1)

67 
¡d
::
¡ršg
 
pŞicy
 = 
·¿ms
->
smtLSQPŞicy
;

70 
¡d
::
	`ŒªsfÜm
(
pŞicy
.
	`begš
(),…Şicy.
	`’d
(),…olicy.begin(),

71 ((*)()è
tŞow”
);

74 ià(
pŞicy
 == "dynamic") {

75 
lsqPŞicy
 = 
DyÇmic
;

77 
maxLQEÁr›s
 = 
LQEÁr›s
;

78 
maxSQEÁr›s
 = 
SQEÁr›s
;

80 
	`DPRINTF
(
LSQ
, "LSQ sharing…olicy seto Dynamic\n");

81 } ià(
pŞicy
 == "partitioned") {

82 
lsqPŞicy
 = 
P¬t™iÚed
;

85 
maxLQEÁr›s
 = 
LQEÁr›s
 / 
numTh»ads
;

86 
maxSQEÁr›s
 = 
SQEÁr›s
 / 
numTh»ads
;

88 
	`DPRINTF
(
F‘ch
, "LSQ sharing…olicy seto Partitioned: "

90 
maxLQEÁr›s
,
maxSQEÁr›s
);

91 } ià(
pŞicy
 == "threshold") {

92 
lsqPŞicy
 = 
Th»shŞd
;

94 
	`as£¹
(
·¿ms
->
smtLSQTh»shŞd
 > 
LQEÁr›s
);

95 
	`as£¹
(
·¿ms
->
smtLSQTh»shŞd
 > 
SQEÁr›s
);

100 
maxLQEÁr›s
 = 
·¿ms
->
smtLSQTh»shŞd
;

101 
maxSQEÁr›s
 = 
·¿ms
->
smtLSQTh»shŞd
;

103 
	`DPRINTF
(
LSQ
, "LSQ sharing…olicy seto Threshold: "

105 
maxLQEÁr›s
,
maxSQEÁr›s
);

107 
	`as£¹
(0 && "Invalid LSQ Sharing Policy.Options Are:{Dynamic,"

112 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

113 
th»ad
[
tid
].
	`š™
(
ıu
, 
›w_±r
, 
·¿ms
, 
this
,

114 
maxLQEÁr›s
, 
maxSQEÁr›s
, 
tid
);

115 
th»ad
[
tid
].
	`£tDÿchePÜt
(&
ıu_±r
->
	`g‘D©aPÜt
());

117 
	}
}

120 
	g‹m¶©e
<
şass
 
	gIm¶
>

121 
	g¡d
::
¡ršg


122 
LSQ
<
Im¶
>::
	$Çme
() const

124  
›wSge
->
	`Çme
() + ".lsq";

125 
	}
}

127 
	g‹m¶©e
<
şass
 
	gIm¶
>

129 
	gLSQ
<
	gIm¶
>::
	$»gSts
()

132 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

133 
th»ad
[
tid
].
	`»gSts
();

135 
	}
}

137 
	g‹m¶©e
<
şass
 
	gIm¶
>

139 
	gLSQ
<
	gIm¶
>::
£tAùiveTh»ads
(
li¡
<
Th»adID
> *
©_±r
)

141 
aùiveTh»ads
 = 
©_±r
;

142 
as£¹
(
aùiveTh»ads
 != 0);

145 
	g‹m¶©e
 <
şass
 
	gIm¶
>

147 
	gLSQ
<
	gIm¶
>::
	$d¿šSª™yCheck
() const

149 
	`as£¹
(
	`isD¿šed
());

151 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++)

152 
th»ad
[
tid
].
	`d¿šSª™yCheck
();

153 
	}
}

155 
	g‹m¶©e
 <
şass
 
	gIm¶
>

156 
boŞ


157 
	gLSQ
<
	gIm¶
>::
	$isD¿šed
() const

159 
boŞ
 
	`d¿šed
(
Œue
);

161 ià(!
	`lqEm±y
()) {

162 
	`DPRINTF
(
D¿š
, "Not drained, LQ‚otƒmpty.\n");

163 
d¿šed
 = 
çl£
;

166 ià(!
	`sqEm±y
()) {

167 
	`DPRINTF
(
D¿š
, "Not drained, SQ‚otƒmpty.\n");

168 
d¿šed
 = 
çl£
;

171 ià(
»ŒyTid
 !ğ
Inv®idTh»adID
) {

172 
	`DPRINTF
(
D¿š
, "Not drained,he LSQ has blockedhe caches.\n");

173 
d¿šed
 = 
çl£
;

176  
d¿šed
;

177 
	}
}

179 
	g‹m¶©e
 <
şass
 
	gIm¶
>

181 
	gLSQ
<
	gIm¶
>::
	$keOv”From
()

183 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

184 
th»ad
[
tid
].
	`keOv”From
();

186 
	}
}

188 
	g‹m¶©e
 <
şass
 
	gIm¶
>

190 
	gLSQ
<
	gIm¶
>::
	$’ŒyAmouÁ
(
Th»adID
 
num_th»ads
)

192 ià(
lsqPŞicy
 =ğ
P¬t™iÚed
) {

193  
LQEÁr›s
 / 
num_th»ads
;

197 
	}
}

199 
	g‹m¶©e
 <
şass
 
	gIm¶
>

201 
	gLSQ
<
	gIm¶
>::
	$»£tEÁr›s
()

203 ià(
lsqPŞicy
 !ğ
DyÇmic
 || 
numTh»ads
 > 1) {

204 
aùive_th»ads
 = 
aùiveTh»ads
->
	`size
();

206 
maxEÁr›s
;

208 ià(
lsqPŞicy
 =ğ
P¬t™iÚed
) {

209 
maxEÁr›s
 = 
LQEÁr›s
 / 
aùive_th»ads
;

210 } ià(
lsqPŞicy
 =ğ
Th»shŞd
 && 
aùive_th»ads
 == 1) {

211 
maxEÁr›s
 = 
LQEÁr›s
;

213 
maxEÁr›s
 = 
LQEÁr›s
;

216 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

217 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

219 
th»ads
 !ğ
’d
) {

220 
Th»adID
 
tid
 = *
th»ads
++;

222 
	`»sizeEÁr›s
(
maxEÁr›s
, 
tid
);

225 
	}
}

227 
	g‹m¶©e
<
şass
 
	gIm¶
>

229 
	gLSQ
<
	gIm¶
>::
	$»moveEÁr›s
(
Th»adID
 
tid
)

231 
th»ad
[
tid
].
	`ş—rLQ
();

232 
th»ad
[
tid
].
	`ş—rSQ
();

233 
	}
}

235 
	g‹m¶©e
<
şass
 
	gIm¶
>

237 
	gLSQ
<
	gIm¶
>::
	$»sizeEÁr›s
(
size
, 
Th»adID
 
tid
)

239 
th»ad
[
tid
].
	`»sizeLQ
(
size
);

240 
th»ad
[
tid
].
	`»sizeSQ
(
size
);

241 
	}
}

243 
	g‹m¶©e
<
şass
 
	gIm¶
>

245 
	gLSQ
<
	gIm¶
>::
	$tick
()

247 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

248 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

250 
th»ads
 !ğ
’d
) {

251 
Th»adID
 
tid
 = *
th»ads
++;

253 
th»ad
[
tid
].
	`tick
();

255 
	}
}

257 
	g‹m¶©e
<
şass
 
	gIm¶
>

259 
	gLSQ
<
	gIm¶
>::
	$š£¹Lßd
(
DynIn¡PŒ
 &
lßd_š¡
)

261 
Th»adID
 
tid
 = 
lßd_š¡
->
th»adNumb”
;

263 
th»ad
[
tid
].
	`š£¹Lßd
(
lßd_š¡
);

264 
	}
}

266 
	g‹m¶©e
<
şass
 
	gIm¶
>

268 
	gLSQ
<
	gIm¶
>::
	$š£¹StÜe
(
DynIn¡PŒ
 &
¡Üe_š¡
)

270 
Th»adID
 
tid
 = 
¡Üe_š¡
->
th»adNumb”
;

272 
th»ad
[
tid
].
	`š£¹StÜe
(
¡Üe_š¡
);

273 
	}
}

275 
	g‹m¶©e
<
şass
 
	gIm¶
>

276 
FauÉ


277 
	gLSQ
<
	gIm¶
>::
	$execu‹Lßd
(
DynIn¡PŒ
 &
š¡
)

279 
Th»adID
 
tid
 = 
š¡
->
th»adNumb”
;

281  
th»ad
[
tid
].
	`execu‹Lßd
(
š¡
);

282 
	}
}

284 
	g‹m¶©e
<
şass
 
	gIm¶
>

285 
FauÉ


286 
	gLSQ
<
	gIm¶
>::
	$execu‹StÜe
(
DynIn¡PŒ
 &
š¡
)

288 
Th»adID
 
tid
 = 
š¡
->
th»adNumb”
;

290  
th»ad
[
tid
].
	`execu‹StÜe
(
š¡
);

291 
	}
}

293 
	g‹m¶©e
<
şass
 
	gIm¶
>

295 
	gLSQ
<
	gIm¶
>::
	$wr™ebackStÜes
()

297 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

298 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

300 
th»ads
 !ğ
’d
) {

301 
Th»adID
 
tid
 = *
th»ads
++;

303 ià(
	`numStÜesToWB
(
tid
) > 0) {

304 
	`DPRINTF
(
Wr™eback
,"[tid:%i] Writing back stores. %i stores "

305 "avaabË fÜ Wr™eback.\n", 
tid
, 
	`numStÜesToWB
(tid));

308 
th»ad
[
tid
].
	`wr™ebackStÜes
();

310 
	}
}

312 
	g‹m¶©e
<
şass
 
	gIm¶
>

313 
boŞ


314 
	gLSQ
<
	gIm¶
>::
	$viŞ©iÚ
()

317 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

318 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

320 
th»ads
 !ğ
’d
) {

321 
Th»adID
 
tid
 = *
th»ads
++;

323 ià(
th»ad
[
tid
].
	`viŞ©iÚ
())

324  
Œue
;

327  
çl£
;

328 
	}
}

330 
	g‹m¶©e
 <
şass
 
	gIm¶
>

332 
	gLSQ
<
	gIm¶
>::
	$»cvR‘ry
()

334 ià(
»ŒyTid
 =ğ
Inv®idTh»adID
)

339 
cu¼_»Œy_tid
 = 
»ŒyTid
;

342 
»ŒyTid
 = -1;

343 
th»ad
[
cu¼_»Œy_tid
].
	`»cvR‘ry
();

344 
	}
}

346 
	g‹m¶©e
 <
şass
 
	gIm¶
>

347 
boŞ


348 
	gLSQ
<
	gIm¶
>::
	$»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
)

350 ià(
pkt
->
	`isE¼Ü
())

351 
	`DPRINTF
(
LSQ
, "Gotƒrror…acket back for‡ddress: %#X\n",

352 
pkt
->
	`g‘Addr
());

353 
th»ad
[
pkt
->
»q
->
	`th»adId
()].
	`com¶‘eD©aAcûss
(pkt);

354  
Œue
;

355 
	}
}

357 
	g‹m¶©e
 <
şass
 
	gIm¶
>

359 
	gLSQ
<
	gIm¶
>::
	$»cvTimšgSnoİReq
(
Pack‘PŒ
 
pkt
)

361 
	`DPRINTF
(
LSQ
, "»ûived…kˆfÜ‡ddr:%#x %s\n", 
pkt
->
	`g‘Addr
(),

362 
pkt
->
	`cmdSŒšg
());

365 ià(
pkt
->
	`isInv®id©e
()) {

366 
	`DPRINTF
(
LSQ
, "received invalidation for‡ddr:%#x\n",

367 
pkt
->
	`g‘Addr
());

368 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

369 
th»ad
[
tid
].
	`checkSnoİ
(
pkt
);

372 
	}
}

374 
	g‹m¶©e
<
şass
 
	gIm¶
>

376 
	gLSQ
<
	gIm¶
>::
	$g‘CouÁ
()

378 
tÙ®
 = 0;

380 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

381 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

383 
th»ads
 !ğ
’d
) {

384 
Th»adID
 
tid
 = *
th»ads
++;

386 
tÙ®
 +ğ
	`g‘CouÁ
(
tid
);

389  
tÙ®
;

390 
	}
}

392 
	g‹m¶©e
<
şass
 
	gIm¶
>

394 
	gLSQ
<
	gIm¶
>::
	$numLßds
()

396 
tÙ®
 = 0;

398 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

399 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

401 
th»ads
 !ğ
’d
) {

402 
Th»adID
 
tid
 = *
th»ads
++;

404 
tÙ®
 +ğ
	`numLßds
(
tid
);

407  
tÙ®
;

408 
	}
}

410 
	g‹m¶©e
<
şass
 
	gIm¶
>

412 
	gLSQ
<
	gIm¶
>::
	$numStÜes
()

414 
tÙ®
 = 0;

416 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

417 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

419 
th»ads
 !ğ
’d
) {

420 
Th»adID
 
tid
 = *
th»ads
++;

422 
tÙ®
 +ğ
th»ad
[
tid
].
	`numStÜes
();

425  
tÙ®
;

426 
	}
}

428 
	g‹m¶©e
<
şass
 
	gIm¶
>

430 
	gLSQ
<
	gIm¶
>::
	$numF»eEÁr›s
()

432 
tÙ®
 = 0;

434 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

435 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

437 
th»ads
 !ğ
’d
) {

438 
Th»adID
 
tid
 = *
th»ads
++;

440 
tÙ®
 +ğ
th»ad
[
tid
].
	`numF»eEÁr›s
();

443  
tÙ®
;

444 
	}
}

446 
	g‹m¶©e
<
şass
 
	gIm¶
>

448 
	gLSQ
<
	gIm¶
>::
	$numF»eEÁr›s
(
Th»adID
 
tid
)

453  
th»ad
[
tid
].
	`numF»eEÁr›s
();

454 
	}
}

456 
	g‹m¶©e
<
şass
 
	gIm¶
>

457 
boŞ


458 
	gLSQ
<
	gIm¶
>::
	$isFuÎ
()

460 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

461 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

463 
th»ads
 !ğ
’d
) {

464 
Th»adID
 
tid
 = *
th»ads
++;

466 ià(!(
th»ad
[
tid
].
	`lqFuÎ
(è||h»ad[tid].
	`sqFuÎ
()))

467  
çl£
;

470  
Œue
;

471 
	}
}

473 
	g‹m¶©e
<
şass
 
	gIm¶
>

474 
boŞ


475 
	gLSQ
<
	gIm¶
>::
	$isFuÎ
(
Th»adID
 
tid
)

479 ià(
lsqPŞicy
 =ğ
DyÇmic
)

480  
	`isFuÎ
();

482  
th»ad
[
tid
].
	`lqFuÎ
(è||h»ad[tid].
	`sqFuÎ
();

483 
	}
}

485 
	g‹m¶©e
<
şass
 
	gIm¶
>

486 
boŞ


487 
	gLSQ
<
	gIm¶
>::
	$isEm±y
() const

489  
	`lqEm±y
(è&& 
	`sqEm±y
();

490 
	}
}

492 
	g‹m¶©e
<
şass
 
	gIm¶
>

493 
boŞ


494 
	gLSQ
<
	gIm¶
>::
	$lqEm±y
() const

496 
li¡
<
Th»adID
>::
cÚ¡_™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

497 
li¡
<
Th»adID
>::
cÚ¡_™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

499 
th»ads
 !ğ
’d
) {

500 
Th»adID
 
tid
 = *
th»ads
++;

502 ià(!
th»ad
[
tid
].
	`lqEm±y
())

503  
çl£
;

506  
Œue
;

507 
	}
}

509 
	g‹m¶©e
<
şass
 
	gIm¶
>

510 
boŞ


511 
	gLSQ
<
	gIm¶
>::
	$sqEm±y
() const

513 
li¡
<
Th»adID
>::
cÚ¡_™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

514 
li¡
<
Th»adID
>::
cÚ¡_™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

516 
th»ads
 !ğ
’d
) {

517 
Th»adID
 
tid
 = *
th»ads
++;

519 ià(!
th»ad
[
tid
].
	`sqEm±y
())

520  
çl£
;

523  
Œue
;

524 
	}
}

526 
	g‹m¶©e
<
şass
 
	gIm¶
>

527 
boŞ


528 
	gLSQ
<
	gIm¶
>::
	$lqFuÎ
()

530 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

531 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

533 
th»ads
 !ğ
’d
) {

534 
Th»adID
 
tid
 = *
th»ads
++;

536 ià(!
th»ad
[
tid
].
	`lqFuÎ
())

537  
çl£
;

540  
Œue
;

541 
	}
}

543 
	g‹m¶©e
<
şass
 
	gIm¶
>

544 
boŞ


545 
	gLSQ
<
	gIm¶
>::
	$lqFuÎ
(
Th»adID
 
tid
)

549 ià(
lsqPŞicy
 =ğ
DyÇmic
)

550  
	`lqFuÎ
();

552  
th»ad
[
tid
].
	`lqFuÎ
();

553 
	}
}

555 
	g‹m¶©e
<
şass
 
	gIm¶
>

556 
boŞ


557 
	gLSQ
<
	gIm¶
>::
	$sqFuÎ
()

559 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

560 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

562 
th»ads
 !ğ
’d
) {

563 
Th»adID
 
tid
 = *
th»ads
++;

565 ià(!
	`sqFuÎ
(
tid
))

566  
çl£
;

569  
Œue
;

570 
	}
}

572 
	g‹m¶©e
<
şass
 
	gIm¶
>

573 
boŞ


574 
	gLSQ
<
	gIm¶
>::
	$sqFuÎ
(
Th»adID
 
tid
)

578 ià(
lsqPŞicy
 =ğ
DyÇmic
)

579  
	`sqFuÎ
();

581  
th»ad
[
tid
].
	`sqFuÎ
();

582 
	}
}

584 
	g‹m¶©e
<
şass
 
	gIm¶
>

585 
boŞ


586 
	gLSQ
<
	gIm¶
>::
	$isSÎed
()

588 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

589 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

591 
th»ads
 !ğ
’d
) {

592 
Th»adID
 
tid
 = *
th»ads
++;

594 ià(!
th»ad
[
tid
].
	`isSÎed
())

595  
çl£
;

598  
Œue
;

599 
	}
}

601 
	g‹m¶©e
<
şass
 
	gIm¶
>

602 
boŞ


603 
	gLSQ
<
	gIm¶
>::
	$isSÎed
(
Th»adID
 
tid
)

605 ià(
lsqPŞicy
 =ğ
DyÇmic
)

606  
	`isSÎed
();

608  
th»ad
[
tid
].
	`isSÎed
();

609 
	}
}

611 
	g‹m¶©e
<
şass
 
	gIm¶
>

612 
boŞ


613 
	gLSQ
<
	gIm¶
>::
	$hasStÜesToWB
()

615 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

616 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

618 
th»ads
 !ğ
’d
) {

619 
Th»adID
 
tid
 = *
th»ads
++;

621 ià(
	`hasStÜesToWB
(
tid
))

622  
Œue
;

625  
çl£
;

626 
	}
}

628 
	g‹m¶©e
<
şass
 
	gIm¶
>

629 
boŞ


630 
	gLSQ
<
	gIm¶
>::
	$wlWB
()

632 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

633 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

635 
th»ads
 !ğ
’d
) {

636 
Th»adID
 
tid
 = *
th»ads
++;

638 ià(
	`wlWB
(
tid
))

639  
Œue
;

642  
çl£
;

643 
	}
}

645 
	g‹m¶©e
<
şass
 
	gIm¶
>

647 
	gLSQ
<
	gIm¶
>::
	$dumpIn¡s
() const

649 
li¡
<
Th»adID
>::
cÚ¡_™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

650 
li¡
<
Th»adID
>::
cÚ¡_™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

652 
th»ads
 !ğ
’d
) {

653 
Th»adID
 
tid
 = *
th»ads
++;

655 
th»ad
[
tid
].
	`dumpIn¡s
();

657 
	}
}

	@lsq_unit.cc

32 
	~"ıu/o3/i§_¥ecific.hh
"

33 
	~"ıu/o3/lsq_un™_im¶.hh
"

36 
‹m¶©e
 
şass
 
	gLSQUn™
<
	gO3CPUIm¶
>;

	@lsq_unit.hh

44 #iâdeà
__CPU_O3_LSQ_UNIT_HH__


45 
	#__CPU_O3_LSQ_UNIT_HH__


	)

47 
	~<®gÜ™hm
>

48 
	~<c¡ršg
>

49 
	~<m­
>

50 
	~<queue
>

52 
	~"¬ch/g’”ic/debugçuÉs.hh
"

53 
	~"¬ch/i§_Œa™s.hh
"

54 
	~"¬ch/locked_mem.hh
"

55 
	~"¬ch/mm­³d_r.hh
"

56 
	~"ba£/hashm­.hh
"

57 
	~"cÚfig/the_i§.hh
"

58 
	~"ıu/š¡_£q.hh
"

59 
	~"ıu/timebuf.hh
"

60 
	~"debug/LSQUn™.hh
"

61 
	~"mem/·ck‘.hh
"

62 
	~"mem/pÜt.hh
"

63 
	~"sim/çuÉ_fwd.hh
"

65 
	gD”ivO3CPUP¬ams
;

79 
	g‹m¶©e
 <
şass
 
	gIm¶
>

80 şas 
	cLSQUn™
 {

81 
	mpublic
:

82 
ty³Çme
 
	tIm¶
::
	tO3CPU
 O3CPU;

83 
ty³Çme
 
	tIm¶
::
	tDynIn¡PŒ
 DynInstPtr;

84 
ty³Çme
 
	tIm¶
::
	tCPUPŞ
::
	tIEW
 IEW;

85 
ty³Çme
 
	tIm¶
::
	tCPUPŞ
::
	tLSQ
 LSQ;

86 
ty³Çme
 
	tIm¶
::
	tCPUPŞ
::
	tIssueSŒuù
 IssueStruct;

88 
	mpublic
:

90 
LSQUn™
();

93 
š™
(
O3CPU
 *
ıu_±r
, 
IEW
 *
›w_±r
, 
D”ivO3CPUP¬ams
 *
·¿ms
,

94 
LSQ
 *
lsq_±r
, 
maxLQEÁr›s
, 
maxSQEÁr›s
,

95 
id
);

98 
	m¡d
::
¡ršg
 
	$Çme
() const;

101 
	`»gSts
();

104 
	`£tDÿchePÜt
(
Ma¡”PÜt
 *
dÿche_pÜt
);

107 
	$d¿šSª™yCheck
() const;

110 
	`keOv”From
();

117 
	$tick
(è{ 
u£dPÜts
 = 0; }

120 
	`š£¹
(
DynIn¡PŒ
 &
š¡
);

122 
	`š£¹Lßd
(
DynIn¡PŒ
 &
lßd_š¡
);

124 
	`š£¹StÜe
(
DynIn¡PŒ
 &
¡Üe_š¡
);

132 
FauÉ
 
	`checkViŞ©iÚs
(
lßd_idx
, 
DynIn¡PŒ
 &
š¡
);

138 
	`checkSnoİ
(
Pack‘PŒ
 
pkt
);

141 
FauÉ
 
	`execu‹Lßd
(
DynIn¡PŒ
 &
š¡
);

143 
FauÉ
 
	$execu‹Lßd
(
lq_idx
è{ 
	`·nic
("NÙ im¶em’‹d");  
NoFauÉ
; 
	}
}

145 
FauÉ
 
execu‹StÜe
(
DynIn¡PŒ
 &
š¡
);

148 
comm™Lßd
();

150 
comm™Lßds
(
In¡SeqNum
 &
younge¡_š¡
);

153 
comm™StÜes
(
In¡SeqNum
 &
younge¡_š¡
);

156 
wr™ebackStÜes
();

160 
com¶‘eD©aAcûss
(
Pack‘PŒ
 
pkt
);

163 
ş—rLQ
();

166 
ş—rSQ
();

169 
»sizeLQ
(
size
);

172 
»sizeSQ
(
size
);

175 
squash
(cÚ¡ 
In¡SeqNum
 &
squashed_num
);

180 
boŞ
 
	$viŞ©iÚ
(è{  
memD•ViŞ©Ü
; 
	}
}

183 
DynIn¡PŒ
 
g‘MemD•ViŞ©Ü
();

186 
boŞ
 
	$lßdBlocked
()

187 {  
isLßdBlocked
; 
	}
}

190 
	$ş—rLßdBlocked
()

191 { 
isLßdBlocked
 = 
çl£
; 
	}
}

194 
boŞ
 
	$isLßdBlockedHªdËd
()

195 {  
lßdBlockedHªdËd
; 
	}
}

198 
	$£tLßdBlockedHªdËd
()

199 { 
lßdBlockedHªdËd
 = 
Œue
; 
	}
}

202 
numF»eEÁr›s
();

205 
	$numLßds
(è{  
lßds
; 
	}
}

208 
	$numStÜes
(è{  
¡Ües
; 
	}
}

211 
boŞ
 
	$isFuÎ
(è{  
	`lqFuÎ
(è|| 
	`sqFuÎ
(); 
	}
}

214 
boŞ
 
	$isEm±y
(ècÚ¡ {  
	`lqEm±y
(è&& 
	`sqEm±y
(); 
	}
}

217 
boŞ
 
	$lqFuÎ
(è{  
lßds
 >ğ(
LQEÁr›s
 - 1); 
	}
}

220 
boŞ
 
	$sqFuÎ
(è{  
¡Ües
 >ğ(
SQEÁr›s
 - 1); 
	}
}

223 
boŞ
 
	$lqEm±y
(ècÚ¡ {  
lßds
 =ğ0; 
	}
}

226 
boŞ
 
	$sqEm±y
(ècÚ¡ {  
¡Ües
 =ğ0; 
	}
}

229 
	$g‘CouÁ
(è{  
lßds
 + 
¡Ües
; 
	}
}

232 
boŞ
 
	$hasStÜesToWB
(è{  
¡ÜesToWB
; 
	}
}

235 
	$numStÜesToWB
(è{  
¡ÜesToWB
; 
	}
}

238 
boŞ
 
	$wlWB
(è{  
¡ÜeQueue
[
¡ÜeWBIdx
].
ÿnWB
 &&

239 !
¡ÜeQueue
[
¡ÜeWBIdx
].
com¶‘ed
 &&

240 !
isStÜeBlocked
; 
	}
}

243 
»cvR‘ry
();

245 
	g´iv©e
:

247 
»£tS‹
();

250 
wr™eback
(
DynIn¡PŒ
 &
š¡
, 
Pack‘PŒ
 
pkt
);

253 
wr™ebackP’dšgStÜe
();

256 
¡ÜePo¡S’d
(
Pack‘PŒ
 
pkt
);

259 
com¶‘eStÜe
(
¡Üe_idx
);

262 
boŞ
 
£ndStÜe
(
Pack‘PŒ
 
d©a_pkt
);

265 
šlše
 
	$šüStIdx
(&
¡Üe_idx
) const;

267 
šlše
 
	$deüStIdx
(&
¡Üe_idx
) const;

269 
šlše
 
	$šüLdIdx
(&
lßd_idx
) const;

271 
šlše
 
	$deüLdIdx
(&
lßd_idx
) const;

273 
public
:

275 
	$dumpIn¡s
() const;

277 
´iv©e
:

279 
O3CPU
 *
ıu
;

282 
IEW
 *
›wSge
;

285 
LSQ
 *
lsq
;

288 
Ma¡”PÜt
 *
dÿchePÜt
;

291 şas 
	cLSQS’d”S‹
 : 
public
 
Pack‘
::
S’d”S‹


293 
public
:

295 
	`LSQS’d”S‹
()

296 : 
	`mašPkt
(
NULL
), 
	`³ndšgPack‘
(NULL), 
	`out¡ªdšg
(1),

297 
	`noWB
(
çl£
), 
	`isS¶™
(çl£), 
	`pktToS’d
(false)

301 
DynIn¡PŒ
 
š¡
;

303 
Pack‘PŒ
 
mašPkt
;

305 
Pack‘PŒ
 
³ndšgPack‘
;

307 
ušt8_t
 
idx
;

309 
ušt8_t
 
out¡ªdšg
;

311 
boŞ
 
isLßd
;

313 
boŞ
 
noWB
;

315 
boŞ
 
isS¶™
;

317 
boŞ
 
pktToS’d
;

320 
šlše
 
boŞ
 
	`com¶‘e
(è{  --
out¡ªdšg
 == 0; }

321 
	}
};

324 şas 
	cWr™ebackEv’t
 : 
public
 
Ev’t
 {

325 
public
:

327 
Wr™ebackEv’t
(
DynIn¡PŒ
 &
_š¡
, 
Pack‘PŒ
 
pkt
, 
LSQUn™
 *
lsq_±r
);

329 
	g¡d
::
¡ršg
 
g‘ObjeùId
() const

331  
lsqPŒ
->
ıu
->
g‘ObjeùId
();

335 
´oûss
();

338 cÚ¡ *
desütiÚ
() const;

340 
	g´iv©e
:

342 
DynIn¡PŒ
 
š¡
;

345 
Pack‘PŒ
 
	gpkt
;

348 
	gLSQUn™
<
	gIm¶
> *
	glsqPŒ
;

351 
	gpublic
:

352 
	sSQEÁry
 {

354 
SQEÁry
()

355 : 
š¡
(
NULL
), 
»q
(NULL), 
size
(0),

356 
ÿnWB
(0), 
comm™‹d
(0), 
com¶‘ed
(0)

358 
	g¡d
::
mem£t
(
d©a
, 0, (data));

361 ~
SQEÁry
()

363 
	gš¡
 = 
NULL
;

367 
SQEÁry
(
DynIn¡PŒ
 &
_š¡
)

368 : 
š¡
(
_š¡
), 
»q
(
NULL
), 
¤eqLow
(NULL), 
¤eqHigh
(NULL), 
size
(0),

369 
isS¶™
(0), 
ÿnWB
(0), 
comm™‹d
(0), 
com¶‘ed
(0)

371 
	g¡d
::
mem£t
(
d©a
, 0, (data));

374 
	gd©a
[16];

376 
DynIn¡PŒ
 
	gš¡
;

378 
Reque¡PŒ
 
	g»q
;

380 
Reque¡PŒ
 
	g¤eqLow
;

381 
Reque¡PŒ
 
	g¤eqHigh
;

383 
ušt8_t
 
	gsize
;

385 
boŞ
 
	gisS¶™
;

387 
boŞ
 
	gÿnWB
;

389 
boŞ
 
	gcomm™‹d
;

391 
boŞ
 
	gcom¶‘ed
;

394 
	g´iv©e
:

396 
Th»adID
 
lsqID
;

399 
	g¡d
::
veùÜ
<
SQEÁry
> 
¡ÜeQueue
;

402 
	g¡d
::
veùÜ
<
DynIn¡PŒ
> 
lßdQueue
;

407 
	gLQEÁr›s
;

411 
	gSQEÁr›s
;

416 
	gd•CheckShiá
;

419 
boŞ
 
	gcheckLßds
;

422 
	glßds
;

424 
	g¡Ües
;

426 
	g¡ÜesToWB
;

429 
	glßdH—d
;

431 
	glßdTa
;

434 
	g¡ÜeH—d
;

438 
	g¡ÜeWBIdx
;

440 
	g¡ÜeTa
;

444 
	gÿchePÜts
;

447 
	gu£dPÜts
;

452 
Addr
 
	gÿcheBlockMask
;

455 
ty³Çme
 
	gTimeBufãr
<
	gIssueSŒuù
>::
wœe
 
äomIssue
;

458 
boŞ
 
	g¡®Ëd
;

462 
In¡SeqNum
 
	g¡®lšgStÜeI¢
;

464 
	g¡®lšgLßdIdx
;

467 
Pack‘PŒ
 
	g»ŒyPkt
;

470 
boŞ
 
	gisStÜeBlocked
;

473 
boŞ
 
	gisLßdBlocked
;

476 
boŞ
 
	glßdBlockedHªdËd
;

479 
boŞ
 
	g¡ÜeInFlight
;

482 
In¡SeqNum
 
	gblockedLßdSeqNum
;

485 
DynIn¡PŒ
 
	gmemD•ViŞ©Ü
;

489 
boŞ
 
	ghasP’dšgPkt
;

492 
Pack‘PŒ
 
	g³ndšgPkt
;

495 
boŞ
 
	gÃedsTSO
;

501 
	gSts
::
SÿÏr
 
lsqFÜwLßds
;

504 
	gSts
::
SÿÏr
 
švAddrLßds
;

507 
	gSts
::
SÿÏr
 
lsqSquashedLßds
;

511 
	gSts
::
SÿÏr
 
lsqIgnÜedRe¥Ú£s
;

514 
	gSts
::
SÿÏr
 
lsqMemOrd”ViŞ©iÚ
;

517 
	gSts
::
SÿÏr
 
lsqSquashedStÜes
;

520 
	gSts
::
SÿÏr
 
švAddrSwpfs
;

523 
	gSts
::
SÿÏr
 
lsqBlockedLßds
;

526 
	gSts
::
SÿÏr
 
lsqRescheduËdLßds
;

529 
	gSts
::
SÿÏr
 
lsqCacheBlocked
;

531 
	gpublic
:

533 
FauÉ
 
»ad
(
Reque¡
 *
»q
, Reque¡ *
¤eqLow
, Reque¡ *
¤eqHigh
,

534 
ušt8_t
 *
d©a
, 
lßd_idx
);

537 
FauÉ
 
wr™e
(
Reque¡
 *
»q
, Reque¡ *
¤eqLow
, Reque¡ *
¤eqHigh
,

538 
ušt8_t
 *
d©a
, 
¡Üe_idx
);

541 
	$g‘LßdH—d
(è{  
lßdH—d
; 
	}
}

543 
In¡SeqNum
 
	$g‘LßdH—dSeqNum
()

545 ià(
lßdQueue
[
lßdH—d
]) {

546  
lßdQueue
[
lßdH—d
]->
£qNum
;

551 
	}
}

554 
	$g‘StÜeH—d
(è{  
¡ÜeH—d
; 
	}
}

556 
In¡SeqNum
 
	$g‘StÜeH—dSeqNum
()

558 ià(
¡ÜeQueue
[
¡ÜeH—d
].
š¡
) {

559  
¡ÜeQueue
[
¡ÜeH—d
].
š¡
->
£qNum
;

564 
	}
}

567 
boŞ
 
	$isSÎed
(è{  
¡®Ëd
; 
	}
}

570 
	g‹m¶©e
 <
şass
 
	gIm¶
>

571 
FauÉ


572 
	gLSQUn™
<
	gIm¶
>::
	$»ad
(
Reque¡
 *
»q
, Reque¡ *
¤eqLow
, Reque¡ *
¤eqHigh
,

573 
ušt8_t
 *
d©a
, 
lßd_idx
)

575 
DynIn¡PŒ
 
lßd_š¡
 = 
lßdQueue
[
lßd_idx
];

577 
	`as£¹
(
lßd_š¡
);

579 
	`as£¹
(!
lßd_š¡
->
	`isExecu‹d
());

585 ià(
»q
->
	`isUnÿch—bË
() &&

586 (
lßd_idx
 !ğ
lßdH—d
 || !
lßd_š¡
->
	`isAtComm™
())) {

587 
›wSge
->
	`»scheduËMemIn¡
(
lßd_š¡
);

588 ++
lsqRescheduËdLßds
;

589 
	`DPRINTF
(
LSQUn™
, "Uncachable†oad [sn:%lli] PC %s\n",

590 
lßd_š¡
->
£qNum
,†ßd_š¡->
	`pcS‹
());

595 
d–‘e
 
»q
;

596 ià(
TheISA
::
HasUÇligÃdMemAcc
 && 
¤eqLow
) {

597 
d–‘e
 
¤eqLow
;

598 
d–‘e
 
¤eqHigh
;

600  
Ãw
 
G’”icISA
::
	`M5PªicFauÉ
(

602 
lßd_š¡
->
£qNum
,†ßd_š¡->
	`pcS‹
());

606 
¡Üe_idx
 = 
lßd_š¡
->
sqIdx
;

608 
¡Üe_size
 = 0;

610 
	`DPRINTF
(
LSQUn™
, "Read called,†oad idx: %i, store idx: %i, "

612 
lßd_idx
, 
¡Üe_idx
, 
¡ÜeH—d
, 
»q
->
	`g‘Paddr
(),

613 
¤eqLow
 ? " split" : "");

615 ià(
»q
->
	`isLLSC
()) {

616 
	`as£¹
(!
¤eqLow
);

620 
lßd_š¡
->
	`»cÜdResuÉ
(
çl£
);

621 
TheISA
::
	`hªdËLockedR—d
(
lßd_š¡
.
	`g‘
(), 
»q
);

622 
lßd_š¡
->
	`»cÜdResuÉ
(
Œue
);

625 ià(
»q
->
	`isMm­³dI´
()) {

626 
	`as£¹
(!
lßd_š¡
->
memD©a
);

627 
lßd_š¡
->
memD©a
 = 
Ãw
 
ušt8_t
[64];

629 
Th»adCÚ‹xt
 *
th»ad
 = 
ıu
->
	`tcBa£
(
lsqID
);

630 
Cyşes
 
	`d–ay
(0);

631 
Pack‘PŒ
 
d©a_pkt
 = 
Ãw
 
	`Pack‘
(
»q
, 
MemCmd
::
R—dReq
);

633 ià(!
TheISA
::
HasUÇligÃdMemAcc
 || !
¤eqLow
) {

634 
d©a_pkt
->
	`d©aStic
(
lßd_š¡
->
memD©a
);

635 
d–ay
 = 
TheISA
::
	`hªdËI´R—d
(
th»ad
, 
d©a_pkt
);

637 
	`as£¹
(
¤eqLow
->
	`isMm­³dI´
(è&& 
¤eqHigh
->isMmappedIpr());

638 
Pack‘PŒ
 
f¡_d©a_pkt
 = 
Ãw
 
	`Pack‘
(
¤eqLow
, 
MemCmd
::
R—dReq
);

639 
Pack‘PŒ
 
¢d_d©a_pkt
 = 
Ãw
 
	`Pack‘
(
¤eqHigh
, 
MemCmd
::
R—dReq
);

641 
f¡_d©a_pkt
->
	`d©aStic
(
lßd_š¡
->
memD©a
);

642 
¢d_d©a_pkt
->
	`d©aStic
(
lßd_š¡
->
memD©a
 + 
¤eqLow
->
	`g‘Size
());

644 
d–ay
 = 
TheISA
::
	`hªdËI´R—d
(
th»ad
, 
f¡_d©a_pkt
);

645 
Cyşes
 
d–ay2
 = 
TheISA
::
	`hªdËI´R—d
(
th»ad
, 
¢d_d©a_pkt
);

646 ià(
d–ay2
 > 
d–ay
)

647 
d–ay
 = 
d–ay2
;

649 
d–‘e
 
¤eqLow
;

650 
d–‘e
 
¤eqHigh
;

651 
d–‘e
 
f¡_d©a_pkt
;

652 
d–‘e
 
¢d_d©a_pkt
;

654 
Wr™ebackEv’t
 *
wb
 = 
Ãw
 
	`Wr™ebackEv’t
(
lßd_š¡
, 
d©a_pkt
, 
this
);

655 
ıu
->
	`scheduË
(
wb
, cpu->
	`şockEdge
(
d–ay
));

656  
NoFauÉ
;

659 
¡Üe_idx
 != -1) {

661 ià(
¡Üe_idx
 =ğ
¡ÜeWBIdx
) {

666 ià(--
¡Üe_idx
 < 0)

667 
¡Üe_idx
 +ğ
SQEÁr›s
;

669 
	`as£¹
(
¡ÜeQueue
[
¡Üe_idx
].
š¡
);

671 
¡Üe_size
 = 
¡ÜeQueue
[
¡Üe_idx
].
size
;

673 ià(
¡Üe_size
 == 0)

675 ià(
¡ÜeQueue
[
¡Üe_idx
].
š¡
->
	`unÿch—bË
())

678 
	`as£¹
(
¡ÜeQueue
[
¡Üe_idx
].
š¡
->
	`effAddrV®id
());

682 
boŞ
 
¡Üe_has_low”_lim™
 =

683 
»q
->
	`g‘Vaddr
(è>ğ
¡ÜeQueue
[
¡Üe_idx
].
š¡
->
effAddr
;

684 
boŞ
 
¡Üe_has_uµ”_lim™
 =

685 (
»q
->
	`g‘Vaddr
(è+„eq->
	`g‘Size
()) <=

686 (
¡ÜeQueue
[
¡Üe_idx
].
š¡
->
effAddr
 + 
¡Üe_size
);

687 
boŞ
 
low”_lßd_has_¡Üe_·¹
 =

688 
»q
->
	`g‘Vaddr
(è< (
¡ÜeQueue
[
¡Üe_idx
].
š¡
->
effAddr
 +

689 
¡Üe_size
);

690 
boŞ
 
uµ”_lßd_has_¡Üe_·¹
 =

691 (
»q
->
	`g‘Vaddr
(è+„eq->
	`g‘Size
()) >

692 
¡ÜeQueue
[
¡Üe_idx
].
š¡
->
effAddr
;

695 ià((
¡Üe_has_low”_lim™
 && 
¡Üe_has_uµ”_lim™
)) {

697 
shiá_amt
 = 
»q
->
	`g‘Vaddr
(è- 
¡ÜeQueue
[
¡Üe_idx
].
š¡
->
effAddr
;

699 
	`memıy
(
d©a
, 
¡ÜeQueue
[
¡Üe_idx
].d©¨+ 
shiá_amt
,

700 
»q
->
	`g‘Size
());

702 
	`as£¹
(!
lßd_š¡
->
memD©a
);

703 
lßd_š¡
->
memD©a
 = 
Ãw
 
ušt8_t
[64];

705 
	`memıy
(
lßd_š¡
->
memD©a
,

706 
¡ÜeQueue
[
¡Üe_idx
].
d©a
 + 
shiá_amt
, 
»q
->
	`g‘Size
());

708 
	`DPRINTF
(
LSQUn™
, "Forwarding from store idx %io†oado "

710 
¡Üe_idx
, 
»q
->
	`g‘Vaddr
(), 
d©a
);

712 
Pack‘PŒ
 
d©a_pkt
 = 
Ãw
 
	`Pack‘
(
»q
, 
MemCmd
::
R—dReq
);

713 
d©a_pkt
->
	`d©aStic
(
lßd_š¡
->
memD©a
);

715 
Wr™ebackEv’t
 *
wb
 = 
Ãw
 
	`Wr™ebackEv’t
(
lßd_š¡
, 
d©a_pkt
, 
this
);

720 
ıu
->
	`scheduË
(
wb
, 
	`curTick
());

723 ià(
TheISA
::
HasUÇligÃdMemAcc
 && 
¤eqLow
) {

724 
d–‘e
 
¤eqLow
;

725 
d–‘e
 
¤eqHigh
;

728 ++
lsqFÜwLßds
;

729  
NoFauÉ
;

730 } ià((
¡Üe_has_low”_lim™
 && 
low”_lßd_has_¡Üe_·¹
) ||

731 (
¡Üe_has_uµ”_lim™
 && 
uµ”_lßd_has_¡Üe_·¹
) ||

732 (
low”_lßd_has_¡Üe_·¹
 && 
uµ”_lßd_has_¡Üe_·¹
)) {

738 ià(
¡ÜeQueue
[
¡Üe_idx
].
com¶‘ed
) {

739 
	`·nic
("Should‚ot check one ofhese");

745 ià(!
¡®Ëd
 ||

746 (
¡®Ëd
 &&

747 
lßd_š¡
->
£qNum
 <

748 
lßdQueue
[
¡®lšgLßdIdx
]->
£qNum
)) {

749 
¡®Ëd
 = 
Œue
;

750 
¡®lšgStÜeI¢
 = 
¡ÜeQueue
[
¡Üe_idx
].
š¡
->
£qNum
;

751 
¡®lšgLßdIdx
 = 
lßd_idx
;

756 
›wSge
->
	`»scheduËMemIn¡
(
lßd_š¡
);

757 
›wSge
->
	`deüWb
(
lßd_š¡
->
£qNum
);

758 
lßd_š¡
->
	`ş—rIssued
();

759 ++
lsqRescheduËdLßds
;

763 
	`DPRINTF
(
LSQUn™
, "Load-store forwarding mis-match. "

765 
¡Üe_idx
, 
»q
->
	`g‘Vaddr
());

770 
d–‘e
 
»q
;

771 ià(
TheISA
::
HasUÇligÃdMemAcc
 && 
¤eqLow
) {

772 
d–‘e
 
¤eqLow
;

773 
d–‘e
 
¤eqHigh
;

776  
NoFauÉ
;

781 
	`DPRINTF
(
LSQUn™
, "Doing memory‡ccess for inst [sn:%lli] PC %s\n",

782 
lßd_š¡
->
£qNum
,†ßd_š¡->
	`pcS‹
());

784 
	`as£¹
(!
lßd_š¡
->
memD©a
);

785 
lßd_š¡
->
memD©a
 = 
Ãw
 
ušt8_t
[64];

787 ++
u£dPÜts
;

790 
boŞ
 
com¶‘edFœ¡
 = 
çl£
;

791 ià(!
lsq
->
	`ÿcheBlocked
()) {

792 
MemCmd
 
commªd
 =

793 
»q
->
	`isLLSC
(è? 
MemCmd
::
LßdLockedReq
 : MemCmd::
R—dReq
;

794 
Pack‘PŒ
 
d©a_pkt
 = 
Ãw
 
	`Pack‘
(
»q
, 
commªd
);

795 
Pack‘PŒ
 
f¡_d©a_pkt
 = 
NULL
;

796 
Pack‘PŒ
 
¢d_d©a_pkt
 = 
NULL
;

798 
d©a_pkt
->
	`d©aStic
(
lßd_š¡
->
memD©a
);

800 
LSQS’d”S‹
 *
¡©e
 = 
Ãw
 LSQSenderState;

801 
¡©e
->
isLßd
 = 
Œue
;

802 
¡©e
->
idx
 = 
lßd_idx
;

803 
¡©e
->
š¡
 = 
lßd_š¡
;

804 
d©a_pkt
->
£nd”S‹
 = 
¡©e
;

806 ià(!
TheISA
::
HasUÇligÃdMemAcc
 || !
¤eqLow
) {

809 
f¡_d©a_pkt
 = 
d©a_pkt
;

813 
f¡_d©a_pkt
 = 
Ãw
 
	`Pack‘
(
¤eqLow
, 
commªd
);

814 
¢d_d©a_pkt
 = 
Ãw
 
	`Pack‘
(
¤eqHigh
, 
commªd
);

816 
f¡_d©a_pkt
->
	`d©aStic
(
lßd_š¡
->
memD©a
);

817 
¢d_d©a_pkt
->
	`d©aStic
(
lßd_š¡
->
memD©a
 + 
¤eqLow
->
	`g‘Size
());

819 
f¡_d©a_pkt
->
£nd”S‹
 = 
¡©e
;

820 
¢d_d©a_pkt
->
£nd”S‹
 = 
¡©e
;

822 
¡©e
->
isS¶™
 = 
Œue
;

823 
¡©e
->
out¡ªdšg
 = 2;

824 
¡©e
->
mašPkt
 = 
d©a_pkt
;

827 ià(!
dÿchePÜt
->
	`£ndTimšgReq
(
f¡_d©a_pkt
)) {

830 
d–‘e
 
¡©e
;

831 
d–‘e
 
d©a_pkt
->
»q
;

832 
d–‘e
 
d©a_pkt
;

833 ià(
TheISA
::
HasUÇligÃdMemAcc
 && 
¤eqLow
) {

834 
d–‘e
 
f¡_d©a_pkt
->
»q
;

835 
d–‘e
 
f¡_d©a_pkt
;

836 
d–‘e
 
¢d_d©a_pkt
->
»q
;

837 
d–‘e
 
¢d_d©a_pkt
;

838 
¤eqLow
 = 
NULL
;

839 
¤eqHigh
 = 
NULL
;

842 
»q
 = 
NULL
;

846 
lsq
->
	`£tR‘ryTid
(
lsqID
);

847 } ià(
TheISA
::
HasUÇligÃdMemAcc
 && 
¤eqLow
) {

848 
com¶‘edFœ¡
 = 
Œue
;

855 ++
u£dPÜts
;

856 ià(!
dÿchePÜt
->
	`£ndTimšgReq
(
¢d_d©a_pkt
)) {

859 
d–‘e
 
¢d_d©a_pkt
->
»q
;

860 
d–‘e
 
¢d_d©a_pkt
;

862 
¡©e
->
	`com¶‘e
();

864 
»q
 = 
NULL
;

865 
¤eqHigh
 = 
NULL
;

867 
lsq
->
	`£tR‘ryTid
(
lsqID
);

874 ià(
lsq
->
	`ÿcheBlocked
()) {

875 ià(
»q
)

876 
d–‘e
 
»q
;

877 ià(
TheISA
::
HasUÇligÃdMemAcc
 && 
¤eqLow
 && !
com¶‘edFœ¡
) {

878 
d–‘e
 
¤eqLow
;

879 
d–‘e
 
¤eqHigh
;

882 ++
lsqCacheBlocked
;

887 ià(!
com¶‘edFœ¡
)

888 
›wSge
->
	`deüWb
(
lßd_š¡
->
£qNum
);

891 ià(
isLßdBlocked
 && 
blockedLßdSeqNum
 < 
lßd_š¡
->
£qNum
)

892  
NoFauÉ
;

897 
isLßdBlocked
 = 
Œue
;

898 
lßdBlockedHªdËd
 = 
çl£
;

899 
blockedLßdSeqNum
 = 
lßd_š¡
->
£qNum
;

901  
NoFauÉ
;

904  
NoFauÉ
;

905 
	}
}

907 
	g‹m¶©e
 <
şass
 
	gIm¶
>

908 
FauÉ


909 
	gLSQUn™
<
	gIm¶
>::
	$wr™e
(
Reque¡
 *
»q
, Reque¡ *
¤eqLow
, Reque¡ *
¤eqHigh
,

910 
ušt8_t
 *
d©a
, 
¡Üe_idx
)

912 
	`as£¹
(
¡ÜeQueue
[
¡Üe_idx
].
š¡
);

914 
	`DPRINTF
(
LSQUn™
, "Doing writeo store idx %i,‡ddr %#x data %#x"

916 
¡Üe_idx
, 
»q
->
	`g‘Paddr
(), 
d©a
, 
¡ÜeH—d
,

917 
¡ÜeQueue
[
¡Üe_idx
].
š¡
->
£qNum
);

919 
¡ÜeQueue
[
¡Üe_idx
].
»q
 =„eq;

920 
¡ÜeQueue
[
¡Üe_idx
].
¤eqLow
 = sreqLow;

921 
¡ÜeQueue
[
¡Üe_idx
].
¤eqHigh
 = sreqHigh;

922 
size
 = 
»q
->
	`g‘Size
();

923 
¡ÜeQueue
[
¡Üe_idx
].
size
 = size;

924 
	`as£¹
(
size
 <ğ(
¡ÜeQueue
[
¡Üe_idx
].
d©a
));

928 ià(
TheISA
::
HasUÇligÃdMemAcc
 && 
¤eqLow
) {

929 
¡ÜeQueue
[
¡Üe_idx
].
isS¶™
 = 
Œue
;

932 
	`memıy
(
¡ÜeQueue
[
¡Üe_idx
].
d©a
, d©a, 
size
);

936  
NoFauÉ
;

937 
	}
}

	@lsq_unit_impl.hh

44 
	~"¬ch/g’”ic/debugçuÉs.hh
"

45 
	~"¬ch/locked_mem.hh
"

46 
	~"ba£/¡r.hh
"

47 
	~"cÚfig/the_i§.hh
"

48 
	~"ıu/check”/ıu.hh
"

49 
	~"ıu/o3/lsq.hh
"

50 
	~"ıu/o3/lsq_un™.hh
"

51 
	~"debug/Aùiv™y.hh
"

52 
	~"debug/IEW.hh
"

53 
	~"debug/LSQUn™.hh
"

54 
	~"mem/·ck‘.hh
"

55 
	~"mem/»que¡.hh
"

57 
	g‹m¶©e
<
şass
 
	gIm¶
>

58 
	gLSQUn™
<
	gIm¶
>::
Wr™ebackEv’t
::
	$Wr™ebackEv’t
(
DynIn¡PŒ
 &
_š¡
, 
Pack‘PŒ
 
_pkt
,

59 
LSQUn™
 *
lsq_±r
)

60 : 
	`Ev’t
(
DeçuÉ_Pri
, 
AutoD–‘e
),

61 
	`š¡
(
_š¡
), 
	`pkt
(
_pkt
), 
	$lsqPŒ
(
lsq_±r
)

63 
	}
}

65 
	g‹m¶©e
<
şass
 
	gIm¶
>

67 
	gLSQUn™
<
	gIm¶
>::
Wr™ebackEv’t
::
	$´oûss
()

69 
	`as£¹
(!
lsqPŒ
->
ıu
->
	`sw™chedOut
());

71 
lsqPŒ
->
	`wr™eback
(
š¡
, 
pkt
);

73 ià(
pkt
->
£nd”S‹
)

74 
d–‘e
 
pkt
->
£nd”S‹
;

76 
d–‘e
 
pkt
->
»q
;

77 
d–‘e
 
pkt
;

78 
	}
}

80 
	g‹m¶©e
<
şass
 
	gIm¶
>

82 
	gLSQUn™
<
	gIm¶
>::
Wr™ebackEv’t
::
	$desütiÚ
() const

85 
	}
}

87 
	g‹m¶©e
<
şass
 
	gIm¶
>

89 
	gLSQUn™
<
	gIm¶
>::
	$com¶‘eD©aAcûss
(
Pack‘PŒ
 
pkt
)

91 
LSQS’d”S‹
 *
¡©e
 = 
dyÇmic_ÿ¡
<LSQS’d”S‹ *>(
pkt
->
£nd”S‹
);

92 
DynIn¡PŒ
 
š¡
 = 
¡©e
->inst;

93 
	`DPRINTF
(
IEW
, "Wr™ebackƒv’ˆ[¢:%Îi].\n", 
š¡
->
£qNum
);

94 
	`DPRINTF
(
Aùiv™y
, "Aùiv™y: Wr™ebackƒv’ˆ[¢:%Îi].\n", 
š¡
->
£qNum
);

99 ià(
TheISA
::
HasUÇligÃdMemAcc
 && !
¡©e
->
	`com¶‘e
()) {

100 
d–‘e
 
pkt
->
»q
;

101 
d–‘e
 
pkt
;

105 
	`as£¹
(!
ıu
->
	`sw™chedOut
());

106 ià(
š¡
->
	`isSquashed
()) {

107 
›wSge
->
	`deüWb
(
š¡
->
£qNum
);

109 ià(!
¡©e
->
noWB
) {

110 ià(!
TheISA
::
HasUÇligÃdMemAcc
 || !
¡©e
->
isS¶™
 ||

111 !
¡©e
->
isLßd
) {

112 
	`wr™eback
(
š¡
, 
pkt
);

114 
	`wr™eback
(
š¡
, 
¡©e
->
mašPkt
);

118 ià(
š¡
->
	`isStÜe
()) {

119 
	`com¶‘eStÜe
(
¡©e
->
idx
);

123 ià(
TheISA
::
HasUÇligÃdMemAcc
 && 
¡©e
->
isS¶™
 && s‹->
isLßd
) {

124 
d–‘e
 
¡©e
->
mašPkt
->
»q
;

125 
d–‘e
 
¡©e
->
mašPkt
;

127 
d–‘e
 
¡©e
;

128 
d–‘e
 
pkt
->
»q
;

129 
d–‘e
 
pkt
;

130 
	}
}

132 
	g‹m¶©e
 <
şass
 
	gIm¶
>

133 
	gLSQUn™
<
	gIm¶
>::
	$LSQUn™
()

134 : 
	`lßds
(0), 
	`¡Ües
(0), 
	`¡ÜesToWB
(0), 
	`ÿcheBlockMask
(0), 
	`¡®Ëd
(
çl£
),

135 
	`isStÜeBlocked
(
çl£
), 
	`isLßdBlocked
(false),

136 
	`lßdBlockedHªdËd
(
çl£
), 
	`¡ÜeInFlight
(çl£), 
	$hasP’dšgPkt
(
çl£
)

138 
	}
}

140 
	g‹m¶©e
<
şass
 
	gIm¶
>

142 
	gLSQUn™
<
	gIm¶
>::
	$š™
(
O3CPU
 *
ıu_±r
, 
IEW
 *
›w_±r
, 
D”ivO3CPUP¬ams
 *
·¿ms
,

143 
LSQ
 *
lsq_±r
, 
maxLQEÁr›s
, 
maxSQEÁr›s
,

144 
id
)

146 
ıu
 = 
ıu_±r
;

147 
›wSge
 = 
›w_±r
;

149 
	`DPRINTF
(
LSQUn™
, "C»©šg LSQUn™%˜objeù.\n",
id
);

151 
lsq
 = 
lsq_±r
;

153 
lsqID
 = 
id
;

156 
LQEÁr›s
 = 
maxLQEÁr›s
 + 1;

157 
SQEÁr›s
 = 
maxSQEÁr›s
 + 1;

159 
lßdQueue
.
	`»size
(
LQEÁr›s
);

160 
¡ÜeQueue
.
	`»size
(
SQEÁr›s
);

162 
d•CheckShiá
 = 
·¿ms
->
LSQD•CheckShiá
;

163 
checkLßds
 = 
·¿ms
->
LSQCheckLßds
;

164 
ÿchePÜts
 = 
·¿ms
->cachePorts;

165 
ÃedsTSO
 = 
·¿ms
->needsTSO;

167 
	`»£tS‹
();

168 
	}
}

171 
	g‹m¶©e
<
şass
 
	gIm¶
>

173 
	gLSQUn™
<
	gIm¶
>::
	$»£tS‹
()

175 
lßds
 = 
¡Ües
 = 
¡ÜesToWB
 = 0;

177 
lßdH—d
 = 
lßdTa
 = 0;

179 
¡ÜeH—d
 = 
¡ÜeWBIdx
 = 
¡ÜeTa
 = 0;

181 
u£dPÜts
 = 0;

183 
»ŒyPkt
 = 
NULL
;

184 
memD•ViŞ©Ü
 = 
NULL
;

186 
blockedLßdSeqNum
 = 0;

188 
¡®Ëd
 = 
çl£
;

189 
isLßdBlocked
 = 
çl£
;

190 
lßdBlockedHªdËd
 = 
çl£
;

192 
ÿcheBlockMask
 = 0;

193 
	}
}

195 
	g‹m¶©e
<
şass
 
	gIm¶
>

196 
	g¡d
::
¡ršg


197 
LSQUn™
<
Im¶
>::
	$Çme
() const

199 ià(
Im¶
::
MaxTh»ads
 == 1) {

200  
›wSge
->
	`Çme
() + ".lsq";

202  
›wSge
->
	`Çme
(è+ ".lsq.th»ad" + 
	`to_¡ršg
(
lsqID
);

204 
	}
}

206 
	g‹m¶©e
<
şass
 
	gIm¶
>

208 
	gLSQUn™
<
	gIm¶
>::
	$»gSts
()

210 
lsqFÜwLßds


211 .
	`Çme
(name() + ".forwLoads")

212 .
	`desc
("Number of†oadshat had data forwarded from stores");

214 
švAddrLßds


215 .
	`Çme
(name() + ".invAddrLoads")

216 .
	`desc
("Number of†oads ignored dueo‡n invalid‡ddress");

218 
lsqSquashedLßds


219 .
	`Çme
(name() + ".squashedLoads")

220 .
	`desc
("Number of†oads squashed");

222 
lsqIgnÜedRe¥Ú£s


223 .
	`Çme
(name() + ".ignoredResponses")

224 .
	`desc
("Number of memory„esponses ignored becausehe instruction is squashed");

226 
lsqMemOrd”ViŞ©iÚ


227 .
	`Çme
(name() + ".memOrderViolation")

228 .
	`desc
("Number of memory ordering violations");

230 
lsqSquashedStÜes


231 .
	`Çme
(name() + ".squashedStores")

232 .
	`desc
("Number of stores squashed");

234 
švAddrSwpfs


235 .
	`Çme
(name() + ".invAddrSwpfs")

236 .
	`desc
("Number of software…refetches ignored dueo‡n invalid‡ddress");

238 
lsqBlockedLßds


239 .
	`Çme
(name() + ".blockedLoads")

240 .
	`desc
("Number of blocked†oads dueo…artial†oad-store forwarding");

242 
lsqRescheduËdLßds


243 .
	`Çme
(name() + ".rescheduledLoads")

244 .
	`desc
("Number of†oadshat were„escheduled");

246 
lsqCacheBlocked


247 .
	`Çme
(name() + ".cacheBlocked")

248 .
	`desc
("Number ofimes‡n‡ccesso memory failed dueohe cache being blocked");

249 
	}
}

251 
	g‹m¶©e
<
şass
 
	gIm¶
>

253 
	gLSQUn™
<
	gIm¶
>::
	$£tDÿchePÜt
(
Ma¡”PÜt
 *
dÿche_pÜt
)

255 
dÿchePÜt
 = 
dÿche_pÜt
;

256 
	}
}

258 
	g‹m¶©e
<
şass
 
	gIm¶
>

260 
	gLSQUn™
<
	gIm¶
>::
	$ş—rLQ
()

262 
lßdQueue
.
	`ş—r
();

263 
	}
}

265 
	g‹m¶©e
<
şass
 
	gIm¶
>

267 
	gLSQUn™
<
	gIm¶
>::
	$ş—rSQ
()

269 
¡ÜeQueue
.
	`ş—r
();

270 
	}
}

272 
	g‹m¶©e
<
şass
 
	gIm¶
>

274 
	gLSQUn™
<
	gIm¶
>::
	$d¿šSª™yCheck
() const

276 
i
 = 0; i < 
lßdQueue
.
	`size
(); ++i)

277 
	`as£¹
(!
lßdQueue
[
i
]);

279 
	`as£¹
(
¡ÜesToWB
 == 0);

280 
	`as£¹
(!
»ŒyPkt
);

281 
	}
}

283 
	g‹m¶©e
<
şass
 
	gIm¶
>

285 
	gLSQUn™
<
	gIm¶
>::
	$keOv”From
()

287 
	`»£tS‹
();

288 
	}
}

290 
	g‹m¶©e
<
şass
 
	gIm¶
>

292 
	gLSQUn™
<
	gIm¶
>::
	$»sizeLQ
(
size
)

294 
size_¶us_£Áš–
 = 
size
 + 1;

295 
	`as£¹
(
size_¶us_£Áš–
 >ğ
LQEÁr›s
);

297 ià(
size_¶us_£Áš–
 > 
LQEÁr›s
) {

298 
size_¶us_£Áš–
 > 
lßdQueue
.
	`size
()) {

299 
DynIn¡PŒ
 
dummy
;

300 
lßdQueue
.
	`push_back
(
dummy
);

301 
LQEÁr›s
++;

304 
LQEÁr›s
 = 
size_¶us_£Áš–
;

307 
	}
}

309 
	g‹m¶©e
<
şass
 
	gIm¶
>

311 
	gLSQUn™
<
	gIm¶
>::
	$»sizeSQ
(
size
)

313 
size_¶us_£Áš–
 = 
size
 + 1;

314 ià(
size_¶us_£Áš–
 > 
SQEÁr›s
) {

315 
size_¶us_£Áš–
 > 
¡ÜeQueue
.
	`size
()) {

316 
SQEÁry
 
dummy
;

317 
¡ÜeQueue
.
	`push_back
(
dummy
);

318 
SQEÁr›s
++;

321 
SQEÁr›s
 = 
size_¶us_£Áš–
;

323 
	}
}

325 
	g‹m¶©e
 <
şass
 
	gIm¶
>

327 
	gLSQUn™
<
	gIm¶
>::
	$š£¹
(
DynIn¡PŒ
 &
š¡
)

329 
	`as£¹
(
š¡
->
	`isMemRef
());

331 
	`as£¹
(
š¡
->
	`isLßd
(è|| in¡->
	`isStÜe
());

333 ià(
š¡
->
	`isLßd
()) {

334 
	`š£¹Lßd
(
š¡
);

336 
	`š£¹StÜe
(
š¡
);

339 
š¡
->
	`£tInLSQ
();

340 
	}
}

342 
	g‹m¶©e
 <
şass
 
	gIm¶
>

344 
	gLSQUn™
<
	gIm¶
>::
	$š£¹Lßd
(
DynIn¡PŒ
 &
lßd_š¡
)

346 
	`as£¹
((
lßdTa
 + 1è% 
LQEÁr›s
 !ğ
lßdH—d
);

347 
	`as£¹
(
lßds
 < 
LQEÁr›s
);

349 
	`DPRINTF
(
LSQUn™
, "Inserting†oad PC %s, idx:%i [sn:%lli]\n",

350 
lßd_š¡
->
	`pcS‹
(), 
lßdTa
,†ßd_š¡->
£qNum
);

352 
lßd_š¡
->
lqIdx
 = 
lßdTa
;

354 ià(
¡Ües
 == 0) {

355 
lßd_š¡
->
sqIdx
 = -1;

357 
lßd_š¡
->
sqIdx
 = 
¡ÜeTa
;

360 
lßdQueue
[
lßdTa
] = 
lßd_š¡
;

362 
	`šüLdIdx
(
lßdTa
);

364 ++
lßds
;

365 
	}
}

367 
	g‹m¶©e
 <
şass
 
	gIm¶
>

369 
	gLSQUn™
<
	gIm¶
>::
	$š£¹StÜe
(
DynIn¡PŒ
 &
¡Üe_š¡
)

372 
	`as£¹
((
¡ÜeTa
 + 1è% 
SQEÁr›s
 !ğ
¡ÜeH—d
);

373 
	`as£¹
(
¡Ües
 < 
SQEÁr›s
);

375 
	`DPRINTF
(
LSQUn™
, "Inserting store PC %s, idx:%i [sn:%lli]\n",

376 
¡Üe_š¡
->
	`pcS‹
(), 
¡ÜeTa
, stÜe_š¡->
£qNum
);

378 
¡Üe_š¡
->
sqIdx
 = 
¡ÜeTa
;

379 
¡Üe_š¡
->
lqIdx
 = 
lßdTa
;

381 
¡ÜeQueue
[
¡ÜeTa
] = 
	`SQEÁry
(
¡Üe_š¡
);

383 
	`šüStIdx
(
¡ÜeTa
);

385 ++
¡Ües
;

386 
	}
}

388 
	g‹m¶©e
 <
şass
 
	gIm¶
>

389 
ty³Çme
 
	gIm¶
::
DynIn¡PŒ


390 
LSQUn™
<
Im¶
>::
	$g‘MemD•ViŞ©Ü
()

392 
DynIn¡PŒ
 
‹mp
 = 
memD•ViŞ©Ü
;

394 
memD•ViŞ©Ü
 = 
NULL
;

396  
‹mp
;

397 
	}
}

399 
	g‹m¶©e
 <
şass
 
	gIm¶
>

401 
	gLSQUn™
<
	gIm¶
>::
	$numF»eEÁr›s
()

403 
ä“_lq_’Œ›s
 = 
LQEÁr›s
 - 
lßds
;

404 
ä“_sq_’Œ›s
 = 
SQEÁr›s
 - 
¡Ües
;

408 ià(
ä“_lq_’Œ›s
 < 
ä“_sq_’Œ›s
) {

409  
ä“_lq_’Œ›s
 - 1;

411  
ä“_sq_’Œ›s
 - 1;

413 
	}
}

415 
	g‹m¶©e
 <
şass
 
	gIm¶
>

417 
	gLSQUn™
<
	gIm¶
>::
	$checkSnoİ
(
Pack‘PŒ
 
pkt
)

419 
lßd_idx
 = 
lßdH—d
;

421 ià(!
ÿcheBlockMask
) {

422 
	`as£¹
(
dÿchePÜt
);

423 
Addr
 
bs
 = 
dÿchePÜt
->
	`³”BlockSize
();

426 
	`as£¹
(
bs
 != 0);

428 
ÿcheBlockMask
 = ~(
bs
 - 1);

435 
x
 = 0; x < 
ıu
->
	`numAùiveTh»ads
(); x++) {

436 
Th»adCÚ‹xt
 *
tc
 = 
ıu
->
	`g‘CÚ‹xt
(
x
);

437 
boŞ
 
no_squash
 = 
ıu
->
th»ad
[
x
]->
noSquashFromTC
;

438 
ıu
->
th»ad
[
x
]->
noSquashFromTC
 = 
Œue
;

439 
TheISA
::
	`hªdËLockedSnoİ
(
tc
, 
pkt
, 
ÿcheBlockMask
);

440 
ıu
->
th»ad
[
x
]->
noSquashFromTC
 = 
no_squash
;

444 ià(
lßd_idx
 =ğ
lßdTa
)

446 
	`šüLdIdx
(
lßd_idx
);

448 
	`DPRINTF
(
LSQUn™
, "GÙ snoİ fÜ‡dd»s %#x\n", 
pkt
->
	`g‘Addr
());

449 
Addr
 
šv®id©e_addr
 = 
pkt
->
	`g‘Addr
(è& 
ÿcheBlockMask
;

450 
lßd_idx
 !ğ
lßdTa
) {

451 
DynIn¡PŒ
 
ld_š¡
 = 
lßdQueue
[
lßd_idx
];

453 ià(!
ld_š¡
->
	`effAddrV®id
(è||†d_š¡->
	`unÿch—bË
()) {

454 
	`šüLdIdx
(
lßd_idx
);

458 
Addr
 
lßd_addr
 = 
ld_š¡
->
physEffAddr
 & 
ÿcheBlockMask
;

459 
	`DPRINTF
(
LSQUn™
, "-- inst [sn:%lli]†oad_addr: %#xo…ktAddr:%#x\n",

460 
ld_š¡
->
£qNum
, 
lßd_addr
, 
šv®id©e_addr
);

462 ià(
lßd_addr
 =ğ
šv®id©e_addr
) {

463 ià(
ld_š¡
->
	`possibËLßdViŞ©iÚ
()) {

464 
	`DPRINTF
(
LSQUn™
, "Conflicting†oad‡t‡ddr %#x [sn:%lli]\n",

465 
ld_š¡
->
physEffAddr
, 
pkt
->
	`g‘Addr
(),†d_š¡->
£qNum
);

468 
ld_š¡
->
çuÉ
 = 
Ãw
 
ReExec
;

473 
ld_š¡
->
	`h™Ex‹º®Snoİ
(
Œue
);

476 
	`šüLdIdx
(
lßd_idx
);

479 
	}
}

481 
	g‹m¶©e
 <
şass
 
	gIm¶
>

482 
FauÉ


483 
	gLSQUn™
<
	gIm¶
>::
	$checkViŞ©iÚs
(
lßd_idx
, 
DynIn¡PŒ
 &
š¡
)

485 
Addr
 
š¡_eff_addr1
 = 
š¡
->
effAddr
 >> 
d•CheckShiá
;

486 
Addr
 
š¡_eff_addr2
 = (
š¡
->
effAddr
 + in¡->
effSize
 - 1è>> 
d•CheckShiá
;

493 
lßd_idx
 !ğ
lßdTa
) {

494 
DynIn¡PŒ
 
ld_š¡
 = 
lßdQueue
[
lßd_idx
];

495 ià(!
ld_š¡
->
	`effAddrV®id
(è||†d_š¡->
	`unÿch—bË
()) {

496 
	`šüLdIdx
(
lßd_idx
);

500 
Addr
 
ld_eff_addr1
 = 
ld_š¡
->
effAddr
 >> 
d•CheckShiá
;

501 
Addr
 
ld_eff_addr2
 =

502 (
ld_š¡
->
effAddr
 +†d_š¡->
effSize
 - 1è>> 
d•CheckShiá
;

504 ià(
š¡_eff_addr2
 >ğ
ld_eff_addr1
 && 
š¡_eff_addr1
 <ğ
ld_eff_addr2
) {

505 ià(
š¡
->
	`isLßd
()) {

509 ià(
ld_š¡
->
	`h™Ex‹º®Snoİ
()) {

510 ià(!
memD•ViŞ©Ü
 ||

511 
ld_š¡
->
£qNum
 < 
memD•ViŞ©Ü
->seqNum) {

512 
	`DPRINTF
(
LSQUn™
, "Detected fault with inst [sn:%lli] "

514 
š¡
->
£qNum
, 
ld_š¡
->£qNum, 
ld_eff_addr1
);

515 
memD•ViŞ©Ü
 = 
ld_š¡
;

517 ++
lsqMemOrd”ViŞ©iÚ
;

519  
Ãw
 
G’”icISA
::
	`M5PªicFauÉ
(

522 
š¡
->
£qNum
, 
ld_š¡
->£qNum, 
ld_eff_addr1
);

528 
ld_š¡
->
	`possibËLßdViŞ©iÚ
(
Œue
);

529 
	`DPRINTF
(
LSQUn™
, "Found…ossible†oad violaiton‡t‡ddr: %#x"

531 
š¡_eff_addr1
, 
š¡
->
£qNum
, 
ld_š¡
->seqNum);

536 ià(
memD•ViŞ©Ü
 && 
ld_š¡
->
£qNum
 > memDepViolator->seqNum)

539 
	`DPRINTF
(
LSQUn™
, "Detected fault with inst [sn:%lli]‡nd "

541 
š¡
->
£qNum
, 
ld_š¡
->£qNum, 
ld_eff_addr1
);

542 
memD•ViŞ©Ü
 = 
ld_š¡
;

544 ++
lsqMemOrd”ViŞ©iÚ
;

546  
Ãw
 
G’”icISA
::
	`M5PªicFauÉ
("Detected fault with "

548 
š¡
->
£qNum
, 
ld_š¡
->£qNum, 
ld_eff_addr1
);

552 
	`šüLdIdx
(
lßd_idx
);

554  
NoFauÉ
;

555 
	}
}

560 
	g‹m¶©e
 <
şass
 
	gIm¶
>

561 
FauÉ


562 
	gLSQUn™
<
	gIm¶
>::
	$execu‹Lßd
(
DynIn¡PŒ
 &
š¡
)

564 
usšg
 
Çme¥aû
 
TheISA
;

566 
FauÉ
 
lßd_çuÉ
 = 
NoFauÉ
;

568 
	`DPRINTF
(
LSQUn™
, "Executing†oad PC %s, [sn:%lli]\n",

569 
š¡
->
	`pcS‹
(), in¡->
£qNum
);

571 
	`as£¹
(!
š¡
->
	`isSquashed
());

573 
lßd_çuÉ
 = 
š¡
->
	`š™Ÿ‹Acc
();

575 ià(
š¡
->
	`isT¿n¦©iÚD–ayed
() &&

576 
lßd_çuÉ
 =ğ
NoFauÉ
)

577  
lßd_çuÉ
;

581 ià(
lßd_çuÉ
 !ğ
NoFauÉ
 || 
š¡
->
	`»adP»diÿ‹
(è=ğ
çl£
) {

586 ià(
š¡
->
	`»adP»diÿ‹
(è=ğ
çl£
)

587 
š¡
->
	`fÜw¬dOldRegs
();

588 
	`DPRINTF
(
LSQUn™
, "Load [sn:%lli]‚otƒxecuted from %s\n",

589 
š¡
->
£qNum
,

590 (
lßd_çuÉ
 !ğ
NoFauÉ
 ? "fault" : "predication"));

591 ià(!(
š¡
->
	`hasReque¡
(è&& in¡->
	`unÿch—bË
()) ||

592 
š¡
->
	`isAtComm™
()) {

593 
š¡
->
	`£tExecu‹d
();

595 
›wSge
->
	`š¡ToComm™
(
š¡
);

596 
›wSge
->
	`aùiv™yThisCyşe
();

597 } ià(!
	`lßdBlocked
()) {

598 
	`as£¹
(
š¡
->
	`effAddrV®id
());

599 
lßd_idx
 = 
š¡
->
lqIdx
;

600 
	`šüLdIdx
(
lßd_idx
);

602 ià(
checkLßds
)

603  
	`checkViŞ©iÚs
(
lßd_idx
, 
š¡
);

606  
lßd_çuÉ
;

607 
	}
}

609 
	g‹m¶©e
 <
şass
 
	gIm¶
>

610 
FauÉ


611 
	gLSQUn™
<
	gIm¶
>::
	$execu‹StÜe
(
DynIn¡PŒ
 &
¡Üe_š¡
)

613 
usšg
 
Çme¥aû
 
TheISA
;

615 
	`as£¹
(
¡Ües
 != 0);

617 
¡Üe_idx
 = 
¡Üe_š¡
->
sqIdx
;

619 
	`DPRINTF
(
LSQUn™
, "Executing store PC %s [sn:%lli]\n",

620 
¡Üe_š¡
->
	`pcS‹
(), stÜe_š¡->
£qNum
);

622 
	`as£¹
(!
¡Üe_š¡
->
	`isSquashed
());

626 
lßd_idx
 = 
¡Üe_š¡
->
lqIdx
;

628 
FauÉ
 
¡Üe_çuÉ
 = 
¡Üe_š¡
->
	`š™Ÿ‹Acc
();

630 ià(
¡Üe_š¡
->
	`isT¿n¦©iÚD–ayed
() &&

631 
¡Üe_çuÉ
 =ğ
NoFauÉ
)

632  
¡Üe_çuÉ
;

634 ià(
¡Üe_š¡
->
	`»adP»diÿ‹
(è=ğ
çl£
)

635 
¡Üe_š¡
->
	`fÜw¬dOldRegs
();

637 ià(
¡ÜeQueue
[
¡Üe_idx
].
size
 == 0) {

638 
	`DPRINTF
(
LSQUn™
,"Fault on Store PC %s, [sn:%lli], Size = 0\n",

639 
¡Üe_š¡
->
	`pcS‹
(), stÜe_š¡->
£qNum
);

641  
¡Üe_çuÉ
;

642 } ià(
¡Üe_š¡
->
	`»adP»diÿ‹
(è=ğ
çl£
) {

643 
	`DPRINTF
(
LSQUn™
, "Store [sn:%lli]‚otƒxecuted from…redication\n",

644 
¡Üe_š¡
->
£qNum
);

645  
¡Üe_çuÉ
;

648 
	`as£¹
(
¡Üe_çuÉ
 =ğ
NoFauÉ
);

650 ià(
¡Üe_š¡
->
	`isStÜeCÚd™iÚ®
()) {

653 
¡ÜeQueue
[
¡Üe_idx
].
ÿnWB
 = 
Œue
;

655 ++
¡ÜesToWB
;

658  
	`checkViŞ©iÚs
(
lßd_idx
, 
¡Üe_š¡
);

660 
	}
}

662 
	g‹m¶©e
 <
şass
 
	gIm¶
>

664 
	gLSQUn™
<
	gIm¶
>::
	$comm™Lßd
()

666 
	`as£¹
(
lßdQueue
[
lßdH—d
]);

668 
	`DPRINTF
(
LSQUn™
, "Committing head†oad instruction, PC %s\n",

669 
lßdQueue
[
lßdH—d
]->
	`pcS‹
());

671 
lßdQueue
[
lßdH—d
] = 
NULL
;

673 
	`šüLdIdx
(
lßdH—d
);

675 --
lßds
;

676 
	}
}

678 
	g‹m¶©e
 <
şass
 
	gIm¶
>

680 
	gLSQUn™
<
	gIm¶
>::
	$comm™Lßds
(
In¡SeqNum
 &
younge¡_š¡
)

682 
	`as£¹
(
lßds
 =ğ0 || 
lßdQueue
[
lßdH—d
]);

684 
lßds
 !ğ0 && 
lßdQueue
[
lßdH—d
]->
£qNum
 <ğ
younge¡_š¡
) {

685 
	`comm™Lßd
();

687 
	}
}

689 
	g‹m¶©e
 <
şass
 
	gIm¶
>

691 
	gLSQUn™
<
	gIm¶
>::
	$comm™StÜes
(
In¡SeqNum
 &
younge¡_š¡
)

693 
	`as£¹
(
¡Ües
 =ğ0 || 
¡ÜeQueue
[
¡ÜeH—d
].
š¡
);

695 
¡Üe_idx
 = 
¡ÜeH—d
;

697 
¡Üe_idx
 !ğ
¡ÜeTa
) {

698 
	`as£¹
(
¡ÜeQueue
[
¡Üe_idx
].
š¡
);

701 ià(!
¡ÜeQueue
[
¡Üe_idx
].
ÿnWB
) {

702 ià(
¡ÜeQueue
[
¡Üe_idx
].
š¡
->
£qNum
 > 
younge¡_š¡
) {

705 
	`DPRINTF
(
LSQUn™
, "Marking store‡s‡bleo write back, PC "

707 
¡ÜeQueue
[
¡Üe_idx
].
š¡
->
	`pcS‹
(),

708 
¡ÜeQueue
[
¡Üe_idx
].
š¡
->
£qNum
);

710 
¡ÜeQueue
[
¡Üe_idx
].
ÿnWB
 = 
Œue
;

712 ++
¡ÜesToWB
;

715 
	`šüStIdx
(
¡Üe_idx
);

717 
	}
}

719 
	g‹m¶©e
 <
şass
 
	gIm¶
>

721 
	gLSQUn™
<
	gIm¶
>::
	$wr™ebackP’dšgStÜe
()

723 ià(
hasP’dšgPkt
) {

724 
	`as£¹
(
³ndšgPkt
 !ğ
NULL
);

727 ià(
	`£ndStÜe
(
³ndšgPkt
)) {

728 
	`¡ÜePo¡S’d
(
³ndšgPkt
);

730 
³ndšgPkt
 = 
NULL
;

731 
hasP’dšgPkt
 = 
çl£
;

733 
	}
}

735 
	g‹m¶©e
 <
şass
 
	gIm¶
>

737 
	gLSQUn™
<
	gIm¶
>::
	$wr™ebackStÜes
()

741 ià(
TheISA
::
HasUÇligÃdMemAcc
) {

742 
	`wr™ebackP’dšgStÜe
();

745 
¡ÜesToWB
 > 0 &&

746 
¡ÜeWBIdx
 !ğ
¡ÜeTa
 &&

747 
¡ÜeQueue
[
¡ÜeWBIdx
].
š¡
 &&

748 
¡ÜeQueue
[
¡ÜeWBIdx
].
ÿnWB
 &&

749 ((!
ÃedsTSO
è|| (!
¡ÜeInFlight
)) &&

750 
u£dPÜts
 < 
ÿchePÜts
) {

752 ià(
isStÜeBlocked
 || 
lsq
->
	`ÿcheBlocked
()) {

753 
	`DPRINTF
(
LSQUn™
, "Unableo write back‡ny more stores, cache"

760 ià(
¡ÜeQueue
[
¡ÜeWBIdx
].
size
 == 0) {

761 
	`com¶‘eStÜe
(
¡ÜeWBIdx
);

763 
	`šüStIdx
(
¡ÜeWBIdx
);

768 ++
u£dPÜts
;

770 ià(
¡ÜeQueue
[
¡ÜeWBIdx
].
š¡
->
	`isD©aP»ãtch
()) {

771 
	`šüStIdx
(
¡ÜeWBIdx
);

776 
	`as£¹
(
¡ÜeQueue
[
¡ÜeWBIdx
].
»q
);

777 
	`as£¹
(!
¡ÜeQueue
[
¡ÜeWBIdx
].
comm™‹d
);

779 ià(
TheISA
::
HasUÇligÃdMemAcc
 && 
¡ÜeQueue
[
¡ÜeWBIdx
].
isS¶™
) {

780 
	`as£¹
(
¡ÜeQueue
[
¡ÜeWBIdx
].
¤eqLow
);

781 
	`as£¹
(
¡ÜeQueue
[
¡ÜeWBIdx
].
¤eqHigh
);

784 
DynIn¡PŒ
 
š¡
 = 
¡ÜeQueue
[
¡ÜeWBIdx
].inst;

786 
Reque¡
 *
»q
 = 
¡ÜeQueue
[
¡ÜeWBIdx
].req;

787 
Reque¡PŒ
 
¤eqLow
 = 
¡ÜeQueue
[
¡ÜeWBIdx
].sreqLow;

788 
Reque¡PŒ
 
¤eqHigh
 = 
¡ÜeQueue
[
¡ÜeWBIdx
].sreqHigh;

790 
¡ÜeQueue
[
¡ÜeWBIdx
].
comm™‹d
 = 
Œue
;

792 
	`as£¹
(!
š¡
->
memD©a
);

793 
š¡
->
memD©a
 = 
Ãw
 
ušt8_t
[64];

795 
	`memıy
(
š¡
->
memD©a
, 
¡ÜeQueue
[
¡ÜeWBIdx
].
d©a
, 
»q
->
	`g‘Size
());

797 
MemCmd
 
commªd
 =

798 
»q
->
	`isSw­
(è? 
MemCmd
::
Sw­Req
 :

799 (
»q
->
	`isLLSC
(è? 
MemCmd
::
StÜeCÚdReq
 : MemCmd::
Wr™eReq
);

800 
Pack‘PŒ
 
d©a_pkt
;

801 
Pack‘PŒ
 
¢d_d©a_pkt
 = 
NULL
;

803 
LSQS’d”S‹
 *
¡©e
 = 
Ãw
 LSQSenderState;

804 
¡©e
->
isLßd
 = 
çl£
;

805 
¡©e
->
idx
 = 
¡ÜeWBIdx
;

806 
¡©e
->
š¡
 = inst;

808 ià(!
TheISA
::
HasUÇligÃdMemAcc
 || !
¡ÜeQueue
[
¡ÜeWBIdx
].
isS¶™
) {

811 
d©a_pkt
 = 
Ãw
 
	`Pack‘
(
»q
, 
commªd
);

812 
d©a_pkt
->
	`d©aStic
(
š¡
->
memD©a
);

813 
d©a_pkt
->
£nd”S‹
 = 
¡©e
;

816 
d©a_pkt
 = 
Ãw
 
	`Pack‘
(
¤eqLow
, 
commªd
);

817 
¢d_d©a_pkt
 = 
Ãw
 
	`Pack‘
(
¤eqHigh
, 
commªd
);

819 
d©a_pkt
->
	`d©aStic
(
š¡
->
memD©a
);

820 
¢d_d©a_pkt
->
	`d©aStic
(
š¡
->
memD©a
 + 
¤eqLow
->
	`g‘Size
());

822 
d©a_pkt
->
£nd”S‹
 = 
¡©e
;

823 
¢d_d©a_pkt
->
£nd”S‹
 = 
¡©e
;

825 
¡©e
->
isS¶™
 = 
Œue
;

826 
¡©e
->
out¡ªdšg
 = 2;

829 
d–‘e
 
»q
;

830 
»q
 = 
¤eqLow
;

833 
	`DPRINTF
(
LSQUn™
, "D-Cache: Writing back store idx:%i PC:%s "

835 
¡ÜeWBIdx
, 
š¡
->
	`pcS‹
(),

836 
»q
->
	`g‘Paddr
(), ()*(
š¡
->
memD©a
),

837 
š¡
->
£qNum
);

840 ià(
š¡
->
	`isStÜeCÚd™iÚ®
()) {

841 
	`as£¹
(!
¡ÜeQueue
[
¡ÜeWBIdx
].
isS¶™
);

845 
š¡
->
	`»cÜdResuÉ
(
çl£
);

846 
boŞ
 
sucûss
 = 
TheISA
::
	`hªdËLockedWr™e
(
š¡
.
	`g‘
(), 
»q
);

847 
š¡
->
	`»cÜdResuÉ
(
Œue
);

849 ià(!
sucûss
) {

851 
	`DPRINTF
(
LSQUn™
, "Store conditional [sn:%lli] failed. "

853 
š¡
->
£qNum
);

854 
Wr™ebackEv’t
 *
wb
 = 
Ãw
 
	`Wr™ebackEv’t
(
š¡
, 
d©a_pkt
, 
this
);

855 
ıu
->
	`scheduË
(
wb
, 
	`curTick
() + 1);

856 ià(
ıu
->
check”
) {

859 
š¡
->
»qToV”ify
->
	`£tExŒaD©a
(0);

860 
š¡
->
	`com¶‘eAcc
(
d©a_pkt
);

862 
	`com¶‘eStÜe
(
¡ÜeWBIdx
);

863 
	`šüStIdx
(
¡ÜeWBIdx
);

868 
¡©e
->
noWB
 = 
Œue
;

871 
boŞ
 
¥l™
 =

872 
TheISA
::
HasUÇligÃdMemAcc
 && 
¡ÜeQueue
[
¡ÜeWBIdx
].
isS¶™
;

874 
Th»adCÚ‹xt
 *
th»ad
 = 
ıu
->
	`tcBa£
(
lsqID
);

876 ià(
»q
->
	`isMm­³dI´
()) {

877 
	`as£¹
(!
š¡
->
	`isStÜeCÚd™iÚ®
());

878 
TheISA
::
	`hªdËI´Wr™e
(
th»ad
, 
d©a_pkt
);

879 
d–‘e
 
d©a_pkt
;

880 ià(
¥l™
) {

881 
	`as£¹
(
¢d_d©a_pkt
->
»q
->
	`isMm­³dI´
());

882 
TheISA
::
	`hªdËI´Wr™e
(
th»ad
, 
¢d_d©a_pkt
);

883 
d–‘e
 
¢d_d©a_pkt
;

884 
d–‘e
 
¤eqLow
;

885 
d–‘e
 
¤eqHigh
;

887 
d–‘e
 
¡©e
;

888 
d–‘e
 
»q
;

889 
	`com¶‘eStÜe
(
¡ÜeWBIdx
);

890 
	`šüStIdx
(
¡ÜeWBIdx
);

891 } ià(!
	`£ndStÜe
(
d©a_pkt
)) {

892 
	`DPRINTF
(
IEW
, "D-Cache became blocked when writing [sn:%lli], will"

894 
š¡
->
£qNum
);

897 ià(
¥l™
) {

898 
¡©e
->
pktToS’d
 = 
Œue
;

899 
¡©e
->
³ndšgPack‘
 = 
¢d_d©a_pkt
;

904 ià(
¥l™
) {

905 
	`as£¹
(
¢d_d©a_pkt
);

908 ià(
u£dPÜts
 < 
ÿchePÜts
) {

909 ++
u£dPÜts
;

910 ià(
	`£ndStÜe
(
¢d_d©a_pkt
)) {

911 
	`¡ÜePo¡S’d
(
¢d_d©a_pkt
);

913 
	`DPRINTF
(
IEW
, "D-Cache became blocked when writing"

915 
š¡
->
£qNum
);

920 
	`as£¹
(
³ndšgPkt
 =ğ
NULL
);

921 
³ndšgPkt
 = 
¢d_d©a_pkt
;

922 
hasP’dšgPkt
 = 
Œue
;

927 
	`¡ÜePo¡S’d
(
d©a_pkt
);

933 
u£dPÜts
 = 0;

935 
	`as£¹
(
¡Ües
 >ğ0 && 
¡ÜesToWB
 >= 0);

936 
	}
}

952 
	g‹m¶©e
 <
şass
 
	gIm¶
>

954 
	gLSQUn™
<
	gIm¶
>::
	$squash
(cÚ¡ 
In¡SeqNum
 &
squashed_num
)

956 
	`DPRINTF
(
LSQUn™
, "Squashing until [sn:%lli]!"

957 "(Lßds:%˜StÜes:%i)\n", 
squashed_num
, 
lßds
, 
¡Ües
);

959 
lßd_idx
 = 
lßdTa
;

960 
	`deüLdIdx
(
lßd_idx
);

962 
lßds
 !ğ0 && 
lßdQueue
[
lßd_idx
]->
£qNum
 > 
squashed_num
) {

963 
	`DPRINTF
(
LSQUn™
,"Load Instruction PC %s squashed, "

965 
lßdQueue
[
lßd_idx
]->
	`pcS‹
(),

966 
lßdQueue
[
lßd_idx
]->
£qNum
);

968 ià(
	`isSÎed
(è&& 
lßd_idx
 =ğ
¡®lšgLßdIdx
) {

969 
¡®Ëd
 = 
çl£
;

970 
¡®lšgStÜeI¢
 = 0;

971 
¡®lšgLßdIdx
 = 0;

975 
lßdQueue
[
lßd_idx
]->
	`£tSquashed
();

976 
lßdQueue
[
lßd_idx
] = 
NULL
;

977 --
lßds
;

980 
lßdTa
 = 
lßd_idx
;

982 
	`deüLdIdx
(
lßd_idx
);

983 ++
lsqSquashedLßds
;

986 ià(
isLßdBlocked
) {

987 ià(
squashed_num
 < 
blockedLßdSeqNum
) {

988 
isLßdBlocked
 = 
çl£
;

989 
lßdBlockedHªdËd
 = 
çl£
;

990 
blockedLßdSeqNum
 = 0;

994 ià(
memD•ViŞ©Ü
 && 
squashed_num
 < memD•ViŞ©Ü->
£qNum
) {

995 
memD•ViŞ©Ü
 = 
NULL
;

998 
¡Üe_idx
 = 
¡ÜeTa
;

999 
	`deüStIdx
(
¡Üe_idx
);

1001 
¡Ües
 != 0 &&

1002 
¡ÜeQueue
[
¡Üe_idx
].
š¡
->
£qNum
 > 
squashed_num
) {

1004 ià(
¡ÜeQueue
[
¡Üe_idx
].
ÿnWB
) {

1008 
	`DPRINTF
(
LSQUn™
,"Store Instruction PC %s squashed, "

1010 
¡ÜeQueue
[
¡Üe_idx
].
š¡
->
	`pcS‹
(),

1011 
¡Üe_idx
, 
¡ÜeQueue
[¡Üe_idx].
š¡
->
£qNum
);

1015 ià(
	`isSÎed
() &&

1016 
¡ÜeQueue
[
¡Üe_idx
].
š¡
->
£qNum
 =ğ
¡®lšgStÜeI¢
) {

1017 
	`·nic
("Is stalled should have been cleared by stalling†oad!\n");

1018 
¡®Ëd
 = 
çl£
;

1019 
¡®lšgStÜeI¢
 = 0;

1023 
¡ÜeQueue
[
¡Üe_idx
].
š¡
->
	`£tSquashed
();

1024 
¡ÜeQueue
[
¡Üe_idx
].
š¡
 = 
NULL
;

1025 
¡ÜeQueue
[
¡Üe_idx
].
ÿnWB
 = 0;

1030 
d–‘e
 
¡ÜeQueue
[
¡Üe_idx
].
»q
;

1031 ià(
TheISA
::
HasUÇligÃdMemAcc
 && 
¡ÜeQueue
[
¡Üe_idx
].
isS¶™
) {

1032 
d–‘e
 
¡ÜeQueue
[
¡Üe_idx
].
¤eqLow
;

1033 
d–‘e
 
¡ÜeQueue
[
¡Üe_idx
].
¤eqHigh
;

1035 
¡ÜeQueue
[
¡Üe_idx
].
¤eqLow
 = 
NULL
;

1036 
¡ÜeQueue
[
¡Üe_idx
].
¤eqHigh
 = 
NULL
;

1039 
¡ÜeQueue
[
¡Üe_idx
].
»q
 = 
NULL
;

1040 --
¡Ües
;

1043 
¡ÜeTa
 = 
¡Üe_idx
;

1045 
	`deüStIdx
(
¡Üe_idx
);

1046 ++
lsqSquashedStÜes
;

1048 
	}
}

1050 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1052 
	gLSQUn™
<
	gIm¶
>::
	$¡ÜePo¡S’d
(
Pack‘PŒ
 
pkt
)

1054 ià(
	`isSÎed
() &&

1055 
¡ÜeQueue
[
¡ÜeWBIdx
].
š¡
->
£qNum
 =ğ
¡®lšgStÜeI¢
) {

1056 
	`DPRINTF
(
LSQUn™
, "Unstalling, stalling store [sn:%lli] "

1058 
¡®lšgStÜeI¢
, 
¡®lšgLßdIdx
);

1059 
¡®Ëd
 = 
çl£
;

1060 
¡®lšgStÜeI¢
 = 0;

1061 
›wSge
->
	`»¶ayMemIn¡
(
lßdQueue
[
¡®lšgLßdIdx
]);

1064 ià(!
¡ÜeQueue
[
¡ÜeWBIdx
].
š¡
->
	`isStÜeCÚd™iÚ®
()) {

1068 
¡ÜeQueue
[
¡ÜeWBIdx
].
š¡
->
	`£tCom¶‘ed
();

1070 ià(
ıu
->
check”
) {

1071 
ıu
->
check”
->
	`v”ify
(
¡ÜeQueue
[
¡ÜeWBIdx
].
š¡
);

1075 ià(
ÃedsTSO
) {

1076 
¡ÜeInFlight
 = 
Œue
;

1079 
	`šüStIdx
(
¡ÜeWBIdx
);

1080 
	}
}

1082 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1084 
	gLSQUn™
<
	gIm¶
>::
	$wr™eback
(
DynIn¡PŒ
 &
š¡
, 
Pack‘PŒ
 
pkt
)

1086 
›wSge
->
	`wakeCPU
();

1089 ià(
š¡
->
	`isSquashed
()) {

1090 
›wSge
->
	`deüWb
(
š¡
->
£qNum
);

1091 
	`as£¹
(!
š¡
->
	`isStÜe
());

1092 ++
lsqIgnÜedRe¥Ú£s
;

1096 ià(!
š¡
->
	`isExecu‹d
()) {

1097 
š¡
->
	`£tExecu‹d
();

1100 
š¡
->
	`com¶‘eAcc
(
pkt
);

1104 
›wSge
->
	`š¡ToComm™
(
š¡
);

1106 
›wSge
->
	`aùiv™yThisCyşe
();

1109 
›wSge
->
	`checkMi¥»diùiÚ
(
š¡
);

1110 
	}
}

1112 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1114 
	gLSQUn™
<
	gIm¶
>::
	$com¶‘eStÜe
(
¡Üe_idx
)

1116 
	`as£¹
(
¡ÜeQueue
[
¡Üe_idx
].
š¡
);

1117 
¡ÜeQueue
[
¡Üe_idx
].
com¶‘ed
 = 
Œue
;

1118 --
¡ÜesToWB
;

1122 
ıu
->
	`wakeCPU
();

1123 
ıu
->
	`aùiv™yThisCyşe
();

1125 ià(
¡Üe_idx
 =ğ
¡ÜeH—d
) {

1127 
	`šüStIdx
(
¡ÜeH—d
);

1129 --
¡Ües
;

1130 } 
¡ÜeQueue
[
¡ÜeH—d
].
com¶‘ed
 &&

1131 
¡ÜeH—d
 !ğ
¡ÜeTa
);

1133 
›wSge
->
upd©eLSQNextCyşe
 = 
Œue
;

1136 
	`DPRINTF
(
LSQUn™
, "Completing store [sn:%lli], idx:%i, store head "

1138 
¡ÜeQueue
[
¡Üe_idx
].
š¡
->
£qNum
, stÜe_idx, 
¡ÜeH—d
);

1140 ià(
	`isSÎed
() &&

1141 
¡ÜeQueue
[
¡Üe_idx
].
š¡
->
£qNum
 =ğ
¡®lšgStÜeI¢
) {

1142 
	`DPRINTF
(
LSQUn™
, "Unstalling, stalling store [sn:%lli] "

1144 
¡®lšgStÜeI¢
, 
¡®lšgLßdIdx
);

1145 
¡®Ëd
 = 
çl£
;

1146 
¡®lšgStÜeI¢
 = 0;

1147 
›wSge
->
	`»¶ayMemIn¡
(
lßdQueue
[
¡®lšgLßdIdx
]);

1150 
¡ÜeQueue
[
¡Üe_idx
].
š¡
->
	`£tCom¶‘ed
();

1152 ià(
ÃedsTSO
) {

1153 
¡ÜeInFlight
 = 
çl£
;

1159 ià(
ıu
->
check”
) {

1160 
ıu
->
check”
->
	`v”ify
(
¡ÜeQueue
[
¡Üe_idx
].
š¡
);

1162 
	}
}

1164 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1165 
boŞ


1166 
	gLSQUn™
<
	gIm¶
>::
	$£ndStÜe
(
Pack‘PŒ
 
d©a_pkt
)

1168 ià(!
dÿchePÜt
->
	`£ndTimšgReq
(
d©a_pkt
)) {

1170 
isStÜeBlocked
 = 
Œue
;

1171 ++
lsqCacheBlocked
;

1172 
	`as£¹
(
»ŒyPkt
 =ğ
NULL
);

1173 
»ŒyPkt
 = 
d©a_pkt
;

1174 
lsq
->
	`£tR‘ryTid
(
lsqID
);

1175  
çl£
;

1177  
Œue
;

1178 
	}
}

1180 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1182 
	gLSQUn™
<
	gIm¶
>::
	$»cvR‘ry
()

1184 ià(
isStÜeBlocked
) {

1185 
	`DPRINTF
(
LSQUn™
, "Receiving„etry: store blocked\n");

1186 
	`as£¹
(
»ŒyPkt
 !ğ
NULL
);

1188 
LSQS’d”S‹
 *
¡©e
 =

1189 
dyÇmic_ÿ¡
<
LSQS’d”S‹
 *>(
»ŒyPkt
->
£nd”S‹
);

1191 ià(
dÿchePÜt
->
	`£ndTimšgReq
(
»ŒyPkt
)) {

1193 ià(!
TheISA
::
HasUÇligÃdMemAcc
 || !
¡©e
->
pktToS’d
 ||

1194 
¡©e
->
³ndšgPack‘
 =ğ
»ŒyPkt
) {

1195 
¡©e
->
pktToS’d
 = 
çl£
;

1196 
	`¡ÜePo¡S’d
(
»ŒyPkt
);

1198 
»ŒyPkt
 = 
NULL
;

1199 
isStÜeBlocked
 = 
çl£
;

1200 
lsq
->
	`£tR‘ryTid
(
Inv®idTh»adID
);

1203 ià(
TheISA
::
HasUÇligÃdMemAcc
 && 
¡©e
->
pktToS’d
) {

1204 
	`as£¹
(
¡©e
->
³ndšgPack‘
);

1205 ià(
	`£ndStÜe
(
¡©e
->
³ndšgPack‘
)) {

1206 
	`¡ÜePo¡S’d
(
¡©e
->
³ndšgPack‘
);

1211 ++
lsqCacheBlocked
;

1212 
lsq
->
	`£tR‘ryTid
(
lsqID
);

1214 } ià(
isLßdBlocked
) {

1215 
	`DPRINTF
(
LSQUn™
, "Loads squashhemselves‡nd‡ll younger insts, "

1218 
	`DPRINTF
(
LSQUn™
, "Retry„eceived but LSQ is‚o†onger blocked.\n");

1220 
	}
}

1222 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1223 
šlše
 

1224 
	gLSQUn™
<
	gIm¶
>::
	$šüStIdx
(&
¡Üe_idx
) const

1226 ià(++
¡Üe_idx
 >ğ
SQEÁr›s
)

1227 
¡Üe_idx
 = 0;

1228 
	}
}

1230 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1231 
šlše
 

1232 
	gLSQUn™
<
	gIm¶
>::
	$deüStIdx
(&
¡Üe_idx
) const

1234 ià(--
¡Üe_idx
 < 0)

1235 
¡Üe_idx
 +ğ
SQEÁr›s
;

1236 
	}
}

1238 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1239 
šlše
 

1240 
	gLSQUn™
<
	gIm¶
>::
	$šüLdIdx
(&
lßd_idx
) const

1242 ià(++
lßd_idx
 >ğ
LQEÁr›s
)

1243 
lßd_idx
 = 0;

1244 
	}
}

1246 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1247 
šlše
 

1248 
	gLSQUn™
<
	gIm¶
>::
	$deüLdIdx
(&
lßd_idx
) const

1250 ià(--
lßd_idx
 < 0)

1251 
lßd_idx
 +ğ
LQEÁr›s
;

1252 
	}
}

1254 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1256 
	gLSQUn™
<
	gIm¶
>::
	$dumpIn¡s
() const

1258 
	`ırštf
("Load store queue: Dumping instructions.\n");

1259 
	`ırštf
("Lßd queusize: %i\n", 
lßds
);

1260 
	`ırštf
("Load queue: ");

1262 
lßd_idx
 = 
lßdH—d
;

1264 
lßd_idx
 !ğ
lßdTa
 && 
lßdQueue
[load_idx]) {

1265 cÚ¡ 
DynIn¡PŒ
 &
	`š¡
(
lßdQueue
[
lßd_idx
]);

1266 
	`ırštf
("%s.[¢:%i] ", 
š¡
->
	`pcS‹
(), in¡->
£qNum
);

1268 
	`šüLdIdx
(
lßd_idx
);

1270 
	`ırštf
("\n");

1272 
	`ırštf
("StÜqueusize: %i\n", 
¡Ües
);

1273 
	`ırštf
("Store queue: ");

1275 
¡Üe_idx
 = 
¡ÜeH—d
;

1277 
¡Üe_idx
 !ğ
¡ÜeTa
 && 
¡ÜeQueue
[¡Üe_idx].
š¡
) {

1278 cÚ¡ 
DynIn¡PŒ
 &
	`š¡
(
¡ÜeQueue
[
¡Üe_idx
].
š¡
);

1279 
	`ırštf
("%s.[¢:%i] ", 
š¡
->
	`pcS‹
(), in¡->
£qNum
);

1281 
	`šüStIdx
(
¡Üe_idx
);

1284 
	`ırštf
("\n");

1285 
	}
}

	@mem_dep_unit.cc

31 
	~"ıu/o3/i§_¥ecific.hh
"

32 
	~"ıu/o3/mem_d•_un™_im¶.hh
"

33 
	~"ıu/o3/¡Üe_£t.hh
"

35 #ifdeà
DEBUG


36 
	g‹m¶©e
 <>

38 
	gMemD•Un™
<
	gStÜeS‘
, 
	gO3CPUIm¶
>::
MemD•EÁry
::
memd•_couÁ
 = 0;

39 
	g‹m¶©e
 <>

41 
	gMemD•Un™
<
	gStÜeS‘
, 
	gO3CPUIm¶
>::
MemD•EÁry
::
memd•_š£¹
 = 0;

42 
	g‹m¶©e
 <>

44 
	gMemD•Un™
<
	gStÜeS‘
, 
	gO3CPUIm¶
>::
MemD•EÁry
::
memd•_”a£
 = 0;

49 
‹m¶©e
 
şass
 
	gMemD•Un™
<
	gStÜeS‘
, 
	gO3CPUIm¶
>;

	@mem_dep_unit.hh

43 #iâdeà
__CPU_O3_MEM_DEP_UNIT_HH__


44 
	#__CPU_O3_MEM_DEP_UNIT_HH__


	)

46 
	~<li¡
>

47 
	~<£t
>

49 
	~"ba£/hashm­.hh
"

50 
	~"ba£/»fút.hh
"

51 
	~"ba£/¡©i¡ics.hh
"

52 
	~"ıu/š¡_£q.hh
"

53 
	~"debug/MemD•Un™.hh
"

55 
	sSNHash
 {

56 
size_t
 
İ”©Ü
(è(cÚ¡ 
	mIn¡SeqNum
 &
	m£q_num
) const {

57 
	ma
 = ()
£q_num
;

58 
	mhash
 = (((
a
 >> 14) ^ ((a >> 2) & 0xffff))) & 0x7FFFFFFF;

60  
	mhash
;

64 
	gD”ivO3CPUP¬ams
;

66 
	g‹m¶©e
 <
şass
 
	gIm¶
>

67 
şass
 
	gIn¡ruùiÚQueue
;

80 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

81 şas 
	cMemD•Un™


83 
	m´Ùeùed
:

84 
¡d
::
¡ršg
 
_Çme
;

86 
	mpublic
:

87 
ty³Çme
 
	tIm¶
::
	tDynIn¡PŒ
 DynInstPtr;

90 
MemD•Un™
();

93 
MemD•Un™
(
D”ivO3CPUP¬ams
 *
·¿ms
);

96 ~
MemD•Un™
();

99 
	m¡d
::
¡ršg
 
	$Çme
(ècÚ¡ {  
_Çme
; }

102 
	`š™
(
D”ivO3CPUP¬ams
 *
·¿ms
, 
Th»adID
 
tid
);

105 
	`»gSts
();

108 
	$d¿šSª™yCheck
() const;

111 
	`keOv”From
();

114 
	`£tIQ
(
In¡ruùiÚQueue
<
Im¶
> *
iq_±r
);

117 
	`š£¹
(
DynIn¡PŒ
 &
š¡
);

120 
	`š£¹NÚS³c
(
DynIn¡PŒ
 &
š¡
);

123 
	`š£¹B¬r›r
(
DynIn¡PŒ
 &
b¬r_š¡
);

126 
	`»gsR—dy
(
DynIn¡PŒ
 &
š¡
);

129 
	`nÚS³cIn¡R—dy
(
DynIn¡PŒ
 &
š¡
);

132 
	`»scheduË
(
DynIn¡PŒ
 &
š¡
);

137 
	`»¶ay
(
DynIn¡PŒ
 &
š¡
);

140 
	`com¶‘ed
(
DynIn¡PŒ
 &
š¡
);

143 
	`com¶‘eB¬r›r
(
DynIn¡PŒ
 &
š¡
);

146 
	`wakeD•’d’ts
(
DynIn¡PŒ
 &
š¡
);

151 
	`squash
(cÚ¡ 
In¡SeqNum
 &
squashed_num
, 
Th»adID
 
tid
);

154 
	`viŞ©iÚ
(
DynIn¡PŒ
 &
¡Üe_š¡
, DynIn¡PŒ &
viŞ©šg_lßd
);

157 
	`issue
(
DynIn¡PŒ
 &
š¡
);

160 
	`dumpLi¡s
();

162 
´iv©e
:

163 
ty³Çme
 
	t¡d
::
	tli¡
<
	tDynIn¡PŒ
>::
	t™”©Ü
 
	tLi¡It
;

165 
şass
 
MemD•EÁry
;

167 
RefCouÁšgPŒ
<
	tMemD•EÁry
> 
	tMemD•EÁryPŒ
;

173 şas 
	cMemD•EÁry
 : 
public
 
RefCouÁed
 {

174 
public
:

176 
	`MemD•EÁry
(
DynIn¡PŒ
 &
Ãw_š¡
)

177 : 
	`š¡
(
Ãw_š¡
), 
	`»gsR—dy
(
çl£
), 
	`memD•R—dy
(false),

178 
	`com¶‘ed
(
çl£
), 
	`squashed
(false)

180 #ifdeà
DEBUG


181 ++
memd•_couÁ
;

183 
	`DPRINTF
(
MemD•Un™
, "Memory dependencyƒntry created. "

184 "memd•_couÁ=%˜%s\n", 
memd•_couÁ
, 
š¡
->
	`pcS‹
());

189 ~
	`MemD•EÁry
()

191 
i
 = 0; i < 
d•’dIn¡s
.
	`size
(); ++i) {

192 
d•’dIn¡s
[
i
] = 
NULL
;

194 #ifdeà
DEBUG


195 --
memd•_couÁ
;

197 
	`DPRINTF
(
MemD•Un™
, "Memory dependencyƒntry deleted. "

198 "memd•_couÁ=%˜%s\n", 
memd•_couÁ
, 
š¡
->
	`pcS‹
());

203 
¡d
::
¡ršg
 
	`Çme
() const {  "memdepentry"; }

206 
DynIn¡PŒ
 
š¡
;

209 
Li¡It
 
li¡It
;

212 
¡d
::
veùÜ
<
MemD•EÁryPŒ
> 
d•’dIn¡s
;

215 
boŞ
 
»gsR—dy
;

217 
boŞ
 
memD•R—dy
;

219 
boŞ
 
com¶‘ed
;

221 
boŞ
 
squashed
;

224 #ifdeà
DEBUG


225 
memd•_couÁ
;

226 
memd•_š£¹
;

227 
memd•_”a£
;

229 
	}
};

232 
šlše
 
	gMemD•EÁryPŒ
 &
fšdInHash
(cÚ¡ 
DynIn¡PŒ
 &
š¡
);

235 
šlše
 
moveToR—dy
(
MemD•EÁryPŒ
 &
»ady_š¡_’Œy
);

237 
	gm5
::
	thash_m­
<
	tIn¡SeqNum
, 
	tMemD•EÁryPŒ
, 
	tSNHash
> 
	tMemD•Hash
;

239 
ty³Çme
 
	tMemD•Hash
::
	t™”©Ü
 
	tMemD•HashIt
;

242 
MemD•Hash
 
	gmemD•Hash
;

245 
	g¡d
::
li¡
<
DynIn¡PŒ
> 
š¡Li¡
[
Im¶
::
MaxTh»ads
];

248 
	g¡d
::
li¡
<
DynIn¡PŒ
> 
š¡sToR•Ïy
;

255 
MemD•P»d
 
	gd•P»d
;

258 
boŞ
 
	glßdB¬r›r
;

260 
In¡SeqNum
 
	glßdB¬r›rSN
;

262 
boŞ
 
	g¡ÜeB¬r›r
;

264 
In¡SeqNum
 
	g¡ÜeB¬r›rSN
;

267 
	gIn¡ruùiÚQueue
<
	gIm¶
> *
	giqPŒ
;

270 
	gid
;

273 
	gSts
::
SÿÏr
 
š£¹edLßds
;

275 
	gSts
::
SÿÏr
 
š£¹edStÜes
;

277 
	gSts
::
SÿÏr
 
cÚæiùšgLßds
;

279 
	gSts
::
SÿÏr
 
cÚæiùšgStÜes
;

	@mem_dep_unit_impl.hh

43 
	~<m­
>

45 
	~"ıu/o3/š¡_queue.hh
"

46 
	~"ıu/o3/mem_d•_un™.hh
"

47 
	~"debug/MemD•Un™.hh
"

48 
	~"·¿ms/D”ivO3CPU.hh
"

50 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

51 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
	$MemD•Un™
()

52 : 
	`lßdB¬r›r
(
çl£
), 
	`lßdB¬r›rSN
(0), 
	`¡ÜeB¬r›r
(false),

53 
	`¡ÜeB¬r›rSN
(0), 
	$iqPŒ
(
NULL
)

55 
	}
}

57 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

58 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
	$MemD•Un™
(
D”ivO3CPUP¬ams
 *
·¿ms
)

59 : 
	`_Çme
(
·¿ms
->
Çme
 + ".memdepunit"),

60 
	`d•P»d
(
·¿ms
->
¡Üe_£t_ş—r_³riod
,…¬ams->
SSITSize
,

61 
·¿ms
->
LFSTSize
),

62 
	`lßdB¬r›r
(
çl£
), 
	`lßdB¬r›rSN
(0), 
	`¡ÜeB¬r›r
(false),

63 
	`¡ÜeB¬r›rSN
(0), 
	$iqPŒ
(
NULL
)

65 
	`DPRINTF
(
MemD•Un™
, "Creating MemDepUnit object.\n");

66 
	}
}

68 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

69 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::~
	$MemD•Un™
()

71 
Th»adID
 
tid
 = 0;id < 
Im¶
::
MaxTh»ads
;id++) {

73 
Li¡It
 
š¡_li¡_™
 = 
š¡Li¡
[
tid
].
	`begš
();

75 
MemD•HashIt
 
hash_™
;

77 !
š¡Li¡
[
tid
].
	`em±y
()) {

78 
hash_™
 = 
memD•Hash
.
	`fšd
((*
š¡_li¡_™
)->
£qNum
);

80 
	`as£¹
(
hash_™
 !ğ
memD•Hash
.
	`’d
());

82 
memD•Hash
.
	`”a£
(
hash_™
);

84 
š¡Li¡
[
tid
].
	`”a£
(
š¡_li¡_™
++);

88 #ifdeà
DEBUG


89 
	`as£¹
(
MemD•EÁry
::
memd•_couÁ
 == 0);

91 
	}
}

93 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

95 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
	$š™
(
D”ivO3CPUP¬ams
 *
·¿ms
, 
Th»adID
 
tid
)

97 
	`DPRINTF
(
MemD•Un™
, "C»©šg MemD•Un™ %˜objeù.\n",
tid
);

99 
_Çme
 = 
	`c¥rštf
("%s.memD•%d", 
·¿ms
->
Çme
, 
tid
);

100 
id
 = 
tid
;

102 
d•P»d
.
	`š™
(
·¿ms
->
¡Üe_£t_ş—r_³riod
,…¬ams->
SSITSize
,

103 
·¿ms
->
LFSTSize
);

104 
	}
}

106 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

108 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
	$»gSts
()

110 
š£¹edLßds


111 .
	`Çme
(name() + ".insertedLoads")

112 .
	`desc
("Number of†oads insertedohe mem dependence unit.");

114 
š£¹edStÜes


115 .
	`Çme
(name() + ".insertedStores")

116 .
	`desc
("Number of stores insertedohe mem dependence unit.");

118 
cÚæiùšgLßds


119 .
	`Çme
(name() + ".conflictingLoads")

120 .
	`desc
("Number of conflicting†oads.");

122 
cÚæiùšgStÜes


123 .
	`Çme
(name() + ".conflictingStores")

124 .
	`desc
("Number of conflicting stores.");

125 
	}
}

127 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

129 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
	$d¿šSª™yCheck
() const

131 
	`as£¹
(
š¡sToR•Ïy
.
	`em±y
());

132 
	`as£¹
(
memD•Hash
.
	`em±y
());

133 
i
 = 0; i < 
Im¶
::
MaxTh»ads
; ++i)

134 
	`as£¹
(
š¡Li¡
[
i
].
	`em±y
());

135 
	`as£¹
(
š¡sToR•Ïy
.
	`em±y
());

136 
	`as£¹
(
memD•Hash
.
	`em±y
());

137 
	}
}

139 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

141 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
	$keOv”From
()

144 
lßdB¬r›r
 = 
¡ÜeB¬r›r
 = 
çl£
;

145 
lßdB¬r›rSN
 = 
¡ÜeB¬r›rSN
 = 0;

146 
d•P»d
.
	`ş—r
();

147 
	}
}

149 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

151 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
£tIQ
(
In¡ruùiÚQueue
<
Im¶
> *
iq_±r
)

153 
iqPŒ
 = 
iq_±r
;

156 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

158 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
	$š£¹
(
DynIn¡PŒ
 &
š¡
)

160 
Th»adID
 
tid
 = 
š¡
->
th»adNumb”
;

162 
MemD•EÁryPŒ
 
š¡_’Œy
 = 
Ãw
 
	`MemD•EÁry
(
š¡
);

165 
memD•Hash
.
	`š£¹
(

166 
¡d
::
·œ
<
In¡SeqNum
, 
MemD•EÁryPŒ
>(
š¡
->
£qNum
, 
š¡_’Œy
));

167 #ifdeà
DEBUG


168 
MemD•EÁry
::
memd•_š£¹
++;

171 
š¡Li¡
[
tid
].
	`push_back
(
š¡
);

173 
š¡_’Œy
->
li¡It
 = --(
š¡Li¡
[
tid
].
	`’d
());

177 
In¡SeqNum
 
´oducšg_¡Üe
;

178 ià(
š¡
->
	`isLßd
(è&& 
lßdB¬r›r
) {

179 
	`DPRINTF
(
MemD•Un™
, "Load barrier [sn:%lli] in flight\n",

180 
lßdB¬r›rSN
);

181 
´oducšg_¡Üe
 = 
lßdB¬r›rSN
;

182 } ià(
š¡
->
	`isStÜe
(è&& 
¡ÜeB¬r›r
) {

183 
	`DPRINTF
(
MemD•Un™
, "Store barrier [sn:%lli] in flight\n",

184 
¡ÜeB¬r›rSN
);

185 
´oducšg_¡Üe
 = 
¡ÜeB¬r›rSN
;

187 
´oducšg_¡Üe
 = 
d•P»d
.
	`checkIn¡
(
š¡
->
	`š¡Addr
());

190 
MemD•EÁryPŒ
 
¡Üe_’Œy
 = 
NULL
;

193 ià(
´oducšg_¡Üe
 != 0) {

194 
	`DPRINTF
(
MemD•Un™
, "Searching for…roducer\n");

195 
MemD•HashIt
 
hash_™
 = 
memD•Hash
.
	`fšd
(
´oducšg_¡Üe
);

197 ià(
hash_™
 !ğ
memD•Hash
.
	`’d
()) {

198 
¡Üe_’Œy
 = (*
hash_™
).
£cÚd
;

199 
	`DPRINTF
(
MemD•Un™
, "Proucer found\n");

205 ià(!
¡Üe_’Œy
) {

206 
	`DPRINTF
(
MemD•Un™
, "No dependency for inst PC "

207 "% [¢:%Îi].\n", 
š¡
->
	`pcS‹
(), in¡->
£qNum
);

209 
š¡_’Œy
->
memD•R—dy
 = 
Œue
;

211 ià(
š¡
->
	`»adyToIssue
()) {

212 
š¡_’Œy
->
»gsR—dy
 = 
Œue
;

214 
	`moveToR—dy
(
š¡_’Œy
);

218 
	`DPRINTF
(
MemD•Un™
, "Addingo dependency†ist; "

220 
š¡
->
	`pcS‹
(), 
´oducšg_¡Üe
);

222 ià(
š¡
->
	`»adyToIssue
()) {

223 
š¡_’Œy
->
»gsR—dy
 = 
Œue
;

227 
š¡
->
	`ş—rCªIssue
();

230 
¡Üe_’Œy
->
d•’dIn¡s
.
	`push_back
(
š¡_’Œy
);

232 ià(
š¡
->
	`isLßd
()) {

233 ++
cÚæiùšgLßds
;

235 ++
cÚæiùšgStÜes
;

239 ià(
š¡
->
	`isStÜe
()) {

240 
	`DPRINTF
(
MemD•Un™
, "Inserting store PC %s [sn:%lli].\n",

241 
š¡
->
	`pcS‹
(), in¡->
£qNum
);

243 
d•P»d
.
	`š£¹StÜe
(
š¡
->
	`š¡Addr
(), in¡->
£qNum
, in¡->
th»adNumb”
);

245 ++
š£¹edStÜes
;

246 } ià(
š¡
->
	`isLßd
()) {

247 ++
š£¹edLßds
;

249 
	`·nic
("Unknownype! (most†ikely‡ barrier).");

251 
	}
}

253 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

255 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
	$š£¹NÚS³c
(
DynIn¡PŒ
 &
š¡
)

257 
Th»adID
 
tid
 = 
š¡
->
th»adNumb”
;

259 
MemD•EÁryPŒ
 
š¡_’Œy
 = 
Ãw
 
	`MemD•EÁry
(
š¡
);

262 
memD•Hash
.
	`š£¹
(

263 
¡d
::
·œ
<
In¡SeqNum
, 
MemD•EÁryPŒ
>(
š¡
->
£qNum
, 
š¡_’Œy
));

264 #ifdeà
DEBUG


265 
MemD•EÁry
::
memd•_š£¹
++;

269 
š¡Li¡
[
tid
].
	`push_back
(
š¡
);

271 
š¡_’Œy
->
li¡It
 = --(
š¡Li¡
[
tid
].
	`’d
());

275 ià(
š¡
->
	`isStÜe
()) {

276 
	`DPRINTF
(
MemD•Un™
, "Inserting store PC %s [sn:%lli].\n",

277 
š¡
->
	`pcS‹
(), in¡->
£qNum
);

279 
d•P»d
.
	`š£¹StÜe
(
š¡
->
	`š¡Addr
(), in¡->
£qNum
, in¡->
th»adNumb”
);

281 ++
š£¹edStÜes
;

282 } ià(
š¡
->
	`isLßd
()) {

283 ++
š£¹edLßds
;

285 
	`·nic
("Unknownype! (most†ikely‡ barrier).");

287 
	}
}

289 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

291 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
	$š£¹B¬r›r
(
DynIn¡PŒ
 &
b¬r_š¡
)

293 
In¡SeqNum
 
b¬r_¢
 = 
b¬r_š¡
->
£qNum
;

295 ià(
b¬r_š¡
->
	`isMemB¬r›r
()) {

296 
lßdB¬r›r
 = 
Œue
;

297 
lßdB¬r›rSN
 = 
b¬r_¢
;

298 
¡ÜeB¬r›r
 = 
Œue
;

299 
¡ÜeB¬r›rSN
 = 
b¬r_¢
;

300 
	`DPRINTF
(
MemD•Un™
, "Inserted‡ memory barrier %s SN:%lli\n",

301 
b¬r_š¡
->
	`pcS‹
(),
b¬r_¢
);

302 } ià(
b¬r_š¡
->
	`isWr™eB¬r›r
()) {

303 
¡ÜeB¬r›r
 = 
Œue
;

304 
¡ÜeB¬r›rSN
 = 
b¬r_¢
;

305 
	`DPRINTF
(
MemD•Un™
, "Inserted‡ write barrier\n");

308 
Th»adID
 
tid
 = 
b¬r_š¡
->
th»adNumb”
;

310 
MemD•EÁryPŒ
 
š¡_’Œy
 = 
Ãw
 
	`MemD•EÁry
(
b¬r_š¡
);

313 
memD•Hash
.
	`š£¹
(

314 
¡d
::
·œ
<
In¡SeqNum
, 
MemD•EÁryPŒ
>(
b¬r_¢
, 
š¡_’Œy
));

315 #ifdeà
DEBUG


316 
MemD•EÁry
::
memd•_š£¹
++;

320 
š¡Li¡
[
tid
].
	`push_back
(
b¬r_š¡
);

322 
š¡_’Œy
->
li¡It
 = --(
š¡Li¡
[
tid
].
	`’d
());

323 
	}
}

325 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

327 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
	$»gsR—dy
(
DynIn¡PŒ
 &
š¡
)

329 
	`DPRINTF
(
MemD•Un™
, "Marking„egisters‡s„eady for "

331 
š¡
->
	`pcS‹
(), in¡->
£qNum
);

333 
MemD•EÁryPŒ
 
š¡_’Œy
 = 
	`fšdInHash
(
š¡
);

335 
š¡_’Œy
->
»gsR—dy
 = 
Œue
;

337 ià(
š¡_’Œy
->
memD•R—dy
) {

338 
	`DPRINTF
(
MemD•Un™
, "Instruction has its memory "

341 
	`moveToR—dy
(
š¡_’Œy
);

343 
	`DPRINTF
(
MemD•Un™
, "Instruction still waiting on "

346 
	}
}

348 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

350 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
	$nÚS³cIn¡R—dy
(
DynIn¡PŒ
 &
š¡
)

352 
	`DPRINTF
(
MemD•Un™
, "Marking‚on speculative "

354 
š¡
->
	`pcS‹
(), in¡->
£qNum
);

356 
MemD•EÁryPŒ
 
š¡_’Œy
 = 
	`fšdInHash
(
š¡
);

358 
	`moveToR—dy
(
š¡_’Œy
);

359 
	}
}

361 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

363 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
	$»scheduË
(
DynIn¡PŒ
 &
š¡
)

365 
š¡sToR•Ïy
.
	`push_back
(
š¡
);

366 
	}
}

368 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

370 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
	$»¶ay
(
DynIn¡PŒ
 &
š¡
)

372 
DynIn¡PŒ
 
‹mp_š¡
;

375 !
š¡sToR•Ïy
.
	`em±y
()) {

376 
‹mp_š¡
 = 
š¡sToR•Ïy
.
	`äÚt
();

378 
MemD•EÁryPŒ
 
š¡_’Œy
 = 
	`fšdInHash
(
‹mp_š¡
);

380 
	`DPRINTF
(
MemD•Un™
, "Replaying mem instruction PC %s [sn:%lli].\n",

381 
‹mp_š¡
->
	`pcS‹
(),emp_š¡->
£qNum
);

383 
	`moveToR—dy
(
š¡_’Œy
);

385 
š¡sToR•Ïy
.
	`pİ_äÚt
();

387 
	}
}

389 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

391 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
	$com¶‘ed
(
DynIn¡PŒ
 &
š¡
)

393 
	`DPRINTF
(
MemD•Un™
, "Completed mem instruction PC %s [sn:%lli].\n",

394 
š¡
->
	`pcS‹
(), in¡->
£qNum
);

396 
Th»adID
 
tid
 = 
š¡
->
th»adNumb”
;

399 
MemD•HashIt
 
hash_™
 = 
memD•Hash
.
	`fšd
(
š¡
->
£qNum
);

401 
	`as£¹
(
hash_™
 !ğ
memD•Hash
.
	`’d
());

403 
š¡Li¡
[
tid
].
	`”a£
((*
hash_™
).
£cÚd
->
li¡It
);

405 (*
hash_™
).
£cÚd
 = 
NULL
;

407 
memD•Hash
.
	`”a£
(
hash_™
);

408 #ifdeà
DEBUG


409 
MemD•EÁry
::
memd•_”a£
++;

411 
	}
}

413 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

415 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
	$com¶‘eB¬r›r
(
DynIn¡PŒ
 &
š¡
)

417 
	`wakeD•’d’ts
(
š¡
);

418 
	`com¶‘ed
(
š¡
);

420 
In¡SeqNum
 
b¬r_¢
 = 
š¡
->
£qNum
;

421 
	`DPRINTF
(
MemD•Un™
, "b¬r›¸com¶‘ed: % SN:%Îi\n", 
š¡
->
	`pcS‹
(),

422 
š¡
->
£qNum
);

423 ià(
š¡
->
	`isMemB¬r›r
()) {

424 ià(
lßdB¬r›rSN
 =ğ
b¬r_¢
)

425 
lßdB¬r›r
 = 
çl£
;

426 ià(
¡ÜeB¬r›rSN
 =ğ
b¬r_¢
)

427 
¡ÜeB¬r›r
 = 
çl£
;

428 } ià(
š¡
->
	`isWr™eB¬r›r
()) {

429 ià(
¡ÜeB¬r›rSN
 =ğ
b¬r_¢
)

430 
¡ÜeB¬r›r
 = 
çl£
;

432 
	}
}

434 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

436 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
	$wakeD•’d’ts
(
DynIn¡PŒ
 &
š¡
)

439 ià(!
š¡
->
	`isStÜe
(è&& !š¡->
	`isMemB¬r›r
(è&& !š¡->
	`isWr™eB¬r›r
()) {

443 
MemD•EÁryPŒ
 
š¡_’Œy
 = 
	`fšdInHash
(
š¡
);

445 
i
 = 0; i < 
š¡_’Œy
->
d•’dIn¡s
.
	`size
(); ++i ) {

446 
MemD•EÁryPŒ
 
wok’_š¡
 = 
š¡_’Œy
->
d•’dIn¡s
[
i
];

448 ià(!
wok’_š¡
->
š¡
) {

453 
	`DPRINTF
(
MemD•Un™
, "Waking up‡ dependent inst, "

455 
wok’_š¡
->
š¡
->
£qNum
);

457 ià(
wok’_š¡
->
»gsR—dy
 && !wok’_š¡->
squashed
) {

458 
	`moveToR—dy
(
wok’_š¡
);

460 
wok’_š¡
->
memD•R—dy
 = 
Œue
;

464 
š¡_’Œy
->
d•’dIn¡s
.
	`ş—r
();

465 
	}
}

467 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

469 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
	$squash
(cÚ¡ 
In¡SeqNum
 &
squashed_num
,

470 
Th»adID
 
tid
)

472 ià(!
š¡sToR•Ïy
.
	`em±y
()) {

473 
Li¡It
 
»¶ay_™
 = 
š¡sToR•Ïy
.
	`begš
();

474 
»¶ay_™
 !ğ
š¡sToR•Ïy
.
	`’d
()) {

475 ià((*
»¶ay_™
)->
th»adNumb”
 =ğ
tid
 &&

476 (*
»¶ay_™
)->
£qNum
 > 
squashed_num
) {

477 
š¡sToR•Ïy
.
	`”a£
(
»¶ay_™
++);

479 ++
»¶ay_™
;

484 
Li¡It
 
squash_™
 = 
š¡Li¡
[
tid
].
	`’d
();

485 --
squash_™
;

487 
MemD•HashIt
 
hash_™
;

489 !
š¡Li¡
[
tid
].
	`em±y
() &&

490 (*
squash_™
)->
£qNum
 > 
squashed_num
) {

492 
	`DPRINTF
(
MemD•Un™
, "Squashing inst [sn:%lli]\n",

493 (*
squash_™
)->
£qNum
);

495 ià((*
squash_™
)->
£qNum
 =ğ
lßdB¬r›rSN
)

496 
lßdB¬r›r
 = 
çl£
;

498 ià((*
squash_™
)->
£qNum
 =ğ
¡ÜeB¬r›rSN
)

499 
¡ÜeB¬r›r
 = 
çl£
;

501 
hash_™
 = 
memD•Hash
.
	`fšd
((*
squash_™
)->
£qNum
);

503 
	`as£¹
(
hash_™
 !ğ
memD•Hash
.
	`’d
());

505 (*
hash_™
).
£cÚd
->
squashed
 = 
Œue
;

507 (*
hash_™
).
£cÚd
 = 
NULL
;

509 
memD•Hash
.
	`”a£
(
hash_™
);

510 #ifdeà
DEBUG


511 
MemD•EÁry
::
memd•_”a£
++;

514 
š¡Li¡
[
tid
].
	`”a£
(
squash_™
--);

518 
d•P»d
.
	`squash
(
squashed_num
, 
tid
);

519 
	}
}

521 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

523 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
	$viŞ©iÚ
(
DynIn¡PŒ
 &
¡Üe_š¡
,

524 
DynIn¡PŒ
 &
viŞ©šg_lßd
)

526 
	`DPRINTF
(
MemD•Un™
, "Passing violating PCso store sets,"

527 "†ßd: %#x, stÜe: %#x\n", 
viŞ©šg_lßd
->
	`š¡Addr
(),

528 
¡Üe_š¡
->
	`š¡Addr
());

530 
d•P»d
.
	`viŞ©iÚ
(
¡Üe_š¡
->
	`š¡Addr
(), 
viŞ©šg_lßd
->instAddr());

531 
	}
}

533 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

535 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
	$issue
(
DynIn¡PŒ
 &
š¡
)

537 
	`DPRINTF
(
MemD•Un™
, "Issuing instruction PC %#x [sn:%lli].\n",

538 
š¡
->
	`š¡Addr
(), in¡->
£qNum
);

540 
d•P»d
.
	`issued
(
š¡
->
	`š¡Addr
(), in¡->
£qNum
, in¡->
	`isStÜe
());

541 
	}
}

543 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

544 
šlše
 
ty³Çme
 
	gMemD•Un™
<
	gMemD•P»d
,
	gIm¶
>::
MemD•EÁryPŒ
 &

545 
MemD•Un™
<
MemD•P»d
, 
	gIm¶
>::
	$fšdInHash
(cÚ¡ 
DynIn¡PŒ
 &
š¡
)

547 
MemD•HashIt
 
hash_™
 = 
memD•Hash
.
	`fšd
(
š¡
->
£qNum
);

549 
	`as£¹
(
hash_™
 !ğ
memD•Hash
.
	`’d
());

551  (*
hash_™
).
£cÚd
;

552 
	}
}

554 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

555 
šlše
 

556 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
	$moveToR—dy
(
MemD•EÁryPŒ
 &
wok’_š¡_’Œy
)

558 
	`DPRINTF
(
MemD•Un™
, "Adding instruction [sn:%lli] "

559 "tØth»ady†i¡.\n", 
wok’_š¡_’Œy
->
š¡
->
£qNum
);

561 
	`as£¹
(!
wok’_š¡_’Œy
->
squashed
);

563 
iqPŒ
->
	`addR—dyMemIn¡
(
wok’_š¡_’Œy
->
š¡
);

564 
	}
}

567 
	g‹m¶©e
 <
şass
 
	gMemD•P»d
, cÏs 
	gIm¶
>

569 
	gMemD•Un™
<
	gMemD•P»d
, 
	gIm¶
>::
	$dumpLi¡s
()

571 
Th»adID
 
tid
 = 0;id < 
Im¶
::
MaxTh»ads
;id++) {

572 
	`ırštf
("Instruction†ist %i size: %i\n",

573 
tid
, 
š¡Li¡
[tid].
	`size
());

575 
Li¡It
 
š¡_li¡_™
 = 
š¡Li¡
[
tid
].
	`begš
();

576 
num
 = 0;

578 
š¡_li¡_™
 !ğ
š¡Li¡
[
tid
].
	`’d
()) {

579 
	`ırštf
("Instruction:%i\nPC: %s\n[sn:%i]\n[tid:%i]\nIssued:%i\n"

581 
num
, (*
š¡_li¡_™
)->
	`pcS‹
(),

582 (*
š¡_li¡_™
)->
£qNum
,

583 (*
š¡_li¡_™
)->
th»adNumb”
,

584 (*
š¡_li¡_™
)->
	`isIssued
(),

585 (*
š¡_li¡_™
)->
	`isSquashed
());

586 
š¡_li¡_™
++;

587 ++
num
;

591 
	`ırštf
("MemÜy d•’d’û hash size: %i\n", 
memD•Hash
.
	`size
());

593 #ifdeà
DEBUG


594 
	`ırštf
("MemÜy d•’d’ûƒÁr›s: %i\n", 
MemD•EÁry
::
memd•_couÁ
);

596 
	}
}

	@regfile.hh

32 #iâdeà
__CPU_O3_REGFILE_HH__


33 
	#__CPU_O3_REGFILE_HH__


	)

35 
	~<veùÜ
>

37 
	~"¬ch/i§_Œa™s.hh
"

38 
	~"¬ch/k”Ãl_¡©s.hh
"

39 
	~"¬ch/ty³s.hh
"

40 
	~"ba£/Œaû.hh
"

41 
	~"cÚfig/the_i§.hh
"

42 
	~"ıu/o3/comm.hh
"

43 
	~"debug/IEW.hh
"

50 
	g‹m¶©e
 <
şass
 
	gIm¶
>

51 şas 
	cPhysRegFe


53 
	m´Ùeùed
:

54 
TheISA
::
	tIÁReg
 IntReg;

55 
	mTheISA
::
	tFlßtReg
 FloatReg;

56 
	mTheISA
::
	tFlßtRegB™s
 FloatRegBits;

59 
FlßtReg
 
	md
;

60 
FlßtRegB™s
 
	mq
;

61 } 
	tPhysFlßtReg
;

68 
	gpublic
:

69 
ty³Çme
 
	tIm¶
::
	tO3CPU
 O3CPU;

75 
PhysRegFe
(
O3CPU
 *
_ıu
, 
_numPhysiÿlIÁRegs
,

76 
_numPhysiÿlFlßtRegs
);

81 ~
PhysRegFe
();

89 
ušt64_t
 
	$»adIÁReg
(
PhysRegIndex
 
»g_idx
)

91 
	`as£¹
(
»g_idx
 < 
numPhysiÿlIÁRegs
);

93 
	`DPRINTF
(
IEW
, "RegFile: Accesso int„egister %i, has data "

94 "%#x\n", (
»g_idx
), 
štRegFe
[reg_idx]);

95  
štRegFe
[
»g_idx
];

96 
	}
}

99 
FlßtReg
 
	$»adFlßtReg
(
PhysRegIndex
 
»g_idx
)

102 
»g_idx
 =„eg_idx - 
numPhysiÿlIÁRegs
;

104 
	`as£¹
(
»g_idx
 < 
numPhysiÿlFlßtRegs
 + 
numPhysiÿlIÁRegs
);

106 
FlßtReg
 
æßtReg
 = 
æßtRegFe
[
»g_idx
].
d
;

108 
	`DPRINTF
(
IEW
, "RegFile: Accesso float„egister %i, has "

109 "d©¨%#x\n", (
»g_idx
), 
æßtRegFe
[»g_idx].
q
);

111  
æßtReg
;

112 
	}
}

114 
FlßtRegB™s
 
	$»adFlßtRegB™s
(
PhysRegIndex
 
»g_idx
)

117 
»g_idx
 =„eg_idx - 
numPhysiÿlIÁRegs
;

119 
	`as£¹
(
»g_idx
 < 
numPhysiÿlFlßtRegs
 + 
numPhysiÿlIÁRegs
);

121 
FlßtRegB™s
 
æßtRegB™s
 = 
æßtRegFe
[
»g_idx
].
q
;

123 
	`DPRINTF
(
IEW
, "RegFile: Accesso float„egister %i‡s int, "

124 "ha d©¨%#x\n", (
»g_idx
), (
ušt64_t
)
æßtRegB™s
);

126  
æßtRegB™s
;

127 
	}
}

130 
	$£tIÁReg
(
PhysRegIndex
 
»g_idx
, 
ušt64_t
 
v®
)

132 
	`as£¹
(
»g_idx
 < 
numPhysiÿlIÁRegs
);

134 
	`DPRINTF
(
IEW
, "RegFile: Setting int„egister %io %#x\n",

135 (
»g_idx
), 
v®
);

137 ià(
»g_idx
 !ğ
TheISA
::
Z”oReg
)

138 
štRegFe
[
»g_idx
] = 
v®
;

139 
	}
}

142 
	$£tFlßtReg
(
PhysRegIndex
 
»g_idx
, 
FlßtReg
 
v®
)

145 
»g_idx
 =„eg_idx - 
numPhysiÿlIÁRegs
;

147 
	`as£¹
(
»g_idx
 < 
numPhysiÿlFlßtRegs
);

149 
	`DPRINTF
(
IEW
, "RegFile: Setting float„egister %io %#x\n",

150 (
»g_idx
), (
ušt64_t
)
v®
);

152 #ià
THE_ISA
 =ğ
ALPHA_ISA


153 ià(
»g_idx
 !ğ
TheISA
::
Z”oReg
)

155 
æßtRegFe
[
»g_idx
].
d
 = 
v®
;

156 
	}
}

158 
	$£tFlßtRegB™s
(
PhysRegIndex
 
»g_idx
, 
FlßtRegB™s
 
v®
)

161 
»g_idx
 =„eg_idx - 
numPhysiÿlIÁRegs
;

163 
	`as£¹
(
»g_idx
 < 
numPhysiÿlFlßtRegs
);

165 
	`DPRINTF
(
IEW
, "RegFile: Setting float„egister %io %#x\n",

166 (
»g_idx
), (
ušt64_t
)
v®
);

168 
æßtRegFe
[
»g_idx
].
q
 = 
v®
;

169 
	}
}

171 
	gpublic
:

173 
IÁReg
 *
štRegFe
;

176 
PhysFlßtReg
 *
	gæßtRegFe
;

178 
	g´iv©e
:

179 
šŒæag
;

181 
	g´iv©e
:

183 
O3CPU
 *
ıu
;

185 
	gpublic
:

187 
numPhysiÿlIÁRegs
;

189 
	gnumPhysiÿlFlßtRegs
;

192 
	g‹m¶©e
 <
şass
 
	gIm¶
>

193 
	gPhysRegFe
<
	gIm¶
>::
	$PhysRegFe
(
O3CPU
 *
_ıu
, 
_numPhysiÿlIÁRegs
,

194 
_numPhysiÿlFlßtRegs
)

195 : 
	`ıu
(
_ıu
), 
	`numPhysiÿlIÁRegs
(
_numPhysiÿlIÁRegs
),

196 
	$numPhysiÿlFlßtRegs
(
_numPhysiÿlFlßtRegs
)

198 
štRegFe
 = 
Ãw
 
IÁReg
[
numPhysiÿlIÁRegs
];

199 
æßtRegFe
 = 
Ãw
 
PhysFlßtReg
[
numPhysiÿlFlßtRegs
];

201 
	`mem£t
(
štRegFe
, 0, (
IÁReg
è* 
numPhysiÿlIÁRegs
);

202 
	`mem£t
(
æßtRegFe
, 0, (
PhysFlßtReg
è* 
numPhysiÿlFlßtRegs
);

203 
	}
}

205 
	g‹m¶©e
 <
şass
 
	gIm¶
>

206 
	gPhysRegFe
<
	gIm¶
>::~
	$PhysRegFe
()

208 
d–‘e
 
štRegFe
;

209 
d–‘e
 
æßtRegFe
;

210 
	}
}

	@rename.cc

31 
	~"ıu/o3/i§_¥ecific.hh
"

32 
	~"ıu/o3/»Çme_im¶.hh
"

34 
‹m¶©e
 
şass
 
	gDeçuÉR’ame
<
	gO3CPUIm¶
>;

	@rename.hh

43 #iâdeà
__CPU_O3_RENAME_HH__


44 
	#__CPU_O3_RENAME_HH__


	)

46 
	~<li¡
>

48 
	~"ba£/¡©i¡ics.hh
"

49 
	~"cÚfig/the_i§.hh
"

50 
	~"ıu/timebuf.hh
"

52 
	gD”ivO3CPUP¬ams
;

66 
	g‹m¶©e
<
şass
 
	gIm¶
>

67 şas 
	cDeçuÉR’ame


69 
	mpublic
:

71 
ty³Çme
 
	tIm¶
::
	tCPUPŞ
 CPUPol;

72 
ty³Çme
 
	tIm¶
::
	tDynIn¡PŒ
 DynInstPtr;

73 
ty³Çme
 
	tIm¶
::
	tO3CPU
 O3CPU;

76 
ty³Çme
 
	tCPUPŞ
::
	tDecodeSŒuù
 DecodeStruct;

77 
ty³Çme
 
	tCPUPŞ
::
	tR’ameSŒuù
 RenameStruct;

78 
ty³Çme
 
	tCPUPŞ
::
	tTimeSŒuù
 TimeStruct;

79 
ty³Çme
 
	tCPUPŞ
::
	tF»eLi¡
 FreeList;

80 
ty³Çme
 
	tCPUPŞ
::
	tR’ameM­
 RenameMap;

82 
ty³Çme
 
	tCPUPŞ
::
	tIEW
 IEW;

83 
ty³Çme
 
	tCPUPŞ
::
	tComm™
 Commit;

86 
	mTheISA
::
	tRegIndex
 RegIndex;

92 
	m¡d
::
	tli¡
<
	tDynIn¡PŒ
> 
	tIn¡Queue
;

93 
ty³Çme
 
	t¡d
::
	tli¡
<
	tDynIn¡PŒ
>::
	t™”©Ü
 
	tLi¡It
;

95 
	mpublic
:

99 
	eR’ameStus
 {

100 
Aùive
,

101 
	mIÇùive


105 
	eTh»adStus
 {

106 
	gRuÂšg
,

107 
	gIdË
,

108 
	gS¹Squash
,

109 
	gSquashšg
,

110 
	gBlocked
,

111 
	gUnblockšg
,

112 
	gS”ŸlizeSÎ


115 
	g´iv©e
:

117 
R’ameStus
 
_¡©us
;

120 
Th»adStus
 
	g»ÇmeStus
[
Im¶
::
MaxTh»ads
];

122 
	gpublic
:

124 
DeçuÉR’ame
(
O3CPU
 *
_ıu
, 
D”ivO3CPUP¬ams
 *
·¿ms
);

127 
	g¡d
::
¡ršg
 
	$Çme
() const;

130 
	`»gSts
();

133 
	`£tTimeBufãr
(
TimeBufãr
<
TimeSŒuù
> *
tb_±r
);

136 
	`£tR’ameQueue
(
TimeBufãr
<
R’ameSŒuù
> *
rq_±r
);

139 
	`£tDecodeQueue
(
TimeBufãr
<
DecodeSŒuù
> *
dq_±r
);

142 
	$£tIEWSge
(
IEW
 *
›w_¡age
)

143 { 
›w_±r
 = 
›w_¡age
; 
	}
}

146 
	$£tComm™Sge
(
Comm™
 *
comm™_¡age
)

147 { 
comm™_±r
 = 
comm™_¡age
; 
	}
}

149 
	g´iv©e
:

151 
IEW
 *
›w_±r
;

154 
Comm™
 *
	gcomm™_±r
;

156 
	gpublic
:

158 
¡¬tupSge
();

161 
£tAùiveTh»ads
(
¡d
::
li¡
<
Th»adID
> *
©_±r
);

164 
£tR’ameM­
(
R’ameM­
 
rm_±r
[
Im¶
::
MaxTh»ads
]);

167 
£tF»eLi¡
(
F»eLi¡
 *
æ_±r
);

170 
£tScÜebßrd
(
ScÜebßrd
 *
_scÜebßrd
);

173 
	$d¿šSª™yCheck
() const;

176 
boŞ
 
	$isD¿šed
() const;

179 
	`keOv”From
();

182 
	`squash
(cÚ¡ 
In¡SeqNum
 &
squash_£q_num
, 
Th»adID
 
tid
);

187 
	`tick
();

190 
	`dumpHi¡Üy
();

192 
´iv©e
:

194 
	`»£tSge
();

201 
	`»Çme
(
boŞ
 &
¡©us_chªge
, 
Th»adID
 
tid
);

206 
	`»ÇmeIn¡s
(
Th»adID
 
tid
);

211 
	`skidIn£¹
(
Th»adID
 
tid
);

216 
	`sÜtIn¡s
();

219 
boŞ
 
	`skidsEm±y
();

222 
	`upd©eStus
();

228 
boŞ
 
	`block
(
Th»adID
 
tid
);

234 
boŞ
 
	`unblock
(
Th»adID
 
tid
);

237 
	`doSquash
(cÚ¡ 
In¡SeqNum
 &
squash_£q_num
, 
Th»adID
 
tid
);

240 
	`»moveFromHi¡Üy
(
In¡SeqNum
 
š¡_£q_num
, 
Th»adID
 
tid
);

243 
šlše
 
	`»ÇmeSrcRegs
(
DynIn¡PŒ
 &
š¡
, 
Th»adID
 
tid
);

246 
šlše
 
	`»ÇmeDe¡Regs
(
DynIn¡PŒ
 &
š¡
, 
Th»adID
 
tid
);

249 
šlše
 
	`ÿlcF»eROBEÁr›s
(
Th»adID
 
tid
);

252 
šlše
 
	`ÿlcF»eIQEÁr›s
(
Th»adID
 
tid
);

255 
šlše
 
	`ÿlcF»eLSQEÁr›s
(
Th»adID
 
tid
);

258 
	`v®idIn¡s
();

261 
	`»adSÎSigÇls
(
Th»adID
 
tid
);

264 
boŞ
 
	`checkSÎ
(
Th»adID
 
tid
);

267 
	`»adF»eEÁr›s
(
Th»adID
 
tid
);

270 
boŞ
 
	`checkSigÇlsAndUpd©e
(
Th»adID
 
tid
);

279 
	`£rŸlizeAá”
(
In¡Queue
 &
š¡_li¡
, 
Th»adID
 
tid
);

285 
	sR’ameHi¡Üy
 {

286 
	`R’ameHi¡Üy
(
In¡SeqNum
 
_š¡SeqNum
, 
RegIndex
 
_¬chReg
,

287 
PhysRegIndex
 
_ÃwPhysReg
, PhysRegIndex 
_´evPhysReg
)

288 : 
	`š¡SeqNum
(
_š¡SeqNum
), 
	`¬chReg
(
_¬chReg
),

289 
	`ÃwPhysReg
(
_ÃwPhysReg
), 
	`´evPhysReg
(
_´evPhysReg
)

294 
In¡SeqNum
 
š¡SeqNum
;

296 
RegIndex
 
¬chReg
;

298 
PhysRegIndex
 
ÃwPhysReg
;

300 
PhysRegIndex
 
´evPhysReg
;

301 
	}
};

306 
	g¡d
::
li¡
<
R’ameHi¡Üy
> 
hi¡ÜyBufãr
[
Im¶
::
MaxTh»ads
];

309 
O3CPU
 *
	gıu
;

312 
	gTimeBufãr
<
	gTimeSŒuù
> *
	gtimeBufãr
;

315 
ty³Çme
 
	gTimeBufãr
<
	gTimeSŒuù
>::
wœe
 
äomIEW
;

318 
ty³Çme
 
	gTimeBufãr
<
	gTimeSŒuù
>::
wœe
 
äomComm™
;

321 
ty³Çme
 
	gTimeBufãr
<
	gTimeSŒuù
>::
wœe
 
toDecode
;

324 
	gTimeBufãr
<
	gR’ameSŒuù
> *
	g»ÇmeQueue
;

327 
ty³Çme
 
	gTimeBufãr
<
	gR’ameSŒuù
>::
wœe
 
toIEW
;

330 
	gTimeBufãr
<
	gDecodeSŒuù
> *
	gdecodeQueue
;

333 
ty³Çme
 
	gTimeBufãr
<
	gDecodeSŒuù
>::
wœe
 
äomDecode
;

336 
In¡Queue
 
	gš¡s
[
Im¶
::
MaxTh»ads
];

339 
In¡Queue
 
	gskidBufãr
[
Im¶
::
MaxTh»ads
];

342 
R’ameM­
 *
	g»ÇmeM­
[
Im¶
::
MaxTh»ads
];

345 
F»eLi¡
 *
	gä“Li¡
;

348 
	g¡d
::
li¡
<
Th»adID
> *
aùiveTh»ads
;

351 
ScÜebßrd
 *
	gscÜebßrd
;

356 
	gš¡sInProg»ss
[
Im¶
::
MaxTh»ads
];

361 
boŞ
 
	gwrÙeToTimeBufãr
;

366 
	sF»eEÁr›s
 {

367 
	giqEÁr›s
;

368 
	glsqEÁr›s
;

369 
	grobEÁr›s
;

375 
F»eEÁr›s
 
	gä“EÁr›s
[
Im¶
::
MaxTh»ads
];

381 
boŞ
 
	gem±yROB
[
Im¶
::
MaxTh»ads
];

384 
	sSÎs
 {

385 
boŞ
 
	g›w
;

386 
boŞ
 
	gcomm™
;

390 
SÎs
 
	g¡®ls
[
Im¶
::
MaxTh»ads
];

393 
DynIn¡PŒ
 
	g£rŸlizeIn¡
[
Im¶
::
MaxTh»ads
];

398 
boŞ
 
	g£rŸlizeOnNextIn¡
[
Im¶
::
MaxTh»ads
];

401 
	g›wToR’ameD–ay
;

404 
	gdecodeToR’ameD–ay
;

407 
	gcomm™ToR’ameD–ay
;

410 
	g»ÇmeWidth
;

415 
	gcomm™Width
;

420 
	gtoIEWIndex
;

423 
boŞ
 
	gblockThisCyşe
;

427 
boŞ
 
	g»sumeS”Ÿlize
;

431 
boŞ
 
	g»sumeUnblockšg
;

434 
Th»adID
 
	gnumTh»ads
;

437 
	gskidBufãrMax
;

439 
PhysRegIndex
 
	gmaxPhysiÿlRegs
;

444 
	eFuÎSourû
 {

445 
	gROB
,

446 
	gIQ
,

447 
	gLSQ
,

448 
	gNONE


454 
šlše
 
šüFuÎSt
(cÚ¡ 
FuÎSourû
 &
sourû
);

457 
	gSts
::
SÿÏr
 
»ÇmeSquashCyşes
;

459 
	gSts
::
SÿÏr
 
»ÇmeIdËCyşes
;

461 
	gSts
::
SÿÏr
 
»ÇmeBlockCyşes
;

463 
	gSts
::
SÿÏr
 
»ÇmeS”ŸlizeSÎCyşes
;

465 
	gSts
::
SÿÏr
 
»ÇmeRunCyşes
;

467 
	gSts
::
SÿÏr
 
»ÇmeUnblockCyşes
;

469 
	gSts
::
SÿÏr
 
»ÇmeR’amedIn¡s
;

471 
	gSts
::
SÿÏr
 
»ÇmeSquashedIn¡s
;

473 
	gSts
::
SÿÏr
 
»ÇmeROBFuÎEv’ts
;

475 
	gSts
::
SÿÏr
 
»ÇmeIQFuÎEv’ts
;

477 
	gSts
::
SÿÏr
 
»ÇmeLSQFuÎEv’ts
;

480 
	gSts
::
SÿÏr
 
»ÇmeFuÎRegi¡”sEv’ts
;

482 
	gSts
::
SÿÏr
 
»ÇmeR’amedO³¿nds
;

484 
	gSts
::
SÿÏr
 
»ÇmeR’ameLookups
;

485 
	gSts
::
SÿÏr
 
štR’ameLookups
;

486 
	gSts
::
SÿÏr
 
åR’ameLookups
;

488 
	gSts
::
SÿÏr
 
»ÇmeComm™‹dM­s
;

490 
	gSts
::
SÿÏr
 
»ÇmeUndÚeM­s
;

492 
	gSts
::
SÿÏr
 
»ÇmedS”Ÿlizšg
;

494 
	gSts
::
SÿÏr
 
»ÇmedTempS”Ÿlizšg
;

496 
	gSts
::
SÿÏr
 
»ÇmeSkidIn¡s
;

	@rename_impl.hh

44 
	~<li¡
>

46 
	~"¬ch/i§_Œa™s.hh
"

47 
	~"¬ch/»gi¡”s.hh
"

48 
	~"cÚfig/the_i§.hh
"

49 
	~"ıu/o3/»Çme.hh
"

50 
	~"debug/Aùiv™y.hh
"

51 
	~"debug/R’ame.hh
"

52 
	~"·¿ms/D”ivO3CPU.hh
"

54 
usšg
 
Çme¥aû
 
	g¡d
;

56 
	g‹m¶©e
 <
şass
 
	gIm¶
>

57 
	gDeçuÉR’ame
<
	gIm¶
>::
	$DeçuÉR’ame
(
O3CPU
 *
_ıu
, 
D”ivO3CPUP¬ams
 *
·¿ms
)

58 : 
	`ıu
(
_ıu
),

59 
	`›wToR’ameD–ay
(
·¿ms
->
›wToR’ameD–ay
),

60 
	`decodeToR’ameD–ay
(
·¿ms
->
decodeToR’ameD–ay
),

61 
	`comm™ToR’ameD–ay
(
·¿ms
->
comm™ToR’ameD–ay
),

62 
	`»ÇmeWidth
(
·¿ms
->
»ÇmeWidth
),

63 
	`comm™Width
(
·¿ms
->
comm™Width
),

64 
	`numTh»ads
(
·¿ms
->
numTh»ads
),

65 
	`maxPhysiÿlRegs
(
·¿ms
->
numPhysIÁRegs
 +…¬ams->
numPhysFlßtRegs
)

68 
skidBufãrMax
 = (2 * (
decodeToR’ameD–ay
 * 
·¿ms
->
decodeWidth
)è+ 
»ÇmeWidth
;

69 
	}
}

71 
	g‹m¶©e
 <
şass
 
	gIm¶
>

72 
	g¡d
::
¡ršg


73 
DeçuÉR’ame
<
Im¶
>::
	$Çme
() const

75  
ıu
->
	`Çme
() + ".rename";

76 
	}
}

78 
	g‹m¶©e
 <
şass
 
	gIm¶
>

80 
	gDeçuÉR’ame
<
	gIm¶
>::
	$»gSts
()

82 
»ÇmeSquashCyşes


83 .
	`Çme
(name() + ".SquashCycles")

84 .
	`desc
("Number of cycles„ename is squashing")

85 .
	`´”eq
(
»ÇmeSquashCyşes
);

86 
»ÇmeIdËCyşes


87 .
	`Çme
(name() + ".IdleCycles")

88 .
	`desc
("Number of cycles„ename is idle")

89 .
	`´”eq
(
»ÇmeIdËCyşes
);

90 
»ÇmeBlockCyşes


91 .
	`Çme
(name() + ".BlockCycles")

92 .
	`desc
("Number of cycles„ename is blocking")

93 .
	`´”eq
(
»ÇmeBlockCyşes
);

94 
»ÇmeS”ŸlizeSÎCyşes


95 .
	`Çme
(name() + ".serializeStallCycles")

96 .
	`desc
("count of cycles„ename stalled for serializing inst")

97 .
	`æags
(
Sts
::
tÙ®
);

98 
»ÇmeRunCyşes


99 .
	`Çme
(name() + ".RunCycles")

100 .
	`desc
("Number of cycles„ename is„unning")

101 .
	`´”eq
(
»ÇmeIdËCyşes
);

102 
»ÇmeUnblockCyşes


103 .
	`Çme
(name() + ".UnblockCycles")

104 .
	`desc
("Number of cycles„ename is unblocking")

105 .
	`´”eq
(
»ÇmeUnblockCyşes
);

106 
»ÇmeR’amedIn¡s


107 .
	`Çme
(name() + ".RenamedInsts")

108 .
	`desc
("Number of instructions…rocessed by„ename")

109 .
	`´”eq
(
»ÇmeR’amedIn¡s
);

110 
»ÇmeSquashedIn¡s


111 .
	`Çme
(name() + ".SquashedInsts")

112 .
	`desc
("Number of squashed instructions…rocessed by„ename")

113 .
	`´”eq
(
»ÇmeSquashedIn¡s
);

114 
»ÇmeROBFuÎEv’ts


115 .
	`Çme
(name() + ".ROBFullEvents")

116 .
	`desc
("Number ofimes„ename has blocked dueo ROB full")

117 .
	`´”eq
(
»ÇmeROBFuÎEv’ts
);

118 
»ÇmeIQFuÎEv’ts


119 .
	`Çme
(name() + ".IQFullEvents")

120 .
	`desc
("Number ofimes„ename has blocked dueo IQ full")

121 .
	`´”eq
(
»ÇmeIQFuÎEv’ts
);

122 
»ÇmeLSQFuÎEv’ts


123 .
	`Çme
(name() + ".LSQFullEvents")

124 .
	`desc
("Number ofimes„ename has blocked dueo LSQ full")

125 .
	`´”eq
(
»ÇmeLSQFuÎEv’ts
);

126 
»ÇmeFuÎRegi¡”sEv’ts


127 .
	`Çme
(name() + ".FullRegisterEvents")

128 .
	`desc
("Number ofimeshere has been‚o free„egisters")

129 .
	`´”eq
(
»ÇmeFuÎRegi¡”sEv’ts
);

130 
»ÇmeR’amedO³¿nds


131 .
	`Çme
(name() + ".RenamedOperands")

132 .
	`desc
("Number of destination operands„ename has„enamed")

133 .
	`´”eq
(
»ÇmeR’amedO³¿nds
);

134 
»ÇmeR’ameLookups


135 .
	`Çme
(name() + ".RenameLookups")

136 .
	`desc
("Number of„egister„ename†ookupshat„ename has made")

137 .
	`´”eq
(
»ÇmeR’ameLookups
);

138 
»ÇmeComm™‹dM­s


139 .
	`Çme
(name() + ".CommittedMaps")

140 .
	`desc
("Number of HB mapshat‡re committed")

141 .
	`´”eq
(
»ÇmeComm™‹dM­s
);

142 
»ÇmeUndÚeM­s


143 .
	`Çme
(name() + ".UndoneMaps")

144 .
	`desc
("Number of HB mapshat‡re undone dueo squashing")

145 .
	`´”eq
(
»ÇmeUndÚeM­s
);

146 
»ÇmedS”Ÿlizšg


147 .
	`Çme
(name() + ".serializingInsts")

148 .
	`desc
("count of serializing insts„enamed")

149 .
	`æags
(
Sts
::
tÙ®
)

151 
»ÇmedTempS”Ÿlizšg


152 .
	`Çme
(name() + ".tempSerializingInsts")

153 .
	`desc
("count ofemporary serializing insts„enamed")

154 .
	`æags
(
Sts
::
tÙ®
)

156 
»ÇmeSkidIn¡s


157 .
	`Çme
(name() + ".skidInsts")

158 .
	`desc
("count of insts‡ddedohe skid buffer")

159 .
	`æags
(
Sts
::
tÙ®
)

161 
štR’ameLookups


162 .
	`Çme
(name() + ".int_rename_lookups")

163 .
	`desc
("Number of integer„ename†ookups")

164 .
	`´”eq
(
štR’ameLookups
);

165 
åR’ameLookups


166 .
	`Çme
(name() + ".fp_rename_lookups")

167 .
	`desc
("Number of floating„ename†ookups")

168 .
	`´”eq
(
åR’ameLookups
);

169 
	}
}

171 
	g‹m¶©e
 <
şass
 
	gIm¶
>

173 
	gDeçuÉR’ame
<
	gIm¶
>::
£tTimeBufãr
(
TimeBufãr
<
TimeSŒuù
> *
tb_±r
)

175 
timeBufãr
 = 
tb_±r
;

178 
	gäomIEW
 = 
timeBufãr
->
g‘Wœe
(-
›wToR’ameD–ay
);

181 
	gäomComm™
 = 
timeBufãr
->
g‘Wœe
(-
comm™ToR’ameD–ay
);

184 
	gtoDecode
 = 
timeBufãr
->
g‘Wœe
(0);

187 
	g‹m¶©e
 <
şass
 
	gIm¶
>

189 
	gDeçuÉR’ame
<
	gIm¶
>::
£tR’ameQueue
(
TimeBufãr
<
R’ameSŒuù
> *
rq_±r
)

191 
»ÇmeQueue
 = 
rq_±r
;

194 
	gtoIEW
 = 
»ÇmeQueue
->
g‘Wœe
(0);

197 
	g‹m¶©e
 <
şass
 
	gIm¶
>

199 
	gDeçuÉR’ame
<
	gIm¶
>::
£tDecodeQueue
(
TimeBufãr
<
DecodeSŒuù
> *
dq_±r
)

201 
decodeQueue
 = 
dq_±r
;

204 
	gäomDecode
 = 
decodeQueue
->
g‘Wœe
(-
decodeToR’ameD–ay
);

207 
	g‹m¶©e
 <
şass
 
	gIm¶
>

209 
	gDeçuÉR’ame
<
	gIm¶
>::
	$¡¬tupSge
()

211 
	`»£tSge
();

212 
	}
}

214 
	g‹m¶©e
 <
şass
 
	gIm¶
>

216 
	gDeçuÉR’ame
<
	gIm¶
>::
	$»£tSge
()

218 
_¡©us
 = 
IÇùive
;

220 
»sumeS”Ÿlize
 = 
çl£
;

221 
»sumeUnblockšg
 = 
çl£
;

224 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

225 
»ÇmeStus
[
tid
] = 
IdË
;

227 
ä“EÁr›s
[
tid
].
iqEÁr›s
 = 
›w_±r
->
š¡Queue
.
	`numF»eEÁr›s
(tid);

228 
ä“EÁr›s
[
tid
].
lsqEÁr›s
 = 
›w_±r
->
ld¡Queue
.
	`numF»eEÁr›s
(tid);

229 
ä“EÁr›s
[
tid
].
robEÁr›s
 = 
comm™_±r
->
	`numROBF»eEÁr›s
(tid);

230 
em±yROB
[
tid
] = 
Œue
;

232 
¡®ls
[
tid
].
›w
 = 
çl£
;

233 
¡®ls
[
tid
].
comm™
 = 
çl£
;

234 
£rŸlizeIn¡
[
tid
] = 
NULL
;

236 
š¡sInProg»ss
[
tid
] = 0;

238 
£rŸlizeOnNextIn¡
[
tid
] = 
çl£
;

240 
	}
}

242 
	g‹m¶©e
<
şass
 
	gIm¶
>

244 
	gDeçuÉR’ame
<
	gIm¶
>::
£tAùiveTh»ads
(
li¡
<
Th»adID
> *
©_±r
)

246 
aùiveTh»ads
 = 
©_±r
;

250 
	g‹m¶©e
 <
şass
 
	gIm¶
>

252 
	gDeçuÉR’ame
<
	gIm¶
>::
	$£tR’ameM­
(
R’ameM­
 
rm_±r
[])

254 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++)

255 
»ÇmeM­
[
tid
] = &
rm_±r
[tid];

256 
	}
}

258 
	g‹m¶©e
 <
şass
 
	gIm¶
>

260 
	gDeçuÉR’ame
<
	gIm¶
>::
	$£tF»eLi¡
(
F»eLi¡
 *
æ_±r
)

262 
ä“Li¡
 = 
æ_±r
;

263 
	}
}

265 
	g‹m¶©e
<
şass
 
	gIm¶
>

267 
	gDeçuÉR’ame
<
	gIm¶
>::
	$£tScÜebßrd
(
ScÜebßrd
 *
_scÜebßrd
)

269 
scÜebßrd
 = 
_scÜebßrd
;

270 
	}
}

272 
	g‹m¶©e
 <
şass
 
	gIm¶
>

273 
boŞ


274 
	gDeçuÉR’ame
<
	gIm¶
>::
	$isD¿šed
() const

276 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

277 ià(
š¡sInProg»ss
[
tid
] != 0 ||

278 !
hi¡ÜyBufãr
[
tid
].
	`em±y
() ||

279 !
skidBufãr
[
tid
].
	`em±y
() ||

280 !
š¡s
[
tid
].
	`em±y
())

281  
çl£
;

283  
Œue
;

284 
	}
}

286 
	g‹m¶©e
 <
şass
 
	gIm¶
>

288 
	gDeçuÉR’ame
<
	gIm¶
>::
	$keOv”From
()

290 
	`»£tSge
();

291 
	}
}

293 
	g‹m¶©e
 <
şass
 
	gIm¶
>

295 
	gDeçuÉR’ame
<
	gIm¶
>::
	$d¿šSª™yCheck
() const

297 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

298 
	`as£¹
(
hi¡ÜyBufãr
[
tid
].
	`em±y
());

299 
	`as£¹
(
š¡s
[
tid
].
	`em±y
());

300 
	`as£¹
(
skidBufãr
[
tid
].
	`em±y
());

301 
	`as£¹
(
š¡sInProg»ss
[
tid
] == 0);

303 
	}
}

305 
	g‹m¶©e
 <
şass
 
	gIm¶
>

307 
	gDeçuÉR’ame
<
	gIm¶
>::
	$squash
(cÚ¡ 
In¡SeqNum
 &
squash_£q_num
, 
Th»adID
 
tid
)

309 
	`DPRINTF
(
R’ame
, "[tid:%u]: Squashšg in¡ruùiÚs.\n",
tid
);

314 ià(
»ÇmeStus
[
tid
] =ğ
Blocked
 ||

315 
»ÇmeStus
[
tid
] =ğ
Unblockšg
) {

316 
toDecode
->
»ÇmeUnblock
[
tid
] = 1;

318 
»sumeS”Ÿlize
 = 
çl£
;

319 
£rŸlizeIn¡
[
tid
] = 
NULL
;

320 } ià(
»ÇmeStus
[
tid
] =ğ
S”ŸlizeSÎ
) {

321 ià(
£rŸlizeIn¡
[
tid
]->
£qNum
 <ğ
squash_£q_num
) {

322 
	`DPRINTF
(
R’ame
, "Rename will„esume serializing‡fter squash\n");

323 
»sumeS”Ÿlize
 = 
Œue
;

324 
	`as£¹
(
£rŸlizeIn¡
[
tid
]);

326 
»sumeS”Ÿlize
 = 
çl£
;

327 
toDecode
->
»ÇmeUnblock
[
tid
] = 1;

329 
£rŸlizeIn¡
[
tid
] = 
NULL
;

334 
»ÇmeStus
[
tid
] = 
Squashšg
;

337 
squashCouÁ
 = 0;

339 
i
=0; i<
äomDecode
->
size
; i++) {

340 ià(
äomDecode
->
š¡s
[
i
]->
th»adNumb”
 =ğ
tid
 &&

341 
äomDecode
->
š¡s
[
i
]->
£qNum
 > 
squash_£q_num
) {

342 
äomDecode
->
š¡s
[
i
]->
	`£tSquashed
();

343 
wrÙeToTimeBufãr
 = 
Œue
;

344 
squashCouÁ
++;

351 
š¡s
[
tid
].
	`ş—r
();

354 
skidBufãr
[
tid
].
	`ş—r
();

356 
	`doSquash
(
squash_£q_num
, 
tid
);

357 
	}
}

359 
	g‹m¶©e
 <
şass
 
	gIm¶
>

361 
	gDeçuÉR’ame
<
	gIm¶
>::
	$tick
()

363 
wrÙeToTimeBufãr
 = 
çl£
;

365 
blockThisCyşe
 = 
çl£
;

367 
boŞ
 
¡©us_chªge
 = 
çl£
;

369 
toIEWIndex
 = 0;

371 
	`sÜtIn¡s
();

373 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

374 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

377 
th»ads
 !ğ
’d
) {

378 
Th»adID
 
tid
 = *
th»ads
++;

380 
	`DPRINTF
(
R’ame
, "Proûssšg [tid:%i]\n", 
tid
);

382 
¡©us_chªge
 = 
	`checkSigÇlsAndUpd©e
(
tid
) || status_change;

384 
	`»Çme
(
¡©us_chªge
, 
tid
);

387 ià(
¡©us_chªge
) {

388 
	`upd©eStus
();

391 ià(
wrÙeToTimeBufãr
) {

392 
	`DPRINTF
(
Aùiv™y
, "Activityhis cycle.\n");

393 
ıu
->
	`aùiv™yThisCyşe
();

396 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

398 
th»ads
 !ğ
’d
) {

399 
Th»adID
 
tid
 = *
th»ads
++;

402 ià(
äomComm™
->
comm™Info
[
tid
].
dÚeSeqNum
 != 0 &&

403 !
äomComm™
->
comm™Info
[
tid
].
squash
 &&

404 
»ÇmeStus
[
tid
] !ğ
Squashšg
) {

406 
	`»moveFromHi¡Üy
(
äomComm™
->
comm™Info
[
tid
].
dÚeSeqNum
,

407 
tid
);

412 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

413 
š¡sInProg»ss
[
tid
] -ğ
äomIEW
->
›wInfo
[tid].
di¥©ched
;

415 
	`as£¹
(
š¡sInProg»ss
[
tid
] >=0);

418 
	}
}

420 
	g‹m¶©e
<
şass
 
	gIm¶
>

422 
	gDeçuÉR’ame
<
	gIm¶
>::
	$»Çme
(
boŞ
 &
¡©us_chªge
, 
Th»adID
 
tid
)

431 ià(
»ÇmeStus
[
tid
] =ğ
Blocked
) {

432 ++
»ÇmeBlockCyşes
;

433 } ià(
»ÇmeStus
[
tid
] =ğ
Squashšg
) {

434 ++
»ÇmeSquashCyşes
;

435 } ià(
»ÇmeStus
[
tid
] =ğ
S”ŸlizeSÎ
) {

436 ++
»ÇmeS”ŸlizeSÎCyşes
;

440 ià(
»sumeS”Ÿlize
) {

441 
»sumeS”Ÿlize
 = 
çl£
;

442 
	`block
(
tid
);

443 
toDecode
->
»ÇmeUnblock
[
tid
] = 
çl£
;

445 } ià(
»ÇmeStus
[
tid
] =ğ
Unblockšg
) {

446 ià(
»sumeUnblockšg
) {

447 
	`block
(
tid
);

448 
»sumeUnblockšg
 = 
çl£
;

449 
toDecode
->
»ÇmeUnblock
[
tid
] = 
çl£
;

453 ià(
»ÇmeStus
[
tid
] =ğ
RuÂšg
 ||

454 
»ÇmeStus
[
tid
] =ğ
IdË
) {

455 
	`DPRINTF
(
R’ame
, "[tid:%u]: Not blocked, so‡ttemptingo„un "

456 "¡age.\n", 
tid
);

458 
	`»ÇmeIn¡s
(
tid
);

459 } ià(
»ÇmeStus
[
tid
] =ğ
Unblockšg
) {

460 
	`»ÇmeIn¡s
(
tid
);

462 ià(
	`v®idIn¡s
()) {

465 
	`skidIn£¹
(
tid
);

470 
¡©us_chªge
 = 
	`unblock
(
tid
è|| stus_chªg|| 
blockThisCyşe
;

472 
	}
}

474 
	g‹m¶©e
 <
şass
 
	gIm¶
>

476 
	gDeçuÉR’ame
<
	gIm¶
>::
	$»ÇmeIn¡s
(
Th»adID
 
tid
)

480 
š¡s_avaabË
 = 
»ÇmeStus
[
tid
] =ğ
Unblockšg
 ?

481 
skidBufãr
[
tid
].
	`size
(è: 
š¡s
[tid].size();

485 ià(
š¡s_avaabË
 == 0) {

486 
	`DPRINTF
(
R’ame
, "[tid:%u]: Nothingo do, breaking outƒarly.\n",

487 
tid
);

489 ++
»ÇmeIdËCyşes
;

491 } ià(
»ÇmeStus
[
tid
] =ğ
Unblockšg
) {

492 ++
»ÇmeUnblockCyşes
;

493 } ià(
»ÇmeStus
[
tid
] =ğ
RuÂšg
) {

494 ++
»ÇmeRunCyşes
;

497 
DynIn¡PŒ
 
š¡
;

501 
ä“_rob_’Œ›s
 = 
	`ÿlcF»eROBEÁr›s
(
tid
);

502 
ä“_iq_’Œ›s
 = 
	`ÿlcF»eIQEÁr›s
(
tid
);

503 
ä“_lsq_’Œ›s
 = 
	`ÿlcF»eLSQEÁr›s
(
tid
);

504 
mš_ä“_’Œ›s
 = 
ä“_rob_’Œ›s
;

506 
FuÎSourû
 
sourû
 = 
ROB
;

508 ià(
ä“_iq_’Œ›s
 < 
mš_ä“_’Œ›s
) {

509 
mš_ä“_’Œ›s
 = 
ä“_iq_’Œ›s
;

510 
sourû
 = 
IQ
;

513 ià(
ä“_lsq_’Œ›s
 < 
mš_ä“_’Œ›s
) {

514 
mš_ä“_’Œ›s
 = 
ä“_lsq_’Œ›s
;

515 
sourû
 = 
LSQ
;

519 ià(
mš_ä“_’Œ›s
 <= 0) {

520 
	`DPRINTF
(
R’ame
, "[tid:%u]: Blocking dueo‚o free ROB/IQ/LSQ "

525 
tid
,

526 
ä“_rob_’Œ›s
,

527 
ä“_iq_’Œ›s
,

528 
ä“_lsq_’Œ›s
);

530 
blockThisCyşe
 = 
Œue
;

532 
	`block
(
tid
);

534 
	`šüFuÎSt
(
sourû
);

537 } ià(
mš_ä“_’Œ›s
 < 
š¡s_avaabË
) {

538 
	`DPRINTF
(
R’ame
, "[tid:%u]: Will haveo blockhis cycle."

541 
tid
, 
š¡s_avaabË
, 
mš_ä“_’Œ›s
);

543 
š¡s_avaabË
 = 
mš_ä“_’Œ›s
;

545 
blockThisCyşe
 = 
Œue
;

547 
	`šüFuÎSt
(
sourû
);

550 
In¡Queue
 &
š¡s_to_»Çme
 = 
»ÇmeStus
[
tid
] =ğ
Unblockšg
 ?

551 
skidBufãr
[
tid
] : 
š¡s
[tid];

553 
	`DPRINTF
(
R’ame
, "[tid:%u]: %i‡vailable instructionso "

554 "£nd iew.\n", 
tid
, 
š¡s_avaabË
);

556 
	`DPRINTF
(
R’ame
, "[tid:%u]: %i insts…ipelining from Rename | %i insts "

558 
tid
, 
š¡sInProg»ss
[tid], 
äomIEW
->
›wInfo
[tid].
di¥©ched
);

561 ià(
£rŸlizeOnNextIn¡
[
tid
]) {

562 ià(
em±yROB
[
tid
] && 
š¡sInProg»ss
[tid] == 0) {

564 
£rŸlizeOnNextIn¡
[
tid
] = 
çl£
;

565 } ià(!
š¡s_to_»Çme
.
	`em±y
()) {

566 
š¡s_to_»Çme
.
	`äÚt
()->
	`£tS”ŸlizeBefÜe
();

570 
»Çmed_š¡s
 = 0;

572 
š¡s_avaabË
 > 0 && 
toIEWIndex
 < 
»ÇmeWidth
) {

573 
	`DPRINTF
(
R’ame
, "[tid:%u]: S’dšg in¡ruùiÚ tØIEW.\n", 
tid
);

575 
	`as£¹
(!
š¡s_to_»Çme
.
	`em±y
());

577 
š¡
 = 
š¡s_to_»Çme
.
	`äÚt
();

579 
š¡s_to_»Çme
.
	`pİ_äÚt
();

581 ià(
»ÇmeStus
[
tid
] =ğ
Unblockšg
) {

582 
	`DPRINTF
(
R’ame
,"[tid:%u]: Removing [sn:%lli] PC:%s from„ename "

583 "skidBufãr\n", 
tid
, 
š¡
->
£qNum
, in¡->
	`pcS‹
());

586 ià(
š¡
->
	`isSquashed
()) {

587 
	`DPRINTF
(
R’ame
, "[tid:%u]: instruction %i with PC %s is "

588 "squashed, skpšg.\n", 
tid
, 
š¡
->
£qNum
,

589 
š¡
->
	`pcS‹
());

591 ++
»ÇmeSquashedIn¡s
;

594 --
š¡s_avaabË
;

599 
	`DPRINTF
(
R’ame
, "[tid:%u]: Processing instruction [sn:%lli] with "

600 "PC %s.\n", 
tid
, 
š¡
->
£qNum
, in¡->
	`pcS‹
());

612 ià((
š¡
->
	`isI´Acûss
(è|| in¡->
	`isS”ŸlizeBefÜe
()) &&

613 !
š¡
->
	`isS”ŸlizeHªdËd
()) {

614 
	`DPRINTF
(
R’ame
, "Serialize before instructionƒncountered.\n");

616 ià(!
š¡
->
	`isTempS”ŸlizeBefÜe
()) {

617 
»ÇmedS”Ÿlizšg
++;

618 
š¡
->
	`£tS”ŸlizeHªdËd
();

620 
»ÇmedTempS”Ÿlizšg
++;

625 
»ÇmeStus
[
tid
] = 
S”ŸlizeSÎ
;

627 
£rŸlizeIn¡
[
tid
] = 
š¡
;

629 
blockThisCyşe
 = 
Œue
;

632 } ià((
š¡
->
	`isStÜeCÚd™iÚ®
(è|| in¡->
	`isS”ŸlizeAá”
()) &&

633 !
š¡
->
	`isS”ŸlizeHªdËd
()) {

634 
	`DPRINTF
(
R’ame
, "Serialize‡fter instructionƒncountered.\n");

636 
»ÇmedS”Ÿlizšg
++;

638 
š¡
->
	`£tS”ŸlizeHªdËd
();

640 
	`£rŸlizeAá”
(
š¡s_to_»Çme
, 
tid
);

645 ià(
»ÇmeM­
[
tid
]->
	`numF»eEÁr›s
(è< 
š¡
->
	`numDe¡Regs
()) {

646 
	`DPRINTF
(
R’ame
, "Blocking dueo†ack of free "

648 
blockThisCyşe
 = 
Œue
;

649 
š¡s_to_»Çme
.
	`push_äÚt
(
š¡
);

650 ++
»ÇmeFuÎRegi¡”sEv’ts
;

655 
	`»ÇmeSrcRegs
(
š¡
, in¡->
th»adNumb”
);

657 
	`»ÇmeDe¡Regs
(
š¡
, in¡->
th»adNumb”
);

659 ++
»Çmed_š¡s
;

661 #ià
TRACING_ON


662 
š¡
->
»ÇmeTick
 = 
	`curTick
(è- in¡->
ãtchTick
;

666 
toIEW
->
š¡s
[
toIEWIndex
] = 
š¡
;

667 ++(
toIEW
->
size
);

670 ++
toIEWIndex
;

673 --
š¡s_avaabË
;

676 
š¡sInProg»ss
[
tid
] +ğ
»Çmed_š¡s
;

677 
»ÇmeR’amedIn¡s
 +ğ
»Çmed_š¡s
;

680 ià(
toIEWIndex
) {

681 
wrÙeToTimeBufãr
 = 
Œue
;

686 ià(
š¡s_avaabË
) {

687 
blockThisCyşe
 = 
Œue
;

690 ià(
blockThisCyşe
) {

691 
	`block
(
tid
);

692 
toDecode
->
»ÇmeUnblock
[
tid
] = 
çl£
;

694 
	}
}

696 
	g‹m¶©e
<
şass
 
	gIm¶
>

698 
	gDeçuÉR’ame
<
	gIm¶
>::
	$skidIn£¹
(
Th»adID
 
tid
)

700 
DynIn¡PŒ
 
š¡
 = 
NULL
;

702 !
š¡s
[
tid
].
	`em±y
()) {

703 
š¡
 = 
š¡s
[
tid
].
	`äÚt
();

705 
š¡s
[
tid
].
	`pİ_äÚt
();

707 
	`as£¹
(
tid
 =ğ
š¡
->
th»adNumb”
);

709 
	`DPRINTF
(
R’ame
, "[tid:%u]: Inserting [sn:%lli] PC: %s into Rename "

710 "skidBufãr\n", 
tid
, 
š¡
->
£qNum
, in¡->
	`pcS‹
());

712 ++
»ÇmeSkidIn¡s
;

714 
skidBufãr
[
tid
].
	`push_back
(
š¡
);

717 ià(
skidBufãr
[
tid
].
	`size
(è> 
skidBufãrMax
)

719 
ty³Çme
 
In¡Queue
::
™”©Ü
 
™
;

720 
	`w¬n
("Skidbuffer contents:\n");

721 
™
 = 
skidBufãr
[
tid
].
	`begš
(); iˆ!ğskidBufãr[tid].
	`’d
(); it++)

723 
	`w¬n
("[tid:%u]: % [¢:%i].\n", 
tid
,

724 (*
™
)->
¡©icIn¡
->
	`di§s£mbË
(
š¡
->
	`š¡Addr
()),

725 (*
™
)->
£qNum
);

727 
	`·nic
("Skidbuffer Exceeded Max Size");

729 
	}
}

731 
	g‹m¶©e
 <
şass
 
	gIm¶
>

733 
	gDeçuÉR’ame
<
	gIm¶
>::
	$sÜtIn¡s
()

735 
š¡s_äom_decode
 = 
äomDecode
->
size
;

736 
i
 = 0; i < 
š¡s_äom_decode
; ++i) {

737 
DynIn¡PŒ
 
š¡
 = 
äomDecode
->
š¡s
[
i
];

738 
š¡s
[
š¡
->
th»adNumb”
].
	`push_back
(inst);

740 
	}
}

742 
	g‹m¶©e
<
şass
 
	gIm¶
>

743 
boŞ


744 
	gDeçuÉR’ame
<
	gIm¶
>::
	$skidsEm±y
()

746 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

747 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

749 
th»ads
 !ğ
’d
) {

750 
Th»adID
 
tid
 = *
th»ads
++;

752 ià(!
skidBufãr
[
tid
].
	`em±y
())

753  
çl£
;

756  
Œue
;

757 
	}
}

759 
	g‹m¶©e
<
şass
 
	gIm¶
>

761 
	gDeçuÉR’ame
<
	gIm¶
>::
	$upd©eStus
()

763 
boŞ
 
ªy_unblockšg
 = 
çl£
;

765 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

766 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

768 
th»ads
 !ğ
’d
) {

769 
Th»adID
 
tid
 = *
th»ads
++;

771 ià(
»ÇmeStus
[
tid
] =ğ
Unblockšg
) {

772 
ªy_unblockšg
 = 
Œue
;

778 ià(
ªy_unblockšg
) {

779 ià(
_¡©us
 =ğ
IÇùive
) {

780 
_¡©us
 = 
Aùive
;

782 
	`DPRINTF
(
Aùiv™y
, "Activating stage.\n");

784 
ıu
->
	`aùiv©eSge
(
O3CPU
::
R’ameIdx
);

789 ià(
_¡©us
 =ğ
Aùive
) {

790 
_¡©us
 = 
IÇùive
;

791 
	`DPRINTF
(
Aùiv™y
, "Deactivating stage.\n");

793 
ıu
->
	`d—ùiv©eSge
(
O3CPU
::
R’ameIdx
);

796 
	}
}

798 
	g‹m¶©e
 <
şass
 
	gIm¶
>

799 
boŞ


800 
	gDeçuÉR’ame
<
	gIm¶
>::
	$block
(
Th»adID
 
tid
)

802 
	`DPRINTF
(
R’ame
, "[tid:%u]: Blockšg.\n", 
tid
);

806 
	`skidIn£¹
(
tid
);

810 ià(
»ÇmeStus
[
tid
] !ğ
Blocked
) {

814 ià(
»sumeUnblockšg
 || 
»ÇmeStus
[
tid
] !ğ
Unblockšg
) {

815 
toDecode
->
»ÇmeBlock
[
tid
] = 
Œue
;

816 
toDecode
->
»ÇmeUnblock
[
tid
] = 
çl£
;

817 
wrÙeToTimeBufãr
 = 
Œue
;

822 ià(
»ÇmeStus
[
tid
] !ğ
S”ŸlizeSÎ
) {

824 
»ÇmeStus
[
tid
] = 
Blocked
;

825  
Œue
;

829  
çl£
;

830 
	}
}

832 
	g‹m¶©e
 <
şass
 
	gIm¶
>

833 
boŞ


834 
	gDeçuÉR’ame
<
	gIm¶
>::
	$unblock
(
Th»adID
 
tid
)

836 
	`DPRINTF
(
R’ame
, "[tid:%u]: TryšgØunblock.\n", 
tid
);

839 ià(
skidBufãr
[
tid
].
	`em±y
(è&& 
»ÇmeStus
[tid] !ğ
S”ŸlizeSÎ
) {

841 
	`DPRINTF
(
R’ame
, "[tid:%u]: DÚunblockšg.\n", 
tid
);

843 
toDecode
->
»ÇmeUnblock
[
tid
] = 
Œue
;

844 
wrÙeToTimeBufãr
 = 
Œue
;

846 
»ÇmeStus
[
tid
] = 
RuÂšg
;

847  
Œue
;

850  
çl£
;

851 
	}
}

853 
	g‹m¶©e
 <
şass
 
	gIm¶
>

855 
	gDeçuÉR’ame
<
	gIm¶
>::
	$doSquash
(cÚ¡ 
In¡SeqNum
 &
squashed_£q_num
, 
Th»adID
 
tid
)

857 
ty³Çme
 
¡d
::
li¡
<
R’ameHi¡Üy
>::
™”©Ü
 
hb_™
 =

858 
hi¡ÜyBufãr
[
tid
].
	`begš
();

862 ià(
hi¡ÜyBufãr
[
tid
].
	`em±y
()) {

868 !
hi¡ÜyBufãr
[
tid
].
	`em±y
() &&

869 (*
hb_™
).
š¡SeqNum
 > 
squashed_£q_num
) {

870 
	`as£¹
(
hb_™
 !ğ
hi¡ÜyBufãr
[
tid
].
	`’d
());

872 
	`DPRINTF
(
R’ame
, "[tid:%u]: Removing historyƒntry with sequence "

873 "numb” %i.\n", 
tid
, (*
hb_™
).
š¡SeqNum
);

877 
»ÇmeM­
[
tid
]->
	`£tEÁry
(
hb_™
->
¬chReg
, hb_™->
´evPhysReg
);

880 
ä“Li¡
->
	`addReg
(
hb_™
->
ÃwPhysReg
);

883 ià(
hb_™
->
ÃwPhysReg
 >ğ
maxPhysiÿlRegs
) {

884 
scÜebßrd
->
	`£tReg
(
hb_™
->
ÃwPhysReg
);

887 
hi¡ÜyBufãr
[
tid
].
	`”a£
(
hb_™
++);

889 ++
»ÇmeUndÚeM­s
;

891 
	}
}

893 
	g‹m¶©e
<
şass
 
	gIm¶
>

895 
	gDeçuÉR’ame
<
	gIm¶
>::
	$»moveFromHi¡Üy
(
In¡SeqNum
 
š¡_£q_num
, 
Th»adID
 
tid
)

897 
	`DPRINTF
(
R’ame
, "[tid:%u]: Removing‡ committed instruction fromhe "

899 
tid
,id, 
hi¡ÜyBufãr
[tid].
	`size
(), 
š¡_£q_num
);

901 
ty³Çme
 
¡d
::
li¡
<
R’ameHi¡Üy
>::
™”©Ü
 
hb_™
 =

902 
hi¡ÜyBufãr
[
tid
].
	`’d
();

904 --
hb_™
;

906 ià(
hi¡ÜyBufãr
[
tid
].
	`em±y
()) {

907 
	`DPRINTF
(
R’ame
, "[tid:%u]: Hi¡Üy bufã¸i em±y.\n", 
tid
);

909 } ià(
hb_™
->
š¡SeqNum
 > 
š¡_£q_num
) {

910 
	`DPRINTF
(
R’ame
, "[tid:%u]: Old sequence‚umberƒncountered. Ensure "

911 "th©‡ sysÿÎ h­³Ãd„eûÁly.\n", 
tid
);

919 !
hi¡ÜyBufãr
[
tid
].
	`em±y
() &&

920 
hb_™
 !ğ
hi¡ÜyBufãr
[
tid
].
	`’d
() &&

921 (*
hb_™
).
š¡SeqNum
 <ğ
š¡_£q_num
) {

923 
	`DPRINTF
(
R’ame
, "[tid:%u]: Freeing up older„ename of„eg %i, "

925 
tid
, (*
hb_™
).
´evPhysReg
, (*hb_™).
š¡SeqNum
);

927 
ä“Li¡
->
	`addReg
((*
hb_™
).
´evPhysReg
);

928 ++
»ÇmeComm™‹dM­s
;

930 
hi¡ÜyBufãr
[
tid
].
	`”a£
(
hb_™
--);

932 
	}
}

934 
	g‹m¶©e
 <
şass
 
	gIm¶
>

935 
šlše
 

936 
	gDeçuÉR’ame
<
	gIm¶
>::
	$»ÇmeSrcRegs
(
DynIn¡PŒ
 &
š¡
, 
Th»adID
 
tid
)

938 
	`as£¹
(
»ÇmeM­
[
tid
] != 0);

940 
num_¤c_»gs
 = 
š¡
->
	`numSrcRegs
();

945 
¤c_idx
 = 0; src_idx < 
num_¤c_»gs
; src_idx++) {

946 
RegIndex
 
¤c_»g
 = 
š¡
->
	`¤cRegIdx
(
¤c_idx
);

947 
RegIndex
 
æ©_¤c_»g
 = 
¤c_»g
;

948 ià(
¤c_»g
 < 
TheISA
::
FP_Ba£_D•Tag
) {

949 
æ©_¤c_»g
 = 
š¡
->
	`tcBa£
()->
	`æ©‹nIÁIndex
(
¤c_»g
);

950 
	`DPRINTF
(
R’ame
, "Flattening index %do %d.\n",

951 ()
¤c_»g
, ()
æ©_¤c_»g
);

952 } ià(
¤c_»g
 < 
TheISA
::
CŒl_Ba£_D•Tag
) {

953 
¤c_»g
 = src_»g - 
TheISA
::
FP_Ba£_D•Tag
;

954 
æ©_¤c_»g
 = 
š¡
->
	`tcBa£
()->
	`æ©‹nFlßtIndex
(
¤c_»g
);

955 
	`DPRINTF
(
R’ame
, "Flattening index %do %d.\n",

956 ()
¤c_»g
, ()
æ©_¤c_»g
);

957 
æ©_¤c_»g
 +ğ
TheISA
::
NumIÁRegs
;

958 } ià(
¤c_»g
 < 
TheISA
::
Max_D•Tag
) {

959 
æ©_¤c_»g
 = 
¤c_»g
 - 
TheISA
::
CŒl_Ba£_D•Tag
 +

960 
TheISA
::
NumFlßtRegs
 + TheISA::
NumIÁRegs
;

961 
	`DPRINTF
(
R’ame
, "Adjusting„eg index from %do %d.\n",

962 
¤c_»g
, 
æ©_¤c_»g
);

964 
	`·nic
("Reg index i ouˆoàbound: %d.", 
¤c_»g
);

969 
PhysRegIndex
 
»Çmed_»g
 = 
»ÇmeM­
[
tid
]->
	`lookup
(
æ©_¤c_»g
);

971 
	`DPRINTF
(
R’ame
, "[tid:%u]: Looking up‡rch„eg %i, got "

972 "physiÿÈ»g %i.\n", 
tid
, ()
æ©_¤c_»g
,

973 ()
»Çmed_»g
);

975 
š¡
->
	`»ÇmeSrcReg
(
¤c_idx
, 
»Çmed_»g
);

978 ià(
scÜebßrd
->
	`g‘Reg
(
»Çmed_»g
è=ğ
Œue
) {

979 
	`DPRINTF
(
R’ame
, "[tid:%u]: Register %d is„eady.\n",

980 
tid
, 
»Çmed_»g
);

982 
š¡
->
	`m¬kSrcRegR—dy
(
¤c_idx
);

984 
	`DPRINTF
(
R’ame
, "[tid:%u]: Register %d is‚ot„eady.\n",

985 
tid
, 
»Çmed_»g
);

988 ++
»ÇmeR’ameLookups
;

989 
š¡
->
	`isFlßtšg
(è? 
åR’ameLookups
++ : 
štR’ameLookups
++;

991 
	}
}

993 
	g‹m¶©e
 <
şass
 
	gIm¶
>

994 
šlše
 

995 
	gDeçuÉR’ame
<
	gIm¶
>::
	$»ÇmeDe¡Regs
(
DynIn¡PŒ
 &
š¡
, 
Th»adID
 
tid
)

997 
ty³Çme
 
R’ameM­
::
R’ameInfo
 
»Çme_»suÉ
;

999 
num_de¡_»gs
 = 
š¡
->
	`numDe¡Regs
();

1002 
de¡_idx
 = 0; de¡_idx < 
num_de¡_»gs
; dest_idx++) {

1003 
RegIndex
 
de¡_»g
 = 
š¡
->
	`de¡RegIdx
(
de¡_idx
);

1004 
RegIndex
 
æ©_de¡_»g
 = 
de¡_»g
;

1005 ià(
de¡_»g
 < 
TheISA
::
FP_Ba£_D•Tag
) {

1007 
æ©_de¡_»g
 = 
š¡
->
	`tcBa£
()->
	`æ©‹nIÁIndex
(
de¡_»g
);

1008 
	`DPRINTF
(
R’ame
, "Flattening index %do %d.\n",

1009 ()
de¡_»g
, ()
æ©_de¡_»g
);

1010 } ià(
de¡_»g
 < 
TheISA
::
CŒl_Ba£_D•Tag
) {

1011 
de¡_»g
 = de¡_»g - 
TheISA
::
FP_Ba£_D•Tag
;

1012 
æ©_de¡_»g
 = 
š¡
->
	`tcBa£
()->
	`æ©‹nFlßtIndex
(
de¡_»g
);

1013 
	`DPRINTF
(
R’ame
, "Flattening index %do %d.\n",

1014 ()
de¡_»g
, ()
æ©_de¡_»g
);

1015 
æ©_de¡_»g
 +ğ
TheISA
::
NumIÁRegs
;

1016 } ià(
de¡_»g
 < 
TheISA
::
Max_D•Tag
) {

1019 
æ©_de¡_»g
 = 
de¡_»g
 - 
TheISA
::
CŒl_Ba£_D•Tag
 +

1020 
TheISA
::
NumIÁRegs
 + TheISA::
NumFlßtRegs
;

1021 
	`DPRINTF
(
R’ame
, "Adjusting„eg index from %do %d.\n",

1022 
de¡_»g
, 
æ©_de¡_»g
);

1024 
	`·nic
("Reg index i ouˆoàbound: %d.", 
de¡_»g
);

1027 
š¡
->
	`æ©‹nDe¡Reg
(
de¡_idx
, 
æ©_de¡_»g
);

1031 
»Çme_»suÉ
 = 
»ÇmeM­
[
tid
]->
	`»Çme
(
æ©_de¡_»g
);

1034 ià(
de¡_»g
 < 
TheISA
::
CŒl_Ba£_D•Tag
)

1035 
scÜebßrd
->
	`un£tReg
(
»Çme_»suÉ
.
fœ¡
);

1037 
	`DPRINTF
(
R’ame
, "[tid:%u]: Renaming‡rch„eg %io…hysical "

1038 "»g %i.\n", 
tid
, ()
æ©_de¡_»g
,

1039 ()
»Çme_»suÉ
.
fœ¡
);

1042 
R’ameHi¡Üy
 
	`hb_’Œy
(
š¡
->
£qNum
, 
æ©_de¡_»g
,

1043 
»Çme_»suÉ
.
fœ¡
,

1044 
»Çme_»suÉ
.
£cÚd
);

1046 
hi¡ÜyBufãr
[
tid
].
	`push_äÚt
(
hb_’Œy
);

1048 
	`DPRINTF
(
R’ame
, "[tid:%u]: Adding instructiono history buffer "

1049 "(size=%i), [¢:%Îi].\n",
tid
,

1050 
hi¡ÜyBufãr
[
tid
].
	`size
(),

1051 (*
hi¡ÜyBufãr
[
tid
].
	`begš
()).
š¡SeqNum
);

1058 
š¡
->
	`»ÇmeDe¡Reg
(
de¡_idx
,

1059 
»Çme_»suÉ
.
fœ¡
,

1060 
»Çme_»suÉ
.
£cÚd
);

1062 ++
»ÇmeR’amedO³¿nds
;

1064 
	}
}

1066 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1067 
šlše
 

1068 
	gDeçuÉR’ame
<
	gIm¶
>::
	$ÿlcF»eROBEÁr›s
(
Th»adID
 
tid
)

1070 
num_ä“
 = 
ä“EÁr›s
[
tid
].
robEÁr›s
 -

1071 (
š¡sInProg»ss
[
tid
] - 
äomIEW
->
›wInfo
[tid].
di¥©ched
);

1075  
num_ä“
;

1076 
	}
}

1078 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1079 
šlše
 

1080 
	gDeçuÉR’ame
<
	gIm¶
>::
	$ÿlcF»eIQEÁr›s
(
Th»adID
 
tid
)

1082 
num_ä“
 = 
ä“EÁr›s
[
tid
].
iqEÁr›s
 -

1083 (
š¡sInProg»ss
[
tid
] - 
äomIEW
->
›wInfo
[tid].
di¥©ched
);

1087  
num_ä“
;

1088 
	}
}

1090 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1091 
šlše
 

1092 
	gDeçuÉR’ame
<
	gIm¶
>::
	$ÿlcF»eLSQEÁr›s
(
Th»adID
 
tid
)

1094 
num_ä“
 = 
ä“EÁr›s
[
tid
].
lsqEÁr›s
 -

1095 (
š¡sInProg»ss
[
tid
] - 
äomIEW
->
›wInfo
[tid].
di¥©chedToLSQ
);

1099  
num_ä“
;

1100 
	}
}

1102 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1104 
	gDeçuÉR’ame
<
	gIm¶
>::
	$v®idIn¡s
()

1106 
š¡_couÁ
 = 0;

1108 
i
=0; i<
äomDecode
->
size
; i++) {

1109 ià(!
äomDecode
->
š¡s
[
i
]->
	`isSquashed
())

1110 
š¡_couÁ
++;

1113  
š¡_couÁ
;

1114 
	}
}

1116 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1118 
	gDeçuÉR’ame
<
	gIm¶
>::
	$»adSÎSigÇls
(
Th»adID
 
tid
)

1120 ià(
äomIEW
->
›wBlock
[
tid
]) {

1121 
¡®ls
[
tid
].
›w
 = 
Œue
;

1124 ià(
äomIEW
->
›wUnblock
[
tid
]) {

1125 
	`as£¹
(
¡®ls
[
tid
].
›w
);

1126 
¡®ls
[
tid
].
›w
 = 
çl£
;

1129 ià(
äomComm™
->
comm™Block
[
tid
]) {

1130 
¡®ls
[
tid
].
comm™
 = 
Œue
;

1133 ià(
äomComm™
->
comm™Unblock
[
tid
]) {

1134 
	`as£¹
(
¡®ls
[
tid
].
comm™
);

1135 
¡®ls
[
tid
].
comm™
 = 
çl£
;

1137 
	}
}

1139 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1140 
boŞ


1141 
	gDeçuÉR’ame
<
	gIm¶
>::
	$checkSÎ
(
Th»adID
 
tid
)

1143 
boŞ
 
»t_v®
 = 
çl£
;

1145 ià(
¡®ls
[
tid
].
›w
) {

1146 
	`DPRINTF
(
R’ame
,"[tid:%i]: SÎ from IEW sgd‘eùed.\n", 
tid
);

1147 
»t_v®
 = 
Œue
;

1148 } ià(
¡®ls
[
tid
].
comm™
) {

1149 
	`DPRINTF
(
R’ame
,"[tid:%i]: SÎ from Comm™ sgd‘eùed.\n", 
tid
);

1150 
»t_v®
 = 
Œue
;

1151 } ià(
	`ÿlcF»eROBEÁr›s
(
tid
) <= 0) {

1152 
	`DPRINTF
(
R’ame
,"[tid:%i]: SÎ: ROB ha 0 f»’Œ›s.\n", 
tid
);

1153 
»t_v®
 = 
Œue
;

1154 } ià(
	`ÿlcF»eIQEÁr›s
(
tid
) <= 0) {

1155 
	`DPRINTF
(
R’ame
,"[tid:%i]: SÎ: IQ ha 0 f»’Œ›s.\n", 
tid
);

1156 
»t_v®
 = 
Œue
;

1157 } ià(
	`ÿlcF»eLSQEÁr›s
(
tid
) <= 0) {

1158 
	`DPRINTF
(
R’ame
,"[tid:%i]: SÎ: LSQ ha 0 f»’Œ›s.\n", 
tid
);

1159 
»t_v®
 = 
Œue
;

1160 } ià(
»ÇmeM­
[
tid
]->
	`numF»eEÁr›s
() <= 0) {

1161 
	`DPRINTF
(
R’ame
,"[tid:%i]: SÎ: R’ameM­ ha 0 f»’Œ›s.\n", 
tid
);

1162 
»t_v®
 = 
Œue
;

1163 } ià(
»ÇmeStus
[
tid
] =ğ
S”ŸlizeSÎ
 &&

1164 (!
em±yROB
[
tid
] || 
š¡sInProg»ss
[tid])) {

1165 
	`DPRINTF
(
R’ame
,"[tid:%i]: Stall: Serialize stall‡nd ROB is‚ot "

1167 
tid
);

1168 
»t_v®
 = 
Œue
;

1171  
»t_v®
;

1172 
	}
}

1174 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1176 
	gDeçuÉR’ame
<
	gIm¶
>::
	$»adF»eEÁr›s
(
Th»adID
 
tid
)

1178 ià(
äomIEW
->
›wInfo
[
tid
].
u£dIQ
)

1179 
ä“EÁr›s
[
tid
].
iqEÁr›s
 = 
äomIEW
->
›wInfo
[tid].
ä“IQEÁr›s
;

1181 ià(
äomIEW
->
›wInfo
[
tid
].
u£dLSQ
)

1182 
ä“EÁr›s
[
tid
].
lsqEÁr›s
 = 
äomIEW
->
›wInfo
[tid].
ä“LSQEÁr›s
;

1184 ià(
äomComm™
->
comm™Info
[
tid
].
u£dROB
) {

1185 
ä“EÁr›s
[
tid
].
robEÁr›s
 =

1186 
äomComm™
->
comm™Info
[
tid
].
ä“ROBEÁr›s
;

1187 
em±yROB
[
tid
] = 
äomComm™
->
comm™Info
[tid].emptyROB;

1190 
	`DPRINTF
(
R’ame
, "[tid:%i]: Free IQ: %i, Free ROB: %i, Free LSQ: %i\n",

1191 
tid
,

1192 
ä“EÁr›s
[
tid
].
iqEÁr›s
,

1193 
ä“EÁr›s
[
tid
].
robEÁr›s
,

1194 
ä“EÁr›s
[
tid
].
lsqEÁr›s
);

1196 
	`DPRINTF
(
R’ame
, "[tid:%i]: %i instructions‚ot yet in ROB\n",

1197 
tid
, 
š¡sInProg»ss
[tid]);

1198 
	}
}

1200 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1201 
boŞ


1202 
	gDeçuÉR’ame
<
	gIm¶
>::
	$checkSigÇlsAndUpd©e
(
Th»adID
 
tid
)

1214 
	`»adF»eEÁr›s
(
tid
);

1215 
	`»adSÎSigÇls
(
tid
);

1217 ià(
äomComm™
->
comm™Info
[
tid
].
squash
) {

1218 
	`DPRINTF
(
R’ame
, "[tid:%u]: Squashing instructions dueo squash from "

1219 "comm™.\n", 
tid
);

1221 
	`squash
(
äomComm™
->
comm™Info
[
tid
].
dÚeSeqNum
,id);

1223  
Œue
;

1226 ià(
äomComm™
->
comm™Info
[
tid
].
robSquashšg
) {

1227 
	`DPRINTF
(
R’ame
, "[tid:%u]: ROB i ¡Èsquashšg.\n", 
tid
);

1229 
»ÇmeStus
[
tid
] = 
Squashšg
;

1231  
Œue
;

1234 ià(
	`checkSÎ
(
tid
)) {

1235  
	`block
(
tid
);

1238 ià(
»ÇmeStus
[
tid
] =ğ
Blocked
) {

1239 
	`DPRINTF
(
R’ame
, "[tid:%u]: Done blocking, switchingo unblocking.\n",

1240 
tid
);

1242 
»ÇmeStus
[
tid
] = 
Unblockšg
;

1244 
	`unblock
(
tid
);

1246  
Œue
;

1249 ià(
»ÇmeStus
[
tid
] =ğ
Squashšg
) {

1252 ià(
»sumeS”Ÿlize
) {

1253 
	`DPRINTF
(
R’ame
, "[tid:%u]: Done squashing, switchingo serialize.\n",

1254 
tid
);

1256 
»ÇmeStus
[
tid
] = 
S”ŸlizeSÎ
;

1257  
Œue
;

1258 } ià(
»sumeUnblockšg
) {

1259 
	`DPRINTF
(
R’ame
, "[tid:%u]: Done squashing, switchingo unblocking.\n",

1260 
tid
);

1261 
»ÇmeStus
[
tid
] = 
Unblockšg
;

1262  
Œue
;

1264 
	`DPRINTF
(
R’ame
, "[tid:%u]: Done squashing, switchingo„unning.\n",

1265 
tid
);

1267 
»ÇmeStus
[
tid
] = 
RuÂšg
;

1268  
çl£
;

1272 ià(
»ÇmeStus
[
tid
] =ğ
S”ŸlizeSÎ
) {

1274 
	`DPRINTF
(
R’ame
, "[tid:%u]: Done with serialize stall, switchingo "

1275 "unblockšg.\n", 
tid
);

1277 
DynIn¡PŒ
 
£rŸl_š¡
 = 
£rŸlizeIn¡
[
tid
];

1279 
»ÇmeStus
[
tid
] = 
Unblockšg
;

1281 
	`unblock
(
tid
);

1283 
	`DPRINTF
(
R’ame
, "[tid:%u]: Processing instruction [%lli] with "

1284 "PC %s.\n", 
tid
, 
£rŸl_š¡
->
£qNum
, s”Ÿl_š¡->
	`pcS‹
());

1287 
£rŸl_š¡
->
	`ş—rS”ŸlizeBefÜe
();

1289 ià(!
skidBufãr
[
tid
].
	`em±y
()) {

1290 
skidBufãr
[
tid
].
	`push_äÚt
(
£rŸl_š¡
);

1292 
š¡s
[
tid
].
	`push_äÚt
(
£rŸl_š¡
);

1295 
	`DPRINTF
(
R’ame
, "[tid:%u]: Instruction must be…rocessed by„ename."

1296 " AddšgØäÚˆoàli¡.\n", 
tid
);

1298 
£rŸlizeIn¡
[
tid
] = 
NULL
;

1300  
Œue
;

1305  
çl£
;

1306 
	}
}

1308 
	g‹m¶©e
<
şass
 
	gIm¶
>

1310 
	gDeçuÉR’ame
<
	gIm¶
>::
	$£rŸlizeAá”
(
In¡Queue
 &
š¡_li¡
, 
Th»adID
 
tid
)

1312 ià(
š¡_li¡
.
	`em±y
()) {

1314 
£rŸlizeOnNextIn¡
[
tid
] = 
Œue
;

1319 
š¡_li¡
.
	`äÚt
()->
	`£tS”ŸlizeBefÜe
();

1320 
	}
}

1322 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1323 
šlše
 

1324 
	gDeçuÉR’ame
<
	gIm¶
>::
	$šüFuÎSt
(cÚ¡ 
FuÎSourû
 &
sourû
)

1326 
sourû
) {

1327 
ROB
:

1328 ++
»ÇmeROBFuÎEv’ts
;

1330 
IQ
:

1331 ++
»ÇmeIQFuÎEv’ts
;

1333 
LSQ
:

1334 ++
»ÇmeLSQFuÎEv’ts
;

1337 
	`·nic
("Rename full stall stat should be incremented for‡„eason!");

1340 
	}
}

1342 
	g‹m¶©e
 <
şass
 
	gIm¶
>

1344 
	gDeçuÉR’ame
<
	gIm¶
>::
	$dumpHi¡Üy
()

1346 
ty³Çme
 
¡d
::
li¡
<
R’ameHi¡Üy
>::
™”©Ü
 
buf_™
;

1348 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

1350 
buf_™
 = 
hi¡ÜyBufãr
[
tid
].
	`begš
();

1352 
buf_™
 !ğ
hi¡ÜyBufãr
[
tid
].
	`’d
()) {

1353 
	`ırštf
("Seq‚um: %i\nArch„eg: %i New…hys„eg: %i Old…hys "

1354 "»g: %i\n", (*
buf_™
).
š¡SeqNum
, ()(*buf_™).
¬chReg
,

1355 ()(*
buf_™
).
ÃwPhysReg
, ()(*buf_™).
´evPhysReg
);

1357 
buf_™
++;

1360 
	}
}

	@rename_map.cc

31 
	~<veùÜ
>

33 
	~"ıu/o3/»Çme_m­.hh
"

34 
	~"debug/R’ame.hh
"

36 
usšg
 
Çme¥aû
 
	g¡d
;

42 
	gSim¶eR’ameM­
::~
	$Sim¶eR’ameM­
()

44 
	}
}

47 
Sim¶eR’ameM­
::
	$š™
(
_numLogiÿlIÁRegs
,

48 
_numPhysiÿlIÁRegs
,

49 
PhysRegIndex
 &
œeg_idx
,

51 
_numLogiÿlFlßtRegs
,

52 
_numPhysiÿlFlßtRegs
,

53 
PhysRegIndex
 &
äeg_idx
,

55 
_numMiscRegs
,

57 
RegIndex
 
_štZ”oReg
,

58 
RegIndex
 
_æßtZ”oReg
,

60 
m­_id
,

61 
boŞ
 
bšdRegs
)

63 
id
 = 
m­_id
;

65 
numLogiÿlIÁRegs
 = 
_numLogiÿlIÁRegs
;

67 
numLogiÿlFlßtRegs
 = 
_numLogiÿlFlßtRegs
;

69 
numPhysiÿlIÁRegs
 = 
_numPhysiÿlIÁRegs
;

71 
numPhysiÿlFlßtRegs
 = 
_numPhysiÿlFlßtRegs
;

73 
numMiscRegs
 = 
_numMiscRegs
;

75 
štZ”oReg
 = 
_štZ”oReg
;

76 
æßtZ”oReg
 = 
_æßtZ”oReg
;

78 
	`DPRINTF
(
R’ame
, "Creating„ename map %i. Phys: %i / %i, Float: "

79 "%˜/ %i.\n", 
id
, 
numLogiÿlIÁRegs
, 
numPhysiÿlIÁRegs
,

80 
numLogiÿlFlßtRegs
, 
numPhysiÿlFlßtRegs
);

82 
numLogiÿlRegs
 = 
numLogiÿlIÁRegs
 + 
numLogiÿlFlßtRegs
;

84 
numPhysiÿlRegs
 = 
numPhysiÿlIÁRegs
 + 
numPhysiÿlFlßtRegs
;

87 
štR’ameM­
.
	`»size
(
numLogiÿlIÁRegs
);

88 
æßtR’ameM­
.
	`»size
(
numLogiÿlRegs
);

90 ià(
bšdRegs
) {

91 
	`DPRINTF
(
R’ame
, "Bšdšg„egi¡” štØ»Çmm­ %i\n",
id
);

95 
RegIndex
 
šdex
 = 0; index < 
numLogiÿlIÁRegs
; ++index)

97 
štR’ameM­
[
šdex
].
physiÿl_»g
 = 
œeg_idx
++;

105 
PhysRegIndex
 
šdex
 = 
numLogiÿlIÁRegs
;

106 
šdex
 < 
numLogiÿlRegs
; ++index)

108 
æßtR’ameM­
[
šdex
].
physiÿl_»g
 = 
äeg_idx
++;

111 
	`DPRINTF
(
R’ame
, "Bšdšg„egi¡” štØ»Çmm­ %i\n",
id
);

113 
PhysRegIndex
 
‹mp_œeg
 = 
œeg_idx
;

115 
RegIndex
 
šdex
 = 0; index < 
numLogiÿlIÁRegs
; ++index)

117 
štR’ameM­
[
šdex
].
physiÿl_»g
 = 
‹mp_œeg
++;

120 
PhysRegIndex
 
‹mp_äeg
 = 
äeg_idx
;

122 
PhysRegIndex
 
šdex
 = 
numLogiÿlIÁRegs
;

123 
šdex
 < 
numLogiÿlRegs
; ++index)

125 
æßtR’ameM­
[
šdex
].
physiÿl_»g
 = 
‹mp_äeg
++;

128 
	}
}

131 
	gSim¶eR’ameM­
::
	$£tF»eLi¡
(
Sim¶eF»eLi¡
 *
æ_±r
)

133 
ä“Li¡
 = 
æ_±r
;

134 
	}
}

137 
	gSim¶eR’ameM­
::
R’ameInfo


138 
Sim¶eR’ameM­
::
	$»Çme
(
RegIndex
 
¬ch_»g
)

140 
PhysRegIndex
 
»Çmed_»g
;

141 
PhysRegIndex
 
´ev_»g
;

143 ià(
¬ch_»g
 < 
numLogiÿlIÁRegs
) {

147 
´ev_»g
 = 
štR’ameM­
[
¬ch_»g
].
physiÿl_»g
;

151 ià(
¬ch_»g
 !ğ
štZ”oReg
) {

152 
»Çmed_»g
 = 
ä“Li¡
->
	`g‘IÁReg
();

154 
štR’ameM­
[
¬ch_»g
].
physiÿl_»g
 = 
»Çmed_»g
;

156 
	`as£¹
(
»Çmed_»g
 >ğ0 &&„’amed_»g < 
numPhysiÿlIÁRegs
);

160 
»Çmed_»g
 = 
štZ”oReg
;

161 
´ev_»g
 = 
štZ”oReg
;

163 } ià(
¬ch_»g
 < 
numLogiÿlRegs
) {

166 
´ev_»g
 = 
æßtR’ameM­
[
¬ch_»g
].
physiÿl_»g
;

170 #ià
THE_ISA
 =ğ
ALPHA_ISA


171 ià(
¬ch_»g
 !ğ
æßtZ”oReg
) {

173 
»Çmed_»g
 = 
ä“Li¡
->
	`g‘FlßtReg
();

175 
æßtR’ameM­
[
¬ch_»g
].
physiÿl_»g
 = 
»Çmed_»g
;

177 
	`as£¹
(
»Çmed_»g
 < 
numPhysiÿlRegs
 &&

178 
»Çmed_»g
 >ğ
numPhysiÿlIÁRegs
);

179 #ià
THE_ISA
 =ğ
ALPHA_ISA


182 
»Çmed_»g
 = 
æßtZ”oReg
;

187 
¬ch_»g
 =‡rch_»g - 
numLogiÿlRegs
;

189 
	`DPRINTF
(
R’ame
, "R’amed misø»g %d\n", 
¬ch_»g
);

195 
»Çmed_»g
 = 
¬ch_»g
 + 
numPhysiÿlRegs
;

200 
´ev_»g
 = 
»Çmed_»g
;

203 
	`DPRINTF
(
R’ame
, "Renamed„eg %do…hysical„eg %d old mapping was %d\n",

204 
¬ch_»g
, 
»Çmed_»g
, 
´ev_»g
);

206  
	`R’ameInfo
(
»Çmed_»g
, 
´ev_»g
);

207 
	}
}

209 
PhysRegIndex


210 
	gSim¶eR’ameM­
::
	$lookup
(
RegIndex
 
¬ch_»g
)

212 ià(
¬ch_»g
 < 
numLogiÿlIÁRegs
) {

213  
štR’ameM­
[
¬ch_»g
].
physiÿl_»g
;

214 } ià(
¬ch_»g
 < 
numLogiÿlRegs
) {

215  
æßtR’ameM­
[
¬ch_»g
].
physiÿl_»g
;

218 
¬ch_»g
 =‡rch_»g - 
numLogiÿlRegs
;

222  
numPhysiÿlRegs
 + 
¬ch_»g
;

224 
	}
}

227 
	gSim¶eR’ameM­
::
	$£tEÁry
(
RegIndex
 
¬ch_»g
, 
PhysRegIndex
 
»Çmed_»g
)

232 ià(
¬ch_»g
 < 
numLogiÿlIÁRegs
) {

233 
	`DPRINTF
(
R’ame
, "Rename Map: Integer„egister %i being seto %i.\n",

234 ()
¬ch_»g
, 
»Çmed_»g
);

236 
štR’ameM­
[
¬ch_»g
].
physiÿl_»g
 = 
»Çmed_»g
;

237 } ià(
¬ch_»g
 < 
numLogiÿlIÁRegs
 + 
numLogiÿlFlßtRegs
) {

238 
	`DPRINTF
(
R’ame
, "Rename Map: Float„egister %i being seto %i.\n",

239 ()
¬ch_»g
 - 
numLogiÿlIÁRegs
, 
»Çmed_»g
);

241 
æßtR’ameM­
[
¬ch_»g
].
physiÿl_»g
 = 
»Çmed_»g
;

243 
	}
}

246 
	gSim¶eR’ameM­
::
	$numF»eEÁr›s
()

248 
ä“_št_»gs
 = 
ä“Li¡
->
	`numF»eIÁRegs
();

249 
ä“_æßt_»gs
 = 
ä“Li¡
->
	`numF»eFlßtRegs
();

251 ià(
ä“_št_»gs
 < 
ä“_æßt_»gs
) {

252  
ä“_št_»gs
;

254  
ä“_æßt_»gs
;

256 
	}
}

	@rename_map.hh

35 #iâdeà
__CPU_O3_RENAME_MAP_HH__


36 
	#__CPU_O3_RENAME_MAP_HH__


	)

38 
	~<io¡»am
>

39 
	~<ut™y
>

40 
	~<veùÜ
>

42 
	~"¬ch/ty³s.hh
"

43 
	~"cÚfig/the_i§.hh
"

44 
	~"ıu/o3/ä“_li¡.hh
"

46 şas 
	cSim¶eR’ameM­


48 
	m´Ùeùed
:

49 
TheISA
::
	tRegIndex
 RegIndex;

50 
	mpublic
:

56 
¡d
::
	t·œ
<
	tRegIndex
, 
	tPhysRegIndex
> 
	tUnm­Info
;

64 
	m¡d
::
	t·œ
<
	tPhysRegIndex
, PhysRegIndex> 
	tR’ameInfo
;

66 
	mpublic
:

68 
	$Sim¶eR’ameM­
() {};

71 ~
	`Sim¶eR’ameM­
();

74 
	`š™
(
_numLogiÿlIÁRegs
,

75 
_numPhysiÿlIÁRegs
,

76 
PhysRegIndex
 &
_št_»g_¡¬t
,

78 
_numLogiÿlFlßtRegs
,

79 
_numPhysiÿlFlßtRegs
,

80 
PhysRegIndex
 &
_æßt_»g_¡¬t
,

82 
_numMiscRegs
,

84 
RegIndex
 
_štZ”oReg
,

85 
RegIndex
 
_æßtZ”oReg
,

87 
id
,

88 
boŞ
 
bšdRegs
);

91 
	`£tF»eLi¡
(
Sim¶eF»eLi¡
 *
æ_±r
);

97 
R’ameInfo
 
	`»Çme
(
RegIndex
 
¬ch_»g
);

99 
PhysRegIndex
 
	`lookup
(
RegIndex
 
phys_»g
);

106 
	`£tEÁry
(
RegIndex
 
¬ch_»g
, 
PhysRegIndex
 
»Çmed_»g
);

108 
	`numF»eEÁr›s
();

110 
´iv©e
:

112 
id
;

115 
numLogiÿlIÁRegs
;

118 
numPhysiÿlIÁRegs
;

121 
numLogiÿlFlßtRegs
;

124 
numPhysiÿlFlßtRegs
;

127 
numMiscRegs
;

130 
numLogiÿlRegs
;

133 
numPhysiÿlRegs
;

138 
RegIndex
 
štZ”oReg
;

143 
RegIndex
 
æßtZ”oReg
;

145 şas 
	cR’ameEÁry


147 
public
:

148 
PhysRegIndex
 
physiÿl_»g
;

149 
boŞ
 
v®id
;

151 
	`R’ameEÁry
()

152 : 
	`physiÿl_»g
(0), 
	`v®id
(
çl£
)

154 
	}
};

156 
	g´iv©e
:

158 
¡d
::
veùÜ
<
R’ameEÁry
> 
štR’ameM­
;

161 
	g¡d
::
veùÜ
<
R’ameEÁry
> 
æßtR’ameM­
;

163 
	g´iv©e
:

165 
Sim¶eF»eLi¡
 *
ä“Li¡
;

	@rob.cc

32 
	~"ıu/o3/i§_¥ecific.hh
"

33 
	~"ıu/o3/rob_im¶.hh
"

36 
‹m¶©e
 
şass
 
	gROB
<
	gO3CPUIm¶
>;

	@rob.hh

44 #iâdeà
__CPU_O3_ROB_HH__


45 
	#__CPU_O3_ROB_HH__


	)

47 
	~<¡ršg
>

48 
	~<ut™y
>

49 
	~<veùÜ
>

51 
	~"¬ch/»gi¡”s.hh
"

52 
	~"ba£/ty³s.hh
"

53 
	~"cÚfig/the_i§.hh
"

58 
	g‹m¶©e
 <
şass
 
	gIm¶
>

59 şas 
	cROB


61 
	m´Ùeùed
:

62 
TheISA
::
	tRegIndex
 RegIndex;

63 
	mpublic
:

65 
ty³Çme
 
	tIm¶
::
	tO3CPU
 O3CPU;

66 
ty³Çme
 
	tIm¶
::
	tDynIn¡PŒ
 DynInstPtr;

68 
	m¡d
::
	t·œ
<
	tRegIndex
, 
	tPhysRegIndex
> 
	tUnm­Info
;

69 
ty³Çme
 
	t¡d
::
	tli¡
<
	tDynIn¡PŒ
>::
	t™”©Ü
 
	tIn¡It
;

72 
	eStus
 {

73 
	mRuÂšg
,

74 
	mIdË
,

75 
	mROBSquashšg


79 
	eROBPŞicy
{

80 
	gDyÇmic
,

81 
	gP¬t™iÚed
,

82 
	gTh»shŞd


85 
	g´iv©e
:

87 
Stus
 
robStus
[
Im¶
::
MaxTh»ads
];

90 
ROBPŞicy
 
	grobPŞicy
;

92 
	gpublic
:

101 
ROB
(
O3CPU
 *
_ıu
, 
_numEÁr›s
, 
_squashWidth
,

102 
¡d
::
¡ršg
 
smtROBPŞicy
, 
_smtROBTh»shŞd
,

103 
Th»adID
 
_numTh»ads
);

105 
	g¡d
::
¡ršg
 
	$Çme
() const;

110 
	`£tAùiveTh»ads
(
¡d
::
li¡
<
Th»adID
> *
©_±r
);

113 
	$d¿šSª™yCheck
() const;

116 
	`keOv”From
();

123 
	`š£¹In¡
(
DynIn¡PŒ
 &
š¡
);

135 
DynIn¡PŒ
 
	`»adH—dIn¡
(
Th»adID
 
tid
);

140 
DynIn¡PŒ
 
	`fšdIn¡
(
Th»adID
 
tid
, 
In¡SeqNum
 
squash_š¡
);

152 
DynIn¡PŒ
 
	`»adTaIn¡
(
Th»adID
 
tid
);

160 
	`»tœeH—d
(
Th»adID
 
tid
);

166 
boŞ
 
	`isH—dR—dy
(
Th»adID
 
tid
);

169 
boŞ
 
	`ÿnComm™
();

172 
	`»£tEÁr›s
();

175 
	`’ŒyAmouÁ
(
Th»adID
 
num_th»ads
);

178 
	`numF»eEÁr›s
();

181 
	`numF»eEÁr›s
(
Th»adID
 
tid
);

184 
	$g‘MaxEÁr›s
(
Th»adID
 
tid
)

185 {  
maxEÁr›s
[
tid
]; 
	}
}

188 
	$g‘Th»adEÁr›s
(
Th»adID
 
tid
)

189 {  
th»adEÁr›s
[
tid
]; 
	}
}

192 
boŞ
 
	$isFuÎ
()

193 {  
numIn¡sInROB
 =ğ
numEÁr›s
; 
	}
}

196 
boŞ
 
	$isFuÎ
(
Th»adID
 
tid
)

197 {  
th»adEÁr›s
[
tid
] =ğ
numEÁr›s
; 
	}
}

200 
boŞ
 
	$isEm±y
() const

201 {  
numIn¡sInROB
 =ğ0; 
	}
}

204 
boŞ
 
	$isEm±y
(
Th»adID
 
tid
) const

205 {  
th»adEÁr›s
[
tid
] =ğ0; 
	}
}

208 
doSquash
(
Th»adID
 
tid
);

213 
squash
(
In¡SeqNum
 
squash_num
, 
Th»adID
 
tid
);

216 
upd©eH—d
();

219 
upd©eTa
();

255 
boŞ
 
	$isDÚeSquashšg
(
Th»adID
 
tid
) const

256 {  
dÚeSquashšg
[
tid
]; 
	}
}

261 
boŞ
 
isDÚeSquashšg
();

267 
couÁIn¡s
();

273 
couÁIn¡s
(
Th»adID
 
tid
);

276 
»gSts
();

278 
	g´iv©e
:

280 
»£tS‹
();

283 
O3CPU
 *
	gıu
;

286 
	g¡d
::
li¡
<
Th»adID
> *
aùiveTh»ads
;

289 
	gnumEÁr›s
;

292 
	gth»adEÁr›s
[
Im¶
::
MaxTh»ads
];

295 
	gmaxEÁr›s
[
Im¶
::
MaxTh»ads
];

298 
	g¡d
::
li¡
<
DynIn¡PŒ
> 
š¡Li¡
[
Im¶
::
MaxTh»ads
];

301 
	gsquashWidth
;

303 
	gpublic
:

308 
In¡It
 

;

312 
In¡It
 
	gh—d
;

314 
	g´iv©e
:

322 
In¡It
 
squashIt
[
Im¶
::
MaxTh»ads
];

324 
	gpublic
:

326 
numIn¡sInROB
;

329 
DynIn¡PŒ
 
	gdummyIn¡
;

331 
	g´iv©e
:

333 
In¡SeqNum
 
squashedSeqNum
[
Im¶
::
MaxTh»ads
];

336 
boŞ
 
	gdÚeSquashšg
[
Im¶
::
MaxTh»ads
];

339 
Th»adID
 
	gnumTh»ads
;

342 
	gSts
::
SÿÏr
 
robR—ds
;

344 
	gSts
::
SÿÏr
 
robWr™es
;

	@rob_impl.hh

44 
	~<li¡
>

46 
	~"ıu/o3/rob.hh
"

47 
	~"debug/F‘ch.hh
"

48 
	~"debug/ROB.hh
"

50 
usšg
 
Çme¥aû
 
	g¡d
;

52 
	g‹m¶©e
 <
şass
 
	gIm¶
>

53 
	gROB
<
	gIm¶
>::
ROB
(
O3CPU
 *
_ıu
, 
_numEÁr›s
, 
_squashWidth
,

54 
¡d
::
¡ršg
 
_smtROBPŞicy
, 
_smtROBTh»shŞd
,

55 
Th»adID
 
_numTh»ads
)

56 : 
ıu
(
_ıu
),

57 
numEÁr›s
(
_numEÁr›s
),

58 
squashWidth
(
_squashWidth
),

59 
numIn¡sInROB
(0),

60 
	$numTh»ads
(
_numTh»ads
)

62 
¡d
::
¡ršg
 
pŞicy
 = 
_smtROBPŞicy
;

65 
¡d
::
	`ŒªsfÜm
(
pŞicy
.
	`begš
(),…Şicy.
	`’d
(),…olicy.begin(),

66 ((*)()è
tŞow”
);

69 ià(
pŞicy
 == "dynamic") {

70 
robPŞicy
 = 
DyÇmic
;

73 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

74 
maxEÁr›s
[
tid
] = 
numEÁr›s
;

77 } ià(
pŞicy
 == "partitioned") {

78 
robPŞicy
 = 
P¬t™iÚed
;

79 
	`DPRINTF
(
F‘ch
, "ROB sharing…olicy seto Partitioned\n");

82 
·¹_amt
 = 
numEÁr›s
 / 
numTh»ads
;

85 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

86 
maxEÁr›s
[
tid
] = 
·¹_amt
;

89 } ià(
pŞicy
 == "threshold") {

90 
robPŞicy
 = 
Th»shŞd
;

91 
	`DPRINTF
(
F‘ch
, "ROB sharing…olicy seto Threshold\n");

93 
th»shŞd
 = 
_smtROBTh»shŞd
;;

96 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

97 
maxEÁr›s
[
tid
] = 
th»shŞd
;

100 
	`as£¹
(0 && "Invalid ROB Sharing Policy.Options Are:{Dynamic,"

104 
	`»£tS‹
();

105 
	}
}

107 
	g‹m¶©e
 <
şass
 
	gIm¶
>

109 
	gROB
<
	gIm¶
>::
	$»£tS‹
()

111 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++) {

112 
dÚeSquashšg
[
tid
] = 
Œue
;

113 
th»adEÁr›s
[
tid
] = 0;

114 
squashIt
[
tid
] = 
š¡Li¡
[tid].
	`’d
();

115 
squashedSeqNum
[
tid
] = 0;

117 
numIn¡sInROB
 = 0;

121 
h—d
 = 
š¡Li¡
[0].
	`’d
();

122 

 = 
š¡Li¡
[0].
	`’d
();

123 
	}
}

125 
	g‹m¶©e
 <
şass
 
	gIm¶
>

126 
	g¡d
::
¡ršg


127 
ROB
<
Im¶
>::
	$Çme
() const

129  
ıu
->
	`Çme
() + ".rob";

130 
	}
}

132 
	g‹m¶©e
 <
şass
 
	gIm¶
>

134 
	gROB
<
	gIm¶
>::
£tAùiveTh»ads
(
li¡
<
Th»adID
> *
©_±r
)

136 
DPRINTF
(
ROB
, "Setting‡ctivehreads†ist…ointer.\n");

137 
	gaùiveTh»ads
 = 
©_±r
;

140 
	g‹m¶©e
 <
şass
 
	gIm¶
>

142 
	gROB
<
	gIm¶
>::
	$d¿šSª™yCheck
() const

144 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++)

145 
	`as£¹
(
š¡Li¡
[
tid
].
	`em±y
());

146 
	`as£¹
(
	`isEm±y
());

147 
	}
}

149 
	g‹m¶©e
 <
şass
 
	gIm¶
>

151 
	gROB
<
	gIm¶
>::
	$keOv”From
()

153 
	`»£tS‹
();

154 
	}
}

156 
	g‹m¶©e
 <
şass
 
	gIm¶
>

158 
	gROB
<
	gIm¶
>::
	$»£tEÁr›s
()

160 ià(
robPŞicy
 !ğ
DyÇmic
 || 
numTh»ads
 > 1) {

161 
aùive_th»ads
 = 
aùiveTh»ads
->
	`size
();

163 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

164 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

166 
th»ads
 !ğ
’d
) {

167 
Th»adID
 
tid
 = *
th»ads
++;

169 ià(
robPŞicy
 =ğ
P¬t™iÚed
) {

170 
maxEÁr›s
[
tid
] = 
numEÁr›s
 / 
aùive_th»ads
;

171 } ià(
robPŞicy
 =ğ
Th»shŞd
 && 
aùive_th»ads
 == 1) {

172 
maxEÁr›s
[
tid
] = 
numEÁr›s
;

176 
	}
}

178 
	g‹m¶©e
 <
şass
 
	gIm¶
>

180 
	gROB
<
	gIm¶
>::
	$’ŒyAmouÁ
(
Th»adID
 
num_th»ads
)

182 ià(
robPŞicy
 =ğ
P¬t™iÚed
) {

183  
numEÁr›s
 / 
num_th»ads
;

187 
	}
}

189 
	g‹m¶©e
 <
şass
 
	gIm¶
>

191 
	gROB
<
	gIm¶
>::
	$couÁIn¡s
()

193 
tÙ®
 = 0;

195 
Th»adID
 
tid
 = 0;id < 
numTh»ads
;id++)

196 
tÙ®
 +ğ
	`couÁIn¡s
(
tid
);

198  
tÙ®
;

199 
	}
}

201 
	g‹m¶©e
 <
şass
 
	gIm¶
>

203 
	gROB
<
	gIm¶
>::
	$couÁIn¡s
(
Th»adID
 
tid
)

205  
š¡Li¡
[
tid
].
	`size
();

206 
	}
}

208 
	g‹m¶©e
 <
şass
 
	gIm¶
>

210 
	gROB
<
	gIm¶
>::
	$š£¹In¡
(
DynIn¡PŒ
 &
š¡
)

212 
	`as£¹
(
š¡
);

214 
robWr™es
++;

216 
	`DPRINTF
(
ROB
, "Addšg in¡ PC % tØthROB.\n", 
š¡
->
	`pcS‹
());

218 
	`as£¹
(
numIn¡sInROB
 !ğ
numEÁr›s
);

220 
Th»adID
 
tid
 = 
š¡
->
th»adNumb”
;

222 
š¡Li¡
[
tid
].
	`push_back
(
š¡
);

225 ià(
numIn¡sInROB
 == 0) {

226 
h—d
 = 
š¡Li¡
[
tid
].
	`begš
();

227 
	`as£¹
((*
h—d
è=ğ
š¡
);

232 

 = 
š¡Li¡
[
tid
].
	`’d
();

233 

--;

235 
š¡
->
	`£tInROB
();

237 ++
numIn¡sInROB
;

238 ++
th»adEÁr›s
[
tid
];

240 
	`as£¹
((*

è=ğ
š¡
);

242 
	`DPRINTF
(
ROB
, "[tid:%i] Now ha %d in¡ruùiÚs.\n", 
tid
, 
th»adEÁr›s
[tid]);

243 
	}
}

245 
	g‹m¶©e
 <
şass
 
	gIm¶
>

247 
	gROB
<
	gIm¶
>::
	$»tœeH—d
(
Th»adID
 
tid
)

249 
robWr™es
++;

251 
	`as£¹
(
numIn¡sInROB
 > 0);

254 
In¡It
 
h—d_™
 = 
š¡Li¡
[
tid
].
	`begš
();

256 
DynIn¡PŒ
 
h—d_š¡
 = (*
h—d_™
);

258 
	`as£¹
(
h—d_š¡
->
	`»adyToComm™
());

260 
	`DPRINTF
(
ROB
, "[tid:%u]: Retiring head instruction, "

261 "š¡ruùiÚ PC %s, [¢:%Îi]\n", 
tid
, 
h—d_š¡
->
	`pcS‹
(),

262 
h—d_š¡
->
£qNum
);

264 --
numIn¡sInROB
;

265 --
th»adEÁr›s
[
tid
];

267 
h—d_š¡
->
	`ş—rInROB
();

268 
h—d_š¡
->
	`£tComm™‹d
();

270 
š¡Li¡
[
tid
].
	`”a£
(
h—d_™
);

273 
	`upd©eH—d
();

278 
ıu
->
	`»moveFrÚtIn¡
(
h—d_š¡
);

279 
	}
}

281 
	g‹m¶©e
 <
şass
 
	gIm¶
>

282 
boŞ


283 
	gROB
<
	gIm¶
>::
	$isH—dR—dy
(
Th»adID
 
tid
)

285 
robR—ds
++;

286 ià(
th»adEÁr›s
[
tid
] != 0) {

287  
š¡Li¡
[
tid
].
	`äÚt
()->
	`»adyToComm™
();

290  
çl£
;

291 
	}
}

293 
	g‹m¶©e
 <
şass
 
	gIm¶
>

294 
boŞ


295 
	gROB
<
	gIm¶
>::
	$ÿnComm™
()

298 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

299 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

301 
th»ads
 !ğ
’d
) {

302 
Th»adID
 
tid
 = *
th»ads
++;

304 ià(
	`isH—dR—dy
(
tid
)) {

305  
Œue
;

309  
çl£
;

310 
	}
}

312 
	g‹m¶©e
 <
şass
 
	gIm¶
>

314 
	gROB
<
	gIm¶
>::
	$numF»eEÁr›s
()

316  
numEÁr›s
 - 
numIn¡sInROB
;

317 
	}
}

319 
	g‹m¶©e
 <
şass
 
	gIm¶
>

321 
	gROB
<
	gIm¶
>::
	$numF»eEÁr›s
(
Th»adID
 
tid
)

323  
maxEÁr›s
[
tid
] - 
th»adEÁr›s
[tid];

324 
	}
}

326 
	g‹m¶©e
 <
şass
 
	gIm¶
>

328 
	gROB
<
	gIm¶
>::
	$doSquash
(
Th»adID
 
tid
)

330 
robWr™es
++;

331 
	`DPRINTF
(
ROB
, "[tid:%u]: Squashing instructions until [sn:%i].\n",

332 
tid
, 
squashedSeqNum
[tid]);

334 
	`as£¹
(
squashIt
[
tid
] !ğ
š¡Li¡
[tid].
	`’d
());

336 ià((*
squashIt
[
tid
])->
£qNum
 < 
squashedSeqNum
[tid]) {

337 
	`DPRINTF
(
ROB
, "[tid:%u]: Done squashing instructions.\n",

338 
tid
);

340 
squashIt
[
tid
] = 
š¡Li¡
[tid].
	`’d
();

342 
dÚeSquashšg
[
tid
] = 
Œue
;

346 
boŞ
 
robTaUpd©e
 = 
çl£
;

348 
numSquashed
 = 0;

349 
numSquashed
 < 
squashWidth
 &&

350 
squashIt
[
tid
] !ğ
š¡Li¡
[tid].
	`’d
() &&

351 (*
squashIt
[
tid
])->
£qNum
 > 
squashedSeqNum
[tid];

352 ++
numSquashed
)

354 
	`DPRINTF
(
ROB
, "[tid:%u]: Squashing instruction PC %s, seq‚um %i.\n",

355 (*
squashIt
[
tid
])->
th»adNumb”
,

356 (*
squashIt
[
tid
])->
	`pcS‹
(),

357 (*
squashIt
[
tid
])->
£qNum
);

361 (*
squashIt
[
tid
])->
	`£tSquashed
();

363 (*
squashIt
[
tid
])->
	`£tCªComm™
();

366 ià(
squashIt
[
tid
] =ğ
š¡Li¡
[tid].
	`begš
()) {

367 
	`DPRINTF
(
ROB
, "Reached head of instruction†ist while "

370 
squashIt
[
tid
] = 
š¡Li¡
[tid].
	`’d
();

372 
dÚeSquashšg
[
tid
] = 
Œue
;

377 
In¡It
 
_th»ad
 = 
š¡Li¡
[
tid
].
	`’d
();

378 
_th»ad
--;

380 ià((*
squashIt
[
tid
]è=ğ(*
_th»ad
))

381 
robTaUpd©e
 = 
Œue
;

383 
squashIt
[
tid
]--;

388 ià((*
squashIt
[
tid
])->
£qNum
 <ğ
squashedSeqNum
[tid]) {

389 
	`DPRINTF
(
ROB
, "[tid:%u]: Done squashing instructions.\n",

390 
tid
);

392 
squashIt
[
tid
] = 
š¡Li¡
[tid].
	`’d
();

394 
dÚeSquashšg
[
tid
] = 
Œue
;

397 ià(
robTaUpd©e
) {

398 
	`upd©eTa
();

400 
	}
}

403 
	g‹m¶©e
 <
şass
 
	gIm¶
>

405 
	gROB
<
	gIm¶
>::
	$upd©eH—d
()

407 
DynIn¡PŒ
 
h—d_š¡
;

408 
In¡SeqNum
 
lowe¡_num
 = 0;

409 
boŞ
 
fœ¡_v®id
 = 
Œue
;

412 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

413 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

415 
th»ads
 !ğ
’d
) {

416 
Th»adID
 
tid
 = *
th»ads
++;

418 ià(
š¡Li¡
[
tid
].
	`em±y
())

421 ià(
fœ¡_v®id
) {

422 
h—d
 = 
š¡Li¡
[
tid
].
	`begš
();

423 
lowe¡_num
 = (*
h—d
)->
£qNum
;

424 
fœ¡_v®id
 = 
çl£
;

428 
In¡It
 
h—d_th»ad
 = 
š¡Li¡
[
tid
].
	`begš
();

430 
DynIn¡PŒ
 
h—d_š¡
 = (*
h—d_th»ad
);

432 
	`as£¹
(
h—d_š¡
 != 0);

434 ià(
h—d_š¡
->
£qNum
 < 
lowe¡_num
) {

435 
h—d
 = 
h—d_th»ad
;

436 
lowe¡_num
 = 
h—d_š¡
->
£qNum
;

440 ià(
fœ¡_v®id
) {

441 
h—d
 = 
š¡Li¡
[0].
	`’d
();

444 
	}
}

446 
	g‹m¶©e
 <
şass
 
	gIm¶
>

448 
	gROB
<
	gIm¶
>::
	$upd©eTa
()

450 

 = 
š¡Li¡
[0].
	`’d
();

451 
boŞ
 
fœ¡_v®id
 = 
Œue
;

453 
li¡
<
Th»adID
>::
™”©Ü
 
th»ads
 = 
aùiveTh»ads
->
	`begš
();

454 
li¡
<
Th»adID
>::
™”©Ü
 
’d
 = 
aùiveTh»ads
->
	`’d
();

456 
th»ads
 !ğ
’d
) {

457 
Th»adID
 
tid
 = *
th»ads
++;

459 ià(
š¡Li¡
[
tid
].
	`em±y
()) {

465 ià(
fœ¡_v®id
) {

466 

 = 
š¡Li¡
[
tid
].
	`’d
();

467 

--;

468 
fœ¡_v®id
 = 
çl£
;

474 
In¡It
 
_th»ad
 = 
š¡Li¡
[
tid
].
	`’d
();

475 
_th»ad
--;

477 ià((*
_th»ad
)->
£qNum
 > (*

)->seqNum) {

478 

 = 
_th»ad
;

481 
	}
}

484 
	g‹m¶©e
 <
şass
 
	gIm¶
>

486 
	gROB
<
	gIm¶
>::
	$squash
(
In¡SeqNum
 
squash_num
, 
Th»adID
 
tid
)

488 ià(
	`isEm±y
()) {

489 
	`DPRINTF
(
ROB
, "Does‚ot‚eedo squash dueo beingƒmpty "

491 
squash_num
);

496 
	`DPRINTF
(
ROB
, "Startingo squash withinhe ROB.\n");

498 
robStus
[
tid
] = 
ROBSquashšg
;

500 
dÚeSquashšg
[
tid
] = 
çl£
;

502 
squashedSeqNum
[
tid
] = 
squash_num
;

504 ià(!
š¡Li¡
[
tid
].
	`em±y
()) {

505 
In¡It
 
_th»ad
 = 
š¡Li¡
[
tid
].
	`’d
();

506 
_th»ad
--;

508 
squashIt
[
tid
] = 
_th»ad
;

510 
	`doSquash
(
tid
);

512 
	}
}

514 
	g‹m¶©e
 <
şass
 
	gIm¶
>

515 
ty³Çme
 
	gIm¶
::
DynIn¡PŒ


516 
ROB
<
Im¶
>::
	$»adH—dIn¡
(
Th»adID
 
tid
)

518 ià(
th»adEÁr›s
[
tid
] != 0) {

519 
In¡It
 
h—d_th»ad
 = 
š¡Li¡
[
tid
].
	`begš
();

521 
	`as£¹
((*
h—d_th»ad
)->
	`isInROB
()==
Œue
);

523  *
h—d_th»ad
;

525  
dummyIn¡
;

527 
	}
}

529 
	g‹m¶©e
 <
şass
 
	gIm¶
>

530 
ty³Çme
 
	gIm¶
::
DynIn¡PŒ


531 
ROB
<
Im¶
>::
	$»adTaIn¡
(
Th»adID
 
tid
)

533 
In¡It
 
_th»ad
 = 
š¡Li¡
[
tid
].
	`’d
();

534 
_th»ad
--;

536  *
_th»ad
;

537 
	}
}

539 
	g‹m¶©e
 <
şass
 
	gIm¶
>

541 
	gROB
<
	gIm¶
>::
	$»gSts
()

543 
usšg
 
Çme¥aû
 
Sts
;

544 
robR—ds


545 .
	`Çme
(name() + ".rob_reads")

546 .
	`desc
("The‚umber of ROB„eads");

548 
robWr™es


549 .
	`Çme
(name() + ".rob_writes")

550 .
	`desc
("The‚umber of ROB writes");

551 
	}
}

553 
	g‹m¶©e
 <
şass
 
	gIm¶
>

554 
ty³Çme
 
	gIm¶
::
DynIn¡PŒ


555 
ROB
<
Im¶
>::
	$fšdIn¡
(
Th»adID
 
tid
, 
In¡SeqNum
 
squash_š¡
)

557 
In¡It
 
™
 = 
š¡Li¡
[
tid
].
	`begš
(); iˆ!ğš¡Li¡[tid].
	`’d
(); it++) {

558 ià((*
™
)->
£qNum
 =ğ
squash_š¡
) {

559  *
™
;

562  
NULL
;

563 
	}
}

	@sat_counter.cc

31 
	~"ba£/misc.hh
"

32 
	~"ıu/o3/§t_couÁ”.hh
"

34 
	gS©CouÁ”
::
	$S©CouÁ”
()

35 : 
	`š™ŸlV®
(0), 
	$couÁ”
(0)

37 
	}
}

39 
	gS©CouÁ”
::
	$S©CouÁ”
(
b™s
)

40 : 
	`š™ŸlV®
(0), 
	`maxV®
((1 << 
b™s
è- 1), 
	$couÁ”
(0)

42 
	}
}

44 
	gS©CouÁ”
::
	$S©CouÁ”
(
b™s
, 
ušt8_t
 
š™Ÿl_v®
)

45 : 
	`š™ŸlV®
(
š™ŸlV®
), 
	`maxV®
((1 << 
b™s
è- 1), 
	$couÁ”
(
š™Ÿl_v®
)

48 ià(
š™Ÿl_v®
 > 
maxV®
) {

49 
	`çl
("BP: Initial counter valueƒxceeds max size.");

51 
	}
}

54 
	gS©CouÁ”
::
	$£tB™s
(
b™s
)

56 
maxV®
 = (1 << 
b™s
) - 1;

57 
	}
}

	@sat_counter.hh

31 #iâdeà
__CPU_O3_SAT_COUNTER_HH__


32 
	#__CPU_O3_SAT_COUNTER_HH__


	)

34 
	~"ba£/misc.hh
"

35 
	~"ba£/ty³s.hh
"

44 şas 
	cS©CouÁ”


46 
	mpublic
:

50 
	$S©CouÁ”
()

51 : 
	`š™ŸlV®
(0), 
	$couÁ”
(0)

58 
	$S©CouÁ”
(
b™s
)

59 : 
	`š™ŸlV®
(0), 
	`maxV®
((1 << 
b™s
è- 1), 
	$couÁ”
(0)

60 { 
	}
}

67 
	$S©CouÁ”
(
b™s
, 
ušt8_t
 
š™Ÿl_v®
)

68 : 
	`š™ŸlV®
(
š™Ÿl_v®
), 
	`maxV®
((1 << 
b™s
) - 1),

69 
	$couÁ”
(
š™Ÿl_v®
)

73 ià(
š™Ÿl_v®
 > 
maxV®
) {

74 
	`çl
("BP: Initial counter valueƒxceeds max size.");

76 
	}
}

81 
	$£tB™s
(
b™s
è{ 
maxV®
 = (1 << b™sè- 1; 
	}
}

83 
	$»£t
(è{ 
couÁ”
 = 
š™ŸlV®
; 
	}
}

88 
	$šüem’t
()

90 ià(
couÁ”
 < 
maxV®
) {

91 ++
couÁ”
;

93 
	}
}

98 
	$deüem’t
()

100 ià(
couÁ”
 > 0) {

101 --
couÁ”
;

103 
	}
}

108 cÚ¡ 
ušt8_t
 
	$»ad
() const

109 {  
couÁ”
; 
	}
}

111 
	g´iv©e
:

112 
ušt8_t
 
š™ŸlV®
;

113 
ušt8_t
 
	gmaxV®
;

114 
ušt8_t
 
	gcouÁ”
;

	@scoreboard.cc

32 
	~"cÚfig/the_i§.hh
"

33 
	~"ıu/o3/scÜebßrd.hh
"

34 
	~"debug/ScÜebßrd.hh
"

36 
	gScÜebßrd
::
	$ScÜebßrd
(
aùiveTh»ads
,

37 
_numLogiÿlIÁRegs
,

38 
_numPhysiÿlIÁRegs
,

39 
_numLogiÿlFlßtRegs
,

40 
_numPhysiÿlFlßtRegs
,

41 
_numMiscRegs
,

42 
_z”oRegIdx
)

43 : 
	`numLogiÿlIÁRegs
(
_numLogiÿlIÁRegs
),

44 
	`numPhysiÿlIÁRegs
(
_numPhysiÿlIÁRegs
),

45 
	`numLogiÿlFlßtRegs
(
_numLogiÿlFlßtRegs
),

46 
	`numPhysiÿlFlßtRegs
(
_numPhysiÿlFlßtRegs
),

47 
	`numMiscRegs
(
_numMiscRegs
),

48 
	$z”oRegIdx
(
_z”oRegIdx
)

51 
numLogiÿlRegs
 = 
numLogiÿlIÁRegs
 + 
numLogiÿlFlßtRegs
;

52 
numPhysiÿlRegs
 = 
numPhysiÿlIÁRegs
 + 
numPhysiÿlFlßtRegs
;

55 
	`»size
(
numPhysiÿlRegs
 + (
numMiscRegs
 * 
aùiveTh»ads
));

58 
i
=0; i < 
numLogiÿlIÁRegs
 * 
aùiveTh»ads
; i++) {

59 
	`as£¹
(
	`šdexInBounds
(
i
));

60 
»gScÜeBßrd
[
i
] = 1;

63 
i
ğ
numPhysiÿlIÁRegs
;

64 
i
 < 
numPhysiÿlIÁRegs
 + (
numLogiÿlFlßtRegs
 * 
aùiveTh»ads
);

65 
i
++) {

66 
	`as£¹
(
	`šdexInBounds
(
i
));

67 
»gScÜeBßrd
[
i
] = 1;

70 
i
 = 
numPhysiÿlRegs
;

71 
i
 < 
numPhysiÿlRegs
 + (
numMiscRegs
 * 
aùiveTh»ads
);

72 
i
++) {

73 
	`as£¹
(
	`šdexInBounds
(
i
));

74 
»gScÜeBßrd
[
i
] = 1;

76 
	}
}

78 
	g¡d
::
¡ršg


79 
ScÜebßrd
::
	$Çme
() const

82 
	}
}

84 
boŞ


85 
	gScÜebßrd
::
	$g‘Reg
(
PhysRegIndex
 
phys_»g
)

87 #ià
THE_ISA
 =ğ
ALPHA_ISA


89 ià(
phys_»g
 =ğ
z”oRegIdx
 ||

90 
phys_»g
 =ğ(
z”oRegIdx
 + 
numPhysiÿlIÁRegs
)) {

95 ià(
phys_»g
 =ğ
z”oRegIdx
) {

100 
	`as£¹
(
	`šdexInBounds
(
phys_»g
));

101  
»gScÜeBßrd
[
phys_»g
];

102 
	}
}

105 
	gScÜebßrd
::
	$£tReg
(
PhysRegIndex
 
phys_»g
)

107 
	`DPRINTF
(
ScÜebßrd
, "S‘tšg„eg %˜a »ady\n", 
phys_»g
);

109 
	`as£¹
(
	`šdexInBounds
(
phys_»g
));

110 
»gScÜeBßrd
[
phys_»g
] = 1;

111 
	}
}

114 
	gScÜebßrd
::
	$un£tReg
(
PhysRegIndex
 
»ady_»g
)

116 #ià
THE_ISA
 =ğ
ALPHA_ISA


117 ià(
»ady_»g
 =ğ
z”oRegIdx
 ||

118 
»ady_»g
 =ğ(
z”oRegIdx
 + 
numPhysiÿlIÁRegs
)) {

123 ià(
»ady_»g
 =ğ
z”oRegIdx
) {

129 
	`as£¹
(
	`šdexInBounds
(
»ady_»g
));

130 
»gScÜeBßrd
[
»ady_»g
] = 0;

131 
	}
}

	@scoreboard.hh

32 #iâdeà
__CPU_O3_SCOREBOARD_HH__


33 
	#__CPU_O3_SCOREBOARD_HH__


	)

35 
	~<io¡»am
>

36 
	~<ut™y
>

37 
	~<veùÜ
>

39 
	~"ba£/Œaû.hh
"

40 
	~"ıu/o3/comm.hh
"

50 şas 
	cScÜebßrd


52 
	mpublic
:

62 
ScÜebßrd
(
aùiveTh»ads
,

63 
_numLogiÿlIÁRegs
,

64 
_numPhysiÿlIÁRegs
,

65 
_numLogiÿlFlßtRegs
,

66 
_numPhysiÿlFlßtRegs
,

67 
_numMiscRegs
,

68 
_z”oRegIdx
);

71 ~
	$ScÜebßrd
() {}

74 
¡d
::
¡ršg
 
	$Çme
() const;

77 
boŞ
 
	`g‘Reg
(
PhysRegIndex
 
»ady_»g
);

80 
	`£tReg
(
PhysRegIndex
 
phys_»g
);

83 
	`un£tReg
(
PhysRegIndex
 
»ady_»g
);

85 
´iv©e
:

89 
¡d
::
veùÜ
<
boŞ
> 
»gScÜeBßrd
;

92 
numLogiÿlIÁRegs
;

95 
numPhysiÿlIÁRegs
;

98 
numLogiÿlFlßtRegs
;

101 
numPhysiÿlFlßtRegs
;

104 
numMiscRegs
;

107 
numLogiÿlRegs
;

110 
numPhysiÿlRegs
;

113 
z”oRegIdx
;

115 
cu¼’tSize
;

118 
	$»size
(
ÃwSize
)

120 
cu¼’tSize
 = 
ÃwSize
;

121 
»gScÜeBßrd
.
	`»size
(
ÃwSize
);

122 
	}
}

124 
boŞ


125 
	$šdexInBounds
(
idx
)

127  
idx
 < 
cu¼’tSize
;

128 
	}
}

	@store_set.cc

31 
	~"ba£/štm©h.hh
"

32 
	~"ba£/misc.hh
"

33 
	~"ba£/Œaû.hh
"

34 
	~"ıu/o3/¡Üe_£t.hh
"

35 
	~"debug/StÜeS‘.hh
"

37 
	gStÜeS‘
::
	$StÜeS‘
(
ušt64_t
 
ş—r_³riod
, 
_SSIT_size
, 
_LFST_size
)

38 : 
	`ş—rP”iod
(
ş—r_³riod
), 
	`SSITSize
(
_SSIT_size
), 
	$LFSTSize
(
_LFST_size
)

40 
	`DPRINTF
(
StÜeS‘
, "StoreSet: Creating store set object.\n");

41 
	`DPRINTF
(
StÜeS‘
, "StoreSet: SSIT size: %i, LFST size: %i.\n",

42 
SSITSize
, 
LFSTSize
);

44 ià(!
	`isPow”Of2
(
SSITSize
)) {

45 
	`çl
("Invalid SSIT size!\n");

48 
SSIT
.
	`»size
(
SSITSize
);

50 
v®idSSIT
.
	`»size
(
SSITSize
);

52 
i
 = 0; i < 
SSITSize
; ++i)

53 
v®idSSIT
[
i
] = 
çl£
;

55 ià(!
	`isPow”Of2
(
LFSTSize
)) {

56 
	`çl
("Invalid LFST size!\n");

59 
LFST
.
	`»size
(
LFSTSize
);

61 
v®idLFST
.
	`»size
(
LFSTSize
);

63 
i
 = 0; i < 
LFSTSize
; ++i) {

64 
v®idLFST
[
i
] = 
çl£
;

65 
LFST
[
i
] = 0;

68 
šdexMask
 = 
SSITSize
 - 1;

70 
off£tB™s
 = 2;

72 
memOpsP»d
 = 0;

73 
	}
}

75 
	gStÜeS‘
::~
	$StÜeS‘
()

77 
	}
}

80 
StÜeS‘
::
	$š™
(
ušt64_t
 
ş—r_³riod
, 
_SSIT_size
, 
_LFST_size
)

82 
SSITSize
 = 
_SSIT_size
;

83 
LFSTSize
 = 
_LFST_size
;

84 
ş—rP”iod
 = 
ş—r_³riod
;

86 
	`DPRINTF
(
StÜeS‘
, "StoreSet: Creating store set object.\n");

87 
	`DPRINTF
(
StÜeS‘
, "StoreSet: SSIT size: %i, LFST size: %i.\n",

88 
SSITSize
, 
LFSTSize
);

90 
SSIT
.
	`»size
(
SSITSize
);

92 
v®idSSIT
.
	`»size
(
SSITSize
);

94 
i
 = 0; i < 
SSITSize
; ++i)

95 
v®idSSIT
[
i
] = 
çl£
;

97 
LFST
.
	`»size
(
LFSTSize
);

99 
v®idLFST
.
	`»size
(
LFSTSize
);

101 
i
 = 0; i < 
LFSTSize
; ++i) {

102 
v®idLFST
[
i
] = 
çl£
;

103 
LFST
[
i
] = 0;

106 
šdexMask
 = 
SSITSize
 - 1;

108 
off£tB™s
 = 2;

110 
memOpsP»d
 = 0;

111 
	}
}

115 
	gStÜeS‘
::
	$viŞ©iÚ
(
Addr
 
¡Üe_PC
, Add¸
lßd_PC
)

117 
lßd_šdex
 = 
	`ÿlcIndex
(
lßd_PC
);

118 
¡Üe_šdex
 = 
	`ÿlcIndex
(
¡Üe_PC
);

120 
	`as£¹
(
lßd_šdex
 < 
SSITSize
 && 
¡Üe_šdex
 < SSITSize);

122 
boŞ
 
v®id_lßd_SSID
 = 
v®idSSIT
[
lßd_šdex
];

123 
boŞ
 
v®id_¡Üe_SSID
 = 
v®idSSIT
[
¡Üe_šdex
];

125 ià(!
v®id_lßd_SSID
 && !
v®id_¡Üe_SSID
) {

127 
SSID
 
Ãw_£t
 = 
	`ÿlcSSID
(
lßd_PC
);

129 
v®idSSIT
[
lßd_šdex
] = 
Œue
;

131 
SSIT
[
lßd_šdex
] = 
Ãw_£t
;

133 
v®idSSIT
[
¡Üe_šdex
] = 
Œue
;

135 
SSIT
[
¡Üe_šdex
] = 
Ãw_£t
;

137 
	`as£¹
(
Ãw_£t
 < 
LFSTSize
);

139 
	`DPRINTF
(
StÜeS‘
, "StoreSet: Neither†oad‚or store had‡ valid "

141 
Ãw_£t
, 
lßd_PC
, 
¡Üe_PC
);

142 } ià(
v®id_lßd_SSID
 && !
v®id_¡Üe_SSID
) {

143 
SSID
 
lßd_SSID
 = 
SSIT
[
lßd_šdex
];

145 
v®idSSIT
[
¡Üe_šdex
] = 
Œue
;

147 
SSIT
[
¡Üe_šdex
] = 
lßd_SSID
;

149 
	`as£¹
(
lßd_SSID
 < 
LFSTSize
);

151 
	`DPRINTF
(
StÜeS‘
, "StoreSet: Load had‡ valid store set. Adding "

153 
lßd_SSID
, 
lßd_PC
, 
¡Üe_PC
);

154 } ià(!
v®id_lßd_SSID
 && 
v®id_¡Üe_SSID
) {

155 
SSID
 
¡Üe_SSID
 = 
SSIT
[
¡Üe_šdex
];

157 
v®idSSIT
[
lßd_šdex
] = 
Œue
;

159 
SSIT
[
lßd_šdex
] = 
¡Üe_SSID
;

161 
	`DPRINTF
(
StÜeS‘
, "StoreSet: Store had‡ valid store set: %i for "

163 
¡Üe_SSID
, 
lßd_PC
, 
¡Üe_PC
);

165 
SSID
 
lßd_SSID
 = 
SSIT
[
lßd_šdex
];

166 
SSID
 
¡Üe_SSID
 = 
SSIT
[
¡Üe_šdex
];

168 
	`as£¹
(
lßd_SSID
 < 
LFSTSize
 && 
¡Üe_SSID
 < LFSTSize);

171 ià(
¡Üe_SSID
 > 
lßd_SSID
) {

172 
SSIT
[
¡Üe_šdex
] = 
lßd_SSID
;

174 
	`DPRINTF
(
StÜeS‘
, "StoreSet: Load had smaller store set: %i; "

176 
lßd_SSID
, 
lßd_PC
, 
¡Üe_PC
);

178 
SSIT
[
lßd_šdex
] = 
¡Üe_SSID
;

180 
	`DPRINTF
(
StÜeS‘
, "StoreSet: Store had smaller store set: %i; "

182 
¡Üe_SSID
, 
lßd_PC
, 
¡Üe_PC
);

185 
	}
}

188 
	gStÜeS‘
::
	$checkCË¬
()

190 
memOpsP»d
++;

191 ià(
memOpsP»d
 > 
ş—rP”iod
) {

192 
	`DPRINTF
(
StÜeS‘
, "Wiping…redictor state beacuse %d†d/stƒxecuted\n",

193 
ş—rP”iod
);

194 
memOpsP»d
 = 0;

195 
	`ş—r
();

197 
	}
}

200 
	gStÜeS‘
::
	$š£¹Lßd
(
Addr
 
lßd_PC
, 
In¡SeqNum
 
lßd_£q_num
)

202 
	`checkCË¬
();

205 
	}
}

208 
	gStÜeS‘
::
	$š£¹StÜe
(
Addr
 
¡Üe_PC
, 
In¡SeqNum
 
¡Üe_£q_num
, 
Th»adID
 
tid
)

210 
šdex
 = 
	`ÿlcIndex
(
¡Üe_PC
);

212 
¡Üe_SSID
;

214 
	`checkCË¬
();

215 
	`as£¹
(
šdex
 < 
SSITSize
);

217 ià(!
v®idSSIT
[
šdex
]) {

221 
¡Üe_SSID
 = 
SSIT
[
šdex
];

223 
	`as£¹
(
¡Üe_SSID
 < 
LFSTSize
);

226 
LFST
[
¡Üe_SSID
] = 
¡Üe_£q_num
;

228 
v®idLFST
[
¡Üe_SSID
] = 1;

230 
¡ÜeLi¡
[
¡Üe_£q_num
] = 
¡Üe_SSID
;

232 
	`DPRINTF
(
StÜeS‘
, "Store %#x updatedhe LFST, SSID: %i\n",

233 
¡Üe_PC
, 
¡Üe_SSID
);

235 
	}
}

237 
In¡SeqNum


238 
	gStÜeS‘
::
	$checkIn¡
(
Addr
 
PC
)

240 
šdex
 = 
	`ÿlcIndex
(
PC
);

242 
š¡_SSID
;

244 
	`as£¹
(
šdex
 < 
SSITSize
);

246 ià(!
v®idSSIT
[
šdex
]) {

247 
	`DPRINTF
(
StÜeS‘
, "Inst %#x with index %i had‚o SSID\n",

248 
PC
, 
šdex
);

253 
š¡_SSID
 = 
SSIT
[
šdex
];

255 
	`as£¹
(
š¡_SSID
 < 
LFSTSize
);

257 ià(!
v®idLFST
[
š¡_SSID
]) {

259 
	`DPRINTF
(
StÜeS‘
, "Inst %#x with index %i‡nd SSID %i had‚o "

260 "d•’d’cy\n", 
PC
, 
šdex
, 
š¡_SSID
);

264 
	`DPRINTF
(
StÜeS‘
, "Inst %#x with index %i‡nd SSID %i had LFST "

265 "šum oà%i\n", 
PC
, 
šdex
, 
š¡_SSID
, 
LFST
[inst_SSID]);

267  
LFST
[
š¡_SSID
];

270 
	}
}

273 
	gStÜeS‘
::
	$issued
(
Addr
 
issued_PC
, 
In¡SeqNum
 
issued_£q_num
, 
boŞ
 
is_¡Üe
)

276 ià(!
is_¡Üe
) {

280 
šdex
 = 
	`ÿlcIndex
(
issued_PC
);

282 
¡Üe_SSID
;

284 
	`as£¹
(
šdex
 < 
SSITSize
);

286 
SeqNumM­It
 
¡Üe_li¡_™
 = 
¡ÜeLi¡
.
	`fšd
(
issued_£q_num
);

288 ià(
¡Üe_li¡_™
 !ğ
¡ÜeLi¡
.
	`’d
()) {

289 
¡ÜeLi¡
.
	`”a£
(
¡Üe_li¡_™
);

293 ià(!
v®idSSIT
[
šdex
]) {

297 
¡Üe_SSID
 = 
SSIT
[
šdex
];

299 
	`as£¹
(
¡Üe_SSID
 < 
LFSTSize
);

303 ià(
v®idLFST
[
¡Üe_SSID
] && 
LFST
[¡Üe_SSID] =ğ
issued_£q_num
) {

304 
	`DPRINTF
(
StÜeS‘
, "StoreSet: store invalidated itself in LFST.\n");

305 
v®idLFST
[
¡Üe_SSID
] = 
çl£
;

307 
	}
}

310 
	gStÜeS‘
::
	$squash
(
In¡SeqNum
 
squashed_num
, 
Th»adID
 
tid
)

312 
	`DPRINTF
(
StÜeS‘
, "StoreSet: Squashing until inum %i\n",

313 
squashed_num
);

315 
idx
;

316 
SeqNumM­It
 
¡Üe_li¡_™
 = 
¡ÜeLi¡
.
	`begš
();

319 !
¡ÜeLi¡
.
	`em±y
()) {

320 
idx
 = (*
¡Üe_li¡_™
).
£cÚd
;

322 ià((*
¡Üe_li¡_™
).
fœ¡
 <ğ
squashed_num
) {

326 
boŞ
 
young”
 = 
LFST
[
idx
] > 
squashed_num
;

328 ià(
v®idLFST
[
idx
] && 
young”
) {

329 
	`DPRINTF
(
StÜeS‘
, "Squashed [¢:%Îi]\n", 
LFST
[
idx
]);

330 
v®idLFST
[
idx
] = 
çl£
;

332 
¡ÜeLi¡
.
	`”a£
(
¡Üe_li¡_™
++);

333 } ià(!
v®idLFST
[
idx
] && 
young”
) {

334 
¡ÜeLi¡
.
	`”a£
(
¡Üe_li¡_™
++);

337 
	}
}

340 
	gStÜeS‘
::
	$ş—r
()

342 
i
 = 0; i < 
SSITSize
; ++i) {

343 
v®idSSIT
[
i
] = 
çl£
;

346 
i
 = 0; i < 
LFSTSize
; ++i) {

347 
v®idLFST
[
i
] = 
çl£
;

350 
¡ÜeLi¡
.
	`ş—r
();

351 
	}
}

354 
	gStÜeS‘
::
	$dump
()

356 
	`ırštf
("¡ÜeLi¡.size(): %i\n", 
¡ÜeLi¡
.
	`size
());

357 
SeqNumM­It
 
¡Üe_li¡_™
 = 
¡ÜeLi¡
.
	`begš
();

359 
num
 = 0;

361 
¡Üe_li¡_™
 !ğ
¡ÜeLi¡
.
	`’d
()) {

362 
	`ırštf
("%i: [sn:%lli] SSID:%i\n",

363 
num
, (*
¡Üe_li¡_™
).
fœ¡
, (*¡Üe_li¡_™).
£cÚd
);

364 
num
++;

365 
¡Üe_li¡_™
++;

367 
	}
}

	@store_set.hh

31 #iâdeà
__CPU_O3_STORE_SET_HH__


32 
	#__CPU_O3_STORE_SET_HH__


	)

34 
	~<li¡
>

35 
	~<m­
>

36 
	~<ut™y
>

37 
	~<veùÜ
>

39 
	~"ba£/ty³s.hh
"

40 
	~"ıu/š¡_£q.hh
"

42 
	sÉ£qnum
 {

43 
boŞ
 
İ”©Ü
()(cÚ¡ 
	mIn¡SeqNum
 &
	mlhs
, cÚ¡ In¡SeqNum &
	mrhs
) const

45  
	mlhs
 > 
	mrhs
;

56 şas 
	cStÜeS‘


58 
	mpublic
:

59 
	tSSID
;

61 
	mpublic
:

63 
	$StÜeS‘
() { };

66 
	`StÜeS‘
(
ušt64_t
 
ş—r_³riod
, 
SSIT_size
, 
LFST_size
);

69 ~
	`StÜeS‘
();

72 
	`š™
(
ušt64_t
 
ş—r_³riod
, 
SSIT_size
, 
LFST_size
);

76 
	`viŞ©iÚ
(
Addr
 
¡Üe_PC
, Add¸
lßd_PC
);

82 
	`checkCË¬
();

87 
	`š£¹Lßd
(
Addr
 
lßd_PC
, 
In¡SeqNum
 
lßd_£q_num
);

91 
	`š£¹StÜe
(
Addr
 
¡Üe_PC
, 
In¡SeqNum
 
¡Üe_£q_num
, 
Th»adID
 
tid
);

97 
In¡SeqNum
 
	`checkIn¡
(
Addr
 
PC
);

100 
	`issued
(
Addr
 
issued_PC
, 
In¡SeqNum
 
issued_£q_num
, 
boŞ
 
is_¡Üe
);

103 
	`squash
(
In¡SeqNum
 
squashed_num
, 
Th»adID
 
tid
);

106 
	`ş—r
();

109 
	`dump
();

111 
´iv©e
:

113 
šlše
 
	$ÿlcIndex
(
Addr
 
PC
)

114 {  (
PC
 >> 
off£tB™s
è& 
šdexMask
; 
	}
}

117 
šlše
 
SSID
 
	$ÿlcSSID
(
Addr
 
PC
)

118 {  ((
PC
 ^ (PC >> 10)è% 
LFSTSize
); 
	}
}

121 
	g¡d
::
veùÜ
<
SSID
> 
SSIT
;

124 
	g¡d
::
veùÜ
<
boŞ
> 
v®idSSIT
;

127 
	g¡d
::
veùÜ
<
In¡SeqNum
> 
LFST
;

130 
	g¡d
::
veùÜ
<
boŞ
> 
v®idLFST
;

135 
	g¡d
::
m­
<
In¡SeqNum
, , 
	gÉ£qnum
> 
	g¡ÜeLi¡
;

137 
	g¡d
::
	tm­
<
	tIn¡SeqNum
, , 
	tÉ£qnum
>::
	t™”©Ü
 
	tSeqNumM­It
;

142 
ušt64_t
 
	gş—rP”iod
;

145 
	gSSITSize
;

148 
	gLFSTSize
;

151 
	gšdexMask
;

154 
	goff£tB™s
;

157 
	gmemOpsP»d
;

	@thread_context.cc

31 
	~"ıu/o3/im¶.hh
"

32 
	~"ıu/o3/th»ad_cÚ‹xt.hh
"

33 
	~"ıu/o3/th»ad_cÚ‹xt_im¶.hh
"

35 
‹m¶©e
 
şass
 
	gO3Th»adCÚ‹xt
<
	gO3CPUIm¶
>;

	@thread_context.hh

43 #iâdeà
__CPU_O3_THREAD_CONTEXT_HH__


44 
	#__CPU_O3_THREAD_CONTEXT_HH__


	)

46 
	~"cÚfig/the_i§.hh
"

47 
	~"ıu/o3/i§_¥ecific.hh
"

48 
	~"ıu/th»ad_cÚ‹xt.hh
"

50 
şass
 
	gEndQu›sûEv’t
;

51 
Çme¥aû
 
	gK”Ãl
 {

52 
şass
 
	gSti¡ics
;

68 
	g‹m¶©e
 <
şass
 
	gIm¶
>

69 şas 
	cO3Th»adCÚ‹xt
 : 
public
 
Th»adCÚ‹xt


71 
public
:

72 
ty³Çme
 
	tIm¶
::
	tO3CPU
 O3CPU;

75 
O3CPU
 *
	mıu
;

78 
	mO3Th»adS‹
<
	mIm¶
> *
	mth»ad
;

81 
	mTheISA
::
TLB
 *
	$g‘ITBPŒ
(è{  
ıu
->
™b
; }

84 
TheISA
::
TLB
 *
	$g‘DTBPŒ
(è{  
ıu
->
dtb
; 
	}
}

86 
Check”CPU
 *
	$g‘Check”CpuPŒ
(è{  
NULL
; 
	}
}

88 
	gTheISA
::
Decod”
 *

89 
	$g‘Decod”PŒ
()

91  
ıu
->
ãtch
.
decod”
[
th»ad
->
	`th»adId
()];

92 
	}
}

95 
vœtu®
 
Ba£CPU
 *
	$g‘CpuPŒ
(è{  
ıu
; 
	}
}

98 
vœtu®
 
	$ıuId
(è{  
ıu
->
	`ıuId
(); 
	}
}

100 
vœtu®
 
	$cÚ‹xtId
(è{  
th»ad
->
	`cÚ‹xtId
(); 
	}
}

102 
vœtu®
 
	$£tCÚ‹xtId
(
id
è{ 
th»ad
->
	`£tCÚ‹xtId
(id); 
	}
}

105 
vœtu®
 
	$th»adId
(è{  
th»ad
->
	`th»adId
(); 
	}
}

106 
vœtu®
 
	$£tTh»adId
(
id
è{  
th»ad
->
	`£tTh»adId
(id); 
	}
}

109 
vœtu®
 
Sy¡em
 *
	$g‘Sy¡emPŒ
(è{  
ıu
->
sy¡em
; 
	}
}

112 
vœtu®
 
	gTheISA
::
K”Ãl
::
Sti¡ics
 *
	$g‘K”ÃlSts
()

113 {  
th»ad
->
k”ÃlSts
; 
	}
}

116 
vœtu®
 
Proûss
 *
	$g‘ProûssPŒ
(è{  
th»ad
->
	`g‘ProûssPŒ
(); 
	}
}

118 
vœtu®
 
	gPÜtProxy
 &
	$g‘PhysProxy
(è{  
th»ad
->
	`g‘PhysProxy
(); 
	}
}

120 
vœtu®
 
	gFST¿n¦©šgPÜtProxy
 &
g‘VœtProxy
();

122 
vœtu®
 
	$š™MemProx›s
(
Th»adCÚ‹xt
 *
tc
)

123 { 
th»ad
->
	`š™MemProx›s
(
tc
); 
	}
}

125 
vœtu®
 
	gSET¿n¦©šgPÜtProxy
 &
	$g‘MemProxy
()

126 {  
th»ad
->
	`g‘MemProxy
(); 
	}
}

129 
vœtu®
 
Stus
 
	$¡©us
(ècÚ¡ {  
th»ad
->
	`¡©us
(); 
	}
}

132 
vœtu®
 
	$£tStus
(
Stus
 
Ãw_¡©us
)

133 { 
th»ad
->
	`£tStus
(
Ãw_¡©us
); 
	}
}

137 
vœtu®
 
aùiv©e
(
Cyşes
 
d–ay
 = Cycles(1));

140 
vœtu®
 
su¥’d
(
Cyşes
 
d–ay
 = Cycles(0));

143 
vœtu®
 
h®t
(
Cyşes
 
d–ay
 = Cycles(0));

148 
vœtu®
 
dumpFuncProfe
();

151 
vœtu®
 
keOv”From
(
Th»adCÚ‹xt
 *
Şd_cÚ‹xt
);

154 
vœtu®
 
»gSts
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
);

157 
vœtu®
 
Tick
 
»adLa¡Aùiv©e
();

159 
vœtu®
 
Tick
 
»adLa¡Su¥’d
();

162 
vœtu®
 
´ofeCË¬
();

164 
vœtu®
 
´ofeSam¶e
();

167 
vœtu®
 
cİyArchRegs
(
Th»adCÚ‹xt
 *
tc
);

170 
vœtu®
 
ş—rArchRegs
();

173 
vœtu®
 
ušt64_t
 
	$»adIÁReg
(
»g_idx
) {

174  
	`»adIÁRegFÏt
(
	`æ©‹nIÁIndex
(
»g_idx
));

175 
	}
}

177 
vœtu®
 
FlßtReg
 
	$»adFlßtReg
(
»g_idx
) {

178  
	`»adFlßtRegFÏt
(
	`æ©‹nFlßtIndex
(
»g_idx
));

179 
	}
}

181 
vœtu®
 
FlßtRegB™s
 
	$»adFlßtRegB™s
(
»g_idx
) {

182  
	`»adFlßtRegB™sFÏt
(
	`æ©‹nFlßtIndex
(
»g_idx
));

183 
	}
}

186 
vœtu®
 
	$£tIÁReg
(
»g_idx
, 
ušt64_t
 
v®
) {

187 
	`£tIÁRegFÏt
(
	`æ©‹nIÁIndex
(
»g_idx
), 
v®
);

188 
	}
}

190 
vœtu®
 
	$£tFlßtReg
(
»g_idx
, 
FlßtReg
 
v®
) {

191 
	`£tFlßtRegFÏt
(
	`æ©‹nFlßtIndex
(
»g_idx
), 
v®
);

192 
	}
}

194 
vœtu®
 
	$£tFlßtRegB™s
(
»g_idx
, 
FlßtRegB™s
 
v®
) {

195 
	`£tFlßtRegB™sFÏt
(
	`æ©‹nFlßtIndex
(
»g_idx
), 
v®
);

196 
	}
}

199 
vœtu®
 
	gTheISA
::
PCS‹
 
	$pcS‹
()

200 {  
ıu
->
	`pcS‹
(
th»ad
->
	`th»adId
()); 
	}
}

203 
vœtu®
 
pcS‹
(cÚ¡ 
TheISA
::
PCS‹
 &
v®
);

205 
vœtu®
 
pcS‹NoRecÜd
(cÚ¡ 
TheISA
::
PCS‹
 &
v®
);

208 
vœtu®
 
Addr
 
	$š¡Addr
()

209 {  
ıu
->
	`š¡Addr
(
th»ad
->
	`th»adId
()); 
	}
}

212 
vœtu®
 
Addr
 
	$ÃxtIn¡Addr
()

213 {  
ıu
->
	`ÃxtIn¡Addr
(
th»ad
->
	`th»adId
()); 
	}
}

216 
vœtu®
 
MiüoPC
 
	$miüoPC
()

217 {  
ıu
->
	`miüoPC
(
th»ad
->
	`th»adId
()); 
	}
}

220 
vœtu®
 
MiscReg
 
	$»adMiscRegNoEfãù
(
misc_»g
)

221 {  
ıu
->
	`»adMiscRegNoEfãù
(
misc_»g
, 
th»ad
->
	`th»adId
()); 
	}
}

225 
vœtu®
 
MiscReg
 
	$»adMiscReg
(
misc_»g
)

226 {  
ıu
->
	`»adMiscReg
(
misc_»g
, 
th»ad
->
	`th»adId
()); 
	}
}

229 
vœtu®
 
£tMiscRegNoEfãù
(
misc_»g
, cÚ¡ 
MiscReg
 &
v®
);

233 
vœtu®
 
£tMiscReg
(
misc_»g
, cÚ¡ 
MiscReg
 &
v®
);

235 
vœtu®
 
æ©‹nIÁIndex
(
»g
);

236 
vœtu®
 
æ©‹nFlßtIndex
(
»g
);

240 
vœtu®
 
	$»adStCÚdFau»s
()

241 {  
th»ad
->
¡ÜeCÚdFau»s
; 
	}
}

244 
vœtu®
 
	$£tStCÚdFau»s
(
sc_çu»s
)

245 { 
th»ad
->
¡ÜeCÚdFau»s
 = 
sc_çu»s
; 
	}
}

253 
vœtu®
 
boŞ
 
	$mis¥ecuÏtšg
(è{  
çl£
; 
	}
}

256 
vœtu®
 
	$sysÿÎ
(
št64_t
 
ÿÎnum
)

257 {  
ıu
->
	`sysÿÎ
(
ÿÎnum
, 
th»ad
->
	`th»adId
()); 
	}
}

260 
vœtu®
 
CouÁ”
 
	$»adFuncExeIn¡
(è{  
th»ad
->
funcExeIn¡
; 
	}
}

263 
vœtu®
 
EndQu›sûEv’t
 *
	$g‘Qu›sûEv’t
()

265  
this
->
th»ad
->
qu›sûEv’t
;

266 
	}
}

272 
šlše
 
	$cÚd™iÚ®Squash
()

274 ià(!
th»ad
->
Œ­P’dšg
 && !th»ad->
noSquashFromTC
)

275 
ıu
->
	`squashFromTC
(
th»ad
->
	`th»adId
());

276 
	}
}

278 
vœtu®
 
ušt64_t
 
»adIÁRegFÏt
(
idx
);

279 
vœtu®
 
£tIÁRegFÏt
(
idx
, 
ušt64_t
 
v®
);

281 
vœtu®
 
FlßtReg
 
»adFlßtRegFÏt
(
idx
);

282 
vœtu®
 
£tFlßtRegFÏt
(
idx
, 
FlßtReg
 
v®
);

284 
vœtu®
 
FlßtRegB™s
 
»adFlßtRegB™sFÏt
(
idx
);

285 
vœtu®
 
£tFlßtRegB™sFÏt
(
idx
, 
FlßtRegB™s
 
v®
);

	@thread_context_impl.hh

44 
	~"¬ch/k”Ãl_¡©s.hh
"

45 
	~"¬ch/»gi¡”s.hh
"

46 
	~"cÚfig/the_i§.hh
"

47 
	~"ıu/o3/th»ad_cÚ‹xt.hh
"

48 
	~"ıu/qu›sû_ev’t.hh
"

49 
	~"debug/O3CPU.hh
"

51 
	g‹m¶©e
 <
şass
 
	gIm¶
>

52 
	gFST¿n¦©šgPÜtProxy
&

53 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
	$g‘VœtProxy
()

55  
th»ad
->
	`g‘VœtProxy
();

56 
	}
}

58 
	g‹m¶©e
 <
şass
 
	gIm¶
>

60 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
	$dumpFuncProfe
()

62 
th»ad
->
	`dumpFuncProfe
();

63 
	}
}

65 
	g‹m¶©e
 <
şass
 
	gIm¶
>

67 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
	$keOv”From
(
Th»adCÚ‹xt
 *
Şd_cÚ‹xt
)

69 ::
	`keOv”From
(*
this
, *
Şd_cÚ‹xt
);

70 
TheISA
::
Decod”
 *
ÃwDecod”
 = 
	`g‘Decod”PŒ
();

71 
TheISA
::
Decod”
 *
ŞdDecod”
 = 
Şd_cÚ‹xt
->
	`g‘Decod”PŒ
();

72 
ÃwDecod”
->
	`keOv”From
(
ŞdDecod”
);

74 
th»ad
->
k”ÃlSts
 = 
Şd_cÚ‹xt
->
	`g‘K”ÃlSts
();

75 
th»ad
->
funcExeIn¡
 = 
Şd_cÚ‹xt
->
	`»adFuncExeIn¡
();

77 
th»ad
->
noSquashFromTC
 = 
çl£
;

78 
th»ad
->
Œ­P’dšg
 = 
çl£
;

79 
	}
}

81 
	g‹m¶©e
 <
şass
 
	gIm¶
>

83 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
	$aùiv©e
(
Cyşes
 
d–ay
)

85 
	`DPRINTF
(
O3CPU
, "Calling‡ctivate on Thread Context %d\n",

86 
	`th»adId
());

88 ià(
th»ad
->
	`¡©us
(è=ğ
Th»adCÚ‹xt
::
Aùive
)

91 
th»ad
->
Ï¡Aùiv©e
 = 
	`curTick
();

92 
th»ad
->
	`£tStus
(
Th»adCÚ‹xt
::
Aùive
);

95 
ıu
->
	`aùiv©eCÚ‹xt
(
th»ad
->
	`th»adId
(), 
d–ay
);

96 
	}
}

98 
	g‹m¶©e
 <
şass
 
	gIm¶
>

100 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
	$su¥’d
(
Cyşes
 
d–ay
)

102 
	`DPRINTF
(
O3CPU
, "Calling suspend on Thread Context %d\n",

103 
	`th»adId
());

105 ià(
th»ad
->
	`¡©us
(è=ğ
Th»adCÚ‹xt
::
Su¥’ded
)

108 
th»ad
->
Ï¡Aùiv©e
 = 
	`curTick
();

109 
th»ad
->
Ï¡Su¥’d
 = 
	`curTick
();

111 
th»ad
->
	`£tStus
(
Th»adCÚ‹xt
::
Su¥’ded
);

112 
ıu
->
	`su¥’dCÚ‹xt
(
th»ad
->
	`th»adId
());

113 
	}
}

115 
	g‹m¶©e
 <
şass
 
	gIm¶
>

117 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
	$h®t
(
Cyşes
 
d–ay
)

119 
	`DPRINTF
(
O3CPU
, "Calling halt on Thread Context %d\n",

120 
	`th»adId
());

122 ià(
th»ad
->
	`¡©us
(è=ğ
Th»adCÚ‹xt
::
H®‹d
)

125 
th»ad
->
	`£tStus
(
Th»adCÚ‹xt
::
H®‹d
);

126 
ıu
->
	`h®tCÚ‹xt
(
th»ad
->
	`th»adId
());

127 
	}
}

129 
	g‹m¶©e
 <
şass
 
	gIm¶
>

131 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
»gSts
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
)

133 ià(
FuÎSy¡em
) {

134 
th»ad
->
k”ÃlSts
 = 
Ãw
 
TheISA
::
K”Ãl
::
Sti¡ics
(
ıu
->
sy¡em
);

135 
	gth»ad
->
	gk”ÃlSts
->
»gSts
(
Çme
 + ".kern");

139 
	g‹m¶©e
 <
şass
 
	gIm¶
>

140 
Tick


141 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
	$»adLa¡Aùiv©e
()

143  
th»ad
->
Ï¡Aùiv©e
;

144 
	}
}

146 
	g‹m¶©e
 <
şass
 
	gIm¶
>

147 
Tick


148 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
	$»adLa¡Su¥’d
()

150  
th»ad
->
Ï¡Su¥’d
;

151 
	}
}

153 
	g‹m¶©e
 <
şass
 
	gIm¶
>

155 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
	$´ofeCË¬
()

157 
th»ad
->
	`´ofeCË¬
();

158 
	}
}

160 
	g‹m¶©e
 <
şass
 
	gIm¶
>

162 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
	$´ofeSam¶e
()

164 
th»ad
->
	`´ofeSam¶e
();

165 
	}
}

167 
	g‹m¶©e
 <
şass
 
	gIm¶
>

169 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
	$cİyArchRegs
(
Th»adCÚ‹xt
 *
tc
)

172 
th»ad
->
noSquashFromTC
 = 
Œue
;

173 
TheISA
::
	`cİyRegs
(
tc
, 
this
);

174 
th»ad
->
noSquashFromTC
 = 
çl£
;

176 ià(!
FuÎSy¡em
)

177 
this
->
th»ad
->
funcExeIn¡
 = 
tc
->
	`»adFuncExeIn¡
();

178 
	}
}

180 
	g‹m¶©e
 <
şass
 
	gIm¶
>

182 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
	$ş—rArchRegs
()

184 
ıu
->
i§
[
th»ad
->
	`th»adId
()]->
	`ş—r
();

185 
	}
}

187 
	g‹m¶©e
 <
şass
 
	gIm¶
>

188 
ušt64_t


189 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
	$»adIÁRegFÏt
(
»g_idx
)

191  
ıu
->
	`»adArchIÁReg
(
»g_idx
, 
th»ad
->
	`th»adId
());

192 
	}
}

194 
	g‹m¶©e
 <
şass
 
	gIm¶
>

195 
	gTheISA
::
FlßtReg


196 
O3Th»adCÚ‹xt
<
Im¶
>::
	$»adFlßtRegFÏt
(
»g_idx
)

198  
ıu
->
	`»adArchFlßtReg
(
»g_idx
, 
th»ad
->
	`th»adId
());

199 
	}
}

201 
	g‹m¶©e
 <
şass
 
	gIm¶
>

202 
	gTheISA
::
FlßtRegB™s


203 
O3Th»adCÚ‹xt
<
Im¶
>::
	$»adFlßtRegB™sFÏt
(
»g_idx
)

205  
ıu
->
	`»adArchFlßtRegIÁ
(
»g_idx
, 
th»ad
->
	`th»adId
());

206 
	}
}

208 
	g‹m¶©e
 <
şass
 
	gIm¶
>

210 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
	$£tIÁRegFÏt
(
»g_idx
, 
ušt64_t
 
v®
)

212 
ıu
->
	`£tArchIÁReg
(
»g_idx
, 
v®
, 
th»ad
->
	`th»adId
());

214 
	`cÚd™iÚ®Squash
();

215 
	}
}

217 
	g‹m¶©e
 <
şass
 
	gIm¶
>

219 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
	$£tFlßtRegFÏt
(
»g_idx
, 
FlßtReg
 
v®
)

221 
ıu
->
	`£tArchFlßtReg
(
»g_idx
, 
v®
, 
th»ad
->
	`th»adId
());

223 
	`cÚd™iÚ®Squash
();

224 
	}
}

226 
	g‹m¶©e
 <
şass
 
	gIm¶
>

228 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
	$£tFlßtRegB™sFÏt
(
»g_idx
, 
FlßtRegB™s
 
v®
)

230 
ıu
->
	`£tArchFlßtRegIÁ
(
»g_idx
, 
v®
, 
th»ad
->
	`th»adId
());

232 
	`cÚd™iÚ®Squash
();

233 
	}
}

235 
	g‹m¶©e
 <
şass
 
	gIm¶
>

237 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
pcS‹
(cÚ¡ 
TheISA
::
PCS‹
 &
v®
)

239 
ıu
->
pcS‹
(
v®
, 
th»ad
->
th»adId
());

241 
cÚd™iÚ®Squash
();

244 
	g‹m¶©e
 <
şass
 
	gIm¶
>

246 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
pcS‹NoRecÜd
(cÚ¡ 
TheISA
::
PCS‹
 &
v®
)

248 
ıu
->
pcS‹
(
v®
, 
th»ad
->
th»adId
());

250 
cÚd™iÚ®Squash
();

253 
	g‹m¶©e
 <
şass
 
	gIm¶
>

255 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
	$æ©‹nIÁIndex
(
»g
)

257  
ıu
->
i§
[
th»ad
->
	`th»adId
()]->
	`æ©‹nIÁIndex
(
»g
);

258 
	}
}

260 
	g‹m¶©e
 <
şass
 
	gIm¶
>

262 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
	$æ©‹nFlßtIndex
(
»g
)

264  
ıu
->
i§
[
th»ad
->
	`th»adId
()]->
	`æ©‹nFlßtIndex
(
»g
);

265 
	}
}

267 
	g‹m¶©e
 <
şass
 
	gIm¶
>

269 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
	$£tMiscRegNoEfãù
(
misc_»g
, cÚ¡ 
MiscReg
 &
v®
)

271 
ıu
->
	`£tMiscRegNoEfãù
(
misc_»g
, 
v®
, 
th»ad
->
	`th»adId
());

273 
	`cÚd™iÚ®Squash
();

274 
	}
}

276 
	g‹m¶©e
 <
şass
 
	gIm¶
>

278 
	gO3Th»adCÚ‹xt
<
	gIm¶
>::
	$£tMiscReg
(
misc_»g
, cÚ¡ 
MiscReg
 &
v®
)

280 
ıu
->
	`£tMiscReg
(
misc_»g
, 
v®
, 
th»ad
->
	`th»adId
());

282 
	`cÚd™iÚ®Squash
();

283 
	}
}

	@thread_state.hh

43 #iâdeà
__CPU_O3_THREAD_STATE_HH__


44 
	#__CPU_O3_THREAD_STATE_HH__


	)

46 
	~"ba£/ÿÎback.hh
"

47 
	~"ba£/ouut.hh
"

48 
	~"ıu/th»ad_cÚ‹xt.hh
"

49 
	~"ıu/th»ad_¡©e.hh
"

50 
	~"sim/fuÎ_sy¡em.hh
"

51 
	~"sim/sim_ex™.hh
"

53 
şass
 
	gEndQu›sûEv’t
;

54 
şass
 
	gEv’t
;

55 
şass
 
	gFunùiÚ®MemÜy
;

56 
şass
 
	gFunùiÚProfe
;

57 
şass
 
	gProûss
;

58 
şass
 
	gProfeNode
;

67 
	g‹m¶©e
 <
şass
 
	gIm¶
>

68 
	gO3Th»adS‹
 : 
public
 
Th»adS‹
 {

69 
Th»adCÚ‹xt
::
	tStus
 Status;

70 
ty³Çme
 
	tIm¶
::
	tO3CPU
 O3CPU;

72 
	g´iv©e
:

74 
O3CPU
 *
ıu
;

75 
	gpublic
:

84 
boŞ
 
noSquashFromTC
;

89 
boŞ
 
	gŒ­P’dšg
;

91 
O3Th»adS‹
(
O3CPU
 *
_ıu
, 
_th»ad_num
, 
Proûss
 *
_´oûss
)

92 : 
Th»adS‹
(
_ıu
, 
_th»ad_num
, 
_´oûss
),

93 
ıu
(
_ıu
), 
noSquashFromTC
(
çl£
), 
Œ­P’dšg
(false)

95 ià(!
	gFuÎSy¡em
)

98 ià(
	gıu
->
·¿ms
()->
	g´ofe
) {

99 
	g´ofe
 = 
Ãw
 
FunùiÚProfe
(

100 
ıu
->
·¿ms
()->
sy¡em
->
k”ÃlSymb
);

101 
C®lback
 *
	gcb
 =

102 
Ãw
 
MakeC®lback
<
O3Th»adS‹
,

103 &
	gO3Th»adS‹
::
dumpFuncProfe
>(
this
);

104 
»gi¡”Ex™C®lback
(
cb
);

109 
ProfeNode
 
	gdummyNode
;

110 
	g´ofeNode
 = &
dummyNode
;

111 
	g´ofePC
 = 3;

114 
£rŸlize
(
¡d
::
o¡»am
 &
os
)

116 
Th»adS‹
::
£rŸlize
(
os
);

119 ::
£rŸlize
(*
tc
, 
os
);

122 
un£rŸlize
(
Checkpošt
 *
ı
, cÚ¡ 
¡d
::
¡ršg
 &
£ùiÚ
)

127 
noSquashFromTC
 = 
Œue
;

128 
	gTh»adS‹
::
un£rŸlize
(
ı
, 
£ùiÚ
);

131 ::
un£rŸlize
(*
tc
, 
ı
, 
£ùiÚ
);

132 
	gnoSquashFromTC
 = 
çl£
;

136 
Th»adCÚ‹xt
 *
	gtc
;

139 
Th»adCÚ‹xt
 *
g‘TC
(è{  
	gtc
; }

142 
sysÿÎ
(
št64_t
 
ÿÎnum
è{ 
	g´oûss
->sysÿÎ(ÿÎnum, 
tc
); }

144 
dumpFuncProfe
()

146 
	g¡d
::
o¡»am
 *
os
 = 
simout
.
ü—‹
(
c¥rštf
("´ofe.%s.d©", 
ıu
->
Çme
()));

147 
	g´ofe
->
dump
(
tc
, *
os
);

	@../base.hh

46 #iâdeà
__CPU_BASE_HH__


47 
	#__CPU_BASE_HH__


	)

49 
	~<veùÜ
>

51 
	~"¬ch/š‹¼u±s.hh
"

52 
	~"¬ch/i§_Œa™s.hh
"

53 
	~"¬ch/miüocode_rom.hh
"

54 
	~"ba£/¡©i¡ics.hh
"

55 
	~"cÚfig/the_i§.hh
"

56 
	~"mem/mem_objeù.hh
"

57 
	~"sim/ev’tq.hh
"

58 
	~"sim/fuÎ_sy¡em.hh
"

59 
	~"sim/š¡Œaûr.hh
"

61 
	gBa£CPUP¬ams
;

62 
şass
 
	gB¿nchP»d
;

63 
şass
 
	gCheck”CPU
;

64 
şass
 
	gTh»adCÚ‹xt
;

65 
şass
 
	gSy¡em
;

67 şas 
	cCPUProg»ssEv’t
 : 
public
 
Ev’t


69 
´Ùeùed
:

70 
Tick
 
_š‹rv®
;

71 
CouÁ”
 
	mÏ¡NumIn¡
;

72 
Ba£CPU
 *
	mıu
;

73 
boŞ
 
	m_»³©Ev’t
;

75 
	mpublic
:

76 
CPUProg»ssEv’t
(
Ba£CPU
 *
_ıu
, 
Tick
 
iv®
 = 0);

78 
´oûss
();

80 
	$š‹rv®
(
Tick
 
iv®
è{ 
_š‹rv®
 = ival; }

81 
Tick
 
	$š‹rv®
(è{  
_š‹rv®
; 
	}
}

83 
	$»³©Ev’t
(
boŞ
 
»³©
è{ 
_»³©Ev’t
 =„•—t; 
	}
}

85 
vœtu®
 cÚ¡ *
	$desütiÚ
() const;

86 
	}
};

88 
şass
 
	gBa£CPU
 : 
public
 
MemObjeù
,…ubliø
	gMa¡”Objeù


90 
	g´iv©e
:

92 
¡d
::
¡ršg
 
objeùId
;

94 
	g´Ùeùed
:

97 
Tick
 
š¡CÁ
;

102 
	g_ıuId
;

105 
Ma¡”ID
 
	g_š¡Ma¡”Id
;

108 
Ma¡”ID
 
	g_d©aMa¡”Id
;

115 
ušt32_t
 
	g_skId
;

119 
ušt32_t
 
	g_pid
;

122 
boŞ
 
	g_sw™chedOut
;

132 şas 
	cCpuPÜt
 : 
public
 
Ma¡”PÜt


134 
public
:

142 
CpuPÜt
(cÚ¡ 
¡d
::
¡ršg
& 
_Çme
, 
MemObjeù
* 
_owÃr
) :

143 
Ma¡”PÜt
(
_Çme
, 
_owÃr
)

146 
	g´Ùeùed
:

148 
vœtu®
 
boŞ
 
»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
);

150 
vœtu®
 
»cvR‘ry
();

152 
vœtu®
 
»cvFunùiÚ®Snoİ
(
Pack‘PŒ
 
pkt
);

156 
	gpublic
:

158 
vœtu®
 
¡d
::
¡ršg
 
	$g‘ObjeùId
() const

160  
objeùId
;

161 
	}
}

163 
vœtu®
 
	$chªgeP”iod
(
Tick
 
³riod
)

166 
ClockedObjeù
::
	`chªgeP”iod
(
³riod
);

173 if(
	`curTick
()!=
	`şockEdge
()) ;

176 
	`chªgeSÏveObjeùP”iod
(
³riod
);

177 
	}
}

185 
vœtu®
 
	gCpuPÜt
 &
g‘D©aPÜt
() = 0;

193 
vœtu®
 
	gCpuPÜt
 &
g‘In¡PÜt
() = 0;

196 
	$ıuId
(è{  
_ıuId
; 
	}
}

199 
Ma¡”ID
 
	$d©aMa¡”Id
(è{  
_d©aMa¡”Id
; 
	}
}

201 
Ma¡”ID
 
	$š¡Ma¡”Id
(è{  
_š¡Ma¡”Id
; 
	}
}

213 
	gBa£Ma¡”PÜt
 &
g‘Ma¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
 &
if_Çme
,

214 
PÜtID
 
idx
 = 
Inv®idPÜtID
);

217 
ušt32_t
 
	$skId
(ècÚ¡ {  
_skId
; 
	}
}

219 
	$skId
(
ušt32_t
 
id
è{ 
_skId
 = id; 
	}
}

221 
ušt32_t
 
	$g‘Pid
(ècÚ¡ {  
_pid
; 
	}
}

222 
	$£tPid
(
ušt32_t
 
pid
è{ 
_pid
 =…id; 
	}
}

224 
šlše
 
	$wÜkI‹mBegš
(è{ 
numWÜkI‹msS¹ed
++; 
	}
}

225 
šlše
 
	$wÜkI‹mEnd
(è{ 
numWÜkI‹msCom¶‘ed
++; 
	}
}

227 
Tick
 
	$š¡CouÁ
(è{  
š¡CÁ
; 
	}
}

229 
	gTheISA
::
MiüocodeRom
 
miüocodeRom
;

231 
	g´Ùeùed
:

232 
TheISA
::
IÁ”ru±s
 *
š‹¼u±s
;

234 
	gpublic
:

235 
TheISA
::
IÁ”ru±s
 *

236 
	$g‘IÁ”ru±CÚŒŞËr
()

238  
š‹¼u±s
;

239 
	}
}

241 
vœtu®
 
wakeup
() = 0;

244 
	$po¡IÁ”ru±
(
št_num
, 
šdex
)

246 
š‹¼u±s
->
	`po¡
(
št_num
, 
šdex
);

247 ià(
FuÎSy¡em
)

248 
	`wakeup
();

249 
	}
}

252 
	$ş—rIÁ”ru±
(
št_num
, 
šdex
)

254 
š‹¼u±s
->
	`ş—r
(
št_num
, 
šdex
);

255 
	}
}

258 
	$ş—rIÁ”ru±s
()

260 
š‹¼u±s
->
	`ş—rAÎ
();

261 
	}
}

263 
boŞ


264 
	$checkIÁ”ru±s
(
Th»adCÚ‹xt
 *
tc
) const

266  
FuÎSy¡em
 && 
š‹¼u±s
->
	`checkIÁ”ru±s
(
tc
);

267 
	}
}

269 şas 
	cProfeEv’t
 : 
public
 
Ev’t


271 
´iv©e
:

272 
Ba£CPU
 *
ıu
;

273 
Tick
 
	gš‹rv®
;

275 
	gpublic
:

276 
ProfeEv’t
(
Ba£CPU
 *
ıu
, 
Tick
 
š‹rv®
);

277 
´oûss
();

279 
ProfeEv’t
 *
	g´ofeEv’t
;

281 
	g´Ùeùed
:

282 
¡d
::
veùÜ
<
Th»adCÚ‹xt
 *> 
th»adCÚ‹xts
;

284 
	gT¿û
::
In¡T¿ûr
 * 
Œaûr
;

286 
	gpublic
:

289 cÚ¡ 
Addr
 
PCMask
 = ~((Addr)(
TheISA
::
MachIn¡
) - 1);

292 
	gT¿û
::
In¡T¿ûr
 * 
	$g‘T¿ûr
(è{  
Œaûr
; 
	}
}

297 
vœtu®
 
	$aùiv©eCÚ‹xt
(
Th»adID
 
th»ad_num
, 
Cyşes
 
d–ay
è{
	}
}

300 
vœtu®
 
	$su¥’dCÚ‹xt
(
Th»adID
 
th»ad_num
è{
	}
}

303 
vœtu®
 
	$d—Îoÿ‹CÚ‹xt
(
Th»adID
 
th»ad_num
è{
	}
}

306 
vœtu®
 
	$h®tCÚ‹xt
(
Th»adID
 
th»ad_num
è{
	}
}

309 
fšdCÚ‹xt
(
Th»adCÚ‹xt
 *
tc
);

312 
Th»adCÚ‹xt
 *
	$g‘CÚ‹xt
(
Š
è{  
th»adCÚ‹xts
[Š]; 
	}
}

314 
	gpublic
:

315 
Ba£CPUP¬ams
 
	tP¬ams
;

316 cÚ¡ 
P¬ams
 *
	$·¿ms
() const

317 {  
»š‹½»t_ÿ¡
<cÚ¡ 
P¬ams
 *>(
_·¿ms
); 
	}
}

318 
Ba£CPU
(
P¬ams
 *
·¿ms
, 
boŞ
 
is_check”
 = 
çl£
);

319 
	gvœtu®
 ~
Ba£CPU
();

321 
vœtu®
 
š™
();

322 
vœtu®
 
¡¬tup
();

323 
vœtu®
 
»gSts
();

325 
vœtu®
 
	$aùiv©eWh’R—dy
(
Th»adID
 
tid
è{
	}
};

327 
»gi¡”Th»adCÚ‹xts
();

336 
vœtu®
 
sw™chOut
();

349 
vœtu®
 
keOv”From
(
Ba£CPU
 *
ıu
);

360 
æushTLBs
();

367 
boŞ
 
	$sw™chedOut
(ècÚ¡ {  
_sw™chedOut
; 
	}
}

373 
Th»adID
 
	gnumTh»ads
;

380 
Ev’tQueue
 **
	gcomIn¡Ev’tQueue
;

387 
Ev’tQueue
 **
	gcomLßdEv’tQueue
;

389 
Sy¡em
 *
	gsy¡em
;

401 
vœtu®
 
£rŸlize
(
¡d
::
o¡»am
 &
os
);

414 
vœtu®
 
un£rŸlize
(
Checkpošt
 *
ı
, cÚ¡ 
¡d
::
¡ršg
 &
£ùiÚ
);

422 
vœtu®
 
£rŸlizeTh»ad
(
¡d
::
o¡»am
 &
os
, 
Th»adID
 
tid
) {};

431 
vœtu®
 
un£rŸlizeTh»ad
(
Checkpošt
 *
ı
, cÚ¡ 
¡d
::
¡ršg
 &
£ùiÚ
,

432 
Th»adID
 
tid
) {};

438 
vœtu®
 
B¿nchP»d
 *
	$g‘B¿nchP»d
(è{  
NULL
; 
	}
};

440 
vœtu®
 
CouÁ”
 
	$tÙ®In¡s
() const = 0;

442 
vœtu®
 
CouÁ”
 
	$tÙ®Ops
() const = 0;

445 
´iv©e
:

446 
boŞ
 
funùiÚT¿cšgEÇbËd
;

447 
¡d
::
o¡»am
 *
funùiÚT¿ûSŒ—m
;

448 
Addr
 
cu¼’tFunùiÚS¹
;

449 
Addr
 
cu¼’tFunùiÚEnd
;

450 
Tick
 
funùiÚEÁryTick
;

451 
	`’abËFunùiÚT¿û
();

452 
	`ŒaûFunùiÚsIÁ”Çl
(
Addr
 
pc
);

454 
´iv©e
:

455 
¡d
::
veùÜ
<
Ba£CPU
 *> 
ıuLi¡
;

457 
public
:

458 
	$ŒaûFunùiÚs
(
Addr
 
pc
)

460 ià(
funùiÚT¿cšgEÇbËd
)

461 
	`ŒaûFunùiÚsIÁ”Çl
(
pc
);

462 
	}
}

464 
	$numSimuÏ‹dCPUs
(è{  
ıuLi¡
.
	`size
(); 
	}
}

465 
CouÁ”
 
	$numSimuÏ‹dIn¡s
()

467 
CouÁ”
 
tÙ®
 = 0;

469 
size
 = 
ıuLi¡
.
	`size
();

470 
i
 = 0; i < 
size
; ++i)

471 
tÙ®
 +ğ
ıuLi¡
[
i
]->
	`tÙ®In¡s
();

473  
tÙ®
;

474 
	}
}

476 
CouÁ”
 
	$numSimuÏ‹dOps
()

478 
CouÁ”
 
tÙ®
 = 0;

480 
size
 = 
ıuLi¡
.
	`size
();

481 
i
 = 0; i < 
size
; ++i)

482 
tÙ®
 +ğ
ıuLi¡
[
i
]->
	`tÙ®Ops
();

484  
tÙ®
;

485 
	}
}

487 
	gpublic
:

489 
Sts
::
SÿÏr
 
numCyşes
;

490 
	gSts
::
SÿÏr
 
numWÜkI‹msS¹ed
;

491 
	gSts
::
SÿÏr
 
numWÜkI‹msCom¶‘ed
;

	@
1
.
1
/usr/include
68
870
DVFSPolicyO3Core.cc
DVFSPolicyO3Core.h
base_dyn_inst.cc
bpred_unit.cc
bpred_unit.hh
bpred_unit_impl.hh
checker.cc
checker.hh
comm.hh
commit.cc
commit.hh
commit_impl.hh
cpu.cc
cpu.hh
cpu_policy.hh
decode.cc
decode.hh
decode_impl.hh
dep_graph.hh
deriv.cc
deriv.hh
dyn_inst.cc
dyn_inst.hh
dyn_inst_impl.hh
fetch.cc
fetch.hh
fetch_impl.hh
free_list.cc
free_list.hh
fu_pool.cc
fu_pool.hh
iew.cc
iew.hh
iew_impl.hh
impl.hh
inst_queue.cc
inst_queue.hh
inst_queue_impl.hh
isa_specific.hh
lsq.cc
lsq.hh
lsq_impl.hh
lsq_unit.cc
lsq_unit.hh
lsq_unit_impl.hh
mem_dep_unit.cc
mem_dep_unit.hh
mem_dep_unit_impl.hh
regfile.hh
rename.cc
rename.hh
rename_impl.hh
rename_map.cc
rename_map.hh
rob.cc
rob.hh
rob_impl.hh
sat_counter.cc
sat_counter.hh
scoreboard.cc
scoreboard.hh
store_set.cc
store_set.hh
thread_context.cc
thread_context.hh
thread_context_impl.hh
thread_state.hh
../base.hh
